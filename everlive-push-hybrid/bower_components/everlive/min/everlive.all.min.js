/*
The MIT License (MIT)

Copyright (c) 2016 Telerik AD

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.y distributed under the MIT license.

Everlive SDK Version: 1.7.0
*/
!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.Everlive=a()}}(function(){var define,module,exports;return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){(function(a){/*!
 * async
 * https://github.com/caolan/async
 *
 * Copyright 2010-2014 Caolan McMahon
 * Released under the MIT license
 */
!function(){function c(a){var b=!1;return function(){if(b)throw new Error("Callback was already called.");b=!0,a.apply(d,arguments)}}var d,e,f={};d=this,null!=d&&(e=d.async),f.noConflict=function(){return d.async=e,f};var g=Object.prototype.toString,h=Array.isArray||function(a){return"[object Array]"===g.call(a)},i=function(a,b){for(var c=0;c<a.length;c+=1)b(a[c],c,a)},j=function(a,b){if(a.map)return a.map(b);var c=[];return i(a,function(a,d,e){c.push(b(a,d,e))}),c},k=function(a,b,c){return a.reduce?a.reduce(b,c):(i(a,function(a,d,e){c=b(c,a,d,e)}),c)},l=function(a){if(Object.keys)return Object.keys(a);var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c);return b};"undefined"!=typeof a&&a.nextTick?(f.nextTick=a.nextTick,f.setImmediate="undefined"!=typeof setImmediate?function(a){setImmediate(a)}:f.nextTick):"function"==typeof setImmediate?(f.nextTick=function(a){setImmediate(a)},f.setImmediate=f.nextTick):(f.nextTick=function(a){setTimeout(a,0)},f.setImmediate=f.nextTick),f.each=function(a,b,d){function e(b){b?(d(b),d=function(){}):(f+=1,f>=a.length&&d())}if(d=d||function(){},!a.length)return d();var f=0;i(a,function(a){b(a,c(e))})},f.forEach=f.each,f.eachSeries=function(a,b,c){if(c=c||function(){},!a.length)return c();var d=0,e=function(){b(a[d],function(b){b?(c(b),c=function(){}):(d+=1,d>=a.length?c():e())})};e()},f.forEachSeries=f.eachSeries,f.eachLimit=function(a,b,c,d){var e=m(b);e.apply(null,[a,c,d])},f.forEachLimit=f.eachLimit;var m=function(a){return function(b,c,d){if(d=d||function(){},!b.length||0>=a)return d();var e=0,f=0,g=0;!function h(){if(e>=b.length)return d();for(;a>g&&f<b.length;)f+=1,g+=1,c(b[f-1],function(a){a?(d(a),d=function(){}):(e+=1,g-=1,e>=b.length?d():h())})}()}},n=function(a){return function(){var b=Array.prototype.slice.call(arguments);return a.apply(null,[f.each].concat(b))}},o=function(a,b){return function(){var c=Array.prototype.slice.call(arguments);return b.apply(null,[m(a)].concat(c))}},p=function(a){return function(){var b=Array.prototype.slice.call(arguments);return a.apply(null,[f.eachSeries].concat(b))}},q=function(a,b,c,d){if(b=j(b,function(a,b){return{index:b,value:a}}),d){var e=[];a(b,function(a,b){c(a.value,function(c,d){e[a.index]=d,b(c)})},function(a){d(a,e)})}else a(b,function(a,b){c(a.value,function(a){b(a)})})};f.map=n(q),f.mapSeries=p(q),f.mapLimit=function(a,b,c,d){return r(b)(a,c,d)};var r=function(a){return o(a,q)};f.reduce=function(a,b,c,d){f.eachSeries(a,function(a,d){c(b,a,function(a,c){b=c,d(a)})},function(a){d(a,b)})},f.inject=f.reduce,f.foldl=f.reduce,f.reduceRight=function(a,b,c,d){var e=j(a,function(a){return a}).reverse();f.reduce(e,b,c,d)},f.foldr=f.reduceRight;var s=function(a,b,c,d){var e=[];b=j(b,function(a,b){return{index:b,value:a}}),a(b,function(a,b){c(a.value,function(c){c&&e.push(a),b()})},function(){d(j(e.sort(function(a,b){return a.index-b.index}),function(a){return a.value}))})};f.filter=n(s),f.filterSeries=p(s),f.select=f.filter,f.selectSeries=f.filterSeries;var t=function(a,b,c,d){var e=[];b=j(b,function(a,b){return{index:b,value:a}}),a(b,function(a,b){c(a.value,function(c){c||e.push(a),b()})},function(){d(j(e.sort(function(a,b){return a.index-b.index}),function(a){return a.value}))})};f.reject=n(t),f.rejectSeries=p(t);var u=function(a,b,c,d){a(b,function(a,b){c(a,function(c){c?(d(a),d=function(){}):b()})},function(){d()})};f.detect=n(u),f.detectSeries=p(u),f.some=function(a,b,c){f.each(a,function(a,d){b(a,function(a){a&&(c(!0),c=function(){}),d()})},function(){c(!1)})},f.any=f.some,f.every=function(a,b,c){f.each(a,function(a,d){b(a,function(a){a||(c(!1),c=function(){}),d()})},function(){c(!0)})},f.all=f.every,f.sortBy=function(a,b,c){f.map(a,function(a,c){b(a,function(b,d){b?c(b):c(null,{value:a,criteria:d})})},function(a,b){if(a)return c(a);var d=function(a,b){var c=a.criteria,d=b.criteria;return d>c?-1:c>d?1:0};c(null,j(b.sort(d),function(a){return a.value}))})},f.auto=function(a,b){b=b||function(){};var c=l(a),d=c.length;if(!d)return b();var e={},g=[],j=function(a){g.unshift(a)},m=function(a){for(var b=0;b<g.length;b+=1)if(g[b]===a)return void g.splice(b,1)},n=function(){d--,i(g.slice(0),function(a){a()})};j(function(){if(!d){var a=b;b=function(){},a(null,e)}}),i(c,function(c){var d=h(a[c])?a[c]:[a[c]],g=function(a){var d=Array.prototype.slice.call(arguments,1);if(d.length<=1&&(d=d[0]),a){var g={};i(l(e),function(a){g[a]=e[a]}),g[c]=d,b(a,g),b=function(){}}else e[c]=d,f.setImmediate(n)},o=d.slice(0,Math.abs(d.length-1))||[],p=function(){return k(o,function(a,b){return a&&e.hasOwnProperty(b)},!0)&&!e.hasOwnProperty(c)};if(p())d[d.length-1](g,e);else{var q=function(){p()&&(m(q),d[d.length-1](g,e))};j(q)}})},f.retry=function(a,b,c){var d=5,e=[];"function"==typeof a&&(c=b,b=a,a=d),a=parseInt(a,10)||d;var g=function(d,g){for(var h=function(a,b){return function(c){a(function(a,d){c(!a||b,{err:a,result:d})},g)}};a;)e.push(h(b,!(a-=1)));f.series(e,function(a,b){b=b[b.length-1],(d||c)(b.err,b.result)})};return c?g():g},f.waterfall=function(a,b){if(b=b||function(){},!h(a)){var c=new Error("First argument to waterfall must be an array of functions");return b(c)}if(!a.length)return b();var d=function(a){return function(c){if(c)b.apply(null,arguments),b=function(){};else{var e=Array.prototype.slice.call(arguments,1),g=a.next();e.push(g?d(g):b),f.setImmediate(function(){a.apply(null,e)})}}};d(f.iterator(a))()};var v=function(a,b,c){if(c=c||function(){},h(b))a.map(b,function(a,b){a&&a(function(a){var c=Array.prototype.slice.call(arguments,1);c.length<=1&&(c=c[0]),b.call(null,a,c)})},c);else{var d={};a.each(l(b),function(a,c){b[a](function(b){var e=Array.prototype.slice.call(arguments,1);e.length<=1&&(e=e[0]),d[a]=e,c(b)})},function(a){c(a,d)})}};f.parallel=function(a,b){v({map:f.map,each:f.each},a,b)},f.parallelLimit=function(a,b,c){v({map:r(b),each:m(b)},a,c)},f.series=function(a,b){if(b=b||function(){},h(a))f.mapSeries(a,function(a,b){a&&a(function(a){var c=Array.prototype.slice.call(arguments,1);c.length<=1&&(c=c[0]),b.call(null,a,c)})},b);else{var c={};f.eachSeries(l(a),function(b,d){a[b](function(a){var e=Array.prototype.slice.call(arguments,1);e.length<=1&&(e=e[0]),c[b]=e,d(a)})},function(a){b(a,c)})}},f.iterator=function(a){var b=function(c){var d=function(){return a.length&&a[c].apply(null,arguments),d.next()};return d.next=function(){return c<a.length-1?b(c+1):null},d};return b(0)},f.apply=function(a){var b=Array.prototype.slice.call(arguments,1);return function(){return a.apply(null,b.concat(Array.prototype.slice.call(arguments)))}};var w=function(a,b,c,d){var e=[];a(b,function(a,b){c(a,function(a,c){e=e.concat(c||[]),b(a)})},function(a){d(a,e)})};f.concat=n(w),f.concatSeries=p(w),f.whilst=function(a,b,c){a()?b(function(d){return d?c(d):void f.whilst(a,b,c)}):c()},f.doWhilst=function(a,b,c){a(function(d){if(d)return c(d);var e=Array.prototype.slice.call(arguments,1);b.apply(null,e)?f.doWhilst(a,b,c):c()})},f.until=function(a,b,c){a()?c():b(function(d){return d?c(d):void f.until(a,b,c)})},f.doUntil=function(a,b,c){a(function(d){if(d)return c(d);var e=Array.prototype.slice.call(arguments,1);b.apply(null,e)?c():f.doUntil(a,b,c)})},f.queue=function(a,b){function d(a,b,c,d){return a.started||(a.started=!0),h(b)||(b=[b]),0==b.length?f.setImmediate(function(){a.drain&&a.drain()}):void i(b,function(b){var e={data:b,callback:"function"==typeof d?d:null};c?a.tasks.unshift(e):a.tasks.push(e),a.saturated&&a.tasks.length===a.concurrency&&a.saturated(),f.setImmediate(a.process)})}void 0===b&&(b=1);var e=0,g={tasks:[],concurrency:b,saturated:null,empty:null,drain:null,started:!1,paused:!1,push:function(a,b){d(g,a,!1,b)},kill:function(){g.drain=null,g.tasks=[]},unshift:function(a,b){d(g,a,!0,b)},process:function(){if(!g.paused&&e<g.concurrency&&g.tasks.length){var b=g.tasks.shift();g.empty&&0===g.tasks.length&&g.empty(),e+=1;var d=function(){e-=1,b.callback&&b.callback.apply(b,arguments),g.drain&&g.tasks.length+e===0&&g.drain(),g.process()},f=c(d);a(b.data,f)}},length:function(){return g.tasks.length},running:function(){return e},idle:function(){return g.tasks.length+e===0},pause:function(){g.paused!==!0&&(g.paused=!0)},resume:function(){if(g.paused!==!1){g.paused=!1;for(var a=1;a<=g.concurrency;a++)f.setImmediate(g.process)}}};return g},f.priorityQueue=function(a,b){function c(a,b){return a.priority-b.priority}function d(a,b,c){for(var d=-1,e=a.length-1;e>d;){var f=d+(e-d+1>>>1);c(b,a[f])>=0?d=f:e=f-1}return d}function e(a,b,e,g){return a.started||(a.started=!0),h(b)||(b=[b]),0==b.length?f.setImmediate(function(){a.drain&&a.drain()}):void i(b,function(b){var h={data:b,priority:e,callback:"function"==typeof g?g:null};a.tasks.splice(d(a.tasks,h,c)+1,0,h),a.saturated&&a.tasks.length===a.concurrency&&a.saturated(),f.setImmediate(a.process)})}var g=f.queue(a,b);return g.push=function(a,b,c){e(g,a,b,c)},delete g.unshift,g},f.cargo=function(a,b){var c=!1,d=[],e={tasks:d,payload:b,saturated:null,empty:null,drain:null,drained:!0,push:function(a,c){h(a)||(a=[a]),i(a,function(a){d.push({data:a,callback:"function"==typeof c?c:null}),e.drained=!1,e.saturated&&d.length===b&&e.saturated()}),f.setImmediate(e.process)},process:function g(){if(!c){if(0===d.length)return e.drain&&!e.drained&&e.drain(),void(e.drained=!0);var f="number"==typeof b?d.splice(0,b):d.splice(0,d.length),h=j(f,function(a){return a.data});e.empty&&e.empty(),c=!0,a(h,function(){c=!1;var a=arguments;i(f,function(b){b.callback&&b.callback.apply(null,a)}),g()})}},length:function(){return d.length},running:function(){return c}};return e};var x=function(a){return function(b){var c=Array.prototype.slice.call(arguments,1);b.apply(null,c.concat([function(b){var c=Array.prototype.slice.call(arguments,1);"undefined"!=typeof console&&(b?console.error&&console.error(b):console[a]&&i(c,function(b){console[a](b)}))}]))}};f.log=x("log"),f.dir=x("dir"),f.memoize=function(a,b){var c={},d={};b=b||function(a){return a};var e=function(){var e=Array.prototype.slice.call(arguments),g=e.pop(),h=b.apply(null,e);h in c?f.nextTick(function(){g.apply(null,c[h])}):h in d?d[h].push(g):(d[h]=[g],a.apply(null,e.concat([function(){c[h]=arguments;var a=d[h];delete d[h];for(var b=0,e=a.length;e>b;b++)a[b].apply(null,arguments)}])))};return e.memo=c,e.unmemoized=a,e},f.unmemoize=function(a){return function(){return(a.unmemoized||a).apply(null,arguments)}},f.times=function(a,b,c){for(var d=[],e=0;a>e;e++)d.push(e);return f.map(d,b,c)},f.timesSeries=function(a,b,c){for(var d=[],e=0;a>e;e++)d.push(e);return f.mapSeries(d,b,c)},f.seq=function(){var a=arguments;return function(){var b=this,c=Array.prototype.slice.call(arguments),d=c.pop();f.reduce(a,c,function(a,c,d){c.apply(b,a.concat([function(){var a=arguments[0],b=Array.prototype.slice.call(arguments,1);d(a,b)}]))},function(a,c){d.apply(b,[a].concat(c))})}},f.compose=function(){return f.seq.apply(null,Array.prototype.reverse.call(arguments))};var y=function(a,b){var c=function(){var c=this,d=Array.prototype.slice.call(arguments),e=d.pop();return a(b,function(a,b){a.apply(c,d.concat([b]))},e)};if(arguments.length>2){var d=Array.prototype.slice.call(arguments,2);return c.apply(this,d)}return c};f.applyEach=n(y),f.applyEachSeries=p(y),f.forever=function(a,b){function c(d){if(d){if(b)return b(d);throw d}a(c)}c()},"undefined"!=typeof b&&b.exports?b.exports=f:"undefined"!=typeof define&&define.amd?define([],function(){return f}):d.async=f}()}).call(this,a("_process"))},{_process:5}],2:[function(a,b){
// Copyright Joyent, Inc. and other Node contributors.
//
// Permission is hereby granted, free of charge, to any person obtaining a
// copy of this software and associated documentation files (the
// "Software"), to deal in the Software without restriction, including
// without limitation the rights to use, copy, modify, merge, publish,
// distribute, sublicense, and/or sell copies of the Software, and to permit
// persons to whom the Software is furnished to do so, subject to the
// following conditions:
//
// The above copyright notice and this permission notice shall be included
// in all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS
// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN
// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE
// USE OR OTHER DEALINGS IN THE SOFTWARE.
function c(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function d(a){return"function"==typeof a}function e(a){return"number"==typeof a}function f(a){return"object"==typeof a&&null!==a}function g(a){return void 0===a}b.exports=c,c.EventEmitter=c,c.prototype._events=void 0,c.prototype._maxListeners=void 0,c.defaultMaxListeners=10,c.prototype.setMaxListeners=function(a){if(!e(a)||0>a||isNaN(a))throw TypeError("n must be a positive number");return this._maxListeners=a,this},c.prototype.emit=function(a){var b,c,e,h,i,j;if(this._events||(this._events={}),"error"===a&&(!this._events.error||f(this._events.error)&&!this._events.error.length)){if(b=arguments[1],b instanceof Error)throw b;throw TypeError('Uncaught, unspecified "error" event.')}if(c=this._events[a],g(c))return!1;if(d(c))switch(arguments.length){case 1:c.call(this);break;case 2:c.call(this,arguments[1]);break;case 3:c.call(this,arguments[1],arguments[2]);break;default:for(e=arguments.length,h=new Array(e-1),i=1;e>i;i++)h[i-1]=arguments[i];c.apply(this,h)}else if(f(c)){for(e=arguments.length,h=new Array(e-1),i=1;e>i;i++)h[i-1]=arguments[i];for(j=c.slice(),e=j.length,i=0;e>i;i++)j[i].apply(this,h)}return!0},c.prototype.addListener=function(a,b){var e;if(!d(b))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",a,d(b.listener)?b.listener:b),this._events[a]?f(this._events[a])?this._events[a].push(b):this._events[a]=[this._events[a],b]:this._events[a]=b,f(this._events[a])&&!this._events[a].warned){var e;e=g(this._maxListeners)?c.defaultMaxListeners:this._maxListeners,e&&e>0&&this._events[a].length>e&&(this._events[a].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[a].length),"function"==typeof console.trace&&console.trace())}return this},c.prototype.on=c.prototype.addListener,c.prototype.once=function(a,b){function c(){this.removeListener(a,c),e||(e=!0,b.apply(this,arguments))}if(!d(b))throw TypeError("listener must be a function");var e=!1;return c.listener=b,this.on(a,c),this},c.prototype.removeListener=function(a,b){var c,e,g,h;if(!d(b))throw TypeError("listener must be a function");if(!this._events||!this._events[a])return this;if(c=this._events[a],g=c.length,e=-1,c===b||d(c.listener)&&c.listener===b)delete this._events[a],this._events.removeListener&&this.emit("removeListener",a,b);else if(f(c)){for(h=g;h-->0;)if(c[h]===b||c[h].listener&&c[h].listener===b){e=h;break}if(0>e)return this;1===c.length?(c.length=0,delete this._events[a]):c.splice(e,1),this._events.removeListener&&this.emit("removeListener",a,b)}return this},c.prototype.removeAllListeners=function(a){var b,c;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[a]&&delete this._events[a],this;if(0===arguments.length){for(b in this._events)"removeListener"!==b&&this.removeAllListeners(b);return this.removeAllListeners("removeListener"),this._events={},this}if(c=this._events[a],d(c))this.removeListener(a,c);else for(;c.length;)this.removeListener(a,c[c.length-1]);return delete this._events[a],this},c.prototype.listeners=function(a){var b;return b=this._events&&this._events[a]?d(this._events[a])?[this._events[a]]:this._events[a].slice():[]},c.listenerCount=function(a,b){var c;return c=a._events&&a._events[b]?d(a._events[b])?1:a._events[b].length:0}},{}],3:[function(a,b){b.exports="function"==typeof Object.create?function(a,b){a.super_=b,a.prototype=Object.create(b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}})}:function(a,b){a.super_=b;var c=function(){};c.prototype=b.prototype,a.prototype=new c,a.prototype.constructor=a}},{}],4:[function(a,b,c){(function(a){
// Copyright Joyent, Inc. and other Node contributors.
//
// Permission is hereby granted, free of charge, to any person obtaining a
// copy of this software and associated documentation files (the
// "Software"), to deal in the Software without restriction, including
// without limitation the rights to use, copy, modify, merge, publish,
// distribute, sublicense, and/or sell copies of the Software, and to permit
// persons to whom the Software is furnished to do so, subject to the
// following conditions:
//
// The above copyright notice and this permission notice shall be included
// in all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS
// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN
// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE
// USE OR OTHER DEALINGS IN THE SOFTWARE.
function b(a,b){for(var c=0,d=a.length-1;d>=0;d--){var e=a[d];"."===e?a.splice(d,1):".."===e?(a.splice(d,1),c++):c&&(a.splice(d,1),c--)}if(b)for(;c--;c)a.unshift("..");return a}function d(a,b){if(a.filter)return a.filter(b);for(var c=[],d=0;d<a.length;d++)b(a[d],d,a)&&c.push(a[d]);return c}var e=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,f=function(a){return e.exec(a).slice(1)};c.resolve=function(){for(var c="",e=!1,f=arguments.length-1;f>=-1&&!e;f--){var g=f>=0?arguments[f]:a.cwd();if("string"!=typeof g)throw new TypeError("Arguments to path.resolve must be strings");g&&(c=g+"/"+c,e="/"===g.charAt(0))}return c=b(d(c.split("/"),function(a){return!!a}),!e).join("/"),(e?"/":"")+c||"."},c.normalize=function(a){var e=c.isAbsolute(a),f="/"===g(a,-1);return a=b(d(a.split("/"),function(a){return!!a}),!e).join("/"),a||e||(a="."),a&&f&&(a+="/"),(e?"/":"")+a},c.isAbsolute=function(a){return"/"===a.charAt(0)},c.join=function(){var a=Array.prototype.slice.call(arguments,0);return c.normalize(d(a,function(a){if("string"!=typeof a)throw new TypeError("Arguments to path.join must be strings");return a}).join("/"))},c.relative=function(a,b){function d(a){for(var b=0;b<a.length&&""===a[b];b++);for(var c=a.length-1;c>=0&&""===a[c];c--);return b>c?[]:a.slice(b,c-b+1)}a=c.resolve(a).substr(1),b=c.resolve(b).substr(1);for(var e=d(a.split("/")),f=d(b.split("/")),g=Math.min(e.length,f.length),h=g,i=0;g>i;i++)if(e[i]!==f[i]){h=i;break}for(var j=[],i=h;i<e.length;i++)j.push("..");return j=j.concat(f.slice(h)),j.join("/")},c.sep="/",c.delimiter=":",c.dirname=function(a){var b=f(a),c=b[0],d=b[1];return c||d?(d&&(d=d.substr(0,d.length-1)),c+d):"."},c.basename=function(a,b){var c=f(a)[2];return b&&c.substr(-1*b.length)===b&&(c=c.substr(0,c.length-b.length)),c},c.extname=function(a){return f(a)[3]};var g="b"==="ab".substr(-1)?function(a,b,c){return a.substr(b,c)}:function(a,b,c){return 0>b&&(b=a.length+b),a.substr(b,c)}}).call(this,a("_process"))},{_process:5}],5:[function(a,b){function c(){l&&j&&(l=!1,j.length?k=j.concat(k):m=-1,k.length&&d())}function d(){if(!l){var a=g(c);l=!0;for(var b=k.length;b;){for(j=k,k=[];++m<b;)j&&j[m].run();m=-1,b=k.length}j=null,l=!1,h(a)}}function e(a,b){this.fun=a,this.array=b}function f(){}var g,h,i=b.exports={};!function(){try{g=setTimeout}catch(a){g=function(){throw new Error("setTimeout is not defined")}}try{h=clearTimeout}catch(a){h=function(){throw new Error("clearTimeout is not defined")}}}();var j,k=[],l=!1,m=-1;i.nextTick=function(a){var b=new Array(arguments.length-1);if(arguments.length>1)for(var c=1;c<arguments.length;c++)b[c-1]=arguments[c];k.push(new e(a,b)),1!==k.length||l||g(d,0)},e.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=f,i.addListener=f,i.once=f,i.off=f,i.removeListener=f,i.removeAllListeners=f,i.emit=f,i.binding=function(){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},{}],6:[function(a,b){b.exports=function(a){return a&&"object"==typeof a&&"function"==typeof a.copy&&"function"==typeof a.fill&&"function"==typeof a.readUInt8}},{}],7:[function(a,b,c){(function(b,d){function e(a,b){var d={seen:[],stylize:g};return arguments.length>=3&&(d.depth=arguments[2]),arguments.length>=4&&(d.colors=arguments[3]),p(b)?d.showHidden=b:b&&c._extend(d,b),v(d.showHidden)&&(d.showHidden=!1),v(d.depth)&&(d.depth=2),v(d.colors)&&(d.colors=!1),v(d.customInspect)&&(d.customInspect=!0),d.colors&&(d.stylize=f),i(d,a,d.depth)}function f(a,b){var c=e.styles[b];return c?"["+e.colors[c][0]+"m"+a+"["+e.colors[c][1]+"m":a}function g(a){return a}function h(a){var b={};return a.forEach(function(a){b[a]=!0}),b}function i(a,b,d){if(a.customInspect&&b&&A(b.inspect)&&b.inspect!==c.inspect&&(!b.constructor||b.constructor.prototype!==b)){var e=b.inspect(d,a);return t(e)||(e=i(a,e,d)),e}var f=j(a,b);if(f)return f;var g=Object.keys(b),p=h(g);if(a.showHidden&&(g=Object.getOwnPropertyNames(b)),z(b)&&(g.indexOf("message")>=0||g.indexOf("description")>=0))return k(b);if(0===g.length){if(A(b)){var q=b.name?": "+b.name:"";return a.stylize("[Function"+q+"]","special")}if(w(b))return a.stylize(RegExp.prototype.toString.call(b),"regexp");if(y(b))return a.stylize(Date.prototype.toString.call(b),"date");if(z(b))return k(b)}var r="",s=!1,u=["{","}"];if(o(b)&&(s=!0,u=["[","]"]),A(b)){var v=b.name?": "+b.name:"";r=" [Function"+v+"]"}if(w(b)&&(r=" "+RegExp.prototype.toString.call(b)),y(b)&&(r=" "+Date.prototype.toUTCString.call(b)),z(b)&&(r=" "+k(b)),0===g.length&&(!s||0==b.length))return u[0]+r+u[1];if(0>d)return w(b)?a.stylize(RegExp.prototype.toString.call(b),"regexp"):a.stylize("[Object]","special");a.seen.push(b);var x;return x=s?l(a,b,d,p,g):g.map(function(c){return m(a,b,d,p,c,s)}),a.seen.pop(),n(x,r,u)}function j(a,b){if(v(b))return a.stylize("undefined","undefined");if(t(b)){var c="'"+JSON.stringify(b).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return a.stylize(c,"string")}return s(b)?a.stylize(""+b,"number"):p(b)?a.stylize(""+b,"boolean"):q(b)?a.stylize("null","null"):void 0}function k(a){return"["+Error.prototype.toString.call(a)+"]"}function l(a,b,c,d,e){for(var f=[],g=0,h=b.length;h>g;++g)f.push(F(b,String(g))?m(a,b,c,d,String(g),!0):"");return e.forEach(function(e){e.match(/^\d+$/)||f.push(m(a,b,c,d,e,!0))}),f}function m(a,b,c,d,e,f){var g,h,j;if(j=Object.getOwnPropertyDescriptor(b,e)||{value:b[e]},j.get?h=j.set?a.stylize("[Getter/Setter]","special"):a.stylize("[Getter]","special"):j.set&&(h=a.stylize("[Setter]","special")),F(d,e)||(g="["+e+"]"),h||(a.seen.indexOf(j.value)<0?(h=q(c)?i(a,j.value,null):i(a,j.value,c-1),h.indexOf("\n")>-1&&(h=f?h.split("\n").map(function(a){return"  "+a}).join("\n").substr(2):"\n"+h.split("\n").map(function(a){return"   "+a}).join("\n"))):h=a.stylize("[Circular]","special")),v(g)){if(f&&e.match(/^\d+$/))return h;g=JSON.stringify(""+e),g.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(g=g.substr(1,g.length-2),g=a.stylize(g,"name")):(g=g.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),g=a.stylize(g,"string"))}return g+": "+h}function n(a,b,c){var d=0,e=a.reduce(function(a,b){return d++,b.indexOf("\n")>=0&&d++,a+b.replace(/\u001b\[\d\d?m/g,"").length+1},0);return e>60?c[0]+(""===b?"":b+"\n ")+" "+a.join(",\n  ")+" "+c[1]:c[0]+b+" "+a.join(", ")+" "+c[1]}function o(a){return Array.isArray(a)}function p(a){return"boolean"==typeof a}function q(a){return null===a}function r(a){return null==a}function s(a){return"number"==typeof a}function t(a){return"string"==typeof a}function u(a){return"symbol"==typeof a}function v(a){return void 0===a}function w(a){return x(a)&&"[object RegExp]"===C(a)}function x(a){return"object"==typeof a&&null!==a}function y(a){return x(a)&&"[object Date]"===C(a)}function z(a){return x(a)&&("[object Error]"===C(a)||a instanceof Error)}function A(a){return"function"==typeof a}function B(a){return null===a||"boolean"==typeof a||"number"==typeof a||"string"==typeof a||"symbol"==typeof a||"undefined"==typeof a}function C(a){return Object.prototype.toString.call(a)}function D(a){return 10>a?"0"+a.toString(10):a.toString(10)}function E(){var a=new Date,b=[D(a.getHours()),D(a.getMinutes()),D(a.getSeconds())].join(":");return[a.getDate(),J[a.getMonth()],b].join(" ")}function F(a,b){return Object.prototype.hasOwnProperty.call(a,b)}
// Copyright Joyent, Inc. and other Node contributors.
//
// Permission is hereby granted, free of charge, to any person obtaining a
// copy of this software and associated documentation files (the
// "Software"), to deal in the Software without restriction, including
// without limitation the rights to use, copy, modify, merge, publish,
// distribute, sublicense, and/or sell copies of the Software, and to permit
// persons to whom the Software is furnished to do so, subject to the
// following conditions:
//
// The above copyright notice and this permission notice shall be included
// in all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS
// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN
// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE
// USE OR OTHER DEALINGS IN THE SOFTWARE.
var G=/%[sdj%]/g;c.format=function(a){if(!t(a)){for(var b=[],c=0;c<arguments.length;c++)b.push(e(arguments[c]));return b.join(" ")}for(var c=1,d=arguments,f=d.length,g=String(a).replace(G,function(a){if("%%"===a)return"%";if(c>=f)return a;switch(a){case"%s":return String(d[c++]);case"%d":return Number(d[c++]);case"%j":try{return JSON.stringify(d[c++])}catch(b){return"[Circular]"}default:return a}}),h=d[c];f>c;h=d[++c])g+=q(h)||!x(h)?" "+h:" "+e(h);return g},c.deprecate=function(a,e){function f(){if(!g){if(b.throwDeprecation)throw new Error(e);b.traceDeprecation?console.trace(e):console.error(e),g=!0}return a.apply(this,arguments)}if(v(d.process))return function(){return c.deprecate(a,e).apply(this,arguments)};if(b.noDeprecation===!0)return a;var g=!1;return f};var H,I={};c.debuglog=function(a){if(v(H)&&(H=b.env.NODE_DEBUG||""),a=a.toUpperCase(),!I[a])if(new RegExp("\\b"+a+"\\b","i").test(H)){var d=b.pid;I[a]=function(){var b=c.format.apply(c,arguments);console.error("%s %d: %s",a,d,b)}}else I[a]=function(){};return I[a]},c.inspect=e,e.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},e.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"},c.isArray=o,c.isBoolean=p,c.isNull=q,c.isNullOrUndefined=r,c.isNumber=s,c.isString=t,c.isSymbol=u,c.isUndefined=v,c.isRegExp=w,c.isObject=x,c.isDate=y,c.isError=z,c.isFunction=A,c.isPrimitive=B,c.isBuffer=a("./support/isBuffer");var J=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];c.log=function(){console.log("%s - %s",E(),c.format.apply(c,arguments))},c.inherits=a("inherits"),c._extend=function(a,b){if(!b||!x(b))return a;for(var c=Object.keys(b),d=c.length;d--;)a[c[d]]=b[c[d]];return a}}).call(this,a("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":6,_process:5,inherits:3}],8:[function(a,b){var c="undefined"!=typeof JSON?JSON:a("jsonify");b.exports=function(a,b){b||(b={}),"function"==typeof b&&(b={cmp:b});var f=b.space||"";"number"==typeof f&&(f=Array(f+1).join(" "));var g="boolean"==typeof b.cycles?b.cycles:!1,h=b.replacer||function(a,b){return b},i=b.cmp&&function(a){return function(b){return function(c,d){var e={key:c,value:b[c]},f={key:d,value:b[d]};return a(e,f)}}}(b.cmp),j=[];return function k(a,b,l,m){var n=f?"\n"+new Array(m+1).join(f):"",o=f?": ":":";if(l&&l.toJSON&&"function"==typeof l.toJSON&&(l=l.toJSON()),l=h.call(a,b,l),void 0!==l){if("object"!=typeof l||null===l)return c.stringify(l);if(d(l)){for(var p=[],q=0;q<l.length;q++){var r=k(l,q,l[q],m+1)||c.stringify(null);p.push(n+f+r)}return"["+p.join(",")+n+"]"}if(-1!==j.indexOf(l)){if(g)return c.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}j.push(l);for(var s=e(l).sort(i&&i(l)),p=[],q=0;q<s.length;q++){var b=s[q],t=k(l,b,l[b],m+1);if(t){var u=c.stringify(b)+o+t;p.push(n+f+u)}}return"{"+p.join(",")+n+"}"}}({"":a},"",a,0)};var d=Array.isArray||function(a){return"[object Array]"==={}.toString.call(a)},e=Object.keys||function(a){var b=Object.prototype.hasOwnProperty||function(){return!0},c=[];for(var d in a)b.call(a,d)&&c.push(d);return c}},{jsonify:9}],9:[function(a,b,c){c.parse=a("./lib/parse"),c.stringify=a("./lib/stringify")},{"./lib/parse":10,"./lib/stringify":11}],10:[function(a,b){var c,d,e,f,g={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"	"},h=function(a){throw{name:"SyntaxError",message:a,at:c,text:e}},i=function(a){return a&&a!==d&&h("Expected '"+a+"' instead of '"+d+"'"),d=e.charAt(c),c+=1,d},j=function(){var a,b="";for("-"===d&&(b="-",i("-"));d>="0"&&"9">=d;)b+=d,i();if("."===d)for(b+=".";i()&&d>="0"&&"9">=d;)b+=d;if("e"===d||"E"===d)for(b+=d,i(),("-"===d||"+"===d)&&(b+=d,i());d>="0"&&"9">=d;)b+=d,i();return a=+b,isFinite(a)?a:void h("Bad number")},k=function(){var a,b,c,e="";if('"'===d)for(;i();){if('"'===d)return i(),e;if("\\"===d)if(i(),"u"===d){for(c=0,b=0;4>b&&(a=parseInt(i(),16),isFinite(a));b+=1)c=16*c+a;e+=String.fromCharCode(c)}else{if("string"!=typeof g[d])break;e+=g[d]}else e+=d}h("Bad string")},l=function(){for(;d&&" ">=d;)i()},m=function(){switch(d){case"t":return i("t"),i("r"),i("u"),i("e"),!0;case"f":return i("f"),i("a"),i("l"),i("s"),i("e"),!1;case"n":return i("n"),i("u"),i("l"),i("l"),null}h("Unexpected '"+d+"'")},n=function(){var a=[];if("["===d){if(i("["),l(),"]"===d)return i("]"),a;for(;d;){if(a.push(f()),l(),"]"===d)return i("]"),a;i(","),l()}}h("Bad array")},o=function(){var a,b={};if("{"===d){if(i("{"),l(),"}"===d)return i("}"),b;for(;d;){if(a=k(),l(),i(":"),Object.hasOwnProperty.call(b,a)&&h('Duplicate key "'+a+'"'),b[a]=f(),l(),"}"===d)return i("}"),b;i(","),l()}}h("Bad object")};f=function(){switch(l(),d){case"{":return o();case"[":return n();case'"':return k();case"-":return j();default:return d>="0"&&"9">=d?j():m()}},b.exports=function(a,b){var g;return e=a,c=0,d=" ",g=f(),l(),d&&h("Syntax error"),"function"==typeof b?function i(a,c){var d,e,f=a[c];if(f&&"object"==typeof f)for(d in f)Object.prototype.hasOwnProperty.call(f,d)&&(e=i(f,d),void 0!==e?f[d]=e:delete f[d]);return b.call(a,c,f)}({"":g},""):g}},{}],11:[function(a,b){function c(a){return h.lastIndex=0,h.test(a)?'"'+a.replace(h,function(a){var b=i[a];return"string"==typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function d(a,b){var h,i,j,k,l,m=e,n=b[a];switch(n&&"object"==typeof n&&"function"==typeof n.toJSON&&(n=n.toJSON(a)),"function"==typeof g&&(n=g.call(b,a,n)),typeof n){case"string":return c(n);case"number":return isFinite(n)?String(n):"null";case"boolean":case"null":return String(n);case"object":if(!n)return"null";if(e+=f,l=[],"[object Array]"===Object.prototype.toString.apply(n)){for(k=n.length,h=0;k>h;h+=1)l[h]=d(h,n)||"null";return j=0===l.length?"[]":e?"[\n"+e+l.join(",\n"+e)+"\n"+m+"]":"["+l.join(",")+"]",e=m,j}if(g&&"object"==typeof g)for(k=g.length,h=0;k>h;h+=1)i=g[h],"string"==typeof i&&(j=d(i,n),j&&l.push(c(i)+(e?": ":":")+j));else for(i in n)Object.prototype.hasOwnProperty.call(n,i)&&(j=d(i,n),j&&l.push(c(i)+(e?": ":":")+j));return j=0===l.length?"{}":e?"{\n"+e+l.join(",\n"+e)+"\n"+m+"}":"{"+l.join(",")+"}",e=m,j}}var e,f,g,h=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,i={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};b.exports=function(a,b,c){var h;if(e="",f="","number"==typeof c)for(h=0;c>h;h+=1)f+=" ";else"string"==typeof c&&(f=c);if(g=b,b&&"function"!=typeof b&&("object"!=typeof b||"number"!=typeof b.length))throw new Error("JSON.stringify");return d("",{"":a})}},{}],12:[function(a,b,c){/**
 * This script gives you the zone info key representing your device's time zone setting.
 *
 * @name jsTimezoneDetect
 * @version 1.0.5
 * @author Jon Nylander
 * @license MIT License - http://www.opensource.org/licenses/mit-license.php
 *
 * For usage and examples, visit:
 * http://pellepim.bitbucket.org/jstz/
 *
 * Copyright (c) Jon Nylander
 */
!function(a){var b=function(){"use strict";var a="s",c=function(a){var b=-a.getTimezoneOffset();return null!==b?b:0},d=function(a,b,c){var d=new Date;return void 0!==a&&d.setFullYear(a),d.setMonth(b),d.setDate(c),d},e=function(a){return c(d(a,0,2))},f=function(a){return c(d(a,5,2))},g=function(a){var b=a.getMonth()>7,d=b?f(a.getFullYear()):e(a.getFullYear()),g=c(a),h=0>d,i=d-g;return h||b?0!==i:0>i},h=function(){var b=e(),c=f(),d=b-c;return 0>d?b+",1":d>0?c+",1,"+a:b+",0"},i=function(){var a=h();return new b.TimeZone(b.olson.timezones[a])},j=function(a){var b=new Date(2010,6,15,1,0,0,0),c={"America/Denver":new Date(2011,2,13,3,0,0,0),"America/Mazatlan":new Date(2011,3,3,3,0,0,0),"America/Chicago":new Date(2011,2,13,3,0,0,0),"America/Mexico_City":new Date(2011,3,3,3,0,0,0),"America/Asuncion":new Date(2012,9,7,3,0,0,0),"America/Santiago":new Date(2012,9,3,3,0,0,0),"America/Campo_Grande":new Date(2012,9,21,5,0,0,0),"America/Montevideo":new Date(2011,9,2,3,0,0,0),"America/Sao_Paulo":new Date(2011,9,16,5,0,0,0),"America/Los_Angeles":new Date(2011,2,13,8,0,0,0),"America/Santa_Isabel":new Date(2011,3,5,8,0,0,0),"America/Havana":new Date(2012,2,10,2,0,0,0),"America/New_York":new Date(2012,2,10,7,0,0,0),"Europe/Helsinki":new Date(2013,2,31,5,0,0,0),"Pacific/Auckland":new Date(2011,8,26,7,0,0,0),"America/Halifax":new Date(2011,2,13,6,0,0,0),"America/Goose_Bay":new Date(2011,2,13,2,1,0,0),"America/Miquelon":new Date(2011,2,13,5,0,0,0),"America/Godthab":new Date(2011,2,27,1,0,0,0),"Europe/Moscow":b,"Asia/Amman":new Date(2013,2,29,1,0,0,0),"Asia/Beirut":new Date(2013,2,31,2,0,0,0),"Asia/Damascus":new Date(2013,3,6,2,0,0,0),"Asia/Jerusalem":new Date(2013,2,29,5,0,0,0),"Asia/Yekaterinburg":b,"Asia/Omsk":b,"Asia/Krasnoyarsk":b,"Asia/Irkutsk":b,"Asia/Yakutsk":b,"Asia/Vladivostok":b,"Asia/Baku":new Date(2013,2,31,4,0,0),"Asia/Yerevan":new Date(2013,2,31,3,0,0),"Asia/Kamchatka":b,"Asia/Gaza":new Date(2010,2,27,4,0,0),"Africa/Cairo":new Date(2010,4,1,3,0,0),"Europe/Minsk":b,"Pacific/Apia":new Date(2010,10,1,1,0,0,0),"Pacific/Fiji":new Date(2010,11,1,0,0,0),"Australia/Perth":new Date(2008,10,1,1,0,0,0)};return c[a]};return{determine:i,date_is_dst:g,dst_start_for:j}}();b.TimeZone=function(a){"use strict";var c={"America/Denver":["America/Denver","America/Mazatlan"],"America/Chicago":["America/Chicago","America/Mexico_City"],"America/Santiago":["America/Santiago","America/Asuncion","America/Campo_Grande"],"America/Montevideo":["America/Montevideo","America/Sao_Paulo"],"Asia/Beirut":["Asia/Amman","Asia/Jerusalem","Asia/Beirut","Europe/Helsinki","Asia/Damascus"],"Pacific/Auckland":["Pacific/Auckland","Pacific/Fiji"],"America/Los_Angeles":["America/Los_Angeles","America/Santa_Isabel"],"America/New_York":["America/Havana","America/New_York"],"America/Halifax":["America/Goose_Bay","America/Halifax"],"America/Godthab":["America/Miquelon","America/Godthab"],"Asia/Dubai":["Europe/Moscow"],"Asia/Dhaka":["Asia/Yekaterinburg"],"Asia/Jakarta":["Asia/Omsk"],"Asia/Shanghai":["Asia/Krasnoyarsk","Australia/Perth"],"Asia/Tokyo":["Asia/Irkutsk"],"Australia/Brisbane":["Asia/Yakutsk"],"Pacific/Noumea":["Asia/Vladivostok"],"Pacific/Tarawa":["Asia/Kamchatka","Pacific/Fiji"],"Pacific/Tongatapu":["Pacific/Apia"],"Asia/Baghdad":["Europe/Minsk"],"Asia/Baku":["Asia/Yerevan","Asia/Baku"],"Africa/Johannesburg":["Asia/Gaza","Africa/Cairo"]},d=a,e=function(){for(var a=c[d],e=a.length,f=0,g=a[0];e>f;f+=1)if(g=a[f],b.date_is_dst(b.dst_start_for(g)))return void(d=g)},f=function(){return"undefined"!=typeof c[d]};return f()&&e(),{name:function(){return d}}},b.olson={},b.olson.timezones={"-720,0":"Pacific/Majuro","-660,0":"Pacific/Pago_Pago","-600,1":"America/Adak","-600,0":"Pacific/Honolulu","-570,0":"Pacific/Marquesas","-540,0":"Pacific/Gambier","-540,1":"America/Anchorage","-480,1":"America/Los_Angeles","-480,0":"Pacific/Pitcairn","-420,0":"America/Phoenix","-420,1":"America/Denver","-360,0":"America/Guatemala","-360,1":"America/Chicago","-360,1,s":"Pacific/Easter","-300,0":"America/Bogota","-300,1":"America/New_York","-270,0":"America/Caracas","-240,1":"America/Halifax","-240,0":"America/Santo_Domingo","-240,1,s":"America/Santiago","-210,1":"America/St_Johns","-180,1":"America/Godthab","-180,0":"America/Argentina/Buenos_Aires","-180,1,s":"America/Montevideo","-120,0":"America/Noronha","-120,1":"America/Noronha","-60,1":"Atlantic/Azores","-60,0":"Atlantic/Cape_Verde","0,0":"UTC","0,1":"Europe/London","60,1":"Europe/Berlin","60,0":"Africa/Lagos","60,1,s":"Africa/Windhoek","120,1":"Asia/Beirut","120,0":"Africa/Johannesburg","180,0":"Asia/Baghdad","180,1":"Europe/Moscow","210,1":"Asia/Tehran","240,0":"Asia/Dubai","240,1":"Asia/Baku","270,0":"Asia/Kabul","300,1":"Asia/Yekaterinburg","300,0":"Asia/Karachi","330,0":"Asia/Kolkata","345,0":"Asia/Kathmandu","360,0":"Asia/Dhaka","360,1":"Asia/Omsk","390,0":"Asia/Rangoon","420,1":"Asia/Krasnoyarsk","420,0":"Asia/Jakarta","480,0":"Asia/Shanghai","480,1":"Asia/Irkutsk","525,0":"Australia/Eucla","525,1,s":"Australia/Eucla","540,1":"Asia/Yakutsk","540,0":"Asia/Tokyo","570,0":"Australia/Darwin","570,1,s":"Australia/Adelaide","600,0":"Australia/Brisbane","600,1":"Asia/Vladivostok","600,1,s":"Australia/Sydney","630,1,s":"Australia/Lord_Howe","660,1":"Asia/Kamchatka","660,0":"Pacific/Noumea","690,0":"Pacific/Norfolk","720,1,s":"Pacific/Auckland","720,0":"Pacific/Tarawa","765,1,s":"Pacific/Chatham","780,0":"Pacific/Tongatapu","780,1,s":"Pacific/Apia","840,0":"Pacific/Kiritimati"},"undefined"!=typeof c?c.jstz=b:a.jstz=b}(this)},{}],13:[function(a,b,c){!function(d,e){"use strict";function f(a){for(var b=0;b<u.length;b++)if(u[b](a))return!0;return!1}function g(a){if(f(a))return p.isRegExp(a)?{$regex:a}:{$eq:a};if(p.isObject(a)){var b=p.keys(a),c=0===p.intersection(k(P),b).length;if(c)return{$eq:a};if(p.contains(b,"$regex")){var d=a.$regex,e=a.$options||"",g="";p.isString(d)&&(g+=d.ignoreCase||e.indexOf("i")>=0?"i":"",g+=d.multiline||e.indexOf("m")>=0?"m":"",g+=d.global||e.indexOf("g")>=0?"g":"",d=new RegExp(d,g)),a.$regex=d,delete a.$options}}return a}function h(a,b){return p.result(a,b)}function i(a,b){if(!b)return e;for(var c,d=b.split("."),f=a,g=0;g<d.length;g++){if(c=null===d[g].match(/^\d+$/),c&&p.isArray(f)){var j=[];p.each(f,function(a){j.push(i(a,d[g]))}),f=j}else f=h(f,d[g]);if(f===e)break}return f}function j(a,b){return new Array(Math.max(b-String(a).length+1,0)).join("0")+a}function k(a){return p.keys(U[a])}function l(a,b){var c={keys:[],groups:[]};if(p.each(a,function(a){var d=b(a),e=-1;if(p.isObject(d)){for(var f=0;f<c.keys.length;f++)if(p.isEqual(d,c.keys[f])){e=f;break}}else e=p.indexOf(c.keys,d);e>-1?c.groups[e].push(a):(c.keys.push(d),c.groups.push([a]))}),c.keys.length!==c.groups.length)throw new Error("assert groupBy(): keys.length !== groups.length");return c}function m(a,b,c){if(p.contains(k(Q),b))return D[b](a,c);if(p.isObject(c)){var d={};for(var f in c)if(c.hasOwnProperty(f)&&(d[f]=m(a,f,c[f]),p.contains(k(Q),f))){if(d=d[f],p.keys(c).length>1)throw new Error("Invalid $group expression '"+JSON.stringify(c)+"'");break}return d}return e}function n(a,b,c){if(p.contains(k(R),c))return O[c](a,b);if(p.isString(b)&&b.length>0&&"$"===b[0])return i(a,b.slice(1));var d;if(f(b))return b;if(p.isArray(b))d=p.map(b,function(b){return n(a,b,null)});else if(p.isObject(b)){d={};for(var e in b)if(b.hasOwnProperty(e)&&(d[e]=n(a,b[e],e),p.contains(k(R),e))){if(d=d[e],p.keys(b).length>1)throw new Error("Invalid aggregation expression '"+JSON.stringify(b)+"'");break}}return d}var o,p,q={};q.VERSION="0.6.2",null!=d&&(o=d.Mingo),q.noConflict=function(){return d.Mingo=o,q};var r=Boolean("undefined"!=typeof android&&android&&android.widget&&android.widget.Button||"undefined"!=typeof UIButton&&UIButton),s="undefined"!=typeof c&&"undefined"!=typeof a&&"undefined"==typeof window&&!r,t="undefined"!=typeof c&&"undefined"!=typeof a;s||r||t?("undefined"!=typeof b&&(b.exports=q),p=a("underscore")):(d.Mingo=q,p=d._);var u=[p.isString,p.isBoolean,p.isNumber,p.isDate,p.isNull,p.isRegExp],v={key:"_id"};if(q.setup=function(a){p.extend(v,a||{})},q.Query=function(a,b){return this instanceof q.Query?(this._criteria=a,this._projection=b,this._compiled=[],void this._compile()):new q.Query(a,b)},q.Query.prototype={_compile:function(){if(!p.isEmpty(this._criteria)){if(p.isArray(this._criteria)||p.isFunction(this._criteria)||!p.isObject(this._criteria))throw new Error("Invalid type for criteria");for(var a in this._criteria)if(this._criteria.hasOwnProperty(a)){var b=this._criteria[a];if(p.contains(["$and","$or","$nor","$where"],a))this._processOperator(a,a,b);else{b=g(b);for(var c in b)b.hasOwnProperty(c)&&this._processOperator(a,c,b[c])}}}},_processOperator:function(a,b,c){if(!p.contains(k(P),b))throw new Error("Invalid query operator '"+b+"' detected");this._compiled.push(z[b](a,c))},test:function(a){for(var b=0;b<this._compiled.length;b++)if(!this._compiled[b].test(a))return!1;return!0},find:function(a,b){return new q.Cursor(a,this,b)},remove:function(a){for(var b=[],c=0;c<a.length;c++)this.test(a[c])||b.push(a[c]);return b}},s){var w=a("stream").Transform,x=a("util");q.Query.prototype.stream=function(a){return new q.Stream(this,a)},q.Stream=function(a,b){return this instanceof q.Stream?(b=b||{},p.extend(b,{objectMode:!0}),w.call(this,b),void(this._query=a)):new q.Stream(a,b)},x.inherits(q.Stream,w),q.Stream.prototype._transform=function(a,b,c){if(p.isObject(a)&&this._query.test(a))if(p.isEmpty(this._query._projection))this.push(a);else{var d=new q.Cursor([a],this._query);d.hasNext()&&this.push(d.next())}c()}}q.Cursor=function(a,b,c){return this instanceof q.Cursor?(this._query=b,this._collection=a,this._projection=c||b._projection,this._operators={},this._result=!1,void(this._position=0)):new q.Cursor(a,b,c)},q.Cursor.prototype={_fetch:function(){var a=this;if(this._result!==!1)return this._result;p.isObject(this._projection)&&p.extend(this._operators,{$project:this._projection}),this._result=p.filter(this._collection,this._query.test,this._query);var b=[];if(p.each(["$sort","$skip","$limit","$project"],function(c){p.has(a._operators,c)&&b.push(p.pick(a._operators,c))}),b.length>0){var c=new q.Aggregator(b);this._result=c.run(this._result,this._query)}return this._result},all:function(){return this._fetch()},first:function(){return this.count()>0?this._fetch()[0]:null},last:function(){return this.count()>0?this._fetch()[this.count()-1]:null},count:function(){return this._fetch().length},skip:function(a){return p.extend(this._operators,{$skip:a}),this},limit:function(a){return p.extend(this._operators,{$limit:a}),this},sort:function(a){return p.extend(this._operators,{$sort:a}),this},next:function(){return this.hasNext()?this._fetch()[this._position++]:null},hasNext:function(){return this.count()>this._position},max:function(a){return D.$max(this._fetch(),a)},min:function(a){return D.$min(this._fetch(),a)},map:function(a){return p.map(this._fetch(),a)},forEach:function(a){p.each(this._fetch(),a)}},q.Aggregator=function(a){return this instanceof q.Aggregator?void(this._operators=a):new q.Aggregator(a)},q.Aggregator.prototype={run:function(a,b){if(!p.isEmpty(this._operators))for(var c=0;c<this._operators.length;c++){var d=this._operators[c],e=p.keys(d);if(1!=e.length||!p.contains(k(S),e[0]))throw new Error("Invalid aggregation operator '"+e+"'");e=e[0],a=b instanceof q.Query?y[e].call(b,a,d[e]):y[e](a,d[e])}return a}},q.find=function(a,b,c){return new q.Query(b).find(a,c)},q.remove=function(a,b){return new q.Query(b).remove(a)},q.aggregate=function(a,b){if(!p.isArray(b))throw new Error("Aggregation pipeline must be an array");return new q.Aggregator(b).run(a)},q.addOperators=function(a,b){var c=b({resolve:i,computeValue:n,ops:k,key:function(){return v.key}});if(!p.contains([R,Q,S,T,P],a))throw new Error("Could not identify type '"+a+"'");var d=k(a);p.each(p.keys(c),function(b){if(!/^\$\w+$/.test(b))throw new Error("Invalid operator name '"+b+"'");if(p.contains(d,b))throw new Error("Operator "+b+" is already defined for "+a+" operators")});var e={};switch(a){case P:p.each(p.keys(c),function(a){e[a]=function(b,c){return function(d,e){return{test:function(f){var g=i(f,d),h=b.call(c,d,g,e);if(p.isBoolean(h))return h;if(h instanceof q.Query)return h.test(f);throw new Error("Invalid return type for '"+a+"'. Must return a Boolean or Mingo.Query")}}}}(c[a],c)});break;case T:p.each(p.keys(c),function(a){e[a]=function(a,b){return function(c,d,e){var f=i(c,e);return a.call(b,e,f,d)}}(c[a],c)});break;default:p.each(p.keys(c),function(a){e[a]=function(a,b){return function(){var c=Array.prototype.slice.call(arguments);return a.apply(b,c)}}(c[a],c)})}p.extend(U[a],e)},q.CollectionMixin={query:function(a,b){return q.find(this.toJSON(),a,b)},aggregate:function(a){var b=[this.toJSON(),a];return q.aggregate.apply(null,b)}};var y={$group:function(a,b){var c=b[v.key],d=l(a,function(a){return n(a,c,c)}),e=[];return b=p.omit(b,v.key),p.each(d.keys,function(a,c){var f={};p.isUndefined(a)||(f[v.key]=a);for(var g in b)b.hasOwnProperty(g)&&(f[g]=m(d.groups[c],g,b[g]));e.push(f)}),e},$match:function(a,b){return new q.Query(b).find(a).all()},$project:function(a,b){if(p.isEmpty(b))return a;var c=!1;p.each(b,function(a,b){if(0===a&&b!==v.key&&(c=!0),0!==a&&c)throw new Error("You cannot mix including and excluding fields.")});var d=[],e=p.keys(b),f=!1;if(p.contains(e,v.key)){var g=b[v.key];(0===g||g===!1)&&(e=p.without(e,v.key),p.isEmpty(e)&&(f=!0))}else e.push(v.key);for(var h=0;h<a.length;h++){var i=a[h],j={},l=!1,m=!1,o=[];f&&o.push(v.key),p.each(e,function(a){var c,d=b[a];if(a!==v.key&&0===d&&(m=!0),a===v.key&&p.isEmpty(d))c=i[a];else if(p.isString(d))c=n(i,d,a);else if(1===d||d===!0)c=p.result(i,a);else if(p.isObject(d)){var e=p.keys(d);if(e=e.length>1?!1:e[0],e!==!1&&p.contains(k(T),e)){var f=C[e](i,d[e],a);p.isUndefined(f)||(c=f),"$slice"==e&&(l=!0)}else c=n(i,d,a)}else o.push(a);p.isUndefined(c)||(j[a]=c)}),(l||m||f)&&(j=p.defaults(j,p.omit(i,o))),d.push(j)}return d},$limit:function(a,b){return p.first(a,b)},$skip:function(a,b){return p.rest(a,b)},$unwind:function(a,b){for(var c=[],d=b.substr(1),e=0;e<a.length;e++){var f=a[e],g=h(f,d);if(!p.isArray(g))throw new Error("Target field '"+d+"' is not of type Array.");p.each(g,function(a){var b=p.clone(f);b[d]=a,c.push(b)})}return c},$sort:function(a,b){if(!p.isEmpty(b)&&p.isObject(b)){var c=p.keys(b);c.reverse().forEach(function(c){var d=[],e=p.groupBy(a,function(a){var b=i(a,c);return d.push(b),b});d=p.sortBy(p.uniq(d),function(a){return a}),-1===b[c]&&d.reverse(),a=[],p.each(d,function(b){Array.prototype.push.apply(a,e[b])})})}return a}},z={},A={$and:function(a,b){if(!p.isArray(b))throw new Error("Invalid expression for $and criteria");var c=[];return p.each(b,function(a){c.push(new q.Query(a))}),{test:function(a){for(var b=0;b<c.length;b++)if(!c[b].test(a))return!1;return!0}}},$or:function(a,b){if(!p.isArray(b))throw new Error("Invalid expression for $or criteria");var c=[];return p.each(b,function(a){c.push(new q.Query(a))}),{test:function(a){for(var b=0;b<c.length;b++)if(c[b].test(a))return!0;return!1}}},$nor:function(a,b){if(!p.isArray(b))throw new Error("Invalid expression for $nor criteria");var c=this.$or("$or",b);return{test:function(a){return!c.test(a)}}},$not:function(a,b){var c={};c[a]=g(b);var d=new q.Query(c);return{test:function(a){return!d.test(a)}}},$where:function(a,b){return p.isFunction(b)||(b=new Function("return "+b+";")),{test:function(a){return b.call(a)===!0}}}};p.extend(z,A);var B={$eq:function(a,b){return a=p.flatten(p.isArray(a)?a:[a]),a=p.find(a,function(a){return p.isEqual(a,b)}),a!==e},$ne:function(a,b){return!this.$eq(a,b)},$in:function(a,b){return a=p.isArray(a)?a:[a],p.intersection(a,b).length>0},$nin:function(a,b){return p.isUndefined(a)||!this.$in(a,b)},$lt:function(a,b){return a=p.isArray(a)?a:[a],a=p.find(a,function(a){return b>a}),a!==e},$lte:function(a,b){return a=p.isArray(a)?a:[a],a=p.find(a,function(a){return b>=a}),a!==e},$gt:function(a,b){return a=p.isArray(a)?a:[a],a=p.find(a,function(a){return a>b}),a!==e},$gte:function(a,b){return a=p.isArray(a)?a:[a],a=p.find(a,function(a){return a>=b}),a!==e},$mod:function(a,b){return a=p.isArray(a)?a:[a],a=p.find(a,function(a){return p.isNumber(a)&&p.isArray(b)&&2===b.length&&a%b[0]===b[1]}),a!==e},$regex:function(a,b){return a=p.isArray(a)?a:[a],a=p.find(a,function(a){return p.isString(a)&&p.isRegExp(b)&&!!a.match(b)}),a!==e},$exists:function(a,b){return b===!1&&p.isUndefined(a)||b===!0&&!p.isUndefined(a)},$all:function(a,b){var c=this,d=!1;if(p.isArray(a)&&p.isArray(b))for(var e=0;e<b.length;e++){if(!p.isObject(b[e])||!p.contains(p.keys(b[e]),"$elemMatch"))return p.intersection(b,a).length===b.length;d=d||c.$elemMatch(a,b[e].$elemMatch)}return d},$size:function(a,b){return p.isArray(a)&&p.isNumber(b)&&a.length===b},$elemMatch:function(a,b){if(p.isArray(a)&&!p.isEmpty(a))for(var c=new q.Query(b),d=0;d<a.length;d++)if(c.test(a[d]))return!0;return!1},$type:function(a,b){switch(b){case 1:return p.isNumeric(a)&&-1!==(a+"").indexOf(".");case 2:case 5:return p.isString(a);case 3:return p.isObject(a);case 4:return p.isArray(a);case 8:return p.isBoolean(a);case 9:return p.isDate(a);case 10:return p.isNull(a);case 11:return p.isRegExp(a);case 16:return p.isNumeric(a)&&2147483647>=a&&-1===(a+"").indexOf(".");case 18:return p.isNumeric(a)&&a>2147483647&&0x8000000000000000>=a&&-1===(a+"").indexOf(".");default:return!1}}};p.each(p.keys(B),function(a){z[a]=function(a,b){return function(c,d){return{test:function(e){var f=i(e,c);return a.call(b,f,d)}}}}(B[a],B)});var C={$:function(){throw new Error("$ not implemented")},$elemMatch:function(a,b,c){var d=i(a,c),f=new q.Query(b);if(p.isUndefined(d)||!p.isArray(d))return e;for(var g=0;g<d.length;g++)if(f.test(d[g]))return[d[g]];return e},$slice:function(a,b,c){var d=i(a,c);if(!p.isArray(d))return d;if(p.isArray(b)){var e=b[0]<0?d.length+b[0]:b,f=e+b[1];b=[e,f]}else{if(!p.isNumber(b))throw new Error("Invalid type for $slice operator");b=0>b?[b]:[0,b]}return Array.prototype.slice.apply(d,b)}},D={$addToSet:function(a,b){var c=p.map(a,function(a){return n(a,b,null)});return p.uniq(c)},$sum:function(a,b){return p.isArray(a)?p.isNumber(b)?a.length*b:p.reduce(a,function(a,c){return a+n(c,b,null)},0):0},$max:function(a,b){var c=p.max(a,function(a){return n(a,b,null)});return n(c,b,null)},$min:function(a,b){var c=p.min(a,function(a){return n(a,b,null)});return n(c,b,null)},$avg:function(a,b){return this.$sum(a,b)/(a.length||1)},$push:function(a,b){return p.map(a,function(a){return n(a,b,null)})},$first:function(a,b){return a.length>0?n(a[0],b):e},$last:function(a,b){return a.length>0?n(a[a.length-1],b):e}},E={$add:function(a,b){var c=n(a,b,null);return p.reduce(c,function(a,b){return a+b},0)},$subtract:function(a,b){var c=n(a,b,null);return c[0]-c[1]},$divide:function(a,b){var c=n(a,b,null);return c[0]/c[1]},$multiply:function(a,b){var c=n(a,b,null);return p.reduce(c,function(a,b){return a*b},1)},$mod:function(a,b){var c=n(a,b,null);return c[0]%c[1]}},F={$concat:function(a,b){var c=n(a,b,null);return p.contains(c,null)||p.contains(c,e)?null:c.join("")},$strcasecmp:function(a,b){var c=n(a,b,null);return c[0]=p.isEmpty(c[0])?"":c[0].toUpperCase(),c[1]=p.isEmpty(c[1])?"":c[1].toUpperCase(),c[0]>c[1]?1:c[0]<c[1]?-1:0},$substr:function(a,b){var c=n(a,b,null);return p.isString(c[0])?c[1]<0?"":c[2]<0?c[0].substr(c[1]):c[0].substr(c[1],c[2]):""},$toLower:function(a,b){var c=n(a,b,null);return p.isEmpty(c)?"":c.toLowerCase()},$toUpper:function(a,b){var c=n(a,b,null);return p.isEmpty(c)?"":c.toUpperCase()}},G={$dayOfYear:function(a,b){var c=n(a,b,null);if(p.isDate(c)){var d=new Date(c.getFullYear(),0,0),f=c-d,g=864e5;return Math.round(f/g)}return e},$dayOfMonth:function(a,b){var c=n(a,b,null);return p.isDate(c)?c.getDate():e},$dayOfWeek:function(a,b){var c=n(a,b,null);return p.isDate(c)?c.getDay()+1:e},$year:function(a,b){var c=n(a,b,null);return p.isDate(c)?c.getFullYear():e},$month:function(a,b){var c=n(a,b,null);return p.isDate(c)?c.getMonth()+1:e},$week:function(a,b){var c=n(a,b,null);c=new Date(+c),c.setHours(0,0,0),c.setDate(c.getDate()+4-(c.getDay()||7));var d=new Date(c.getFullYear(),0,1);return Math.floor(((c-d)/864e5+1)/7)},$hour:function(a,b){var c=n(a,b,null);return p.isDate(c)?c.getHours():e},$minute:function(a,b){var c=n(a,b,null);return p.isDate(c)?c.getMinutes():e},$second:function(a,b){var c=n(a,b,null);return p.isDate(c)?c.getSeconds():e},$millisecond:function(a,b){var c=n(a,b,null);return p.isDate(c)?c.getMilliseconds():e},$dateToString:function(a,b){for(var c=b.format,d=n(a,b.date,null),e=c.match(/(%%|%Y|%m|%d|%H|%M|%S|%L|%j|%w|%U)/g),f=0,g=e.length;g>f;f++){var h=V[e[f]],i=h;if(p.isArray(h)){var k=this[h[0]],l=h[1];i=j(k.call(this,a,d),l)}c=c.replace(e[f],i)}return c}},H={$setEquals:function(a,b){var c=n(a,b,null),d=p.uniq(c[0]),e=p.uniq(c[1]);return d.length!==e.length?!1:0==p.difference(d,e).length},$setIntersection:function(a,b){var c=n(a,b,null);return p.intersection(c[0],c[1])},$setDifference:function(a,b){var c=n(a,b,null);return p.difference(c[0],c[1])},$setUnion:function(a,b){var c=n(a,b,null);return p.union(c[0],c[1])},$setIsSubset:function(a,b){var c=n(a,b,null);return p.intersection(c[0],c[1]).length===c[0].length},$anyElementTrue:function(a,b){for(var c=n(a,b,null)[0],d=0;d<c.length;d++)if(c[d])return!0;return!1},$allElementsTrue:function(a,b){for(var c=n(a,b,null)[0],d=0;d<c.length;d++)if(!c[d])return!1;return!0}},I={$cond:function(a,b){var c,d,e;if(p.isArray(b)){if(3!=b.length)throw new Error("Invalid arguments for $cond operator");c=b[0],d=b[1],e=b[2]}else p.isObject(b)&&(c=b["if"],d=b.then,e=b["else"]);var f=n(a,c,null);return f?n(a,d,null):n(a,e,null)},$ifNull:function(a,b){if(!p.isArray(b)||2!=b.length)throw new Error("Invalid arguments for $ifNull operator");var c=n(a,b,null);return null===c[0]||c[0]===e?c[1]:c[0]}},J={$cmp:function(a,b){var c=n(a,b,null);return c[0]>c[1]?1:c[0]<c[1]?-1:0}};p.each(["$eq","$ne","$gt","$gte","$lt","$lte"],function(a){J[a]=function(b,c){var d=n(b,c,null);return B[a](d[0],d[1])}});var K={$size:function(a,b){var c=n(a,b,null);return p.isArray(c)?c.length:e}},L={$literal:function(a,b){return b}},M={$map:function(a,b){var c=n(a,b.input,null);if(!p.isArray(c))throw new Error("Input expression for $map must resolve to an array");var d=b.as,e=b["in"],f="$"+d,g=a[f];return p.map(c,function(b){a[f]=b;var c=n(a,e,null);return p.isUndefined(g)?delete a[f]:a[f]=g,c})},$let:function(a,b){var c=b.vars,d=b["in"],e={},f=p.keys(c);p.each(f,function(b){var d=n(a,c[b],null),f="$"+b;e[f]=a[f],a[f]=d});var g=n(a,d,null);return p.each(f,function(b){var c="$"+b;p.isUndefined(e[c])?delete a[c]:a[c]=e[c]}),g}},N={$and:function(a,b){var c=n(a,b,null);return p.every(c)},$or:function(a,b){var c=n(a,b,null);return p.some(c)},$not:function(a,b){return!n(a,b[0],null)}},O=p.extend({},K,E,N,J,I,G,L,H,F,M),P=q.OP_QUERY="query",Q=q.OP_GROUP="group",R=q.OP_AGGREGATE="aggregate",S=q.OP_PIPELINE="pipeline",T=q.OP_PROJECTION="projection",U={aggregate:O,group:D,pipeline:y,projection:C,query:z},V={"%Y":["$year",4],"%m":["$month",2],"%d":["$dayOfMonth",2],"%H":["$hour",2],"%M":["$minute",2],"%S":["$second",2],"%L":["$millisecond",3],"%j":["$dayOfYear",3],"%w":["$dayOfWeek",1],"%U":["$week",2],"%%":"%"}}(this)},{stream:"stream",underscore:36,util:7}],14:[function(a,b,c){function d(a,b){a=a||{};var c={};for(var f in b)if(b.hasOwnProperty(f)){var g,i,k=b[f],l=f.split("."),m=a,n=[];a:for(var o=0;o<l.length;o++)switch(m=m[l[o]],h(m)){case"array":if(g=l.slice(0,o+1).join("."),i=l.slice(o+1).join("."),j('searching array "%s"',g),k.$size&&!i.length)return e(k,m);for(var p=c[g]||m,q=0;q<p.length;q++)if(i.length){var r={};r[i]=k,"object"==h(p[q])&&(j("attempting subdoc search with query %j",r),d(p[q],r)&&(c[g]&&~c[g].indexOf(p[q])||n.push(p[q])))}else j("performing simple array item search"),e(k,p[q])&&(c[g]&&~c[g].indexOf(p[q])||n.push(p[q]));n.length&&(c[g]=c[g]||[],c[g].push.apply(c[g],n));break a;case"undefined":return!1;case"object":if(null!=l[o+1])continue;if(!e(k,m))return!1;break;default:if(!e(k,m))return!1}}return c}function e(a,b){if("object"!=h(a))return g(a,b);var c=i.keys(a);if("$"==c[0][0]){for(var e=0;e<c.length;e++){if("$elemMatch"==c[e])return!1!==d(b,a.$elemMatch);if(!f[c[e]](a[c[e]],b))return!1}return!0}return g(a,b)}var f=a("./ops"),g=a("mongo-eql"),h=(a("dot-component"),a("component-type")),i=a("object-component"),j=a("debug")("mongo-query");b.exports=c=d,c.ops=f},{"./ops":25,"component-type":17,debug:18,"dot-component":21,"mongo-eql":23,"object-component":24}],15:[function(a,b,c){function d(a,b,c,d){a=a||{},d=d||{},b=b||{},c=c||{};var j,k=!!d.strict,l=[];if(h.length(b)&&(j=f(a,b)),k&&!1===j)i("no matches for query %j",b);else{for(var m=h.keys(c),n=[],o=0,p=m.length;p>o;o++)if(e[m[o]]){i('found modifier "%s"',m[o]);for(var q in c[m[o]]){var r=q.indexOf(".$.");if(~r){var s=q.substr(0,r),t=q.substr(r+3);if(j[s]){i('executing "%s" %s on first match within "%s"',q,m[o],s);var u=e[m[o]](j[s][0],t,c[m[o]][q]);if(u){var v=g.get(a,s).indexOf(j[s][0]);u.key=s+"."+v+"."+t,u.op=m[o],n.push(u)}}else i('ignoring "%s" %s - no matches within "%s"',q,m[o],s)}else{var u=e[m[o]](a,q,c[m[o]][q]);u&&(u.key=q,u.op=m[o],n.push(u))}}}else i('skipping unknown modifier "%s"',m[o]);if(n.length)for(var o=0;o<n.length;o++){var u=n[o],w=u();l.push({op:u.op,key:u.key,value:w})}}return l}var e=a("./mods"),f=a("./filter"),g=a("dot-component"),h=(a("component-type"),a("object-component")),i=a("debug")("mongo-query");b.exports=c=d,c.filter=f,c.mods=e},{"./filter":14,"./mods":16,"component-type":17,debug:18,"dot-component":21,"object-component":24}],16:[function(a,b,c){function d(a,b){for(var c=0,d=a.length;d>c;c++)if(g(b,a[c]))return!0;return!1}function e(a,b,c){for(var d=[],e=0;e<a.length;e++)for(var f=a[e],h=0;h<b.length;h++){var l=b[h];if("object"==i(l))if("object"==i(f)){var m=!1;if(j(l).length){for(var h in l)if(l.hasOwnProperty(h)){if(!g(l[h],f[h])){m=!1;break}m=!0}}else j(f).length||(m=!0);if(m){d.push(e),c.push(f);continue}}else k("ignoring pull match against object");else if(g(l,f)){d.push(e),c.push(f);continue}}return function(){for(var b=0;b<d.length;b++){var c=d[b];a.splice(c-b,1)}}}function f(a){return"number"==i(a)||Number(a)==a}var g=a("mongo-eql"),h=a("dot-component"),i=a("component-type"),j=a("object-component").keys,k=a("debug")("mongo-query");c.$set=function(a,b,c){var d=b.split(".").pop();switch(a=h.parent(a,b,!0),i(a)){case"object":if(!g(a[d],c))return function(){return a[d]=c,c};break;case"array":if(!f(d))throw new Error("can't append to array using string field name ["+d+"]");if(!g(a[d],c))return function(){return a[d]=c,c};break;default:throw new Error("$set only supports object not "+i(a))}},c.$unset=function(a,b){var c=b.split(".").pop();switch(a=h.parent(a,b),i(a)){case"array":case"object":if(a.hasOwnProperty(c))return function(){delete a[c]};k("ignoring unset of inexisting key")}},c.$rename=function(a,b,c){if(b==c)throw new Error("$rename source must differ from target");if(0===b.indexOf(c+"."))throw new Error("$rename target may not be a parent of source");var d=h.parent(a,b),e=i(d);if("object"==e){var f=b.split(".").pop();if(d.hasOwnProperty(f))return function(){var b=d[f];delete d[f];var e=h.parent(a,c,!0);return"object"==i(e)?e[c.split(".").pop()]=b:k("invalid $rename target path type"),c};k("ignoring rename from inexisting source")}else if("undefined"!=e)throw new Error("$rename source field invalid")},c.$inc=function(a,b,c){if("number"!=i(c))throw new Error("Modifier $inc allowed for numbers only");a=h.parent(a,b,!0);var d=b.split(".").pop();switch(i(a)){case"array":case"object":if(a.hasOwnProperty(d)){if("number"!=i(a[d]))throw new Error("Cannot apply $inc modifier to non-number");return function(){return a[d]+=c,c}}if("object"==i(a)||f(d))return function(){return a[d]=c,c};throw new Error("can't append to array using string field name ["+d+"]");default:throw new Error("Cannot apply $inc modifier to non-number")}},c.$pop=function(a,b,c){a=h.parent(a,b);var d=b.split(".").pop();switch(i(a)){case"array":case"object":if(a.hasOwnProperty(d))switch(i(a[d])){case"array":if(a[d].length)return function(){return-1==c?a[d].shift():a[d].pop()};break;case"undefined":k("ignoring pop to inexisting key");break;default:throw new Error("Cannot apply $pop modifier to non-array")}else k("ignoring pop to inexisting key");break;case"undefined":k("ignoring pop to inexisting key")}},c.$push=function(a,b,c){a=h.parent(a,b,!0);var d=b.split(".").pop();switch(i(a)){case"object":if(a.hasOwnProperty(d)){if("array"==i(a[d]))return function(){return a[d].push(c),c};throw new Error("Cannot apply $push/$pushAll modifier to non-array")}return function(){return a[d]=[c],c};case"array":if(a.hasOwnProperty(d)){if("array"==i(a[d]))return function(){return a[d].push(c),c};throw new Error("Cannot apply $push/$pushAll modifier to non-array")}if(f(d))return function(){return a[d]=[c],c};throw new Error("can't append to array using string field name ["+d+"]")}},c.$pushAll=function(a,b,c){if("array"!=i(c))throw new Error("Modifier $pushAll/pullAll allowed for arrays only");a=h.parent(a,b,!0);var d=b.split(".").pop();switch(i(a)){case"object":if(a.hasOwnProperty(d)){if("array"==i(a[d]))return function(){return a[d].push.apply(a[d],c),c};throw new Error("Cannot apply $push/$pushAll modifier to non-array")}return function(){return a[d]=c,c};case"array":if(a.hasOwnProperty(d)){if("array"==i(a[d]))return function(){return a[d].push.apply(a[d],c),c};throw new Error("Cannot apply $push/$pushAll modifier to non-array")}if(f(d))return function(){return a[d]=c,c};throw new Error("can't append to array using string field name ["+d+"]")}},c.$pull=function(a,b,c){a=h.parent(a,b,!0);var d=b.split(".").pop(),f=i(a);switch(f){case"object":if(a.hasOwnProperty(d)){if("array"!=i(a[d]))throw new Error("Cannot apply $pull/$pullAll modifier to non-array");var g=[],j=e(a[d],[c],g);if(g.length)return function(){return j(),g}}break;case"array":if(a.hasOwnProperty(d)){if("array"!=i(a[d]))throw new Error("Cannot apply $pull/$pullAll modifier to non-array");var g=[],j=e(a[d],[c],g);if(g.length)return function(){return j(),g}}else k("ignoring pull to non array");break;default:if("undefined"!=f)throw new Error("LEFT_SUBFIELD only supports Object: hello not: "+f)}},c.$pullAll=function(a,b,c){if("array"!=i(c))throw new Error("Modifier $pushAll/pullAll allowed for arrays only");a=h.parent(a,b,!0);var d=b.split(".").pop(),f=i(a);switch(f){case"object":if(a.hasOwnProperty(d)){if("array"!=i(a[d]))throw new Error("Cannot apply $pull/$pullAll modifier to non-array");var g=[],j=e(a[d],c,g);if(g.length)return function(){return j(),g}}break;case"array":if(a.hasOwnProperty(d)){if("array"!=i(a[d]))throw new Error("Cannot apply $pull/$pullAll modifier to non-array");var g=[],j=e(a[d],c,g);if(g.length)return function(){return j(),g}}else k("ignoring pull to non array");break;default:if("undefined"!=f)throw new Error("LEFT_SUBFIELD only supports Object: hello not: "+f)}},c.$addToSet=function l(a,b,c,e){if(!e&&"array"==i(c.$each)){for(var g=[],j=0,k=c.$each.length;k>j;j++){var m=l(a,b,c.$each[j],!0);m&&g.push(m)}return g.length?function(){for(var a=[],b=0;b<g.length;b++)a.push(g[b]());return a}:void 0}a=h.parent(a,b,!0);var n=b.split(".").pop();switch(i(a)){case"object":if(!a.hasOwnProperty(n))return function(){return a[n]=[c],c};if("array"!=i(a[n]))throw new Error("Cannot apply $addToSet modifier to non-array");if(!d(a[n],c))return function(){return a[n].push(c),c};break;case"array":if(!a.hasOwnProperty(n)){if(f(n))return function(){return a[n]=[c],c};throw new Error("can't append to array using string field name ["+n+"]")}if("array"!=i(a[n]))throw new Error("Cannot apply $addToSet modifier to non-array");if(!d(a[n],c))return function(){return a[n].push(c),c}}}},{"component-type":17,debug:18,"dot-component":21,"mongo-eql":23,"object-component":24}],17:[function(a,b){var c=Object.prototype.toString;b.exports=function(a){switch(c.call(a)){case"[object Date]":return"date";

case"[object RegExp]":return"regexp";case"[object Arguments]":return"arguments";case"[object Array]":return"array";case"[object Error]":return"error"}return null===a?"null":void 0===a?"undefined":a!==a?"nan":a&&1===a.nodeType?"element":(a=a.valueOf?a.valueOf():Object.prototype.valueOf.apply(a),typeof a)}},{}],18:[function(a,b,c){function d(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}function e(){var a=arguments,b=this.useColors;if(a[0]=(b?"%c":"")+this.namespace+(b?" %c":" ")+a[0]+(b?"%c ":" ")+"+"+c.humanize(this.diff),!b)return a;var d="color: "+this.color;a=[a[0],d,"color: inherit"].concat(Array.prototype.slice.call(a,1));var e=0,f=0;return a[0].replace(/%[a-z%]/g,function(a){"%%"!==a&&(e++,"%c"===a&&(f=e))}),a.splice(f,0,d),a}function f(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function g(a){try{null==a?c.storage.removeItem("debug"):c.storage.debug=a}catch(b){}}function h(){var a;try{a=c.storage.debug}catch(b){}return a}function i(){try{return window.localStorage}catch(a){}}c=b.exports=a("./debug"),c.log=f,c.formatArgs=e,c.save=g,c.load=h,c.useColors=d,c.storage="undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage?chrome.storage.local:i(),c.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],c.formatters.j=function(a){return JSON.stringify(a)},c.enable(h())},{"./debug":19}],19:[function(a,b,c){function d(){return c.colors[k++%c.colors.length]}function e(a){function b(){}function e(){var a=e,b=+new Date,f=b-(j||b);a.diff=f,a.prev=j,a.curr=b,j=b,null==a.useColors&&(a.useColors=c.useColors()),null==a.color&&a.useColors&&(a.color=d());var g=Array.prototype.slice.call(arguments);g[0]=c.coerce(g[0]),"string"!=typeof g[0]&&(g=["%o"].concat(g));var h=0;g[0]=g[0].replace(/%([a-z%])/g,function(b,d){if("%%"===b)return b;h++;var e=c.formatters[d];if("function"==typeof e){var f=g[h];b=e.call(a,f),g.splice(h,1),h--}return b}),"function"==typeof c.formatArgs&&(g=c.formatArgs.apply(a,g));var i=e.log||c.log||console.log.bind(console);i.apply(a,g)}b.enabled=!1,e.enabled=!0;var f=c.enabled(a)?e:b;return f.namespace=a,f}function f(a){c.save(a);for(var b=(a||"").split(/[\s,]+/),d=b.length,e=0;d>e;e++)b[e]&&(a=b[e].replace(/\*/g,".*?"),"-"===a[0]?c.skips.push(new RegExp("^"+a.substr(1)+"$")):c.names.push(new RegExp("^"+a+"$")))}function g(){c.enable("")}function h(a){var b,d;for(b=0,d=c.skips.length;d>b;b++)if(c.skips[b].test(a))return!1;for(b=0,d=c.names.length;d>b;b++)if(c.names[b].test(a))return!0;return!1}function i(a){return a instanceof Error?a.stack||a.message:a}c=b.exports=e,c.coerce=i,c.disable=g,c.enable=f,c.enabled=h,c.humanize=a("ms"),c.names=[],c.skips=[],c.formatters={};var j,k=0},{ms:20}],20:[function(a,b){function c(a){if(a=""+a,!(a.length>1e4)){var b=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(a);if(b){var c=parseFloat(b[1]),d=(b[2]||"ms").toLowerCase();switch(d){case"years":case"year":case"yrs":case"yr":case"y":return c*k;case"days":case"day":case"d":return c*j;case"hours":case"hour":case"hrs":case"hr":case"h":return c*i;case"minutes":case"minute":case"mins":case"min":case"m":return c*h;case"seconds":case"second":case"secs":case"sec":case"s":return c*g;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return c}}}}function d(a){return a>=j?Math.round(a/j)+"d":a>=i?Math.round(a/i)+"h":a>=h?Math.round(a/h)+"m":a>=g?Math.round(a/g)+"s":a+"ms"}function e(a){return f(a,j,"day")||f(a,i,"hour")||f(a,h,"minute")||f(a,g,"second")||a+" ms"}function f(a,b,c){return b>a?void 0:1.5*b>a?Math.floor(a/b)+" "+c:Math.ceil(a/b)+" "+c+"s"}var g=1e3,h=60*g,i=60*h,j=24*i,k=365.25*j;b.exports=function(a,b){return b=b||{},"string"==typeof a?c(a):b["long"]?e(a):d(a)}},{}],21:[function(a,b,c){function d(a,b,c){if(~b.indexOf(".")){for(var d=b.split("."),f=a,g=0;g<d.length-1;g++)Number(d[g])==d[g]&&"array"==e(f)?f=f[d[g]]:"object"==e(f)&&(c&&!f.hasOwnProperty(d[g])&&(f[d[g]]={}),f&&(f=f[d[g]]));return f}return a}var e=a("type-component");c.get=function(a,b){if(!~b.indexOf("."))return a[b];var c=d(a,b),f=b.split(".").pop(),g=e(c);return"object"==g||"array"==g?c[f]:void 0},c.set=function(a,b,c){if(~b.indexOf(".")){var f=d(a,b,!0),g=b.split(".").pop();f&&"object"==e(f)&&(f[g]=c)}else a[b]=c},c.parent=d},{"type-component":22}],22:[function(a,b){var c=Object.prototype.toString;b.exports=function(a){switch(c.call(a)){case"[object Function]":return"function";case"[object Date]":return"date";case"[object RegExp]":return"regexp";case"[object Arguments]":return"arguments";case"[object Array]":return"array"}return null===a?"null":void 0===a?"undefined":a===Object(a)?"object":typeof a}},{}],23:[function(a,b){function c(a,b){switch(d(a)){case"null":case"undefined":return null==b;case"regexp":return a.test(b);case"array":if("array"==d(b)&&a.length==b.length){for(var e=0;e<a.length;e++)if(!c(b[e],a[e]))return!1;return!0}return!1;case"object":var f={};for(var e in a){if(a.hasOwnProperty(e)&&(!b.hasOwnProperty(e)||!c(a[e],b[e])))return!1;f[e]=!0}for(var e in b)if(b.hasOwnProperty(e)&&!f.hasOwnProperty(e))return!1;return!0;default:return a===b}}var d=a("component-type");b.exports=c},{"component-type":17}],24:[function(a,b,c){var d=Object.prototype.hasOwnProperty;c.keys=Object.keys||function(a){var b=[];for(var c in a)d.call(a,c)&&b.push(c);return b},c.values=function(a){var b=[];for(var c in a)d.call(a,c)&&b.push(a[c]);return b},c.merge=function(a,b){for(var c in b)d.call(b,c)&&(a[c]=b[c]);return a},c.length=function(a){return c.keys(a).length},c.isEmpty=function(a){return 0==c.length(a)}},{}],25:[function(a,b,c){var d=a("mongo-eql"),e=a("component-type");c.$ne=function(a,b){return!d(a,b)},c.$gt=function(a,b){return"number"===e(a)&&b>a},c.$gte=function(a,b){return"number"===e(a)&&b>=a},c.$lt=function(a,b){return"number"===e(a)&&a>b},c.$lte=function(a,b){return"number"===e(a)&&a>=b},c.$regex=function(a,b){return"regexp"!=e("matcher")&&(a=new RegExp(a)),a.test(b)},c.$exists=function(a,b){return a?void 0!==b:void 0===b},c.$in=function(a,b){if("array"!=e(a))return!1;for(var c=0;c<a.length;c++)if(d(a[c],b))return!0;return!1},c.$nin=function(a,b){return!c.$in(a,b)},c.$size=function(a,b){return Array.isArray(b)&&a==b.length}},{"component-type":17,"mongo-eql":23}],26:[function(a,b,c){var d=a("./lib/core").CryptoJS;a("./lib/enc-base64"),a("./lib/md5"),a("./lib/evpkdf"),a("./lib/cipher-core"),a("./lib/aes");var e=a("./lib/jsonformatter").JsonFormatter;c.CryptoJS=d,c.JsonFormatter=e},{"./lib/aes":27,"./lib/cipher-core":28,"./lib/core":29,"./lib/enc-base64":30,"./lib/evpkdf":31,"./lib/jsonformatter":32,"./lib/md5":33}],27:[function(a){var b=a("./core").CryptoJS;/*
CryptoJS v3.1.2
code.google.com/p/crypto-js
(c) 2009-2013 by Jeff Mott. All rights reserved.
code.google.com/p/crypto-js/wiki/License
*/
!function(){var a=b,c=a.lib,d=c.BlockCipher,e=a.algo,f=[],g=[],h=[],i=[],j=[],k=[],l=[],m=[],n=[],o=[];!function(){for(var a=[],b=0;256>b;b++)a[b]=128>b?b<<1:b<<1^283;for(var c=0,d=0,b=0;256>b;b++){var e=d^d<<1^d<<2^d<<3^d<<4;e=e>>>8^255&e^99,f[c]=e,g[e]=c;var p=a[c],q=a[p],r=a[q],s=257*a[e]^16843008*e;h[c]=s<<24|s>>>8,i[c]=s<<16|s>>>16,j[c]=s<<8|s>>>24,k[c]=s;var s=16843009*r^65537*q^257*p^16843008*c;l[e]=s<<24|s>>>8,m[e]=s<<16|s>>>16,n[e]=s<<8|s>>>24,o[e]=s,c?(c=p^a[a[a[r^p]]],d^=a[a[d]]):c=d=1}}();var p=[0,1,2,4,8,16,32,64,128,27,54],q=e.AES=d.extend({_doReset:function(){for(var a=this._key,b=a.words,c=a.sigBytes/4,d=this._nRounds=c+6,e=4*(d+1),g=this._keySchedule=[],h=0;e>h;h++)if(c>h)g[h]=b[h];else{var i=g[h-1];h%c?c>6&&h%c==4&&(i=f[i>>>24]<<24|f[i>>>16&255]<<16|f[i>>>8&255]<<8|f[255&i]):(i=i<<8|i>>>24,i=f[i>>>24]<<24|f[i>>>16&255]<<16|f[i>>>8&255]<<8|f[255&i],i^=p[h/c|0]<<24),g[h]=g[h-c]^i}for(var j=this._invKeySchedule=[],k=0;e>k;k++){var h=e-k;if(k%4)var i=g[h];else var i=g[h-4];j[k]=4>k||4>=h?i:l[f[i>>>24]]^m[f[i>>>16&255]]^n[f[i>>>8&255]]^o[f[255&i]]}},encryptBlock:function(a,b){this._doCryptBlock(a,b,this._keySchedule,h,i,j,k,f)},decryptBlock:function(a,b){var c=a[b+1];a[b+1]=a[b+3],a[b+3]=c,this._doCryptBlock(a,b,this._invKeySchedule,l,m,n,o,g);var c=a[b+1];a[b+1]=a[b+3],a[b+3]=c},_doCryptBlock:function(a,b,c,d,e,f,g,h){for(var i=this._nRounds,j=a[b]^c[0],k=a[b+1]^c[1],l=a[b+2]^c[2],m=a[b+3]^c[3],n=4,o=1;i>o;o++){var p=d[j>>>24]^e[k>>>16&255]^f[l>>>8&255]^g[255&m]^c[n++],q=d[k>>>24]^e[l>>>16&255]^f[m>>>8&255]^g[255&j]^c[n++],r=d[l>>>24]^e[m>>>16&255]^f[j>>>8&255]^g[255&k]^c[n++],s=d[m>>>24]^e[j>>>16&255]^f[k>>>8&255]^g[255&l]^c[n++];j=p,k=q,l=r,m=s}var p=(h[j>>>24]<<24|h[k>>>16&255]<<16|h[l>>>8&255]<<8|h[255&m])^c[n++],q=(h[k>>>24]<<24|h[l>>>16&255]<<16|h[m>>>8&255]<<8|h[255&j])^c[n++],r=(h[l>>>24]<<24|h[m>>>16&255]<<16|h[j>>>8&255]<<8|h[255&k])^c[n++],s=(h[m>>>24]<<24|h[j>>>16&255]<<16|h[k>>>8&255]<<8|h[255&l])^c[n++];a[b]=p,a[b+1]=q,a[b+2]=r,a[b+3]=s},keySize:8});a.AES=d._createHelper(q)}()},{"./core":29}],28:[function(a){var b=a("./core").CryptoJS;/*
CryptoJS v3.1.2
code.google.com/p/crypto-js
(c) 2009-2013 by Jeff Mott. All rights reserved.
code.google.com/p/crypto-js/wiki/License
*/
b.lib.Cipher||function(a){var c=b,d=c.lib,e=d.Base,f=d.WordArray,g=d.BufferedBlockAlgorithm,h=c.enc,i=(h.Utf8,h.Base64),j=c.algo,k=j.EvpKDF,l=d.Cipher=g.extend({cfg:e.extend(),createEncryptor:function(a,b){return this.create(this._ENC_XFORM_MODE,a,b)},createDecryptor:function(a,b){return this.create(this._DEC_XFORM_MODE,a,b)},init:function(a,b,c){this.cfg=this.cfg.extend(c),this._xformMode=a,this._key=b,this.reset()},reset:function(){g.reset.call(this),this._doReset()},process:function(a){return this._append(a),this._process()},finalize:function(a){a&&this._append(a);var b=this._doFinalize();return b},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function a(a){return"string"==typeof a?x:u}return function(b){return{encrypt:function(c,d,e){return a(d).encrypt(b,c,d,e)},decrypt:function(c,d,e){return a(d).decrypt(b,c,d,e)}}}}()}),m=(d.StreamCipher=l.extend({_doFinalize:function(){var a=this._process(!0);return a},blockSize:1}),c.mode={}),n=d.BlockCipherMode=e.extend({createEncryptor:function(a,b){return this.Encryptor.create(a,b)},createDecryptor:function(a,b){return this.Decryptor.create(a,b)},init:function(a,b){this._cipher=a,this._iv=b}}),o=m.CBC=function(){function b(b,c,d){var e=this._iv;if(e){var f=e;this._iv=a}else var f=this._prevBlock;for(var g=0;d>g;g++)b[c+g]^=f[g]}var c=n.extend();return c.Encryptor=c.extend({processBlock:function(a,c){var d=this._cipher,e=d.blockSize;b.call(this,a,c,e),d.encryptBlock(a,c),this._prevBlock=a.slice(c,c+e)}}),c.Decryptor=c.extend({processBlock:function(a,c){var d=this._cipher,e=d.blockSize,f=a.slice(c,c+e);d.decryptBlock(a,c),b.call(this,a,c,e),this._prevBlock=f}}),c}(),p=c.pad={},q=p.Pkcs7={pad:function(a,b){for(var c=4*b,d=c-a.sigBytes%c,e=d<<24|d<<16|d<<8|d,g=[],h=0;d>h;h+=4)g.push(e);var i=f.create(g,d);a.concat(i)},unpad:function(a){var b=255&a.words[a.sigBytes-1>>>2];a.sigBytes-=b}},r=(d.BlockCipher=l.extend({cfg:l.cfg.extend({mode:o,padding:q}),reset:function(){l.reset.call(this);var a=this.cfg,b=a.iv,c=a.mode;if(this._xformMode==this._ENC_XFORM_MODE)var d=c.createEncryptor;else{var d=c.createDecryptor;this._minBufferSize=1}this._mode=d.call(c,this,b&&b.words)},_doProcessBlock:function(a,b){this._mode.processBlock(a,b)},_doFinalize:function(){var a=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){a.pad(this._data,this.blockSize);var b=this._process(!0)}else{var b=this._process(!0);a.unpad(b)}return b},blockSize:4}),d.CipherParams=e.extend({init:function(a){this.mixIn(a)},toString:function(a){return(a||this.formatter).stringify(this)}})),s=c.format={},t=s.OpenSSL={stringify:function(a){var b=a.ciphertext,c=a.salt;if(c)var d=f.create([1398893684,1701076831]).concat(c).concat(b);else var d=b;return d.toString(i)},parse:function(a){var b=i.parse(a),c=b.words;if(1398893684==c[0]&&1701076831==c[1]){var d=f.create(c.slice(2,4));c.splice(0,4),b.sigBytes-=16}return r.create({ciphertext:b,salt:d})}},u=d.SerializableCipher=e.extend({cfg:e.extend({format:t}),encrypt:function(a,b,c,d){d=this.cfg.extend(d);var e=a.createEncryptor(c,d),f=e.finalize(b),g=e.cfg;return r.create({ciphertext:f,key:c,iv:g.iv,algorithm:a,mode:g.mode,padding:g.padding,blockSize:a.blockSize,formatter:d.format})},decrypt:function(a,b,c,d){d=this.cfg.extend(d),b=this._parse(b,d.format);var e=a.createDecryptor(c,d).finalize(b.ciphertext);return e},_parse:function(a,b){return"string"==typeof a?b.parse(a,this):a}}),v=c.kdf={},w=v.OpenSSL={execute:function(a,b,c,d){d||(d=f.random(8));var e=k.create({keySize:b+c}).compute(a,d),g=f.create(e.words.slice(b),4*c);return e.sigBytes=4*b,r.create({key:e,iv:g,salt:d})}},x=d.PasswordBasedCipher=u.extend({cfg:u.cfg.extend({kdf:w}),encrypt:function(a,b,c,d){d=this.cfg.extend(d);var e=d.kdf.execute(c,a.keySize,a.ivSize);d.iv=e.iv;var f=u.encrypt.call(this,a,b,e.key,d);return f.mixIn(e),f},decrypt:function(a,b,c,d){d=this.cfg.extend(d),b=this._parse(b,d.format);var e=d.kdf.execute(c,a.keySize,a.ivSize,b.salt);d.iv=e.iv;var f=u.decrypt.call(this,a,b,e.key,d);return f}})}()},{"./core":29}],29:[function(a,b,c){/*
CryptoJS v3.1.2
code.google.com/p/crypto-js
(c) 2009-2013 by Jeff Mott. All rights reserved.
code.google.com/p/crypto-js/wiki/License
*/
var d=d||function(a,b){var c={},d=c.lib={},e=d.Base=function(){function a(){}return{extend:function(b){a.prototype=this;var c=new a;return b&&c.mixIn(b),c.hasOwnProperty("init")||(c.init=function(){c.$super.init.apply(this,arguments)}),c.init.prototype=c,c.$super=this,c},create:function(){var a=this.extend();return a.init.apply(a,arguments),a},init:function(){},mixIn:function(a){for(var b in a)a.hasOwnProperty(b)&&(this[b]=a[b]);a.hasOwnProperty("toString")&&(this.toString=a.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),f=d.WordArray=e.extend({init:function(a,c){a=this.words=a||[],this.sigBytes=c!=b?c:4*a.length},toString:function(a){return(a||h).stringify(this)},concat:function(a){var b=this.words,c=a.words,d=this.sigBytes,e=a.sigBytes;if(this.clamp(),d%4)for(var f=0;e>f;f++){var g=c[f>>>2]>>>24-f%4*8&255;b[d+f>>>2]|=g<<24-(d+f)%4*8}else if(c.length>65535)for(var f=0;e>f;f+=4)b[d+f>>>2]=c[f>>>2];else b.push.apply(b,c);return this.sigBytes+=e,this},clamp:function(){var b=this.words,c=this.sigBytes;b[c>>>2]&=4294967295<<32-c%4*8,b.length=a.ceil(c/4)},clone:function(){var a=e.clone.call(this);return a.words=this.words.slice(0),a},random:function(b){for(var c=[],d=0;b>d;d+=4)c.push(4294967296*a.random()|0);return new f.init(c,b)}}),g=c.enc={},h=g.Hex={stringify:function(a){for(var b=a.words,c=a.sigBytes,d=[],e=0;c>e;e++){var f=b[e>>>2]>>>24-e%4*8&255;d.push((f>>>4).toString(16)),d.push((15&f).toString(16))}return d.join("")},parse:function(a){for(var b=a.length,c=[],d=0;b>d;d+=2)c[d>>>3]|=parseInt(a.substr(d,2),16)<<24-d%8*4;return new f.init(c,b/2)}},i=g.Latin1={stringify:function(a){for(var b=a.words,c=a.sigBytes,d=[],e=0;c>e;e++){var f=b[e>>>2]>>>24-e%4*8&255;d.push(String.fromCharCode(f))}return d.join("")},parse:function(a){for(var b=a.length,c=[],d=0;b>d;d++)c[d>>>2]|=(255&a.charCodeAt(d))<<24-d%4*8;return new f.init(c,b)}},j=g.Utf8={stringify:function(a){try{return decodeURIComponent(escape(i.stringify(a)))}catch(b){throw new Error("Malformed UTF-8 data")}},parse:function(a){return i.parse(unescape(encodeURIComponent(a)))}},k=d.BufferedBlockAlgorithm=e.extend({reset:function(){this._data=new f.init,this._nDataBytes=0},_append:function(a){"string"==typeof a&&(a=j.parse(a)),this._data.concat(a),this._nDataBytes+=a.sigBytes},_process:function(b){var c=this._data,d=c.words,e=c.sigBytes,g=this.blockSize,h=4*g,i=e/h;i=b?a.ceil(i):a.max((0|i)-this._minBufferSize,0);var j=i*g,k=a.min(4*j,e);if(j){for(var l=0;j>l;l+=g)this._doProcessBlock(d,l);var m=d.splice(0,j);c.sigBytes-=k}return new f.init(m,k)},clone:function(){var a=e.clone.call(this);return a._data=this._data.clone(),a},_minBufferSize:0}),l=(d.Hasher=k.extend({cfg:e.extend(),init:function(a){this.cfg=this.cfg.extend(a),this.reset()},reset:function(){k.reset.call(this),this._doReset()},update:function(a){return this._append(a),this._process(),this},finalize:function(a){a&&this._append(a);var b=this._doFinalize();return b},blockSize:16,_createHelper:function(a){return function(b,c){return new a.init(c).finalize(b)}},_createHmacHelper:function(a){return function(b,c){return new l.HMAC.init(a,c).finalize(b)}}}),c.algo={});return c}(Math);c.CryptoJS=d},{}],30:[function(a){var b=a("./core").CryptoJS;/*
CryptoJS v3.1.2
code.google.com/p/crypto-js
(c) 2009-2013 by Jeff Mott. All rights reserved.
code.google.com/p/crypto-js/wiki/License
*/
!function(){{var a=b,c=a.lib,d=c.WordArray,e=a.enc;e.Base64={stringify:function(a){var b=a.words,c=a.sigBytes,d=this._map;a.clamp();for(var e=[],f=0;c>f;f+=3)for(var g=b[f>>>2]>>>24-f%4*8&255,h=b[f+1>>>2]>>>24-(f+1)%4*8&255,i=b[f+2>>>2]>>>24-(f+2)%4*8&255,j=g<<16|h<<8|i,k=0;4>k&&c>f+.75*k;k++)e.push(d.charAt(j>>>6*(3-k)&63));var l=d.charAt(64);if(l)for(;e.length%4;)e.push(l);return e.join("")},parse:function(a){var b=a.length,c=this._map,e=c.charAt(64);if(e){var f=a.indexOf(e);-1!=f&&(b=f)}for(var g=[],h=0,i=0;b>i;i++)if(i%4){var j=c.indexOf(a.charAt(i-1))<<i%4*2,k=c.indexOf(a.charAt(i))>>>6-i%4*2;g[h>>>2]|=(j|k)<<24-h%4*8,h++}return d.create(g,h)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}}()},{"./core":29}],31:[function(a){var b=a("./core").CryptoJS;/*
CryptoJS v3.1.2
code.google.com/p/crypto-js
(c) 2009-2013 by Jeff Mott. All rights reserved.
code.google.com/p/crypto-js/wiki/License
*/
!function(){var a=b,c=a.lib,d=c.Base,e=c.WordArray,f=a.algo,g=f.MD5,h=f.EvpKDF=d.extend({cfg:d.extend({keySize:4,hasher:g,iterations:1}),init:function(a){this.cfg=this.cfg.extend(a)},compute:function(a,b){for(var c=this.cfg,d=c.hasher.create(),f=e.create(),g=f.words,h=c.keySize,i=c.iterations;g.length<h;){j&&d.update(j);var j=d.update(a).finalize(b);d.reset();for(var k=1;i>k;k++)j=d.finalize(j),d.reset();f.concat(j)}return f.sigBytes=4*h,f}});a.EvpKDF=function(a,b,c){return h.create(c).compute(a,b)}}()},{"./core":29}],32:[function(a,b,c){var d=a("./core").CryptoJS,e={stringify:function(a){var b={ct:a.ciphertext.toString(d.enc.Base64)};return a.iv&&(b.iv=a.iv.toString()),a.salt&&(b.s=a.salt.toString()),JSON.stringify(b)},parse:function(a){var b=JSON.parse(a),c=d.lib.CipherParams.create({ciphertext:d.enc.Base64.parse(b.ct)});return b.iv&&(c.iv=d.enc.Hex.parse(b.iv)),b.s&&(c.salt=d.enc.Hex.parse(b.s)),c}};c.JsonFormatter=e},{"./core":29}],33:[function(a){var b=a("./core").CryptoJS;/*
CryptoJS v3.1.2
code.google.com/p/crypto-js
(c) 2009-2013 by Jeff Mott. All rights reserved.
code.google.com/p/crypto-js/wiki/License
*/
!function(a){function c(a,b,c,d,e,f,g){var h=a+(b&c|~b&d)+e+g;return(h<<f|h>>>32-f)+b}function d(a,b,c,d,e,f,g){var h=a+(b&d|c&~d)+e+g;return(h<<f|h>>>32-f)+b}function e(a,b,c,d,e,f,g){var h=a+(b^c^d)+e+g;return(h<<f|h>>>32-f)+b}function f(a,b,c,d,e,f,g){var h=a+(c^(b|~d))+e+g;return(h<<f|h>>>32-f)+b}var g=b,h=g.lib,i=h.WordArray,j=h.Hasher,k=g.algo,l=[];!function(){for(var b=0;64>b;b++)l[b]=4294967296*a.abs(a.sin(b+1))|0}();var m=k.MD5=j.extend({_doReset:function(){this._hash=new i.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(a,b){for(var g=0;16>g;g++){var h=b+g,i=a[h];a[h]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8)}var j=this._hash.words,k=a[b+0],m=a[b+1],n=a[b+2],o=a[b+3],p=a[b+4],q=a[b+5],r=a[b+6],s=a[b+7],t=a[b+8],u=a[b+9],v=a[b+10],w=a[b+11],x=a[b+12],y=a[b+13],z=a[b+14],A=a[b+15],B=j[0],C=j[1],D=j[2],E=j[3];B=c(B,C,D,E,k,7,l[0]),E=c(E,B,C,D,m,12,l[1]),D=c(D,E,B,C,n,17,l[2]),C=c(C,D,E,B,o,22,l[3]),B=c(B,C,D,E,p,7,l[4]),E=c(E,B,C,D,q,12,l[5]),D=c(D,E,B,C,r,17,l[6]),C=c(C,D,E,B,s,22,l[7]),B=c(B,C,D,E,t,7,l[8]),E=c(E,B,C,D,u,12,l[9]),D=c(D,E,B,C,v,17,l[10]),C=c(C,D,E,B,w,22,l[11]),B=c(B,C,D,E,x,7,l[12]),E=c(E,B,C,D,y,12,l[13]),D=c(D,E,B,C,z,17,l[14]),C=c(C,D,E,B,A,22,l[15]),B=d(B,C,D,E,m,5,l[16]),E=d(E,B,C,D,r,9,l[17]),D=d(D,E,B,C,w,14,l[18]),C=d(C,D,E,B,k,20,l[19]),B=d(B,C,D,E,q,5,l[20]),E=d(E,B,C,D,v,9,l[21]),D=d(D,E,B,C,A,14,l[22]),C=d(C,D,E,B,p,20,l[23]),B=d(B,C,D,E,u,5,l[24]),E=d(E,B,C,D,z,9,l[25]),D=d(D,E,B,C,o,14,l[26]),C=d(C,D,E,B,t,20,l[27]),B=d(B,C,D,E,y,5,l[28]),E=d(E,B,C,D,n,9,l[29]),D=d(D,E,B,C,s,14,l[30]),C=d(C,D,E,B,x,20,l[31]),B=e(B,C,D,E,q,4,l[32]),E=e(E,B,C,D,t,11,l[33]),D=e(D,E,B,C,w,16,l[34]),C=e(C,D,E,B,z,23,l[35]),B=e(B,C,D,E,m,4,l[36]),E=e(E,B,C,D,p,11,l[37]),D=e(D,E,B,C,s,16,l[38]),C=e(C,D,E,B,v,23,l[39]),B=e(B,C,D,E,y,4,l[40]),E=e(E,B,C,D,k,11,l[41]),D=e(D,E,B,C,o,16,l[42]),C=e(C,D,E,B,r,23,l[43]),B=e(B,C,D,E,u,4,l[44]),E=e(E,B,C,D,x,11,l[45]),D=e(D,E,B,C,A,16,l[46]),C=e(C,D,E,B,n,23,l[47]),B=f(B,C,D,E,k,6,l[48]),E=f(E,B,C,D,s,10,l[49]),D=f(D,E,B,C,z,15,l[50]),C=f(C,D,E,B,q,21,l[51]),B=f(B,C,D,E,x,6,l[52]),E=f(E,B,C,D,o,10,l[53]),D=f(D,E,B,C,v,15,l[54]),C=f(C,D,E,B,m,21,l[55]),B=f(B,C,D,E,t,6,l[56]),E=f(E,B,C,D,A,10,l[57]),D=f(D,E,B,C,r,15,l[58]),C=f(C,D,E,B,y,21,l[59]),B=f(B,C,D,E,p,6,l[60]),E=f(E,B,C,D,w,10,l[61]),D=f(D,E,B,C,n,15,l[62]),C=f(C,D,E,B,u,21,l[63]),j[0]=j[0]+B|0,j[1]=j[1]+C|0,j[2]=j[2]+D|0,j[3]=j[3]+E|0},_doFinalize:function(){var b=this._data,c=b.words,d=8*this._nDataBytes,e=8*b.sigBytes;c[e>>>5]|=128<<24-e%32;var f=a.floor(d/4294967296),g=d;c[(e+64>>>9<<4)+15]=16711935&(f<<8|f>>>24)|4278255360&(f<<24|f>>>8),c[(e+64>>>9<<4)+14]=16711935&(g<<8|g>>>24)|4278255360&(g<<24|g>>>8),b.sigBytes=4*(c.length+1),this._process();for(var h=this._hash,i=h.words,j=0;4>j;j++){var k=i[j];i[j]=16711935&(k<<8|k>>>24)|4278255360&(k<<24|k>>>8)}return h},clone:function(){var a=j.clone.call(this);return a._hash=this._hash.clone(),a}});g.MD5=j._createHelper(m),g.HmacMD5=j._createHmacHelper(m)}(Math)},{"./core":29}],34:[function(require,module,exports){/*!
  * Reqwest! A general purpose XHR connection manager
  * license MIT (c) Dustin Diaz 2014
  * https://github.com/ded/reqwest
  */
!function(a,b,c){"undefined"!=typeof module&&module.exports?module.exports=c():"function"==typeof define&&define.amd?define(c):b[a]=c()}("reqwest",this,function(){function succeed(a){var b=protocolRe.exec(a.url);return b=b&&b[1]||window.location.protocol,httpsRe.test(b)?twoHundo.test(a.request.status):!!a.request.response}function handleReadyState(a,b,c){return function(){return a._aborted?c(a.request):a._timedOut?c(a.request,"Request is aborted: timeout"):void(a.request&&4==a.request[readyState]&&(a.request.onreadystatechange=noop,succeed(a)?b(a.request):c(a.request)))}}function setHeaders(a,b){var c,d=b.headers||{};d.Accept=d.Accept||defaultHeaders.accept[b.type]||defaultHeaders.accept["*"];var e="function"==typeof FormData&&b.data instanceof FormData;b.crossOrigin||d[requestedWith]||(d[requestedWith]=defaultHeaders.requestedWith),d[contentType]||e||(d[contentType]=b.contentType||defaultHeaders.contentType);for(c in d)d.hasOwnProperty(c)&&"setRequestHeader"in a&&a.setRequestHeader(c,d[c])}function setCredentials(a,b){"undefined"!=typeof b.withCredentials&&"undefined"!=typeof a.withCredentials&&(a.withCredentials=!!b.withCredentials)}function generalCallback(a){lastValue=a}function urlappend(a,b){return a+(/\?/.test(a)?"&":"?")+b}function handleJsonp(a,b,c,d){var e=uniqid++,f=a.jsonpCallback||"callback",g=a.jsonpCallbackName||reqwest.getcallbackPrefix(e),h=new RegExp("((^|\\?|&)"+f+")=([^&]+)"),i=d.match(h),j=doc.createElement("script"),k=0,l=-1!==navigator.userAgent.indexOf("MSIE 10.0");return i?"?"===i[3]?d=d.replace(h,"$1="+g):g=i[3]:d=urlappend(d,f+"="+g),win[g]=generalCallback,j.type="text/javascript",j.src=d,j.async=!0,"undefined"==typeof j.onreadystatechange||l||(j.htmlFor=j.id="_reqwest_"+e),j.onload=j.onreadystatechange=function(){return j[readyState]&&"complete"!==j[readyState]&&"loaded"!==j[readyState]||k?!1:(j.onload=j.onreadystatechange=null,j.onclick&&j.onclick(),b(lastValue),lastValue=void 0,head.removeChild(j),void(k=1))},head.appendChild(j),{abort:function(){j.onload=j.onreadystatechange=null,c({},"Request is aborted: timeout",{}),lastValue=void 0,head.removeChild(j),k=1}}}function getRequest(a,b){var c,d=this.o,e=(d.method||"GET").toUpperCase(),f="string"==typeof d?d:d.url,g=d.processData!==!1&&d.data&&"string"!=typeof d.data?reqwest.toQueryString(d.data):d.data||null,h=!1;return"jsonp"!=d.type&&"GET"!=e||!g||(f=urlappend(f,g),g=null),"jsonp"==d.type?handleJsonp(d,a,b,f):(c=d.xhr&&d.xhr(d)||xhr(d),c.open(e,f,d.async===!1?!1:!0),setHeaders(c,d),setCredentials(c,d),win[xDomainRequest]&&c instanceof win[xDomainRequest]?(c.onload=a,c.onerror=b,c.onprogress=function(){},h=!0):c.onreadystatechange=handleReadyState(this,a,b),d.before&&d.before(c),h?setTimeout(function(){c.send(g)},200):c.send(g),c)}function Reqwest(a,b){this.o=a,this.fn=b,init.apply(this,arguments)}function setType(a){return a.match("json")?"json":a.match("javascript")?"js":a.match("text")?"html":a.match("xml")?"xml":void 0}function init(o,fn){function complete(a){for(o.timeout&&clearTimeout(self.timeout),self.timeout=null;self._completeHandlers.length>0;)self._completeHandlers.shift()(a)}function success(resp){var type=o.type||resp&&setType(resp.getResponseHeader("Content-Type"));resp="jsonp"!==type?self.request:resp;var filteredResponse=globalSetupOptions.dataFilter(resp.responseText,type),r=filteredResponse;try{resp.responseText=r}catch(e){}if(r)switch(type){case"json":try{resp=win.JSON?win.JSON.parse(r):eval("("+r+")")}catch(err){return error(resp,"Could not parse JSON in response",err)}break;case"js":resp=eval(r);break;case"html":resp=r;break;case"xml":resp=resp.responseXML&&resp.responseXML.parseError&&resp.responseXML.parseError.errorCode&&resp.responseXML.parseError.reason?null:resp.responseXML}for(self._responseArgs.resp=resp,self._fulfilled=!0,fn(resp),self._successHandler(resp);self._fulfillmentHandlers.length>0;)resp=self._fulfillmentHandlers.shift()(resp);complete(resp)}function timedOut(){self._timedOut=!0,self.request.abort()}function error(a,b,c){for(a=self.request,self._responseArgs.resp=a,self._responseArgs.msg=b,self._responseArgs.t=c,self._erred=!0;self._errorHandlers.length>0;)self._errorHandlers.shift()(a,b,c);complete(a)}this.url="string"==typeof o?o:o.url,this.timeout=null,this._fulfilled=!1,this._successHandler=function(){},this._fulfillmentHandlers=[],this._errorHandlers=[],this._completeHandlers=[],this._erred=!1,this._responseArgs={};var self=this;fn=fn||function(){},o.timeout&&(this.timeout=setTimeout(function(){timedOut()},o.timeout)),o.success&&(this._successHandler=function(){o.success.apply(o,arguments)}),o.error&&this._errorHandlers.push(function(){o.error.apply(o,arguments)}),o.complete&&this._completeHandlers.push(function(){o.complete.apply(o,arguments)}),this.request=getRequest.call(this,success,error)}function reqwest(a,b){return new Reqwest(a,b)}function normalize(a){return a?a.replace(/\r?\n/g,"\r\n"):""}function serial(a,b){var c,d,e,f,g=a.name,h=a.tagName.toLowerCase(),i=function(a){a&&!a.disabled&&b(g,normalize(a.attributes.value&&a.attributes.value.specified?a.value:a.text))};if(!a.disabled&&g)switch(h){case"input":/reset|button|image|file/i.test(a.type)||(c=/checkbox/i.test(a.type),d=/radio/i.test(a.type),e=a.value,(!(c||d)||a.checked)&&b(g,normalize(c&&""===e?"on":e)));break;case"textarea":b(g,normalize(a.value));break;case"select":if("select-one"===a.type.toLowerCase())i(a.selectedIndex>=0?a.options[a.selectedIndex]:null);else for(f=0;a.length&&f<a.length;f++)a.options[f].selected&&i(a.options[f])}}function eachFormElement(){var a,b,c=this,d=function(a,b){var d,e,f;for(d=0;d<b.length;d++)for(f=a[byTag](b[d]),e=0;e<f.length;e++)serial(f[e],c)};for(b=0;b<arguments.length;b++)a=arguments[b],/input|select|textarea/i.test(a.tagName)&&serial(a,c),d(a,["input","select","textarea"])}function serializeQueryString(){return reqwest.toQueryString(reqwest.serializeArray.apply(null,arguments))}function serializeHash(){var a={};return eachFormElement.apply(function(b,c){b in a?(a[b]&&!isArray(a[b])&&(a[b]=[a[b]]),a[b].push(c)):a[b]=c},arguments),a}function buildParams(a,b,c,d){var e,f,g,h=/\[\]$/;if(isArray(b))for(f=0;b&&f<b.length;f++)g=b[f],c||h.test(a)?d(a,g):buildParams(a+"["+("object"==typeof g?f:"")+"]",g,c,d);else if(b&&"[object Object]"===b.toString())for(e in b)buildParams(a+"["+e+"]",b[e],c,d);else d(a,b)}var win=window,doc=document,httpsRe=/^http/,protocolRe=/(^\w+):\/\//,twoHundo=/^(20\d|1223)$/,byTag="getElementsByTagName",readyState="readyState",contentType="Content-Type",requestedWith="X-Requested-With",head=doc[byTag]("head")[0],uniqid=0,callbackPrefix="reqwest_"+ +new Date,lastValue,xmlHttpRequest="XMLHttpRequest",xDomainRequest="XDomainRequest",noop=function(){},isArray="function"==typeof Array.isArray?Array.isArray:function(a){return a instanceof Array},defaultHeaders={contentType:"application/x-www-form-urlencoded",requestedWith:xmlHttpRequest,accept:{"*":"text/javascript, text/html, application/xml, text/xml, */*",xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript",js:"application/javascript, text/javascript"}},xhr=function(a){if(a.crossOrigin===!0){var b=win[xmlHttpRequest]?new XMLHttpRequest:null;if(b&&"withCredentials"in b)return b;if(win[xDomainRequest])return new XDomainRequest;throw new Error("Browser does not support cross-origin requests")}return win[xmlHttpRequest]?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")},globalSetupOptions={dataFilter:function(a){return a}};return Reqwest.prototype={abort:function(){this._aborted=!0,this.request.abort()},retry:function(){init.call(this,this.o,this.fn)},then:function(a,b){return a=a||function(){},b=b||function(){},this._fulfilled?this._responseArgs.resp=a(this._responseArgs.resp):this._erred?b(this._responseArgs.resp,this._responseArgs.msg,this._responseArgs.t):(this._fulfillmentHandlers.push(a),this._errorHandlers.push(b)),this},always:function(a){return this._fulfilled||this._erred?a(this._responseArgs.resp):this._completeHandlers.push(a),this},fail:function(a){return this._erred?a(this._responseArgs.resp,this._responseArgs.msg,this._responseArgs.t):this._errorHandlers.push(a),this},"catch":function(a){return this.fail(a)}},reqwest.serializeArray=function(){var a=[];return eachFormElement.apply(function(b,c){a.push({name:b,value:c})},arguments),a},reqwest.serialize=function(){if(0===arguments.length)return"";var a,b,c=Array.prototype.slice.call(arguments,0);return a=c.pop(),a&&a.nodeType&&c.push(a)&&(a=null),a&&(a=a.type),b="map"==a?serializeHash:"array"==a?reqwest.serializeArray:serializeQueryString,b.apply(null,c)},reqwest.toQueryString=function(a,b){var c,d,e=b||!1,f=[],g=encodeURIComponent,h=function(a,b){b="function"==typeof b?b():null==b?"":b,f[f.length]=g(a)+"="+g(b)};if(isArray(a))for(d=0;a&&d<a.length;d++)h(a[d].name,a[d].value);else for(c in a)a.hasOwnProperty(c)&&buildParams(c,a[c],e,h);return f.join("&").replace(/%20/g,"+")},reqwest.getcallbackPrefix=function(){return callbackPrefix},reqwest.compat=function(a,b){return a&&(a.type&&(a.method=a.type)&&delete a.type,a.dataType&&(a.type=a.dataType),a.jsonpCallback&&(a.jsonpCallbackName=a.jsonpCallback)&&delete a.jsonpCallback,a.jsonp&&(a.jsonpCallback=a.jsonp)),new Reqwest(a,b)},reqwest.ajaxSetup=function(a){a=a||{};for(var b in a)globalSetupOptions[b]=a[b]},reqwest})},{}],35:[function(a,b){(function(c){/*!
 * @overview RSVP - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/tildeio/rsvp.js/master/LICENSE
 * @version   3.0.17
 */
(function(){"use strict";function d(a){return"function"==typeof a||"object"==typeof a&&null!==a}function e(a){return"function"==typeof a}function f(a){return"object"==typeof a&&null!==a}function g(){}function h(a,b){for(var c=0,d=a.length;d>c;c++)if(a[c]===b)return c;return-1}function i(a){var b=a._promiseCallbacks;return b||(b=a._promiseCallbacks={}),b}function j(a,b){return"onerror"===a?void ya.on("error",b):2!==arguments.length?ya[a]:void(ya[a]=b)}function k(){setTimeout(function(){for(var a,b=0;b<za.length;b++){a=za[b];var c=a.payload;c.guid=c.key+c.id,c.childGuid=c.key+c.childId,c.error&&(c.stack=c.error.stack),ya.trigger(a.name,a.payload)}za.length=0},50)}function l(a,b,c){1===za.push({name:a,payload:{key:b._guidKey,id:b._id,eventName:a,detail:b._result,childId:c&&c._id,label:b._label,timeStamp:va(),error:ya["instrument-with-stack"]?new Error(b._label):null}})&&k()}function m(){return new TypeError("A promises callback cannot return that same promise.")}function n(){}function o(a){try{return a.then}catch(b){return Ea.error=b,Ea}}function p(a,b,c,d){try{a.call(b,c,d)}catch(e){return e}}function q(a,b,c){ya.async(function(a){var d=!1,e=p(c,b,function(c){d||(d=!0,b!==c?t(a,c):v(a,c))},function(b){d||(d=!0,w(a,b))},"Settle: "+(a._label||" unknown promise"));!d&&e&&(d=!0,w(a,e))},a)}function r(a,b){b._state===Ca?v(a,b._result):b._state===Da?(b._onError=null,w(a,b._result)):x(b,void 0,function(c){b!==c?t(a,c):v(a,c)},function(b){w(a,b)})}function s(a,b){if(b.constructor===a.constructor)r(a,b);else{var c=o(b);c===Ea?w(a,Ea.error):void 0===c?v(a,b):e(c)?q(a,b,c):v(a,b)}}function t(a,b){a===b?v(a,b):d(b)?s(a,b):v(a,b)}function u(a){a._onError&&a._onError(a._result),y(a)}function v(a,b){a._state===Ba&&(a._result=b,a._state=Ca,0===a._subscribers.length?ya.instrument&&Aa("fulfilled",a):ya.async(y,a))}function w(a,b){a._state===Ba&&(a._state=Da,a._result=b,ya.async(u,a))}function x(a,b,c,d){var e=a._subscribers,f=e.length;a._onError=null,e[f]=b,e[f+Ca]=c,e[f+Da]=d,0===f&&a._state&&ya.async(y,a)}function y(a){var b=a._subscribers,c=a._state;if(ya.instrument&&Aa(c===Ca?"fulfilled":"rejected",a),0!==b.length){for(var d,e,f=a._result,g=0;g<b.length;g+=3)d=b[g],e=b[g+c],d?B(c,d,e,f):e(f);a._subscribers.length=0}}function z(){this.error=null}function A(a,b){try{return a(b)}catch(c){return Fa.error=c,Fa}}function B(a,b,c,d){var f,g,h,i,j=e(c);if(j){if(f=A(c,d),f===Fa?(i=!0,g=f.error,f=null):h=!0,b===f)return void w(b,m())}else f=d,h=!0;b._state!==Ba||(j&&h?t(b,f):i?w(b,g):a===Ca?v(b,f):a===Da&&w(b,f))}function C(a,b){var c=!1;try{b(function(b){c||(c=!0,t(a,b))},function(b){c||(c=!0,w(a,b))})}catch(d){w(a,d)}}function D(a,b,c){return a===Ca?{state:"fulfilled",value:c}:{state:"rejected",reason:c}}function E(a,b,c,d){this._instanceConstructor=a,this.promise=new a(n,d),this._abortOnReject=c,this._validateInput(b)?(this._input=b,this.length=b.length,this._remaining=b.length,this._init(),0===this.length?v(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&v(this.promise,this._result))):w(this.promise,this._validationError())}function F(a,b){return new Ga(this,a,!0,b).promise}function G(a,b){function c(a){t(f,a)}function d(a){w(f,a)}var e=this,f=new e(n,b);if(!ua(a))return w(f,new TypeError("You must pass an array to race.")),f;for(var g=a.length,h=0;f._state===Ba&&g>h;h++)x(e.resolve(a[h]),void 0,c,d);return f}function H(a,b){var c=this;if(a&&"object"==typeof a&&a.constructor===c)return a;var d=new c(n,b);return t(d,a),d}function I(a,b){var c=this,d=new c(n,b);return w(d,a),d}function J(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function K(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function L(a,b){this._id=Ma++,this._label=b,this._state=void 0,this._result=void 0,this._subscribers=[],ya.instrument&&Aa("created",this),n!==a&&(e(a)||J(),this instanceof L||K(),C(this,a))}function M(a,b,c){this._superConstructor(a,b,!1,c)}function N(a,b){return new M(Na,a,b).promise}function O(a,b){return Na.all(a,b)}function P(a,b){Za[Sa]=a,Za[Sa+1]=b,Sa+=2,2===Sa&&Pa()}function Q(){var a=c.nextTick,b=c.versions.node.match(/^(?:(\d+)\.)?(?:(\d+)\.)?(\*|\d+)$/);return Array.isArray(b)&&"0"===b[1]&&"10"===b[2]&&(a=setImmediate),function(){a(V)}}function R(){return function(){Oa(V)}}function S(){var a=0,b=new Wa(V),c=document.createTextNode("");return b.observe(c,{characterData:!0}),function(){c.data=a=++a%2}}function T(){var a=new MessageChannel;return a.port1.onmessage=V,function(){a.port2.postMessage(0)}}function U(){return function(){setTimeout(V,1)}}function V(){for(var a=0;Sa>a;a+=2){var b=Za[a],c=Za[a+1];b(c),Za[a]=void 0,Za[a+1]=void 0}Sa=0}function W(){try{var b=a,c=b("vertx");return Oa=c.runOnLoop||c.runOnContext,R()}catch(d){return U()}}function X(a){var b={};return b.promise=new Na(function(a,c){b.resolve=a,b.reject=c},a),b}function Y(a,b,c){return Na.all(a,c).then(function(a){if(!e(b))throw new TypeError("You must pass a function as filter's second argument.");for(var d=a.length,f=new Array(d),g=0;d>g;g++)f[g]=b(a[g]);return Na.all(f,c).then(function(b){for(var c=new Array(d),e=0,f=0;d>f;f++)b[f]&&(c[e]=a[f],e++);return c.length=e,c})})}function Z(a,b,c){this._superConstructor(a,b,!0,c)}function $(a,b,c){this._superConstructor(a,b,!1,c)}function _(a,b){return new $(Na,a,b).promise}function aa(a,b){return new ab(Na,a,b).promise}function ba(a,b,c){return Na.all(a,c).then(function(a){if(!e(b))throw new TypeError("You must pass a function as map's second argument.");for(var d=a.length,f=new Array(d),g=0;d>g;g++)f[g]=b(a[g]);return Na.all(f,c)})}function ca(){this.value=void 0}function da(a){try{return a.then}catch(b){return eb.value=b,eb}}function ea(a,b,c){try{a.apply(b,c)}catch(d){return eb.value=d,eb}}function fa(a,b){for(var c,d,e={},f=a.length,g=new Array(f),h=0;f>h;h++)g[h]=a[h];for(d=0;d<b.length;d++)c=b[d],e[c]=g[d+1];return e}function ga(a){for(var b=a.length,c=new Array(b-1),d=1;b>d;d++)c[d-1]=a[d];return c}function ha(a,b){return{then:function(c,d){return a.call(b,c,d)}}}function ia(a,b){var c=function(){for(var c,d=this,e=arguments.length,f=new Array(e+1),g=!1,h=0;e>h;++h){if(c=arguments[h],!g){if(g=la(c),g===fb){var i=new Na(n);return w(i,fb.value),i}g&&g!==!0&&(c=ha(g,c))}f[h]=c}var j=new Na(n);return f[e]=function(a,c){a?w(j,a):void 0===b?t(j,c):b===!0?t(j,ga(arguments)):ua(b)?t(j,fa(arguments,b)):t(j,c)},g?ka(j,f,a,d):ja(j,f,a,d)};return c.__proto__=a,c}function ja(a,b,c,d){var e=ea(c,d,b);return e===eb&&w(a,e.value),a}function ka(a,b,c,d){return Na.all(b).then(function(b){var e=ea(c,d,b);return e===eb&&w(a,e.value),a})}function la(a){return a&&"object"==typeof a?a.constructor===Na?!0:da(a):!1}function ma(a,b){return Na.race(a,b)}function na(a,b){return Na.reject(a,b)}function oa(a,b){return Na.resolve(a,b)}function pa(a){throw setTimeout(function(){throw a}),a}function qa(a,b){ya.async(a,b)}function ra(){ya.on.apply(ya,arguments)}function sa(){ya.off.apply(ya,arguments)}var ta;ta=Array.isArray?Array.isArray:function(a){return"[object Array]"===Object.prototype.toString.call(a)};var ua=ta,va=Date.now||function(){return(new Date).getTime()},wa=Object.create||function(a){if(arguments.length>1)throw new Error("Second argument not supported");if("object"!=typeof a)throw new TypeError("Argument must be an object");return g.prototype=a,new g},xa={mixin:function(a){return a.on=this.on,a.off=this.off,a.trigger=this.trigger,a._promiseCallbacks=void 0,a},on:function(a,b){var c,d=i(this);c=d[a],c||(c=d[a]=[]),-1===h(c,b)&&c.push(b)},off:function(a,b){var c,d,e=i(this);return b?(c=e[a],d=h(c,b),void(-1!==d&&c.splice(d,1))):void(e[a]=[])},trigger:function(a,b){var c,d,e=i(this);if(c=e[a])for(var f=0;f<c.length;f++)(d=c[f])(b)}},ya={instrument:!1};xa.mixin(ya);var za=[],Aa=l,Ba=void 0,Ca=1,Da=2,Ea=new z,Fa=new z,Ga=E;E.prototype._validateInput=function(a){return ua(a)},E.prototype._validationError=function(){return new Error("Array Methods must be provided an Array")},E.prototype._init=function(){this._result=new Array(this.length)},E.prototype._enumerate=function(){for(var a=this.length,b=this.promise,c=this._input,d=0;b._state===Ba&&a>d;d++)this._eachEntry(c[d],d)},E.prototype._eachEntry=function(a,b){var c=this._instanceConstructor;f(a)?a.constructor===c&&a._state!==Ba?(a._onError=null,this._settledAt(a._state,b,a._result)):this._willSettleAt(c.resolve(a),b):(this._remaining--,this._result[b]=this._makeResult(Ca,b,a))},E.prototype._settledAt=function(a,b,c){var d=this.promise;d._state===Ba&&(this._remaining--,this._abortOnReject&&a===Da?w(d,c):this._result[b]=this._makeResult(a,b,c)),0===this._remaining&&v(d,this._result)},E.prototype._makeResult=function(a,b,c){return c},E.prototype._willSettleAt=function(a,b){var c=this;x(a,void 0,function(a){c._settledAt(Ca,b,a)},function(a){c._settledAt(Da,b,a)})};var Ha=F,Ia=G,Ja=H,Ka=I,La="rsvp_"+va()+"-",Ma=0,Na=L;L.cast=Ja,L.all=Ha,L.race=Ia,L.resolve=Ja,L.reject=Ka,L.prototype={constructor:L,_guidKey:La,_onError:function(a){ya.async(function(b){setTimeout(function(){b._onError&&ya.trigger("error",a)},0)},this)},then:function(a,b,c){var d=this,e=d._state;if(e===Ca&&!a||e===Da&&!b)return ya.instrument&&Aa("chained",this,this),this;d._onError=null;var f=new this.constructor(n,c),g=d._result;if(ya.instrument&&Aa("chained",d,f),e){var h=arguments[e-1];ya.async(function(){B(e,f,h,g)})}else x(d,f,a,b);return f},"catch":function(a,b){return this.then(null,a,b)},"finally":function(a,b){var c=this.constructor;return this.then(function(b){return c.resolve(a()).then(function(){return b})},function(b){return c.resolve(a()).then(function(){throw b})},b)}},M.prototype=wa(Ga.prototype),M.prototype._superConstructor=Ga,M.prototype._makeResult=D,M.prototype._validationError=function(){return new Error("allSettled must be called with an array")};var Oa,Pa,Qa=N,Ra=O,Sa=0,Ta=({}.toString,P),Ua="undefined"!=typeof window?window:void 0,Va=Ua||{},Wa=Va.MutationObserver||Va.WebKitMutationObserver,Xa="undefined"!=typeof c&&"[object process]"==={}.toString.call(c),Ya="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,Za=new Array(1e3);Pa=Xa?Q():Wa?S():Ya?T():void 0===Ua&&"function"==typeof a?W():U();var $a=X,_a=Y,ab=Z;Z.prototype=wa(Ga.prototype),Z.prototype._superConstructor=Ga,Z.prototype._init=function(){this._result={}},Z.prototype._validateInput=function(a){return a&&"object"==typeof a},Z.prototype._validationError=function(){return new Error("Promise.hash must be called with an object")},Z.prototype._enumerate=function(){var a=this.promise,b=this._input,c=[];for(var d in b)a._state===Ba&&b.hasOwnProperty(d)&&c.push({position:d,entry:b[d]});var e=c.length;this._remaining=e;for(var f,g=0;a._state===Ba&&e>g;g++)f=c[g],this._eachEntry(f.entry,f.position)},$.prototype=wa(ab.prototype),$.prototype._superConstructor=Ga,$.prototype._makeResult=D,$.prototype._validationError=function(){return new Error("hashSettled must be called with an object")};var bb=_,cb=aa,db=ba,eb=new ca,fb=new ca,gb=ia,hb=ma,ib=na,jb=oa,kb=pa;ya.async=Ta;if("undefined"!=typeof window&&"object"==typeof window.__PROMISE_INSTRUMENTATION__){var lb=window.__PROMISE_INSTRUMENTATION__;j("instrument",!0);for(var mb in lb)lb.hasOwnProperty(mb)&&ra(mb,lb[mb])}var nb={race:hb,Promise:Na,allSettled:Qa,hash:cb,hashSettled:bb,denodeify:gb,on:ra,off:sa,map:db,filter:_a,resolve:jb,reject:ib,all:Ra,rethrow:kb,defer:$a,EventTarget:xa,configure:j,async:qa};"function"==typeof define&&define.amd?define(function(){return nb}):"undefined"!=typeof b&&b.exports?b.exports=nb:"undefined"!=typeof this&&(this.RSVP=nb)}).call(this)}).call(this,a("_process"))},{_process:5}],36:[function(a,b,c){
//     (c) 2009-2015 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
//     Underscore may be freely distributed under the MIT license.
(function(){function a(a){function b(b,c,d,e,f,g){for(;f>=0&&g>f;f+=a){var h=e?e[f]:f;d=c(d,b[h],h,b)}return d}return function(c,d,e,f){d=u(d,f,4);var g=!z(c)&&t.keys(c),h=(g||c).length,i=a>0?0:h-1;return arguments.length<3&&(e=c[g?g[i]:i],i+=a),b(c,d,e,g,i,h)}}function d(a){return function(b,c,d){c=v(c,d);for(var e=null!=b&&b.length,f=a>0?0:e-1;f>=0&&e>f;f+=a)if(c(b[f],f,b))return f;return-1}}function e(a,b){var c=E.length,d=a.constructor,e=t.isFunction(d)&&d.prototype||i,f="constructor";for(t.has(a,f)&&!t.contains(b,f)&&b.push(f);c--;)f=E[c],f in a&&a[f]!==e[f]&&!t.contains(b,f)&&b.push(f)}var f=this,g=f._,h=Array.prototype,i=Object.prototype,j=Function.prototype,k=h.push,l=h.slice,m=i.toString,n=i.hasOwnProperty,o=Array.isArray,p=Object.keys,q=j.bind,r=Object.create,s=function(){},t=function(a){return a instanceof t?a:this instanceof t?void(this._wrapped=a):new t(a)};"undefined"!=typeof c?("undefined"!=typeof b&&b.exports&&(c=b.exports=t),c._=t):f._=t,t.VERSION="1.8.2";var u=function(a,b,c){if(void 0===b)return a;switch(null==c?3:c){case 1:return function(c){return a.call(b,c)};case 2:return function(c,d){return a.call(b,c,d)};case 3:return function(c,d,e){return a.call(b,c,d,e)};case 4:return function(c,d,e,f){return a.call(b,c,d,e,f)}}return function(){return a.apply(b,arguments)}},v=function(a,b,c){return null==a?t.identity:t.isFunction(a)?u(a,b,c):t.isObject(a)?t.matcher(a):t.property(a)};t.iteratee=function(a,b){return v(a,b,1/0)};var w=function(a,b){return function(c){var d=arguments.length;if(2>d||null==c)return c;for(var e=1;d>e;e++)for(var f=arguments[e],g=a(f),h=g.length,i=0;h>i;i++){var j=g[i];b&&void 0!==c[j]||(c[j]=f[j])}return c}},x=function(a){if(!t.isObject(a))return{};if(r)return r(a);s.prototype=a;var b=new s;return s.prototype=null,b},y=Math.pow(2,53)-1,z=function(a){var b=a&&a.length;return"number"==typeof b&&b>=0&&y>=b};t.each=t.forEach=function(a,b,c){b=u(b,c);var d,e;if(z(a))for(d=0,e=a.length;e>d;d++)b(a[d],d,a);else{var f=t.keys(a);for(d=0,e=f.length;e>d;d++)b(a[f[d]],f[d],a)}return a},t.map=t.collect=function(a,b,c){b=v(b,c);for(var d=!z(a)&&t.keys(a),e=(d||a).length,f=Array(e),g=0;e>g;g++){var h=d?d[g]:g;f[g]=b(a[h],h,a)}return f},t.reduce=t.foldl=t.inject=a(1),t.reduceRight=t.foldr=a(-1),t.find=t.detect=function(a,b,c){var d;return d=z(a)?t.findIndex(a,b,c):t.findKey(a,b,c),void 0!==d&&-1!==d?a[d]:void 0},t.filter=t.select=function(a,b,c){var d=[];return b=v(b,c),t.each(a,function(a,c,e){b(a,c,e)&&d.push(a)}),d},t.reject=function(a,b,c){return t.filter(a,t.negate(v(b)),c)},t.every=t.all=function(a,b,c){b=v(b,c);for(var d=!z(a)&&t.keys(a),e=(d||a).length,f=0;e>f;f++){var g=d?d[f]:f;if(!b(a[g],g,a))return!1}return!0},t.some=t.any=function(a,b,c){b=v(b,c);for(var d=!z(a)&&t.keys(a),e=(d||a).length,f=0;e>f;f++){var g=d?d[f]:f;if(b(a[g],g,a))return!0}return!1},t.contains=t.includes=t.include=function(a,b,c){return z(a)||(a=t.values(a)),t.indexOf(a,b,"number"==typeof c&&c)>=0},t.invoke=function(a,b){var c=l.call(arguments,2),d=t.isFunction(b);return t.map(a,function(a){var e=d?b:a[b];return null==e?e:e.apply(a,c)})},t.pluck=function(a,b){return t.map(a,t.property(b))},t.where=function(a,b){return t.filter(a,t.matcher(b))},t.findWhere=function(a,b){return t.find(a,t.matcher(b))},t.max=function(a,b,c){var d,e,f=-(1/0),g=-(1/0);if(null==b&&null!=a){a=z(a)?a:t.values(a);for(var h=0,i=a.length;i>h;h++)d=a[h],d>f&&(f=d)}else b=v(b,c),t.each(a,function(a,c,d){e=b(a,c,d),(e>g||e===-(1/0)&&f===-(1/0))&&(f=a,g=e)});return f},t.min=function(a,b,c){var d,e,f=1/0,g=1/0;if(null==b&&null!=a){a=z(a)?a:t.values(a);for(var h=0,i=a.length;i>h;h++)d=a[h],f>d&&(f=d)}else b=v(b,c),t.each(a,function(a,c,d){e=b(a,c,d),(g>e||e===1/0&&f===1/0)&&(f=a,g=e)});return f},t.shuffle=function(a){for(var b,c=z(a)?a:t.values(a),d=c.length,e=Array(d),f=0;d>f;f++)b=t.random(0,f),b!==f&&(e[f]=e[b]),e[b]=c[f];return e},t.sample=function(a,b,c){return null==b||c?(z(a)||(a=t.values(a)),a[t.random(a.length-1)]):t.shuffle(a).slice(0,Math.max(0,b))},t.sortBy=function(a,b,c){return b=v(b,c),t.pluck(t.map(a,function(a,c,d){return{value:a,index:c,criteria:b(a,c,d)}}).sort(function(a,b){var c=a.criteria,d=b.criteria;if(c!==d){if(c>d||void 0===c)return 1;if(d>c||void 0===d)return-1}return a.index-b.index}),"value")};var A=function(a){return function(b,c,d){var e={};return c=v(c,d),t.each(b,function(d,f){var g=c(d,f,b);a(e,d,g)}),e}};t.groupBy=A(function(a,b,c){t.has(a,c)?a[c].push(b):a[c]=[b]}),t.indexBy=A(function(a,b,c){a[c]=b}),t.countBy=A(function(a,b,c){t.has(a,c)?a[c]++:a[c]=1}),t.toArray=function(a){return a?t.isArray(a)?l.call(a):z(a)?t.map(a,t.identity):t.values(a):[]},t.size=function(a){return null==a?0:z(a)?a.length:t.keys(a).length},t.partition=function(a,b,c){b=v(b,c);var d=[],e=[];return t.each(a,function(a,c,f){(b(a,c,f)?d:e).push(a)}),[d,e]},t.first=t.head=t.take=function(a,b,c){return null==a?void 0:null==b||c?a[0]:t.initial(a,a.length-b)},t.initial=function(a,b,c){return l.call(a,0,Math.max(0,a.length-(null==b||c?1:b)))},t.last=function(a,b,c){return null==a?void 0:null==b||c?a[a.length-1]:t.rest(a,Math.max(0,a.length-b))},t.rest=t.tail=t.drop=function(a,b,c){return l.call(a,null==b||c?1:b)},t.compact=function(a){return t.filter(a,t.identity)};var B=function(a,b,c,d){for(var e=[],f=0,g=d||0,h=a&&a.length;h>g;g++){var i=a[g];if(z(i)&&(t.isArray(i)||t.isArguments(i))){b||(i=B(i,b,c));var j=0,k=i.length;for(e.length+=k;k>j;)e[f++]=i[j++]}else c||(e[f++]=i)}return e};t.flatten=function(a,b){return B(a,b,!1)},t.without=function(a){return t.difference(a,l.call(arguments,1))},t.uniq=t.unique=function(a,b,c,d){if(null==a)return[];t.isBoolean(b)||(d=c,c=b,b=!1),null!=c&&(c=v(c,d));for(var e=[],f=[],g=0,h=a.length;h>g;g++){var i=a[g],j=c?c(i,g,a):i;b?(g&&f===j||e.push(i),f=j):c?t.contains(f,j)||(f.push(j),e.push(i)):t.contains(e,i)||e.push(i)}return e},t.union=function(){return t.uniq(B(arguments,!0,!0))},t.intersection=function(a){if(null==a)return[];for(var b=[],c=arguments.length,d=0,e=a.length;e>d;d++){var f=a[d];if(!t.contains(b,f)){for(var g=1;c>g&&t.contains(arguments[g],f);g++);g===c&&b.push(f)}}return b},t.difference=function(a){var b=B(arguments,!0,!0,1);return t.filter(a,function(a){return!t.contains(b,a)})},t.zip=function(){return t.unzip(arguments)},t.unzip=function(a){for(var b=a&&t.max(a,"length").length||0,c=Array(b),d=0;b>d;d++)c[d]=t.pluck(a,d);return c},t.object=function(a,b){for(var c={},d=0,e=a&&a.length;e>d;d++)b?c[a[d]]=b[d]:c[a[d][0]]=a[d][1];return c},t.indexOf=function(a,b,c){var d=0,e=a&&a.length;if("number"==typeof c)d=0>c?Math.max(0,e+c):c;else if(c&&e)return d=t.sortedIndex(a,b),a[d]===b?d:-1;if(b!==b)return t.findIndex(l.call(a,d),t.isNaN);for(;e>d;d++)if(a[d]===b)return d;return-1},t.lastIndexOf=function(a,b,c){var d=a?a.length:0;if("number"==typeof c&&(d=0>c?d+c+1:Math.min(d,c+1)),b!==b)return t.findLastIndex(l.call(a,0,d),t.isNaN);for(;--d>=0;)if(a[d]===b)return d;return-1},t.findIndex=d(1),t.findLastIndex=d(-1),t.sortedIndex=function(a,b,c,d){c=v(c,d,1);for(var e=c(b),f=0,g=a.length;g>f;){var h=Math.floor((f+g)/2);c(a[h])<e?f=h+1:g=h}return f},t.range=function(a,b,c){arguments.length<=1&&(b=a||0,a=0),c=c||1;for(var d=Math.max(Math.ceil((b-a)/c),0),e=Array(d),f=0;d>f;f++,a+=c)e[f]=a;return e};var C=function(a,b,c,d,e){if(!(d instanceof b))return a.apply(c,e);var f=x(a.prototype),g=a.apply(f,e);return t.isObject(g)?g:f};t.bind=function(a,b){if(q&&a.bind===q)return q.apply(a,l.call(arguments,1));if(!t.isFunction(a))throw new TypeError("Bind must be called on a function");var c=l.call(arguments,2),d=function(){return C(a,d,b,this,c.concat(l.call(arguments)))};return d},t.partial=function(a){var b=l.call(arguments,1),c=function(){for(var d=0,e=b.length,f=Array(e),g=0;e>g;g++)f[g]=b[g]===t?arguments[d++]:b[g];for(;d<arguments.length;)f.push(arguments[d++]);return C(a,c,this,this,f)};return c},t.bindAll=function(a){var b,c,d=arguments.length;if(1>=d)throw new Error("bindAll must be passed function names");for(b=1;d>b;b++)c=arguments[b],a[c]=t.bind(a[c],a);return a},t.memoize=function(a,b){var c=function(d){var e=c.cache,f=""+(b?b.apply(this,arguments):d);return t.has(e,f)||(e[f]=a.apply(this,arguments)),e[f]};return c.cache={},c},t.delay=function(a,b){var c=l.call(arguments,2);return setTimeout(function(){return a.apply(null,c)},b)},t.defer=t.partial(t.delay,t,1),t.throttle=function(a,b,c){var d,e,f,g=null,h=0;c||(c={});var i=function(){h=c.leading===!1?0:t.now(),g=null,f=a.apply(d,e),g||(d=e=null)};return function(){var j=t.now();h||c.leading!==!1||(h=j);var k=b-(j-h);return d=this,e=arguments,0>=k||k>b?(g&&(clearTimeout(g),g=null),h=j,f=a.apply(d,e),g||(d=e=null)):g||c.trailing===!1||(g=setTimeout(i,k)),f}},t.debounce=function(a,b,c){var d,e,f,g,h,i=function(){var j=t.now()-g;b>j&&j>=0?d=setTimeout(i,b-j):(d=null,c||(h=a.apply(f,e),d||(f=e=null)))};return function(){f=this,e=arguments,g=t.now();var j=c&&!d;return d||(d=setTimeout(i,b)),j&&(h=a.apply(f,e),f=e=null),h}},t.wrap=function(a,b){return t.partial(b,a)},t.negate=function(a){return function(){return!a.apply(this,arguments)}},t.compose=function(){var a=arguments,b=a.length-1;return function(){for(var c=b,d=a[b].apply(this,arguments);c--;)d=a[c].call(this,d);return d}},t.after=function(a,b){return function(){return--a<1?b.apply(this,arguments):void 0}},t.before=function(a,b){var c;return function(){return--a>0&&(c=b.apply(this,arguments)),1>=a&&(b=null),c}},t.once=t.partial(t.before,2);var D=!{toString:null}.propertyIsEnumerable("toString"),E=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];t.keys=function(a){if(!t.isObject(a))return[];if(p)return p(a);var b=[];for(var c in a)t.has(a,c)&&b.push(c);return D&&e(a,b),b},t.allKeys=function(a){if(!t.isObject(a))return[];var b=[];for(var c in a)b.push(c);return D&&e(a,b),b},t.values=function(a){for(var b=t.keys(a),c=b.length,d=Array(c),e=0;c>e;e++)d[e]=a[b[e]];return d},t.mapObject=function(a,b,c){b=v(b,c);for(var d,e=t.keys(a),f=e.length,g={},h=0;f>h;h++)d=e[h],g[d]=b(a[d],d,a);return g},t.pairs=function(a){for(var b=t.keys(a),c=b.length,d=Array(c),e=0;c>e;e++)d[e]=[b[e],a[b[e]]];return d},t.invert=function(a){for(var b={},c=t.keys(a),d=0,e=c.length;e>d;d++)b[a[c[d]]]=c[d];return b},t.functions=t.methods=function(a){var b=[];for(var c in a)t.isFunction(a[c])&&b.push(c);return b.sort()},t.extend=w(t.allKeys),t.extendOwn=t.assign=w(t.keys),t.findKey=function(a,b,c){b=v(b,c);for(var d,e=t.keys(a),f=0,g=e.length;g>f;f++)if(d=e[f],b(a[d],d,a))return d},t.pick=function(a,b,c){var d,e,f={},g=a;if(null==g)return f;t.isFunction(b)?(e=t.allKeys(g),d=u(b,c)):(e=B(arguments,!1,!1,1),d=function(a,b,c){return b in c},g=Object(g));for(var h=0,i=e.length;i>h;h++){var j=e[h],k=g[j];d(k,j,g)&&(f[j]=k)}return f},t.omit=function(a,b,c){if(t.isFunction(b))b=t.negate(b);else{var d=t.map(B(arguments,!1,!1,1),String);b=function(a,b){return!t.contains(d,b)}}return t.pick(a,b,c)},t.defaults=w(t.allKeys,!0),t.clone=function(a){return t.isObject(a)?t.isArray(a)?a.slice():t.extend({},a):a},t.tap=function(a,b){return b(a),a},t.isMatch=function(a,b){var c=t.keys(b),d=c.length;if(null==a)return!d;for(var e=Object(a),f=0;d>f;f++){var g=c[f];if(b[g]!==e[g]||!(g in e))return!1}return!0};var F=function(a,b,c,d){if(a===b)return 0!==a||1/a===1/b;if(null==a||null==b)return a===b;a instanceof t&&(a=a._wrapped),b instanceof t&&(b=b._wrapped);var e=m.call(a);if(e!==m.call(b))return!1;switch(e){case"[object RegExp]":case"[object String]":return""+a==""+b;case"[object Number]":return+a!==+a?+b!==+b:0===+a?1/+a===1/b:+a===+b;case"[object Date]":case"[object Boolean]":return+a===+b}var f="[object Array]"===e;if(!f){if("object"!=typeof a||"object"!=typeof b)return!1;var g=a.constructor,h=b.constructor;if(g!==h&&!(t.isFunction(g)&&g instanceof g&&t.isFunction(h)&&h instanceof h)&&"constructor"in a&&"constructor"in b)return!1}c=c||[],d=d||[];for(var i=c.length;i--;)if(c[i]===a)return d[i]===b;if(c.push(a),d.push(b),f){if(i=a.length,i!==b.length)return!1;for(;i--;)if(!F(a[i],b[i],c,d))return!1}else{var j,k=t.keys(a);if(i=k.length,t.keys(b).length!==i)return!1;for(;i--;)if(j=k[i],!t.has(b,j)||!F(a[j],b[j],c,d))return!1}return c.pop(),d.pop(),!0};t.isEqual=function(a,b){return F(a,b)},t.isEmpty=function(a){return null==a?!0:z(a)&&(t.isArray(a)||t.isString(a)||t.isArguments(a))?0===a.length:0===t.keys(a).length},t.isElement=function(a){return!(!a||1!==a.nodeType)},t.isArray=o||function(a){return"[object Array]"===m.call(a)},t.isObject=function(a){var b=typeof a;return"function"===b||"object"===b&&!!a},t.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(a){t["is"+a]=function(b){return m.call(b)==="[object "+a+"]"}}),t.isArguments(arguments)||(t.isArguments=function(a){return t.has(a,"callee")}),"function"!=typeof/./&&"object"!=typeof Int8Array&&(t.isFunction=function(a){return"function"==typeof a||!1}),t.isFinite=function(a){return isFinite(a)&&!isNaN(parseFloat(a))},t.isNaN=function(a){return t.isNumber(a)&&a!==+a},t.isBoolean=function(a){return a===!0||a===!1||"[object Boolean]"===m.call(a)},t.isNull=function(a){return null===a},t.isUndefined=function(a){return void 0===a},t.has=function(a,b){return null!=a&&n.call(a,b)},t.noConflict=function(){return f._=g,this},t.identity=function(a){return a},t.constant=function(a){return function(){return a}},t.noop=function(){},t.property=function(a){return function(b){return null==b?void 0:b[a]}},t.propertyOf=function(a){return null==a?function(){}:function(b){return a[b]}},t.matcher=t.matches=function(a){return a=t.extendOwn({},a),function(b){return t.isMatch(b,a)}},t.times=function(a,b,c){var d=Array(Math.max(0,a));b=u(b,c,1);for(var e=0;a>e;e++)d[e]=b(e);return d},t.random=function(a,b){return null==b&&(b=a,a=0),a+Math.floor(Math.random()*(b-a+1))},t.now=Date.now||function(){return(new Date).getTime()};var G={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},H=t.invert(G),I=function(a){var b=function(b){return a[b]},c="(?:"+t.keys(a).join("|")+")",d=RegExp(c),e=RegExp(c,"g");return function(a){return a=null==a?"":""+a,d.test(a)?a.replace(e,b):a}};t.escape=I(G),t.unescape=I(H),t.result=function(a,b,c){var d=null==a?void 0:a[b];return void 0===d&&(d=c),t.isFunction(d)?d.call(a):d};var J=0;t.uniqueId=function(a){var b=++J+"";return a?a+b:b},t.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var K=/(.)^/,L={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},M=/\\|'|\r|\n|\u2028|\u2029/g,N=function(a){return"\\"+L[a]};t.template=function(a,b,c){!b&&c&&(b=c),b=t.defaults({},b,t.templateSettings);var d=RegExp([(b.escape||K).source,(b.interpolate||K).source,(b.evaluate||K).source].join("|")+"|$","g"),e=0,f="__p+='";a.replace(d,function(b,c,d,g,h){return f+=a.slice(e,h).replace(M,N),e=h+b.length,c?f+="'+\n((__t=("+c+"))==null?'':_.escape(__t))+\n'":d?f+="'+\n((__t=("+d+"))==null?'':__t)+\n'":g&&(f+="';\n"+g+"\n__p+='"),b}),f+="';\n",b.variable||(f="with(obj||{}){\n"+f+"}\n"),f="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+f+"return __p;\n";try{var g=new Function(b.variable||"obj","_",f)}catch(h){throw h.source=f,h}var i=function(a){return g.call(this,a,t)},j=b.variable||"obj";return i.source="function("+j+"){\n"+f+"}",i},t.chain=function(a){var b=t(a);return b._chain=!0,b};var O=function(a,b){return a._chain?t(b).chain():b};t.mixin=function(a){t.each(t.functions(a),function(b){var c=t[b]=a[b];t.prototype[b]=function(){var a=[this._wrapped];return k.apply(a,arguments),O(this,c.apply(t,a))}})},t.mixin(t),t.each(["pop","push","reverse","shift","sort","splice","unshift"],function(a){var b=h[a];t.prototype[a]=function(){var c=this._wrapped;return b.apply(c,arguments),"shift"!==a&&"splice"!==a||0!==c.length||delete c[0],O(this,c)}}),t.each(["concat","join","slice"],function(a){var b=h[a];t.prototype[a]=function(){return O(this,b.apply(this._wrapped,arguments))}}),t.prototype.value=function(){return this._wrapped},t.prototype.valueOf=t.prototype.toJSON=t.prototype.value,t.prototype.toString=function(){return""+this._wrapped},"function"==typeof define&&define.amd&&define("underscore",[],function(){return t})}).call(this)},{}],37:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var f=a("../common/dataQuery/DataQuery"),g=d(f),h=function(){function a(b,c){e(this,a),this.settings=c,this.sdk=b}return a.prototype.processDataQuery=function(a,b,c){return this.sdk.processDataQuery(a,this,b,c)},a.prototype.buildDataQuery=function(a,b,c){return this.sdk.buildDataQuery(a,b,c)},a.prototype.create=function(a,b,c){return this.sdk.buildDataQuery(this,a,g["default"].operations.Create,b,c)},a.prototype.getById=function(){},a.prototype.get=function(){},a.prototype.count=function(){},a}();c["default"]=h},{"../common/dataQuery/DataQuery":41}],38:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function f(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function g(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var h=a("events"),i=d(h),j=a("underscore"),k=function(){function a(){g(this,a),this.canceled=!1}return a.prototype.cancel=function(){this.canceled=!0},a}(),l=function(a){function b(){return g(this,b),e(this,a.apply(this,arguments))}return f(b,a),b.prototype.emit=function(b){for(var c,d=arguments.length,e=Array(d>1?d-1:0),f=1;d>f;f++)e[f-1]=arguments[f];return e.push(new k),(c=a.prototype.emit).call.apply(c,[this,b].concat(e))},b.prototype.addListener=function(b,c){var d=this,e=function(){for(var a=arguments.length,b=Array(a),e=0;a>e;e++)b[e]=arguments[e];var f=j.last(b);if(!f.canceled)return c.apply(d,b)};return a.prototype.addListener.call(this,b,e)},b.prototype.prependOnceListener=function(a,b){if(this.once(a,b),!Array.isArray(this._events[a]))return this;var c=j.last(this._events[a]),d=j.without(this._events[a],c);return this._events[a]=[c].concat(d),this},b.prototype.once=function(){for(var b,c=arguments.length,d=Array(c),e=0;c>e;e++)d[e]=arguments[e];return(b=a.prototype.once).call.apply(b,[this].concat(d))},b.prototype.on=function(){return this.addListener.apply(this,arguments)},b}(i["default"]);c["default"]=l},{events:2,underscore:36}],39:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var f=a("../common/dataQuery/Processor"),g=d(f),h=a("../common/processors/ErrorProcessor"),i=d(h),j=a("../common/dataQuery/DataQueryBuilder"),k=d(j),l=a("underscore"),m=(d(l),new Error("Method must be overriden")),n=function(){function a(b){e(this,a),this.options=b,this.setup=this._getSetup(b),this.dataQueryProcessor=this._getDataQueryProcessor(),this.dataQueryBuilder=this._getDataQueryBuilder(),this.authentication=this._getAuthentication(),this.registerErrorProcessor(new i["default"])}return a.prototype.registerDataQueryPreProcessor=function(a){this.dataQueryProcessor.preProcessors.push(a)},a.prototype.registerDataQueryProcessor=function(a){this.dataQueryProcessor.processors.push(a)},a.prototype.registerDataQueryPostProcessor=function(a){this.dataQueryProcessor.postProcessors.push(a)},a.prototype.registerErrorProcessor=function(a){this.dataQueryProcessor.errorProcessors.push(a)},a.prototype.processDataQuery=function(a,b,c,d){return this.dataQueryProcessor.process(a,b,c,d)},a.prototype.buildDataQuery=function(){var a=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],b=arguments[1],c=arguments[2];return this.dataQueryBuilder.buildDataQuery(a,b,c)},a.prototype.data=function(a){return this._getData(a)},a.prototype._getDataQueryProcessor=function(){return new g["default"](this)},a.prototype._getDataQueryBuilder=function(){return new k["default"]},a.prototype._getSetup=function(){throw m},a.prototype._getData=function(){throw m},a.prototype._getAuthentication=function(){throw m},a}();c["default"]=n},{"../common/dataQuery/DataQueryBuilder":42,"../common/dataQuery/Processor":43,"../common/processors/ErrorProcessor":52,underscore:36}],40:[function(a,b){"use strict";var c={};b.exports=c},{}],41:[function(a,b){"use strict";function c(a){return a&&a.__esModule?a:{"default":a}}function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function f(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var g=a("events"),h=c(g),i=function(a){function b(c){d(this,b);var f=e(this,a.call(this));return f.config=c,f.data=c.data,f.query=c.query,f.originalParameters=c.originalParameters,f.operation=c.operation,f.additionalOptions=c.additionalOptions,f}return f(b,a),b}(h["default"]);b.exports=i},{events:2}],42:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var f=a("underscore"),g=d(f),h=a("../../common/dataQuery/DataQuery"),i=d(h),j=a("../../common/query/Query"),k=d(j),l=function(){function a(){e(this,a)}return a.prototype._getInitialDataQuery=function(a,b){return new i["default"]({meta:b,operation:a})},a.prototype.buildDataQuery=function(a,b,c){var d=this._getInitialDataQuery(b,c);a instanceof k["default"]&&(d.query=a),a&&(d.additionalOptions=a.additionalOptions);var e=g["default"].extend(d,c);return e},a}();c["default"]=l},{"../../common/dataQuery/DataQuery":41,"../../common/query/Query":53,underscore:36}],43:[function(a,b){"use strict";function c(a){return a&&a.__esModule?a:{"default":a}}function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var e=a("rsvp"),f=c(e),g=a("../../common/dataQuery/QueryProcessorIterator"),h=c(g),i=a("../../common/errors"),j=c(i),k=a("../../common/utils"),l=function(){function a(b){d(this,a),this.sdk=b,this.preProcessors=[],this.processors=[],this.postProcessors=[],this.errorProcessors=[]}return a.prototype._iterate=function(a,b,c,d){var e=this;return new f["default"].Promise(function(f,g){var i=new h["default"](b,a),k=null,l=function(b,d){clearTimeout(k),k=setTimeout(function(){return i.error(new Error("Iterator timed out. Processor: "+b.constructor.name+". Value - "+JSON.stringify(d)))},6e4);try{return b.processDataQuery(a,i,c,d)}catch(e){return i.error(e)}},m=function(){i.removeListener("next",l),clearTimeout(k)};i.on("next",l).once("end",function(a){return m(),f(a)}).once("error",function(b){m();var d=e._processError(a,c,b),f=d||b;return g(f)}).once("cancel",function(a){return m(),g({reason:a,error:j["default"].cancelled})}).start(d)})},a.prototype._preProcess=function(a,b){return this._iterate(a,this.preProcessors,b)},a.prototype._process=function(a,b,c){return this._iterate(a,this.processors,b,c)},a.prototype._postProcess=function(a,b,c){return this._iterate(a,this.postProcessors,b,c)},a.prototype._processError=function(a,b,c){var d=c;return this.errorProcessors.forEach(function(c){d=c.processError(a,b,d)}),d},a.prototype.process=function(a,b,c,d){var e=this;return k.buildPromise(function(c,d){return e._preProcess(a,b).then(function(c){return e._process(a,b,c)}).then(function(c){return e._postProcess(a,b,c)}).then(function(a){c(a)})["catch"](function(a){d(a)})},c,d)},a}();b.exports=l},{"../../common/dataQuery/QueryProcessorIterator":44,"../../common/errors":45,"../../common/utils":54,rsvp:35}],44:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(c,"__esModule",{value:!0});var h=a("../../common/EventEmitterExtended"),i=d(h),j=a("underscore"),k=function(a){function b(c,d){e(this,b);var g=f(this,a.call(this));return g.done=!1,g.position=-1,g.processors=c,g.$id=j.random(0,5e3),g.$query=d,g.$operation=d.operation,g._initialValue=null,g}return g(b,a),b.prototype.restart=function(){var a=arguments.length<=0||void 0===arguments[0]?this._initialValue:arguments[0];return this.start(a)},b.prototype.start=function(a){return this._initialValue=a,this.position=-1,this.done=!1,this.next(a)},b.prototype.next=function(a){if(this.position++,this.position>=this.processors.length)return this.end(a);var b=this.processors[this.position];return this.emit("next",b,a)},b.prototype.end=function(a){return this.done=!0,this.emit("end",a)},b.prototype.cancel=function(a){return this.done=!0,this.emit("cancel",a)},b.prototype.error=function(a){return this.emit("error",a)},b}(i["default"]);c["default"]=k},{"../../common/EventEmitterExtended":38,underscore:36}],45:[function(a,b){"use strict";var c={};c.cancelled={code:3e3,message:"Cancelled."},b.exports=c},{}],46:[function(a){"use strict";a("../common/mixins/mixins")},{"../common/mixins/mixins":47}],47:[function(a){"use strict";function b(a){return a&&a.__esModule?a:{"default":a}}var c=a("underscore"),d=b(c),e=a("../../common/mixins/underscoreDeepExtend"),f=b(e),g=a("../../common/mixins/underscoreCompactObject"),h=b(g),i=a("../../common/mixins/underscoreIsObjectEmpty"),j=b(i);d["default"].mixin({deepExtend:f["default"]}),d["default"].mixin({compactObject:h["default"]}),d["default"].mixin({isEmptyObject:j["default"]})},{"../../common/mixins/underscoreCompactObject":48,"../../common/mixins/underscoreDeepExtend":49,"../../common/mixins/underscoreIsObjectEmpty":50,underscore:36}],48:[function(a,b){"use strict";function c(a){return a&&a.__esModule?a:{"default":a}}var d=a("underscore"),e=c(d);b.exports=function(a){var b={};return e["default"].each(a,function(a,c){null!==a&&void 0!==a&&(b[c]=a)}),b}},{underscore:36}],49:[function(a,b){"use strict";function c(a){return a&&a.__esModule?a:{"default":a}}var d=a("underscore"),e=c(d);b.exports=function(a){var b=/#{\s*?_\s*?}/,c=Array.prototype.slice;return e["default"].each(c.call(arguments,1),function(c){for(var d in c)if(e["default"].isUndefined(a[d])||e["default"].isFunction(a[d])||e["default"].isNull(c[d])||e["default"].isDate(c[d]))a[d]=c[d];else if(e["default"].isString(c[d])&&b.test(c[d]))e["default"].isString(a[d])&&(a[d]=c[d].replace(b,a[d]));else if(e["default"].isArray(a[d])||e["default"].isArray(c[d])){if(!e["default"].isArray(a[d])||!e["default"].isArray(c[d]))throw new Error("Trying to combine an array with a non-array ("+d+")");a[d]=e["default"].reject(e["default"].deepExtend(e["default"].clone(a[d]),c[d]),function(a){return e["default"].isNull(a)})}else if(e["default"].isObject(a[d])||e["default"].isObject(c[d])){if(!e["default"].isObject(a[d])||!e["default"].isObject(c[d]))throw new Error("Trying to combine an object with a non-object ("+d+")");a[d]=e["default"].deepExtend(e["default"].clone(a[d]),c[d])}else a[d]=c[d]}),a}},{underscore:36}],50:[function(a,b){"use strict";function c(a){if(null==a)return!0;if(a.length>0)return!1;if(0===a.length)return!0;for(var b in a)if(d.call(a,b))return!1;return!0}var d=Object.prototype.hasOwnProperty;b.exports=c},{}],51:[function(a,b,c){"use strict";var d,e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol?"symbol":typeof a},f=Boolean("undefined"!=typeof android&&android&&android.widget&&android.widget.Button||"undefined"!=typeof UIButton&&UIButton),g=!1,h=!1,i=!1;"undefined"==typeof window||f||(g=/^file:\/{3}[^\/]|x-wmapp/i.test(window.location.href)&&/ios|iphone|ipod|ipad|android|iemobile/i.test(navigator.userAgent),h=g&&/iemobile/i.test(navigator.userAgent),i=g&&"android"===cordova.platformId);var j="object"===("undefined"==typeof c?"undefined":e(c))&&"undefined"==typeof window,k="function"==typeof define&&define.amd,l=!f&&!g&&!j;f?d="ns":j?d="nodejs":l?d="desktop":g&&(d="cordova");var m=function(){return"undefined"!=typeof window&&window.navigator&&window.navigator.simulator};b.exports={isCordova:g,isNativeScript:f,isDesktop:l,isWindowsPhone:h,isAndroid:i,isNodejs:j,isRequirejs:k,platform:d,isInAppBuilderSimulator:m}},{}],52:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=a("../../common/utils"),f=function(){function a(){d(this,a)}return a.prototype.processError=function(a,b,c){var d=b.sdk.setup,f=d&&d.parseOnlyCompleteDateTimeObjects,g=e.parseUtilities.getReviver(f);return e.parseUtilities.parseXhrError(g,c)},a}();c["default"]=f},{"../../common/utils":54}],53:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=function f(){d(this,f)};c["default"]=e},{}],54:[function(a,b){"use strict";function c(a){return a&&a.__esModule?a:{"default":a}}var d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol?"symbol":typeof a},e=a("../common/platform"),f=c(e),g=a("rsvp"),h=c(g),i=a("../everlive/EverliveError"),j=a("underscore"),k=c(j),l={};l.guardUnset=function(a,b,c){if(c||(c="The "+b+" is required"),"undefined"==typeof a||null===a)throw new i.EverliveError(c)},l.buildPromise=function(a,b,c){var d=l.getCallbacks(b,c);return a(d.success,d.error),d.promise},l.getCallbacks=function(a,b){var c,d=function(){return new h["default"].Promise(function(c,d){a=function(a){c(a)},b=function(a){d(a)}})};if(f["default"].isNodejs)if("function"==typeof a&&"function"!=typeof b){var e=a;a=function(a,b){e(null,a,b)},b=function(a){e(a)}}else"function"!=typeof a&&"function"!=typeof b&&(c=d());else"function"!=typeof a&&"function"!=typeof b&&(c=d());return{promise:c,success:a,error:b}},l.parseUtilities={getReviver:function(a){var b;return b=a?l.parseUtilities.parseIsoDateString:l.parseUtilities.parseOnlyCompleteDateTimeString,function(a,c){if("string"==typeof c){var d=b(c);d&&(c=d)}return c}},parseIsoDateString:function(a){var b;if(b=a.match(/^(\d{4})(-(\d{2})(-(\d{2})(T(\d{2}):(\d{2})(:(\d{2})(\.(\d+))?)?(Z|((\+|-)(\d{2}):(\d{2}))))?))$/)){var c=b[12];c&&(c.length>3?c=Math.round(Number(c.substr(0,3)+"."+c.substr(3))):c.length<3&&(c+=2===c.length?"0":"00"));var d=new Date(Date.UTC(Number(b[1]),Number(b[3])-1||0,Number(b[5])||0,Number(b[7])||0,Number(b[8])||0,Number(b[10])||0,Number(c)||0));if(b[13]&&"Z"!==b[13]){var e=Number(b[16])||0,f=Number(b[17])||0;e*=36e5,f*=6e4;var g=e+f;"+"===b[15]&&(g=-g),
d=new Date(d.valueOf()+g)}return d}return null},parseOnlyCompleteDateTimeString:function(a){return/^\d{4}-\d{2}-\d{2}$/.test(a)?null:/^(\d{2}):(\d{2})(:(\d{2})(\.(\d+))?)?(Z|((\+|-)(\d{2}):(\d{2})))?$/.test(a)?null:l.parseUtilities.parseIsoDateString(a)},traverse:function(a,b){var c,e,f;for(c in a)a.hasOwnProperty(c)&&(e=a[c],f=b(c,e),a[c]=f,e===f&&"object"===("undefined"==typeof e?"undefined":d(e))&&l.parseUtilities.traverse(e,b));return a},traverseAndRevive:function(a,b){return b||(b=l.parseUtilities.getReviver()),l.parseUtilities.traverse(a,b)},parseError:function(a,b){if(!("string"==typeof b&&b.length>0))return b;try{return b=JSON.parse(b),{message:b.message,code:b.errorCode}}catch(c){return b}},_parseInternal:function(a,b){return"string"==typeof b&&b.length>0?b=JSON.parse(b,a):"object"===("undefined"==typeof b?"undefined":d(b))&&l.parseUtilities.traverseAndRevive(b,a),b},_transformResult:function(a,b){if(a){var c=k["default"].extend({},b);return c.result=void 0===a.Result?a.result:a.Result,c.count=void 0===a.Count?a.count:a.Count,c}return a},parseResult:function(a,b){return b=l.parseUtilities._parseInternal.apply(null,arguments),l.parseUtilities._transformResult(b,{count:b.Count})},parseSingleResult:function(a,b){return b=l.parseUtilities._parseInternal.apply(null,arguments),l.parseUtilities._transformResult(b)},parseUpdateResult:function(a,b){return b=l.parseUtilities._parseInternal.apply(null,arguments),l.parseUtilities._transformResult(b,{ModifiedAt:b.ModifiedAt})},parseJSON:function(a){return JSON.parse(a,l.parseUtilities.getReviver())},parseXhrResponse:function(a){var b=a.getResponseHeader("content-type"),c=b&&b.toLowerCase().indexOf("json")>-1,d=a.responseText||a.statusText;return c?l.parseUtilities.parseJSON(d):d},parseXhrError:function(a,b){if(b instanceof Error)return b;var c=b.responseText||b.statusText||b;return l.parseUtilities.parseError(a,c)},parseErrorOrResponse:function(a){if(a instanceof XMLHttpRequest){var b=l.parseUtilities.parseXhrResponse(a);return{code:b.code||b.errorCode,message:b.message}}return l.parseUtilities.parseError(null,a)}},l.isDate=function(a){return a&&(a instanceof Date||!k["default"].isNaN(Date.parse(a)))},l.cloneDate=function(a){return new Date(a)},l.isGuid=function(a){return/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(a)},l.successfulPromise=function(a){return new h["default"].Promise(function(b){b(a)})},l.rejectedPromise=function(a){return new h["default"].Promise(function(b,c){c(a)})},l.uuid=function(){var a=(new Date).getTime(),b="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(b){var c=(a+16*Math.random())%16|0;return a=Math.floor(a/16),("x"==b?c:3&c|8).toString(16)});return b},b.exports=l},{"../common/platform":51,"../everlive/EverliveError":58,rsvp:35,underscore:36}],55:[function(a,b){"use strict";function c(a){return a&&a.__esModule?a:{"default":a}}var d=a("../everlive/EverliveError"),e=a("../everlive/constants"),f=c(e),g=a("underscore"),h=c(g);b.exports=function(){function a(a){if(a=parseInt(a||f["default"].MaxConcurrentDownloadTasks),isNaN(a)||0>=a)throw new d.EverliveError("The maxConcurrentTasks must be a number larger than 0");this.maxConcurrentTasks=a,this.runningTasksCount=0,this.tasks=[]}return a.prototype={enqueue:function(a,b,c){if(!h["default"].isFunction(b)||!h["default"].isFunction(c))throw new d.EverliveError("taskSuccess and taskError functions must be provided");var e=[].splice.call(arguments,3);this.tasks.push({task:a,args:e,success:b,error:c}),this._runNext()},_runNext:function(){var a=this;if(a.runningTasksCount!==a.maxConcurrentTasks&&a.tasks.length){a.runningTasksCount++;var b=this.tasks.shift(),c=b.task,d=b.args,e=b.success,f=b.error;d.unshift(function(b){a.runningTasksCount--,b?f(b):e.apply(null,[].splice.call(arguments,1)),a._runNext()}),c.apply(null,d)}}},a}()},{"../everlive/EverliveError":58,"../everlive/constants":70,underscore:36}],56:[function(a,b){"use strict";function c(a){return a&&a.__esModule?a:{"default":a}}var d=a("events"),e=c(d),f=function(a){a._emitter=new e["default"],a._emitterProxy=function(b,c){a._emitter[b].apply(a._emitter,c)},a.addListener=function(){a._emitterProxy("addListener",arguments)},a.on=a.addListener,a.removeListener=function(){a._emitterProxy("removeListener",arguments)},a.off=a.removeListener,a.once=function(){a._emitterProxy("once",arguments)},a.removeAllListeners=function(){a._emitterProxy("removeAllListeners",arguments)}};b.exports={apply:f}},{events:2}],57:[function(a,b){"use strict";function c(a){return a&&a.__esModule?a:{"default":a}}function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function f(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function g(){if(!this._isOfflineStorageEnabled())throw new H.EverliveError("You have instantiated the SDK without support for offline storage")}var h=a("../common/Sdk"),i=c(h),j=a("../everlive/Setup"),k=c(j),l=a("../everlive/types/Data"),m=c(l),n=a("../everlive/types/Users"),o=c(n),p=a("../everlive/types/Files"),q=c(p),r=a("../everlive/constants"),s=c(r),t=a("../everlive/utils"),u=c(t),v=a("../everlive/Push"),w=c(v),x=a("../everlive/auth/Authentication"),y=c(x),z=a("../everlive/offline/offline"),A=c(z),B=a("../everlive/caching/caching"),C=c(B),D=a("../everlive/Request"),E=c(D),F=a("underscore"),G=c(F),H=a("../everlive/EverliveError"),I=a("../everlive/helpers/helpers"),J=c(I),K=a("../everlive/EventEmitterProxy"),L=c(K),M=a("../everlive/business-logic/BusinessLogic"),N=c(M),O=a("../everlive/types/preProcessors/DataPreprocessor"),P=c(O),Q=a("../everlive/types/preProcessors/OfflineQueryPreprocessor"),R=c(Q),S=a("../everlive/types/processors/BusinessLogicQueryProcessor"),T=c(S),U=a("../everlive/types/processors/EventQueryProcessor"),V=c(U),W=a("../everlive/types/processors/AuthenticationProcessor"),X=c(W),Y=a("../everlive/types/processors/OfflineQueryProcessor"),Z=c(Y),$=a("../everlive/types/processors/OnlineQueryProcessor"),_=c($),aa=a("../everlive/types/processors/CacheQueryProcessor"),ba=c(aa),ca=a("../everlive/response/ResponseParserProcessor"),da=c(ca),ea=a("../everlive/response/ResponseTransformProcessor"),fa=c(ea),ga=a("../everlive/dataQuery/DataQueryBuilder"),ha=c(ga),ia=[],ja=function(a){function b(c){d(this,b);var f=e(this,a.call(this,c));f.push=f._getPush(),f.files=f.Files=f._getFiles(),f.users=f.Users=f._getUsers(),f.businessLogic=f._getBusinessLogic();var g=G["default"].pick(f.setup,["appId","apiKey"]),h=G["default"].extend({},c,g);return G["default"].each(ia,function(a){a.func.call(f,h)}),null===b.$&&(b.$=f),f.registerDataQueryPreProcessor(new P["default"]),f.registerDataQueryPreProcessor(new R["default"]),f.registerDataQueryProcessor(new T["default"]),f.registerDataQueryProcessor(new V["default"]),f.registerDataQueryProcessor(new X["default"]),f.registerDataQueryProcessor(new Z["default"]),f.registerDataQueryProcessor(new _["default"]),f.registerDataQueryProcessor(new ba["default"]),f.registerDataQueryPostProcessor(new da["default"]),f.registerDataQueryPostProcessor(new fa["default"]),L["default"].apply(f),f}return f(b,a),b.init=function(a){return b.$=null,new b(a)},b.disableRequestCache=function(){return u["default"].disableRequestCache()},b.prototype._getData=function(a){return new m["default"](this,a)},b.prototype.buildUrl=function(){return u["default"].buildUrl(this.setup)},b.prototype.buildAuthHeader=function(){return t.buildAuthHeader(this.setup)},b.prototype.authInfo=function(a,c){var d=this;return u["default"].buildPromise(function(a,c){var e=d.setup;return e.masterKey?a({status:b.AuthStatus.masterKey}):e.token?d.authentication&&d.authentication.isAuthenticationInProgress()?a({status:b.AuthStatus.authenticating}):void d.users.skipAuth(!0).currentUser().then(function(c){return a({status:b.AuthStatus.authenticated,user:c.result})},function(e){return d.authentication&&d.authentication.isAuthenticationInProgress()?a({status:b.AuthStatus.authenticating}):e.code===H.EverliveErrors.invalidRequest.code||e.code===H.EverliveErrors.expiredToken.code?a({status:b.AuthStatus.invalidAuthentication}):c(e)}):a({status:b.AuthStatus.unauthenticated})},a,c)},b.prototype.request=function(a){return new E["default"](this.setup,a)},b.prototype.offline=function(){g.call(this);var a;a=0===arguments.length?!0:1==arguments[0],this.offlineStorage._setOffline(a)},b.prototype.online=function(){g.call(this);var a;a=0===arguments.length?!0:1==arguments[0],this.offlineStorage._setOffline(!a)},b.prototype.isOffline=function(){return g.call(this),!this.isOnline()},b.prototype.isOnline=function(){return this.offlineStorage.isOnline()},b.prototype.sync=function(){return g.call(this),this.offlineStorage.sync.apply(this.offlineStorage,arguments)},b.prototype._isOfflineStorageEnabled=function(){var a=this.setup.offlineStorage||this.setup.offline;return a&&a.enabled!==!1},b.prototype._getDataQueryBuilder=function(){return new ha["default"]},b.prototype._getSetup=function(a){return new k["default"](a)},b.prototype._getUsers=function(){return new o["default"](this)},b.prototype._getAuthentication=function(){return new y["default"](this)},b.prototype._getPush=function(){return new w["default"](this)},b.prototype._getFiles=function(){return new q["default"](this)},b.prototype._getBusinessLogic=function(){return new N["default"](this)},b}(i["default"]);ja.$=null,ja.idField=s["default"].idField,ja.initializations=ia,ja.AuthStatus=s["default"].AuthStatus;var ka=function(a){var b=this;this.helpers={},G["default"].each(J["default"],function(c){var d=a.helpers?a.helpers[c.name]:null;b.helpers[c.name]=new c.ctor(b,d)})};ia.push({name:"caching",func:C["default"].initCaching}),ia.push({name:"offlineStorage",func:A["default"].initOfflineStorage}),ia.push({name:"cacheStore",func:C["default"]._initStore}),ia.push({name:"helpers",func:ka}),b.exports=ja},{"../common/Sdk":39,"../everlive/EventEmitterProxy":56,"../everlive/EverliveError":58,"../everlive/Push":62,"../everlive/Request":63,"../everlive/Setup":64,"../everlive/auth/Authentication":65,"../everlive/business-logic/BusinessLogic":67,"../everlive/caching/caching":69,"../everlive/constants":70,"../everlive/dataQuery/DataQueryBuilder":72,"../everlive/helpers/helpers":75,"../everlive/offline/offline":85,"../everlive/response/ResponseParserProcessor":103,"../everlive/response/ResponseTransformProcessor":104,"../everlive/types/Data":110,"../everlive/types/Files":111,"../everlive/types/Users":112,"../everlive/types/preProcessors/DataPreprocessor":113,"../everlive/types/preProcessors/OfflineQueryPreprocessor":114,"../everlive/types/processors/AuthenticationProcessor":115,"../everlive/types/processors/BusinessLogicQueryProcessor":116,"../everlive/types/processors/CacheQueryProcessor":117,"../everlive/types/processors/EventQueryProcessor":118,"../everlive/types/processors/OfflineQueryProcessor":119,"../everlive/types/processors/OnlineQueryProcessor":120,"../everlive/utils":121,underscore:36}],58:[function(a,b){"use strict";function c(a){return a&&a.__esModule?a:{"default":a}}var d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol?"symbol":typeof a},e=a("underscore"),f=c(e),g=a("../common/errors"),h=c(g),i={itemNotFound:{code:801,message:"Item not found."},syncConflict:{code:10001,message:"A conflict occurred while syncing data."},syncError:{code:10002,message:"Synchronization failed for item."},syncInProgress:{code:10003,message:"Cannot perform operation while synchronization is in progress."},syncCancelledByUser:{code:10004,message:"Synchronization cancelled by user."},syncErrorUnknown:{code:10005,message:"An unknown error occurred while synchronizing. Please make sure there is internet connectivity."},operationNotSupportedOffline:{code:2e4},invalidId:{code:20001,message:"Invalid or missing Id in model."},bodyWithGetRequestNotSupported:{code:601,message:'Sending a request body is not supported for "GET" requests.'},invalidOrMissingFunctionName:{code:601,message:"Invalid or missing cloud function name."},invalidOrMissingProcedureName:{code:601,message:"Invalid or missing procedure name."},generalDatabaseError:{code:107,message:"General database error."},invalidToken:{code:301,message:"Invalid access token."},expiredToken:{code:302,message:"Expired access token."},invalidExpandExpression:{code:618,message:"Invalid expand expression."},invalidRequest:{code:601,message:"Invalid request."},missingContentType:{code:701,message:"ContentType not specified."},missingOrInvalidFileContent:{code:702,message:"Missing or invalid file content."},customFileSyncNotSupported:{code:703,message:"Custom ConflictResolution for files is not allowed."},cannotDownloadOffline:{code:704,message:"Cannot download a file while offline."},cannotForceCacheWhenDisabled:{code:705,message:"Cannot use forceCache while the caching is disabled."},filesNotSupportedInBrowser:{code:706,message:"Create and Update operations are not supported for Files in browsers while in offline mode."},pushNotSupportedOffline:{code:707,message:"Push is not supported in offline mode."},singleValueExpected:{code:710}};i=f["default"].deepExtend(i,h["default"]);var j={buildSingleValueExpectedErrorMessage:function(a){var b="A single value is expected in "+a+" query modifier.";return b}},k=function(){function a(a,b){var c=Error.apply(this);if("object"===("undefined"==typeof a?"undefined":d(a))){var e=a;a=e.message,b=e.code}return c.message=a,c.code=b||0,c.name=this.name="EverliveError",this.message=c.message,this.code=b,Object.defineProperty(this,"stack",{get:function(){return c.stack}}),this}return a.prototype=Object.create(Error.prototype),a.prototype.toJSON=function(){return{name:this.name,message:this.message,code:this.code,stack:this.stack}},a}(),l=function(){var a=function(a,b,c){var d=c?c.code:void 0;k.call(this,b,d),this.errorType=a,this.message=b,void 0!==c&&(this.additionalInformation=c)};a.prototype=Object.create(k.prototype),a.fromEverliveError=function(c){var d=new a(b.EverliveError,c.message,c);return d},a.fromPluginError=function(c){var d="A plugin error occurred";c&&("string"==typeof c.error?d=c.error:"string"==typeof c.message&&(d=c.message));var e=new a(b.PluginError,d,c);return e};var b={EverliveError:1,PluginError:2};return a}();b.exports={EverliveError:k,EverliveErrors:i,EverliveErrorHelper:j,DeviceRegistrationError:l}},{"../common/errors":45,underscore:36}],59:[function(a,b){"use strict";function c(a){return a&&a.__esModule?a:{"default":a}}var d=a("../scripts/bs-expand-processor"),e=c(d),f=a("../everlive/dataQuery/DataQuery"),g=c(f),h=a("../everlive/query/Query"),i=c(h),j=a("../everlive/query/AggregateQuery"),k=c(j),l=a("../everlive/constants"),m=c(l);b.exports=function(){return new e["default"]({executionNodeFunction:function(a,b,c){var d,e=a.targetTypeName.toLowerCase()===m["default"].FilesTypeNameLegacy?m["default"].FilesTypeName:a.targetTypeName;d=new g["default"](a.aggregate?{operation:g["default"].operations.Aggregate,meta:{collectionName:e},query:new k["default"](a.filter,a.select,a.sort,a.skip,a.take,null,a.aggregate)}:{operation:g["default"].operations.Read,meta:{collectionName:e},query:new i["default"](a.filter,a.select,a.sort,a.skip,a.take)}),b.offlineModule.processQuery(d).then(function(a){c(null,a.result)},c)}})}()},{"../everlive/constants":70,"../everlive/dataQuery/DataQuery":71,"../everlive/query/AggregateQuery":94,"../everlive/query/Query":96,"../scripts/bs-expand-processor":127}],60:[function(a,b){"use strict";b.exports=function(){function a(a,b){this.operator=a,this.operands=b||[]}return a.prototype={addOperand:function(a){this.operands.push(a)}},a}()},{}],61:[function(a,b){"use strict";b.exports=function(){function a(a,b){this.longitude=a||0,this.latitude=b||0}return a}()},{}],62:[function(a,b){"use strict";function c(a){return a&&a.__esModule?a:{"default":a}}var d=a("../everlive/utils"),e=c(d),f=a("../everlive/EverliveError"),g=a("../everlive/push/CurrentDevice"),h=c(g),i=a("../everlive/constants"),j=c(i);b.exports=function(){function a(a){this._el=a,this.notifications=a.data(j["default"].Push.NotificationsType),this.devices=a.data(j["default"].Push.DevicesType)}return a.prototype={ensurePushIsAvailable:function(){h["default"].ensurePushIsAvailable()},currentDevice:function(a){return this.ensurePushIsAvailable(),0===arguments.length&&(a=this._el.setup._emulatorMode),this._currentDevice||(this._currentDevice=new h["default"](this)),this._currentDevice.emulatorMode=a||e["default"]._inAppBuilderSimulator(),this._currentDevice},register:function(a,b,c){this.ensurePushIsAvailable();var e=this.currentDevice(),g=this;a=a||{},a.android&&(a.android.senderID=a.android.projectNumber||a.android.senderID);var h=function(a,b){var c=new d.DeviceRegistrationResult(a);b(c)},j=function(a,b){var c=f.DeviceRegistrationError.fromEverliveError(a);b(c)},k=function(b,c,d){var f=e._getPlatformType(),k=f===i.Platform.iOS;k&&a.iOS&&(k=a.iOS.clearBadge!==!1),k?g.clearBadgeNumber().then(function(){h(b,c)},function(a){j(a,d)}):h(b,c)};return d.buildPromise(function(b,c){e.enableNotifications(a,function(d){var f=d.token,g=a.customParameters;e.getRegistration().then(function(){e.updateRegistration(g,function(){k(f,b,c)},function(a){j(a,c)})},function(a){801===a.code?e.register(g,function(){k(f,b,c)},c):j(a,c)})},function(a){var b=f.DeviceRegistrationError.fromPluginError(a);c(b)})},b,c)},unregister:function(){this.ensurePushIsAvailable();var a=this.currentDevice();return a.disableNotifications.apply(a,arguments)},updateRegistration:function(){this.ensurePushIsAvailable();var a=this.currentDevice();return a.updateRegistration.apply(a,arguments)},setBadgeNumber:function(a,b,c){if(this.ensurePushIsAvailable(),a=parseInt(a),isNaN(a))return d.buildPromise(function(a,b){b(new f.EverliveError("The badge must have a numeric value"))},b,c);var g={},h=this.currentDevice(),i=h._getDeviceId();return g.Id="HardwareId/"+encodeURIComponent(i),g.BadgeCounter=a,d.buildPromise(function(b,c){h._pushHandler.devices.updateSingle(g).then(function(){return"undefined"!=typeof window&&window.plugins&&window.plugins.pushNotification&&!e["default"]._inAppBuilderSimulator()?window.plugins.pushNotification.setApplicationIconBadgeNumber(b,c,a):b()},c)},b,c)},clearBadgeNumber:function(a,b){return this.ensurePushIsAvailable(),this.setBadgeNumber(0,a,b)},getRegistration:function(){this.ensurePushIsAvailable();var a=this.currentDevice();return a.getRegistration.apply(a,arguments)},send:function(){return this.notifications.create.apply(this.notifications,arguments)},areNotificationsEnabled:function(a,b,c){this.ensurePushIsAvailable();var d=this.currentDevice();return d.areNotificationsEnabled(a,b,c)},notificationProcessed:function(){this.ensurePushIsAvailable();var a=this.currentDevice();a.notificationProcessed()}},a}()},{"../everlive/EverliveError":58,"../everlive/constants":70,"../everlive/push/CurrentDevice":92,"../everlive/utils":121}],63:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=a("../everlive/utils"),h=d(g),i=a("../everlive/reqwest.everlive"),j=d(i),k=a("underscore"),l=d(k),m=a("../everlive/constants"),n=d(m),o=a("../everlive/everlive.platform"),p=a("../everlive/query/Query"),q=d(p),r=a("rsvp"),s=d(r),t=function(){function a(b,c){e(this,a),g.guardUnset(b,"setup"),g.guardUnset(c,"options"),this.setup=b,this.method=null,this.endpoint=null,this.data=null,this._headers={},l["default"].extend(this,c),this._init(c)}return a.sendRequest=function(a){var b=a.buildUrl();b=h["default"].disableRequestCache(b,a.method),a.method=a.method||n["default"].HttpMethod.GET;var c=a.method===n["default"].HttpMethod.GET?a.data:JSON.stringify(a.data);a.headers.Accept="*/*";var d={url:b,method:a.method,data:c,headers:a.headers,contentType:"application/json"};return o.isNodejs||(d.crossOrigin=!0),new s["default"].Promise(function(a,b){return j["default"](d).then(function(b){a(b)},function(a){b(a)})})},a.prototype.buildAuthHeader=function(){return g.buildAuthHeader.apply(void 0,arguments)},a.prototype.send=function(){return a.sendRequest(this)},a.prototype.buildUrl=function(){var a=h["default"].buildUrl(this.setup)+this.endpoint;return l["default"].size(this.queryStringParams)&&(a=a+"?"+h["default"].toQueryString(this.queryStringParams)),a},a.prototype.buildQueryHeaders=function(b){return b?b instanceof q["default"]?a.prototype._buildQueryHeaders(b):a.prototype._buildFilterHeader(b.filter):{}},a.prototype._init=function(a){l["default"].extend(this.headers,this.buildAuthHeader(this.setup,a),this.buildQueryHeaders(a.query)),this.encodeHeaders()},a.prototype._buildQueryHeaders=function(a){a=a.build();var b={};return null!==a.$where&&(b[m.Headers.filter]=JSON.stringify(a.$where)),null!==a.$select&&(b[m.Headers.select]=JSON.stringify(a.$select)),null!==a.$sort&&(b[m.Headers.sort]=JSON.stringify(a.$sort)),null!==a.$skip&&(b[m.Headers.skip]=a.$skip),null!==a.$take&&(b[m.Headers.take]=a.$take),null!==a.$expand&&(b[m.Headers.expand]=JSON.stringify(a.$expand)),null!==a.$aggregate&&(b[m.Headers.aggregate]=JSON.stringify(a.$aggregate)),b},a.prototype._buildFilterHeader=function(a){var b={};return b[m.Headers.filter]=JSON.stringify(a),b},a.prototype.encodeHeaders=function(){var a=this.headers;l["default"].each(m.EncodableHeaders,function(b){void 0!==a[b]&&(a[b]=encodeURIComponent(a[b]))})},f(a,[{key:"headers",get:function(){return this._headers},set:function(a){this._headers=h["default"].normalizeKeys(a)}}]),a}();t.reviver=g.parseUtilities.getReviver(),t.parsers={simple:{result:g.parseUtilities.parseResult.bind(null,t.reviver),error:g.parseUtilities.parseXhrError.bind(null,t.reviver)},single:{result:g.parseUtilities.parseSingleResult.bind(null,t.reviver),error:g.parseUtilities.parseXhrError.bind(null,t.reviver)},update:{result:g.parseUtilities.parseUpdateResult.bind(null,t.reviver),error:g.parseUtilities.parseXhrError.bind(null,t.reviver)},customRequest:{result:l["default"].identity,error:g.parseUtilities.parseXhrResponse}},c["default"]=t},{"../everlive/constants":70,"../everlive/everlive.platform":74,"../everlive/query/Query":96,"../everlive/reqwest.everlive":100,"../everlive/utils":121,rsvp:35,underscore:36}],64:[function(a,b){"use strict";function c(a){return a&&a.__esModule?a:{"default":a}}var d=a("underscore"),e=c(d),f=a("../everlive/constants"),g=c(f),h=a("../everlive/auth/AuthenticationSetup"),i=c(h);b.exports=function(){function a(a){this.url=b,this.appId=null,this.masterKey=null,this.token=null,this.tokenType=null,this.principalId=null,this.scheme="http",this.parseOnlyCompleteDateTimeObjects=!1,"string"==typeof a?this.appId=a:(this._emulatorMode=a.emulatorMode,e["default"].extend(this,a),a.apiKey&&(this.appId=a.apiKey)),this.apiKey=this.appId,this.authentication=new i["default"](this,a.authentication)}var b=g["default"].everliveUrl;return a.prototype.setAuthorizationProperties=function(a,b,c){this.token=a,this.tokenType=b,this.principalId=c},a.prototype.getAuthorizationProperties=function(){return{token:this.token,tokenType:this.tokenType,principalId:this.principalId}},a}()},{"../everlive/auth/AuthenticationSetup":66,"../everlive/constants":70,underscore:36}],65:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(c,"__esModule",{value:!0});var h=a("../../everlive/utils"),i=d(h),j=a("../../everlive/Everlive"),k=(d(j),a("../../everlive/constants")),l=d(k),m=a("../../everlive/storages/LocalStore"),n=d(m),o=a("../../everlive/EverliveError"),p=a("../../everlive/types/Data"),q=d(p),r=function(a){function b(c){e(this,b);var d=f(this,a.call(this,c,"Users"));if(d.authSetup=c.setup.authentication||{},d._authenticationCallbacks=null,d.authSetup.persist){d._localStore=new n["default"](c);var g=d._getLocalStoreKey(),h=d._localStore.getItem(g),i=void 0;h&&(i=JSON.parse(d._localStore.getItem(g))),i&&d.sdk.setup.setAuthorizationProperties(i.token,i.tokenType,i.principalId)}return d}return g(b,a),b.prototype._getLocalStoreKey=function(){return l["default"].AuthStoreKey+this.sdk.setup.apiKey+"$authentication"},b.prototype._ensureAuthentication=function(){if(!this.isAuthenticationInProgress())throw new Error("onAuthenticationRequired option of Everlive.Setup.Authentication is required.");return this.isAuthenticating()?this._authenticationCallbacks.promise:(this.clearAuthorization(),this.authSetup.onAuthenticationRequired.call(this),this._authenticationCallbacks=i["default"].getCallbacks(),this._authenticationCallbacks.promise)},b.prototype._loginSuccess=function(a){var b=a.result;this.setAuthorization(b.access_token,b.token_type,b.principal_id)},b.prototype._logoutSuccess=function(){this.clearAuthorization()},b.prototype._loginWithProvider=function(a,b,c){var d=this,e={Identity:a},f=this.buildDataQuery(e,k.DataQueryOperations.UserLoginWithProvider);return h.buildPromise(function(a,b){return d.processDataQuery(f).then(function(){return d._loginSuccess.apply(d,arguments),a.apply(void 0,arguments)})["catch"](b)},b,c)},b.prototype.login=function(a,b,c,d){var e=this,f="password",g={grant_type:f,username:a,password:b},i=this.buildDataQuery(g,k.DataQueryOperations.UserLogin);return h.buildPromise(function(a,b){return e.processDataQuery(i).then(function(){return e._loginSuccess.apply(e,arguments),a.apply(void 0,arguments)})["catch"](b)},c,d)},b.prototype.logout=function(a,b){var c=this,d=this.buildDataQuery(null,k.DataQueryOperations.UserLogout);return h.buildPromise(function(a,b){return c.processDataQuery(d).then(function(){return c._logoutSuccess.apply(c,arguments),a.apply(void 0,arguments)})["catch"](function(a){return 301===a.code&&c.clearAuthorization(),b(a)})},a,b)},b.prototype.loginWithFacebook=function(a,b,c){var d={Provider:"Facebook",Token:a};return this._loginWithProvider(d,b,c)},b.prototype.loginWithADFS=function(a,b,c){var d={Provider:"ADFS",Token:a};return this._loginWithProvider(d,b,c)},b.prototype.loginWithLiveID=function(a,b,c){var d={Provider:"LiveID",Token:a};return this._loginWithProvider(d,b,c)},b.prototype.loginWithGoogle=function(a,b,c){var d={Provider:"Google",Token:a};return this._loginWithProvider(d,b,c)},b.prototype.loginWithTwitter=function(a,b,c,d){var e={Provider:"Twitter",Token:a,TokenSecret:b};return this._loginWithProvider(e,c,d)},b.prototype.setAuthorization=function(a,b,c){if(this.sdk.setup.setAuthorizationProperties(a,b,c),this.authSetup.persist){var d=this._getLocalStoreKey(),e=this.sdk.setup.getAuthorizationProperties();this._localStore.setItem(d,JSON.stringify(e))}this._authenticationCallbacks&&(this._authenticationCallbacks.success(),this._authenticationCallbacks=null)},b.prototype.clearAuthorization=function(){this.setAuthorization(null,null,null),this.clearPersistedAuthentication()},b.prototype.clearPersistedAuthentication=function(){if(this._localStore){var a=this._getLocalStoreKey();this._localStore.removeItem(a),this.sdk.setup.setAuthorizationProperties(null,null,null)}},b.prototype.isAuthenticationInProgress=function(){return"function"==typeof this.authSetup.onAuthenticationRequired},b.prototype.completeAuthentication=function(a){this.sdk.setAuthorization(a.access_token,a.token_type,a.principal_id)},b.prototype.getAuthenticationStatus=function(a,b){var c=this;return i["default"].buildPromise(function(a,b){var d=c.sdk.setup;return d.masterKey?a({status:l["default"].AuthStatus.masterKey}):d.token?c.isAuthenticationInProgress()?a({status:l["default"].AuthStatus.authenticating}):c.sdk.users.skipAuth(!0).currentUser().then(function(b){return a({status:l["default"].AuthStatus.authenticated,user:b.result})},function(d){return c.isAuthenticationInProgress()?a({status:l["default"].AuthStatus.authenticating}):d.code===o.EverliveErrors.invalidRequest.code||d.code===o.EverliveErrors.invalidToken.code?a({status:l["default"].AuthStatus.invalidAuthentication}):d.code===o.EverliveErrors.expiredToken.code?a({status:l["default"].AuthStatus.expiredAuthentication}):b(d)}):a({status:l["default"].AuthStatus.unauthenticated})},a,b)},b.prototype.isAuthenticating=function(){return!!this._authenticationCallbacks},b}(q["default"]);c["default"]=r},{"../../everlive/Everlive":57,"../../everlive/EverliveError":58,"../../everlive/constants":70,"../../everlive/storages/LocalStore":107,"../../everlive/types/Data":110,"../../everlive/utils":121}],66:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=function f(a){var b=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];d(this,f),this.onAuthenticationRequired=b.onAuthenticationRequired,this.persist=b.persist,this.everlive=a};c["default"]=e},{}],67:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(c,"__esModule",{value:!0});var h=a("path"),i=d(h),j=a("../../everlive/constants"),k=d(j),l=a("underscore"),m=d(l),n=a("../../everlive/utils"),o=d(n),p=a("../../everlive/EverliveError"),q=a("../../everlive/types/Data"),r=d(q),s=function(a){function b(c){return e(this,b),f(this,a.call(this,c,"BusinessLogic"))}return g(b,a),b._isValidFuncName=function(a){return m["default"].isString(a)&&""!==a},b.prototype._invokeFunction=function(a,b){var c=a.customParameters,d=a.method,e=a.endpoint,f=a.success,g=a.error,h=m["default"].extend({customParameters:c,method:d,endpoint:e,authHeaders:!0,isCustomRequest:!0},a),i=this.buildDataQuery({additionalOptions:h},b);return this.processDataQuery(i,f,g)},b.prototype.invokeCloudFunction=function(a,c,d,e){if(!b._isValidFuncName(a)){var f=new p.EverliveError(p.EverliveErrors.invalidOrMissingFunctionName);return o["default"].callbackAndPromiseErrorResponse(f,e)}if(c=m["default"].extend({method:k["default"].HttpMethod.GET,success:d,error:e},c),c.method.toUpperCase()===k["default"].HttpMethod.GET&&m["default"].size(c.data)){var g=new p.EverliveError(p.EverliveErrors.bodyWithGetRequestNotSupported);return o["default"].callbackAndPromiseErrorResponse(g,e)}return c.endpoint=i["default"].join(k["default"].cloudFuncsEndpoint,a),
this._invokeFunction(c,j.DataQueryOperations.InvokeCloudFunction)},b.prototype.invokeStoredProcedure=function(a,c,d,e){if(!b._isValidFuncName(a)){var f=new p.EverliveError(p.EverliveErrors.invalidOrMissingProcedureName);return o["default"].callbackAndPromiseErrorResponse(f,e)}var g={method:k["default"].HttpMethod.POST,endpoint:i["default"].join(k["default"].sqlProceduresEndpoint,a),data:c||{},success:d,error:e};return this._invokeFunction(g,j.DataQueryOperations.InvokeStoredProcedure)},b}(r["default"]);c["default"]=s},{"../../everlive/EverliveError":58,"../../everlive/constants":70,"../../everlive/types/Data":110,"../../everlive/utils":121,path:4,underscore:36}],68:[function(a,b){"use strict";function c(a){return a&&a.__esModule?a:{"default":a}}var d=a("../../everlive/constants"),e=c(d),f=a("underscore"),g=c(f),h=a("rsvp"),i=c(h),j=a("../../everlive/utils"),k=c(j),l=a("json-stable-stringify"),m=c(l),n=a("../../everlive/services/RequestService"),o=a("../../everlive/offline/offlinePersisters"),p=c(o),q=a("../../everlive/offline/offline"),r=function(a,b){this.options=a,this.typeSettings=this.options.typeSettings,this.maxAgeInMs=60*this.options.maxAge*1e3,this._everlive=b},s=[d.DataQueryOperations.Read,d.DataQueryOperations.ReadById,d.DataQueryOperations.Count];r.prototype={_hash:function(a){return m["default"](a)},_initStore:function(a){if(!this.persister){var b=q.buildOfflineStorageOptions(a),c=this.options.storage.storagePath+"_"+a.apiKey;this.persister=p["default"].getPersister(c,b)}},_getCacheData:function(){var a=this;return this.cacheData?k["default"].successfulPromise(this.cacheData):this._persisterGetAllDataWrap().then(function(b){return a.cacheData=b,a.cacheData})},_persisterGetAllDataWrap:function(){var a=this;return new i["default"].Promise(function(b,c){return a.persister.getAllData(b,c)})},_persisterSaveDataWrap:function(a,b){var c=this;return new i["default"].Promise(function(d,e){return c.persister.saveData(a,JSON.stringify(b),d,e)})},_getCacheDataForContentType:function(a){return this._getCacheData().then(function(b){return b[a]="string"==typeof b[a]?JSON.parse(b[a]):b[a]||{},g["default"].clone(b[a])})},_persistCacheData:function(a,b){var c=this;return this._getCacheDataForContentType(a).then(function(){var d=g["default"].extend({},c.cacheData[a],b);return c.cacheData[a]=g["default"].compactObject(d),c._persisterSaveDataWrap(a,c.cacheData[a])})},isQueryUnsupportedOffline:function(a){var b=!!a.getHeader(e["default"].Headers.powerFields),c=a.getQueryParameters(),d=c.filter,f=k["default"].getUnsupportedOperators(d),g=0!==f.length;return b||g},_shouldSkipCache:function(a){var b=-1===s.indexOf(a.operation),c=a.collectionName,d=this.typeSettings,e=d&&d&&d[c]&&d[c].enabled===!1,f=a.ignoreCache,g=this.isQueryUnsupportedOffline(a),h=a.additionalOptions&&"me"===a.additionalOptions.id;return b||e||h||f||g},_processCacheItem:function(a,b){var c=this,e=a.collectionName,f=this._getHashForQuery(a);return c._getCacheDataForContentType(e).then(function(g){return g[f]?c._isHashExpired(e,f,a.maxAge).then(function(g){return g&&!a.forceCache?c._purgeForHash(e,f).then(function(){return c._cacheQuery(a,f,b)}):(a.operation===d.DataQueryOperations.ReadById&&"me"===a.additionalOptions.id&&(a.additionalOptions.id=c._everlive.setup.principalId),c._everlive.offlineStorage.processQuery(a))}):c._cacheQuery(a,f,b)})},_addObjectToCache:function(a,b,c){var d=a.Id;return this._cacheResultFromDataQuery(b,d,c)},_cacheQuery:function(a,b,c){var e=this,f=a.collectionName,h=new i["default"].Promise(function(h,j){var k=void 0;return n.RequestService.handleRequestProcessing(a,c).then(function(a){return k=a.result||a,e._getCacheData()}).then(function(){var b=[],c=k.Result||k;if(a.operation!==d.DataQueryOperations.Count)if(Array.isArray(c))g["default"].each(c,function(a){var c=e._addObjectToCache(a,f);b.push(c)});else if(g["default"].isObject(c)){var h=e._addObjectToCache(c,f);b.push(h)}return i["default"].all(b)}).then(function(){return a.operation!==d.DataQueryOperations.Count?e._cacheResultFromDataQuery(f,b):void 0}).then(function(){h(k)})["catch"](function(a){j(a)})});return h},_cacheResultFromDataQuery:function(a,b){var c={};return c[b]={cachedAt:Date.now()},this._persistCacheData(a,c)},_getExpirationForHash:function(a,b){return this._getCacheDataForContentType(a).then(function(a){return a[b].cachedAt})},_isHashExpired:function(a,b,c){var d=this;return this._getExpirationForHash(a,b).then(function(b){var e,f=d.typeSettings&&d.typeSettings[a]?60*d.typeSettings[a].maxAge*1e3:null;return e=c||0===c?c:f||0===f?f:d.maxAgeInMs,b+e<Date.now()})},_purgeForHash:function(a,b){var c={};return c[b]=null,this._persistCacheData(a,c)},_getHashForQuery:function(a){if(a.operation===d.DataQueryOperations.ReadById)return a.additionalOptions.id;var b=a.getQueryParameters();return this._hash(b)},clear:function(a,b,c){var d=this;return j.buildPromise(function(b,c){return d.persister.purge(a,function(){delete d.cacheData[a],d._everlive.offlineStorage.setup.enabled?b():d._everlive.offlineStorage._queryProcessor._persister.purge(a,b,c)},c)},b,c)},clearAll:function(a,b){var c=this;return c.cacheData=null,j.buildPromise(function(a,b){return c.persister.purgeAll(function(){c._everlive.offlineStorage.setup.enabled?a():c._everlive.offlineStorage._queryProcessor._persister.purgeAll(a,b)},b)},a,b)}},b.exports=r},{"../../everlive/constants":70,"../../everlive/offline/offline":85,"../../everlive/offline/offlinePersisters":86,"../../everlive/services/RequestService":105,"../../everlive/utils":121,"json-stable-stringify":8,rsvp:35,underscore:36}],69:[function(a,b){"use strict";function c(a){return a&&a.__esModule?a:{"default":a}}var d=a("../../everlive/caching/CacheModule"),e=c(d),f=a("underscore"),g=c(f),h=function(){return{maxAge:60,enabled:!1,storage:{storagePath:"el_cache"}}};b.exports={initCaching:function(a){var b,c=h();a.caching===!0?(b=g["default"].deepExtend({},c),b.enabled=!0):b=g["default"].deepExtend(c,a.caching),a.caching!==!1&&(this.setup.caching=b),this.cache=new e["default"](b,this)},_initStore:function(a){this.cache._initStore(a)}}},{"../../everlive/caching/CacheModule":68,underscore:36}],70:[function(a,b){"use strict";function c(a){return a&&a.__esModule?a:{"default":a}}var d=a("underscore"),e=c(d),f=a("../common/constants"),g=c(f),h={idField:"Id",guidEmpty:"00000000-0000-0000-0000-000000000000",cloudFuncsEndpoint:"Functions",sqlProceduresEndpoint:"Invoke/SqlProcedures",everliveUrl:"//api.everlive.com/v1/",ConflictResolutionStrategy:{ClientWins:"clientWins",ServerWins:"serverWins",Custom:"custom"},ConflictResolution:{KeepServer:"keepServer",KeepClient:"keepClient",Custom:"custom",Skip:"skip"},StorageProvider:{LocalStorage:"localStorage",FileSystem:"fileSystem",Custom:"custom"},DefaultStoragePath:"el_store",DefaultFilesStoragePath:"el_file_store",DefaultFilesMetadataPath:"el_file_mapping",EncryptionProvider:{Default:"default",Custom:"custom"},Headers:{ContentType:"content-type",filter:"x-everlive-filter",select:"x-everlive-fields",sort:"x-everlive-sort",skip:"x-everlive-skip",take:"x-everlive-take",expand:"x-everlive-expand",singleField:"x-everlive-single-field",includeCount:"x-everlive-include-count",powerFields:"x-everlive-power-fields",debug:"x-everlive-debug",overrideSystemFields:"x-everlive-override-system-fields",sdk:"x-everlive-sdk",sync:"x-everlive-sync",aggregate:"x-everlive-aggregate",customParameters:"x-everlive-custom-parameters"},Platform:{WindowsPhone:1,Windows:2,Android:3,iOS:4,OSX:5,Blackberry:6,Nokia:7,Unknown:100},OperatorType:{query:1,where:100,filter:101,and:110,or:111,not:112,equal:120,not_equal:121,lt:122,lte:123,gt:124,gte:125,isin:126,notin:127,all:128,size:129,regex:130,contains:131,startsWith:132,endsWith:133,nearShpere:140,withinBox:141,withinPolygon:142,withinShpere:143,select:200,exclude:201,order:300,order_desc:301,skip:400,take:401,expand:402},AuthStatus:{unauthenticated:"unauthenticated",masterKey:"masterKey",invalidAuthentication:"invalidAuthentication",authenticated:"authenticated",expiredAuthentication:"expiredAuthentication",authenticating:"authenticating"},offlineItemStates:{created:"create",modified:"update",deleted:"delete"},HttpMethod:{GET:"GET",POST:"POST",PUT:"PUT",DELETE:"DELETE"},maxDistanceConsts:{radians:"$maxDistance",km:"$maxDistanceInKilometers",miles:"$maxDistanceInMiles"},radiusConsts:{radians:"radius",km:"radiusInKilometers",miles:"radiusInMiles"}};h.offlineItemsStateMarker="__everlive_offline_state",h.SyncErrors={generalError:"generalError",itemSyncError:"itemSyncError"},h.syncBatchSize=10,h.AuthStoreKey="__everlive_auth_key",h.CachingStoreKey="__everlive_cache",h.defaultSyncInterval=6e5,h.fileUploadKey="fileUpload",h.fileUploadDelimiter="_",h.FilesTypeNameLegacy="system.files",h.FilesTypeName="Files",h.MaxConcurrentDownloadTasks=3,h.DefaultFilesystemStorageQuota=10485760,h.Events={SyncStart:"syncStart",SyncEnd:"syncEnd",Processed:"processed",ItemProcessed:"itemProcessed",BeforeExecute:"beforeExecute"},h.DataQueryOperations={Read:"read",Create:"create",Update:"update",Delete:"destroy",DeleteById:"destroySingle",ReadById:"readById",Count:"count",RawUpdate:"rawUpdate",SetAcl:"setAcl",SetOwner:"setOwner",UpdateById:"updateSingle",UserLogin:"login",UserLogout:"logout",UserChangePassword:"changePassword",UserLoginWithProvider:"loginWith",UserLinkWithProvider:"linkWith",UserUnlinkFromProvider:"unlinkFrom",UserResetPassword:"resetPassword",UserSetPassword:"setPassword",FilesUpdateContent:"updateContent",FilesGetDownloadUrlById:"downloadUrlById",Aggregate:"aggregate",InvokeCloudFunction:"invokeCloudFunction",InvokeStoredProcedure:"invokeStoredProcedure"},h.Aggregation={MaxDocumentsCount:1e5},h.Push={NotificationsType:"Push/Notifications",DevicesType:"Push/Devices"},h.EncodableHeaders=[h.Headers.filter,h.Headers.expand,h.Headers.powerFields,h.Headers.customParameters],e["default"].deepExtend(h,g["default"]),b.exports=h},{"../common/constants":40,underscore:36}],71:[function(a,b){"use strict";function c(a){return a&&a.__esModule?a:{"default":a}}function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function f(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var g=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=a("underscore"),i=c(h),j=a("../../everlive/constants"),k=a("../../common/query/Query"),l=c(k),m=a("../../common/dataQuery/DataQuery"),n=c(m),o=a("../../everlive/utils"),p=c(o),q=a("../../common/platform"),r=c(q),s=function(a){function b(c){d(this,b);var f=e(this,a.call(this,c));f.headers=c.headers||{},f.useOffline=c.useOffline,f.applyOffline=c.applyOffline,f.noRetry=c.noRetry,f.skipAuth=c.skipAuth,f._normalizedHeaders=null,f.isSync=c.isSync;var g=c.meta||c.config.meta||{};return g.collectionName&&(f.collectionName=g.collectionName),f}return f(b,a),b.prototype._normalizeHeaders=function(){this._normalizedHeaders=p["default"].normalizeKeys(this.headers)},b.prototype.getHeader=function(a){this._normalizeHeaders();var b=a.toLowerCase();return this._normalizedHeaders[b]},b.prototype.getHeaders=function(){this._normalizeHeaders();var a=i["default"].deepExtend(this._normalizedHeaders);return a},b.prototype.getHeaderAsJSON=function(a){this._normalizeHeaders();var b;if(a&&(b=this._normalizedHeaders[a.toLowerCase()]),i["default"].isObject(b))return b;if(!i["default"].isString(b))return b;try{return JSON.parse(b)}catch(c){return b}},b.prototype.getQueryParameters=function(){var a={};if(this.operation===b.operations.ReadById)a.expand=this.getHeaderAsJSON(j.Headers.expand),a.select=this.getHeaderAsJSON(j.Headers.select);else if(!this.additionalOptions||void 0===this.additionalOptions.id){var c=this.getHeaderAsJSON(j.Headers.sort),d=this.getHeaderAsJSON(j.Headers.take),e=this.getHeaderAsJSON(j.Headers.skip),f=this.getHeaderAsJSON(j.Headers.select),g=this.getHeaderAsJSON(j.Headers.filter),h=this.getHeaderAsJSON(j.Headers.expand),i=this.getHeaderAsJSON(j.Headers.aggregate);if(this.query instanceof l["default"]){var k=this.query.build();a.filter=k.$where||g||{},a.sort=k.$sort||c,a.limit=k.$take||d,a.skip=k.$skip||e,a.select=k.$select||f,a.expand=k.$expand||h,a.aggregate=k.$aggregate||i}else a.filter=this.filter||g||this.config.filter||{},a.sort=c,a.limit=d,a.skip=e,a.select=f,a.expand=h,a.aggregate=i}return a},b.prototype.applyEventQuery=function(a){this._applyCustomHeaders(a),this._applyEventQueryHeaders(a),this._applyEventQueryParams(a),this.additionalOptions=this.additionalOptions||{},this.additionalOptions.id=a.itemId,this.data=a.data,this._applyEventQuerySettings(a)},b.prototype._applyCustomHeaders=function(a){this.headers=a.headers,this._normalizeHeaders()},b.prototype._applyEventQueryHeaders=function(a){this._applyEventHeader(j.Headers.filter,a.filter),this._applyEventHeader(j.Headers.select,a.fields),this._applyEventHeader(j.Headers.sort,a.sort),this._applyEventHeader(j.Headers.skip,a.skip),this._applyEventHeader(j.Headers.take,a.take),this._applyEventHeader(j.Headers.expand,a.expand),this._applyEventHeader(j.Headers.aggregate,a.aggregate),this._applyEventHeader(j.Headers.powerFields,a.powerfields)},b.prototype._applyEventQueryParams=function(a){a.filter&&(this.query=this.query||{},this.query.filter=a.filter),a.aggregate&&(this.query=this.query||{},this.query.aggregateExpression=a.aggregate),this.fields=a.select,this.sort=a.sort,this.skip=a.skip,this.take=a.take,this.expand=a.expand},b.prototype._applyEventQuerySettings=function(a){this.useOffline=a.settings.useOffline,this.forceCache=a.settings.forceCache,this.ignoreCache=a.settings.ignoreCache,this.applyOffline=a.settings.applyOffline},b.prototype._applyEventHeader=function(a,b){if(b&&"string"!=typeof b){var c=a.toLowerCase();this.headers[c]=JSON.stringify(b)}},g(b,[{key:"canUseOffline",get:function(){var a=null;if(p["default"].isContentType.files(this.collectionName)&&r["default"].isDesktop){var b=this.operation;a=this.useOffline&&(b===j.DataQueryOperations.Read||b===j.DataQueryOperations.ReadById||b===j.DataQueryOperations.FilesGetDownloadUrlById||b===j.DataQueryOperations.Delete||b===j.DataQueryOperations.DeleteById)}else a=this.useOffline;return a}}]),b}(n["default"]);s.operations=j.DataQueryOperations,b.exports=s},{"../../common/dataQuery/DataQuery":41,"../../common/platform":51,"../../common/query/Query":53,"../../everlive/constants":70,"../../everlive/utils":121,underscore:36}],72:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}function f(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function g(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function h(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(c,"__esModule",{value:!0});var i=a("../../common/dataQuery/DataQueryBuilder"),j=d(i),k=a("../../everlive/dataQuery/DataQuery"),l=d(k),m=a("../../everlive/query/Query"),n=d(m),o=a("../../everlive/constants"),p=a("underscore"),q=function(a){function b(){return f(this,b),g(this,a.apply(this,arguments))}return h(b,a),b.prototype._getInitialDataQuery=function(a,b){return new l["default"]({meta:b,operation:a})},b.prototype._isOperationAllowed=function(a,b){return p.contains(a,b)},b.prototype._buildQuery=function(a){return a?a instanceof n["default"]?a:new n["default"](a):null},b.prototype._tryBuildQuery=function(a,c){var d=b._tryBuildQueryAllowedOperations;if(!this._isOperationAllowed(d,a))return null;var e=p.has(c,"query")?c.query:c;return this._buildQuery(e)},b.prototype._tryGetData=function(a,c){var d=b._tryGetDataAllowedOperations;if(!this._isOperationAllowed(d,a))return null;var e=b._tryGetDataFields,f=p.find(e,function(a){return p.has(c,a)});return f?c[f]:c},b.prototype._isAuthenticationOperation=function(a){return a===o.DataQueryOperations.UserLogin||a===o.DataQueryOperations.UserLogout||a===o.DataQueryOperations.UserLoginWithProvider||a===o.DataQueryOperations.UserLinkWithProvider||a===o.DataQueryOperations.UserUnlinkFromProvider},b.prototype._isCloudCodeOperation=function(a){return a===o.DataQueryOperations.InvokeCloudFunction||a===o.DataQueryOperations.InvokeStoredProcedure},b.prototype._applyOperationSpecificProperties=function(a,b){if(a===o.DataQueryOperations.UserLoginWithProvider)b.authHeaders=!1;else if(this._isCloudCodeOperation(a)){var c=b.additionalOptions,d=c.customParameters,f=c.authHeaders;b.authHeaders=f,d&&(b.headers=p.extend(b.headers,e({},o.Headers.customParameters,JSON.stringify(d))))}return this._isAuthenticationOperation(a)&&(b.skipAuth=!0),b},b.prototype.buildDataQuery=function(b,c,d,e,f){if(!p.chain(o.DataQueryOperations).values().contains(c).value())throw new Error("Unknown data query operation - "+c);var g=a.prototype.buildDataQuery.call(this,b,c,d,e,f);return g.query?g:(g.query=this._tryBuildQuery(c,b)||void 0,g.data=this._tryGetData(c,b)||void 0,this._applyOperationSpecificProperties(c,g),g)},b}(j["default"]);q._tryBuildQueryAllowedOperations=[o.DataQueryOperations.Read,o.DataQueryOperations.ReadById,o.DataQueryOperations.Count,o.DataQueryOperations.Aggregate,o.DataQueryOperations.SetAcl,o.DataQueryOperations.Update,o.DataQueryOperations.SetOwner,o.DataQueryOperations.Delete,o.DataQueryOperations.DeleteById,o.DataQueryOperations.RawUpdate],q._tryGetDataAllowedOperations=[o.DataQueryOperations.Create,o.DataQueryOperations.RawUpdate,o.DataQueryOperations.Update,o.DataQueryOperations.SetOwner,o.DataQueryOperations.UserLogin,o.DataQueryOperations.UserLoginWithProvider,o.DataQueryOperations.FilesUpdateContent,o.DataQueryOperations.UserResetPassword,o.DataQueryOperations.UserSetPassword,o.DataQueryOperations.UserChangePassword,o.DataQueryOperations.UserLinkWithProvider,o.DataQueryOperations.UserUnlinkFromProvider],q._tryGetDataFields=["updateObject","data"],c["default"]=q},{"../../common/dataQuery/DataQueryBuilder":42,"../../everlive/constants":70,"../../everlive/dataQuery/DataQuery":71,"../../everlive/query/Query":96,underscore:36}],73:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=a("node-cryptojs-aes"),f=e.CryptoJS.AES,g=function(){function a(){var b=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];d(this,a),this.options=b}return a.prototype._getKey=function(){return this.options.encryption.key},a.prototype._canEncryptDecrypt=function(a){return this._getKey()&&null!==a&&void 0!==a},a.prototype.encrypt=function(a){return this._canEncryptDecrypt(a)?f.encrypt(a,this._getKey()).toString():a},a.prototype.decrypt=function(a){return this._canEncryptDecrypt(a)?f.decrypt(a,this._getKey()).toString(e.CryptoJS.enc.Utf8):a},a}();c["default"]=g},{"node-cryptojs-aes":26}],74:[function(a,b,c){"use strict";var d,e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol?"symbol":typeof a},f=Boolean("undefined"!=typeof android&&android&&android.widget&&android.widget.Button||"undefined"!=typeof UIButton&&UIButton),g=!1,h=!1,i=!1;"undefined"==typeof window||f||(g=/^file:\/{3}[^\/]|x-wmapp/i.test(window.location.href)&&/ios|iphone|ipod|ipad|android|iemobile/i.test(navigator.userAgent),h=g&&/iemobile/i.test(navigator.userAgent),i=g&&"android"===cordova.platformId);var j="object"===("undefined"==typeof c?"undefined":e(c))&&"undefined"==typeof window,k="function"==typeof define&&define.amd,l=!f&&!g&&!j;f?d="ns":j?d="nodejs":l?d="desktop":g&&(d="cordova");var m=function(){return"undefined"!=typeof window&&window.navigator&&window.navigator.simulator};b.exports={isCordova:g,isNativeScript:f,isDesktop:l,isWindowsPhone:h,isAndroid:i,isNodejs:j,isRequirejs:k,platform:d,isInAppBuilderSimulator:m}},{}],75:[function(a,b){"use strict";function c(a){return a&&a.__esModule?a:{"default":a}}var d=a("../../everlive/everlive.platform"),e=c(d),f=a("../../everlive/helpers/html/htmlHelper"),g=c(f),h=[];(e["default"].isCordova||e["default"].isDesktop)&&h.push({name:"html",ctor:g["default"]}),b.exports=h},{"../../everlive/everlive.platform":74,"../../everlive/helpers/html/htmlHelper":76}],76:[function(a,b){"use strict";function c(a){return a&&a.__esModule?a:{"default":a}}var d=a("underscore"),e=c(d),f=a("../../../everlive/utils"),g=c(f),h=a("rsvp"),i=c(h),j=a("../../../everlive/helpers/html/htmlHelperResponsiveModule"),k=c(j),l=a("../../../everlive/helpers/html/htmlHelperOfflineModule"),m=c(l),n=a("../../../everlive/constants"),o=c(n),p=a("../../../everlive/EverliveError"),q=a("../../../everlive/EventEmitterProxy"),r=c(q);b.exports=function(){function a(a,c){r["default"].apply(this),this._everlive=a,this._settings={urlTemplate:"[protocol][hostname][appid]/[operations][url]",server:"bs1.cdn.telerik.com/image/v1/"},c=c||{},this.options=e["default"].extend({},b,c),this.options.attributes=e["default"].extend({},b.attributes,c.attributes),this.options.responsiveParams=e["default"].extend({},b.responsiveParams,c.responsiveParams),this._responsive=new k["default"](this),this._offline=new m["default"](this),this._init()}var b={processOnLoad:!1,processOnResize:!1,loadingImageUrl:"",errorImageUrl:"",attributes:{loadingImage:"data-loading-image",errorImage:"data-error-image",dpi:"data-dpi",imageSource:"data-src",fileSource:"data-href",enableOffline:"data-offline",enableResponsive:"data-responsive"},responsiveParams:{}};return a.prototype={_init:function(){var a=this;a.options.processOnLoad&&window.addEventListener("load",this.processAll.bind(this),!1),this.options.processOnResize&&window.addEventListener("resize",e["default"].debounce(this.processAll.bind(this),300),!1)},_triggerOnProcessed:function(a){this._emitter.emit(o["default"].Events.Processed,a)},_defaultProcessSettings:function(a){return e["default"].defaults({},a,{responsive:!0,offline:!0})},_setLoadingUrl:function(a){var b=a.getAttribute(this.options.attributes.loadingImage)||this.options.loadingImageUrl;return!b||g["default"].isElement.anchor(a)?g["default"].successfulPromise():this._setUrl(a,b,!0)},_getBackgroundSrc:function(a){var b=window.getComputedStyle(a,null),c=b.getPropertyValue("background-image"),d="none"!==c?c:!1;return d&&(d=d.replace(/url\(('?"?)(.*?)\1\)/gi,"$2")),d},_setErrorUrl:function(a){var b=a.getAttribute(this.options.attributes.errorImage)||this.options.errorImageUrl;return!b||g["default"].isElement.anchor(a)?g["default"].successfulPromise():this._setUrl(a,b,!0)},_setUrl:function(a,b,c){var d=this;return new i["default"].Promise(function(f,h){var i=d._getAttr(a);if(g["default"].isElement.image(a)&&i===d.options.attributes.imageSource)if(c)a.src=b,a.style.visibility="visible";else{var j=new Image;j.onerror=function(){j=null,h(new p.EverliveError("Can't be loaded: "+b))},j.onload=function(){j=null,d._setUrl(a,b,!0).then(f)["catch"](h)},j.src=b}else if(c=!0,i){var k;k=i===d.options.attributes.imageSource?"src":i===d.options.attributes.fileSource?"href":e["default"].last(i.split("-")),a.setAttribute(k,b)}else a.style.backgroundImage="url("+b+")";c&&f()})},_getAttr:function(a){return a.getAttribute(this.options.attributes.imageSource)?this.options.attributes.imageSource:a.getAttribute(this.options.attributes.fileSource)?this.options.attributes.fileSource:void 0},_getUrl:function(a){var b=a.getAttribute(this.options.attributes.imageSource)||a.getAttribute(this.options.attributes.fileSource)||this._getBackgroundSrc(a);return b},_wrapElements:function(a){var b=this,c=e["default"].map(a,function(a){var c=a.tagName.toLowerCase(),d=function(b){var c,d=(a.attributes[b]||{value:null}).value;if(""===d)c=!0;else if(d)try{c=JSON.parse(d)}catch(e){c=!0}else c=!1;return c},e=d(b.options.attributes.enableResponsive),f=d(b.options.attributes.enableOffline);return{item:a,tag:c,operations:{responsive:e,offline:f}}});return c},process:function(a,b,c,d){var f=this;return g["default"].buildPromise(function(c){b=f._defaultProcessSettings(b),a=e["default"].isArray(a)||a instanceof NodeList||a.length?e["default"].flatten(a):[a];var d=f._wrapElements(a),h=[];e["default"].each(d,function(a){var c={element:a.item,responsive:!1,offline:!1},d=f._getUrl(c.element);if(!d)return h.push(g["default"].successfulPromise(c));var e=b.responsive?a.operations.responsive:!1,i=b.offline?a.operations.offline:!1;if(!e&&!i)return h.push(f._setUrl(c.element,d,!0).then(function(){return c}));var j=f._setLoadingUrl(c.element),k=function(a,b){return b?(c[a]=!0,b):void 0};e&&(j=j.then(function(){return f._responsive.responsiveImage(a,d).then(k.bind(this,"responsive"))})),i&&(j=j.then(function(a){return f._offline.processOffline(a||d).then(k.bind(this,"offline"))})),j=j.then(function(a){return f._setUrl(c.element,a).then(function(){return c})})["catch"](function(a){return f._setErrorUrl(c.element).then(function(){throw{element:c.element,error:a}})}),h.push(j)}),i["default"].allSettled(h).then(function(a){var b=[],d=[];e["default"].each(a,function(a){"fulfilled"===a.state?b.push(a.value):d.push(a.reason)});var g={processed:b,failed:d};f._triggerOnProcessed(g),c(g)})},c,d)},processAll:function(a,b,c){a=this._defaultProcessSettings(a);var d="["+this.options.attributes.enableResponsive+"]",f="["+this.options.attributes.enableOffline+"]",g=[];a.responsive&&(g=document.querySelectorAll(d));var h=[];a.offline&&(h=document.querySelectorAll(f));var i=[].slice,j=e["default"].unique(i.call(g).concat(i.call(h)));return this.process(j,a,b,c)}},a}()},{"../../../everlive/EventEmitterProxy":56,"../../../everlive/EverliveError":58,"../../../everlive/constants":70,"../../../everlive/helpers/html/htmlHelperOfflineModule":77,"../../../everlive/helpers/html/htmlHelperResponsiveModule":78,"../../../everlive/utils":121,rsvp:35,underscore:36}],77:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var f=a("../../../everlive/utils"),g=d(f),h=a("../../../everlive/EverliveError"),i=a("path"),j=d(i),k=a("underscore"),l=d(k),m=function(){function a(b){e(this,a),this.htmlHelper=b}return a.prototype.processOffline=function(a){var b=this;return b.htmlHelper._everlive.offlineStorage.files?b.htmlHelper._everlive.offlineStorage.files.downloadOffline(a).then(function(a){return a})["catch"](function(c){if(c.code!==h.EverliveErrors.cannotDownloadOffline.code)throw c;return b.htmlHelper._everlive.offlineStorage._offlineFilesProcessor.getOfflineFilesData().then(function(b){var c=j["default"].basename(a),d=l["default"].find(b,function(a){if(a.onlineLocation&&a.offlineLocation){var b=a.onlineLocation,d=b.lastIndexOf(c);return-1!==d}});if(d)return d.offlineLocation;throw new h.EverliveError("Cannot find offline image "+a,h.EverliveErrors.missingOrInvalidFileContent.code)})}):g["default"].rejectedPromise(new h.EverliveError("Offline storage must be enabled in order to use the offline features of the images component."))},a}();c["default"]=m},{"../../../everlive/EverliveError":58,"../../../everlive/utils":121,path:4,underscore:36}],78:[function(a,b){"use strict";function c(a){return a&&a.__esModule?a:{"default":a}}var d=a("underscore"),e=c(d),f=a("rsvp"),g=c(f),h=(a("../../../everlive/EverliveError"),a("../../../everlive/utils")),i=c(h),j={params:{resize:{}},isUserResize:!1};b.exports=function(){function a(a){this.htmlHelper=a}return a.prototype={getBackgroundWidth:function(a){return Math.ceil(a.offsetWidth)},getBackgroundHeight:function(a){return Math.ceil(a.offsetHeight)},parseParamsString:function(a){if(!a||"undefined"==typeof a||a.length<=1)return j;var b=a.split("/"),c={},d=!1;return e["default"].chain(b).filter(function(a){return!!a}).each(function(a){var b=a.split("="),e=b[0],f=b[1];f=unescape(f.replace(/\+/g," ")),c[e]=f,"resize"===e&&(d=!0)}),{params:c,isUserResize:d}},getImgParams:function(a,b){var c,d=this,f=a.replace(/.*?resize=[^\/\/]*\//gi,""),g=new RegExp("https?://","gi"),h=new RegExp(this.htmlHelper._settings.server,"gi"),i=new RegExp(this.htmlHelper._everlive.appId+"/","gi"),k=a.replace(f,"").replace(g,"").replace(h,"").replace(i,"").toLowerCase();if(""!==k){var l=k.indexOf("/")?k.substring(0,k.length-1):k;c=this.parseParamsString(l)}else b.dataset.responsiveParams?(c=j,e["default"].each(b.dataset.responsiveParams.split(","),function(a){var b=a.split(":"),d=b[0],e=b[1];c.params.resize[d]=e})):c=j;return e["default"].chain(this.htmlHelper.options.responsiveParams).keys().each(function(a){var b=d.htmlHelper.options.responsiveParams[a];c.params.resize[a]=b}),c.isUserResize&&(f=a),{imgUrl:f,operations:c.params,isUserResize:c.isUserResize}},hasClass:function(a,b){var c=new RegExp("(?:\\s|^)"+b+"(?:\\s|$)");return!!a.className.match(c)},getImageWidth:function(a){var b=a.parentNode;if(b){var c=b.offsetWidth,d=window.getComputedStyle(b,null),e=parseFloat(d.getPropertyValue("padding-left")),f=parseFloat(d.getPropertyValue("padding-right")),g=parseFloat(d.getPropertyValue("border-left-width")),h=parseFloat(d.getPropertyValue("border-right-width"));return Math.abs(c-Math.ceil(e+f+g+h))}return 0},getImageHeight:function(a){var b=a.parentNode;if(b){var c=b.offsetHeight,d=window.getComputedStyle(b,null),e=parseFloat(d.getPropertyValue("padding-top")),f=parseFloat(d.getPropertyValue("padding-bottom")),g=parseFloat(d.getPropertyValue("border-top-width")),h=parseFloat(d.getPropertyValue("border-bottom-width"));return Math.abs(c-Math.ceil(e+f+g+h))}return 0},getDevicePixelRatio:function(){return window.devicePixelRatio?window.devicePixelRatio:1},getPixelRatio:function(a){var b=a.getAttribute(this.htmlHelper.options.attributes.dpi)||"";return""!==b?e["default"].isNumber(b)?parseFloat(b):!1:this.getDevicePixelRatio()},getImgParamsString:function(a){var b="resize=";return e["default"].chain(a.resize).keys().each(function(c,d,e){b+=c+":"+a.resize[c],b+=d<e.length-1?",":"/"}),b},responsiveImage:function(a,b){var c,d=this,f=e["default"].extend({},a),h=f.item,j=f.tag,k=i["default"].isElement.image(j);f=e["default"].extend({},f,d.getImgParams(b,a.item)),f.isUserResize||(c=k?d.getImageWidth(h):d.getBackgroundWidth(h)),c=c?c:!1;var l=f.isUserResize?f.imgUrl:d.getImgSrc(f,c);return new g["default"].Promise(function(a){return c||f.isUserResize?a(l):a()})},getImgSrc:function(a,b){var c=this.htmlHelper._everlive.setup.scheme+"://",d=this.htmlHelper._everlive.setup.appId,e=this.htmlHelper._settings.server,f=this.htmlHelper._settings.urlTemplate,g=this.getPixelRatio(a.item);f=f.replace("[protocol]",c),f=f.replace("[appid]",d||""),f=f.replace("[hostname]",e);var h,i=a.operations||!1;if(i){i.resize=i.resize||{},i.resize.w=b,i.resize.pd=g;var j=i.resize.fill;("cover"===j||"contain"===j)&&(i.resize.h=this.getImageHeight(a.item)||this.getBackgroundHeight(a.item)),h=this.getImgParamsString(i)}else{var k={resize:{w:b,pd:g}};h=this.getImgParamsString(k)}return f=f.replace("[operations]",h),f=f.replace("[url]",a.imgUrl)}},a}()},{"../../../everlive/EverliveError":58,"../../../everlive/utils":121,
rsvp:35,underscore:36}],79:[function(a,b){"use strict";function c(a){return a&&a.__esModule?a:{"default":a}}var d=a("../everlive/Everlive"),e=c(d),f=a("../everlive/everlive.platform"),g=c(f),h=a("underscore"),i=c(h),j=a("rsvp"),k=c(j),l=a("../everlive/reqwest.everlive"),m=c(l),n=a("../everlive/query/Query"),o=c(n),p=a("../everlive/query/AggregateQuery"),q=c(p),r=a("../everlive/query/QueryBuilder"),s=c(r),t=a("../everlive/GeoPoint"),u=c(t),v=a("../everlive/constants"),w=c(v),x=a("../everlive/Request"),y=c(x),z=a("../everlive/EverliveError"),A=a("../everlive/utils"),B=c(A),C=a("../everlive/types/Data"),D=c(C),E=a("../everlive/offline/offlinePersisters"),F=c(E);!function(){if(e["default"].version="1.7.0",!g["default"].isNativeScript&&!g["default"].isNodejs){var c=a("../everlive/kendo/kendo.everlive");e["default"].createDataSource=c.createDataSource,e["default"].createHierarchicalDataSource=c.createHierarchicalDataSource}e["default"].PushCallbacks={},e["default"].Offline={},e["default"].Query=o["default"],e["default"].AggregateQuery=q["default"],e["default"].QueryBuilder=s["default"],e["default"].GeoPoint=u["default"],e["default"].Constants=w["default"],e["default"].Request=y["default"],e["default"].EverliveErrors=z.EverliveErrors,e["default"].Data=D["default"],e["default"]._utils=B["default"],e["default"]._traverseAndRevive=e["default"]._utils.parseUtilities.traverseAndRevive,e["default"]._common={_:i["default"],rsvp:k["default"],reqwest:m["default"]},e["default"].persister={LocalStorage:F["default"].LocalStoragePersister,FileSystem:F["default"].FileSystemPersister},b.exports=e["default"]}()},{"../everlive/Everlive":57,"../everlive/EverliveError":58,"../everlive/GeoPoint":61,"../everlive/Request":63,"../everlive/constants":70,"../everlive/everlive.platform":74,"../everlive/kendo/kendo.everlive":80,"../everlive/offline/offlinePersisters":86,"../everlive/query/AggregateQuery":94,"../everlive/query/Query":96,"../everlive/query/QueryBuilder":97,"../everlive/reqwest.everlive":100,"../everlive/types/Data":110,"../everlive/utils":121,rsvp:35,underscore:36}],80:[function(a,b){"use strict";function c(a){return a&&a.__esModule?a:{"default":a}}var d=a("../../everlive/query/QueryBuilder"),e=c(d),f=a("../../everlive/query/Query"),g=c(f),h=a("../../everlive/query/AggregateQuery"),i=c(h),j=a("../../everlive/constants"),k=c(j),l=a("underscore"),m=c(l),n=a("../../everlive/Everlive"),o=c(n),p=(a("../../everlive/EverliveError"),{read:"read",update:"update",destroy:"destroy",create:"create"});!function(){function a(a){var b={};if(a){if(a.skip&&(b.$skip=a.skip,delete a.skip),a.take&&(b.$take=a.take,delete a.take),a.sort){var d=a.sort,e={};c.isArray(d)||(d=[d]),c.each(d,function(a,b){e[b.field]="asc"===b.dir?1:-1}),b.$sort=e,delete a.sort}a.filter&&(b.$where=n.build(a.filter),delete a.filter)}return b}if(!("undefined"!=typeof window&&"undefined"==typeof window.jQuery||"undefined"==typeof window.kendo||m["default"].isEmpty(window.kendo.data))){var c=window.jQuery,d=window.kendo,f=c.extend,h="_",j=d.data.RemoteTransport.extend({init:function(a){if(this.everlive$=a.dataProvider||o["default"].$,this._subscribeToSdkEvents(a),!this.everlive$)throw new Error("An instance of the Backend services sdk must be provided.");if(!a.typeName)throw new Error("A type name must be provided.");this.headers=a.headers,this.dataCollection=this.everlive$.data(a.typeName),d.data.RemoteTransport.fn.init.call(this,a)},read:function(b){var c=this.options.read,e=this;if(c&&c.url)return d.data.RemoteTransport.fn.read.call(this,b);var f;c&&c.headers&&(f=c.headers);var h=a(b.data),i=new g["default"](h.$where,null,h.$sort,h.$skip,h.$take),j=b.data.Id;j?this.dataCollection.withHeaders(this.headers).withHeaders(f).getById(j).then(b.success,b.error):this.dataCollection.withHeaders(this.headers).withHeaders(f).get(i).then(function(a){return e._readServAggregates(a,h,b,f)}).then(b.success)["catch"](b.error)},update:function(a){var b=this.options.update;if(b&&b.url)return d.data.RemoteTransport.fn.read.call(this,a);var c;b&&b.headers&&(c=b.headers);var e=m["default"].isArray(a.data.models);if(e)throw new Error("Batch update is not supported.");var f=a.data;return this.dataCollection.withHeaders(this.headers).withHeaders(c).updateSingle(f).then(a.success.bind(this,f),a.error)["catch"](a.error)},create:function(a){var b=this.options.create;if(b&&b.url)return d.data.RemoteTransport.fn.read.call(this,a);var c;b&&b.headers&&(c=b.headers);var e=m["default"].isArray(a.data.models),f=e?a.data.models:a.data;return this.dataCollection.withHeaders(this.headers).withHeaders(c).create(f).then(a.success.bind(this,f),a.error)["catch"](a.error)},destroy:function(a){var b=this.options.destroy;if(b&&b.url)return d.data.RemoteTransport.fn.read.call(this,a);var c;b&&b.headers&&(c=b.headers);var e=m["default"].isArray(a.data.models);if(e)throw new Error("Batch destroy is not supported.");var f={Id:a.data.Id};return this.dataCollection.withHeaders(this.headers).withHeaders(c).destroySingle(f).then(a.success,a.error)["catch"](a.error)},_subscribeToSdkEvents:function(a){var b=this;m["default"].map(p,function(c){if(a&&a[c]&&"function"==typeof a[c].beforeSend){var d=a[c].beforeSend;b.everlive$.on(o["default"].Constants.Events.BeforeExecute,d)}})},_readServAggregates:function(a,b,d,e){if(d.data.aggregate){if(!d.data.hasOwnProperty("filter")&&!b.$where)throw new Error("The serverFiltering option must be enabled, when using serverAggregates.");var f=new i["default"](b.$where,null,b.$sort,b.$skip,b.$take);return v(d.data.aggregate,f),this.dataCollection.withHeaders(this.headers).withHeaders(e).aggregate(f).then(function(b){var e=w(d.data.aggregate,b.result[0]);return c.extend(!0,a,{aggregates:e}),a})["catch"](d.error)}return a}});c.extend(!0,d.data,{transports:{everlive:j},schemas:{everlive:{type:"json",total:function(a){return a.hasOwnProperty("count")?a.count:a.Count},data:function(a){return a.result||o["default"]._traverseAndRevive(a.Result)||a},model:{id:k["default"].idField},aggregates:"aggregates"}}});var l=["startswith","startsWith","endswith","endsWith","contains"],n={build:function(a){return n._build(a)},_build:function(a){return n._isRaw(a)?n._raw(a):n._isSimple(a)?n._simple(a):n._isRegex(a)?n._regex(a):n._isAnd(a)?n._and(a):n._isOr(a)?n._or(a):void 0},_isRaw:function(a){return"_raw"===a.operator},_raw:function(a){var b={};return b[a.field]=a.value,b},_isSimple:function(a){return"undefined"==typeof a.logic&&!n._isRegex(a)},_simple:function(a){var b={},c={},d=n._translateoperator(a.operator);return d?b[d]=a.value:b=a.value,c[a.field]=b,c},_isRegex:function(a){return-1!==c.inArray(a.operator,l)},_regex:function(a){var b={},c=n._getRegex(a);return b[a.field]=n._getRegexValue(c),b},_getRegex:function(a){var b=a.value,c=a.operator;switch(c){case"contains":return new RegExp(".*"+b+".*","i");case"startsWith":case"startswith":return new RegExp("^"+b,"i");case"endsWith":case"endswith":return new RegExp(b+"$","i")}throw new Error("Unknown operator type.")},_getRegexValue:function(a){return e["default"].prototype._getRegexValue.call(this,a)},_isAnd:function(a){return"and"===a.logic},_and:function(a){var b,c,d,e={$and:[]},f=a.filters;for(b=0,c=f.length;c>b;b++)d=n._build(f[b]),e.$and.push(d);return e},_isOr:function(a){return"or"===a.logic},_or:function(a){var b,c,d,e=[],f=a.filters;for(b=0,c=f.length;c>b;b++)d=n._build(f[b]),e.push(d);return{$or:e}},_translateoperator:function(a){switch(a){case"eq":return null;case"neq":return"$ne";case"gt":return"$gt";case"lt":return"$lt";case"gte":return"$gte";case"lte":return"$lte"}throw new Error("Unknown operator type.")}},q=function(a){return a=a||{},everlive$.getKendoDataSource(a.typeName,a)},r=function(a){var b=a.typeName,c=a.dataProvider||o["default"].$;if(!c)throw new Error("You need to instantiate an Everlive instance in order to create a Kendo UI DataSource.");if(!b)throw new Error("You need to specify a 'typeName' in order to create a Kendo UI DataSource.");return c.getHierarchicalDataSource(b,a)};o["default"].prototype.getKendoDataSource=function(a,b){b=b||{};var c=b.dataProvider||o["default"].$;if(!c)throw new Error("You need to instantiate an Everlive instance in order to create a Kendo UI DataSource.");if(!a)throw new Error("You need to specify a 'typeName' in order to create a Kendo UI DataSource.");if(b.serverGrouping)throw new Error("serverGrouping is not supported.");if(b.serverAggregates&&!b.serverFiltering)throw new Error("The serverFiltering option must be enabled, when using serverAggregates.");var e={type:"everlive",transport:{typeName:a,dataProvider:this}},b=m["default"].defaults(e,b);return new d.data.DataSource(b)},o["default"].prototype.getHierarchicalDataSource=function(a,b){b=b||{};var e=b.expand||b;if(delete b.expand,!a)throw new Error("You need to specify a 'typeName' in order to create a Kendo UI HierarchicalDataSource.");if(!c.isArray(e))throw new Error("You need to set 'expand' array option in order to create a Kendo UI HierarchicalDataSource");for(var g,h=this.buildUrl()+a,i=this._isOfflineStorageEnabled(),j=e.length-1;j>=0;j--){var k=e[j];if(i){if(!c.isPlainObject(k))throw new Error("When offline is enabled, each member of the expand array option must be an object. (Expand node index: "+j+")");if(!k.relation)throw new Error("When offline is enabled, each member of the expand array option must have a `relation` option set.  (Expand node index: "+j+")");if(!k.typeName)throw new Error("When offline is enabled, each member of the expand array option must have a `typeName` option set.  (Expand node index: "+j+")");var l,m={};m[k.relation]={TargetTypeName:k.typeName,Filter:k.filter,Sort:k.sort,Take:k.take,Skip:k.skip,Fields:k.fields,SingleField:k.singleField},l={"X-Everlive-Expand":JSON.stringify(m),"X-Everlive-Single-Field":k.relation};var n;n=0===j?a:e[j-1].typeName,g={model:{hasChildren:k.relation,children:{type:"everlive",transport:{typeName:n,read:{headers:l}},schema:g}}}}else g={model:{hasChildren:u(k),children:{type:"everlive",transport:{read:{url:s(h,e.slice(0,j+1)),headers:t(k)}},schema:g}}}}var o={};return o.type="everlive",o.transport={typeName:a,dataProvider:this},o.schema=g,c.isPlainObject(b)&&f(!0,o,b),new d.data.HierarchicalDataSource(o)};var s=function(a,b){for(var c=u(b[b.length-1]),d=b.slice(0,b.length-1),e="/_expand",f=0;f<d.length;f++)e+="/"+u(d[f]);return function(b,c){return function(d){var e=a+"";return d.Id&&c&&(e+=b+"/"+d.Id+"/"+c),e}}(e,c)},t=function(a){return"string"==typeof a?{}:{"X-Everlive-Filter":JSON.stringify(a.filter),"X-Everlive-Sort":JSON.stringify(a.sort),"X-Everlive-Single-Field":a.singleField,"X-Everlive-Skip":a.skip,"X-Everlive-Take":a.take,"X-Everlive-Fields":JSON.stringify(a.fields)}},u=function(a){if("string"==typeof a)return a;if(a.relation)return a.relation;throw new Error("You need to specify a 'relation' for an expand node when using the object notation")},v=function(a,b){m["default"].each(a,function(a){"count"===a.aggregate?b[a.aggregate](a.aggregate+h+a.field):b[a.aggregate](a.field,a.aggregate+h+a.field)})},w=function(a,b){var c={};return m["default"].each(a,function(a){c[a.field]||(c[a.field]={}),c[a.field][a.aggregate]=b[a.aggregate+h+a.field]}),m["default"].isEmpty(c)?null:c};b.exports={createDataSource:q,createHierarchicalDataSource:r}}}()},{"../../everlive/Everlive":57,"../../everlive/EverliveError":58,"../../everlive/constants":70,"../../everlive/query/AggregateQuery":94,"../../everlive/query/Query":96,"../../everlive/query/QueryBuilder":97,underscore:36}],81:[function(a,b){"use strict";function c(a){return a&&a.__esModule?a:{"default":a}}var d=a("../../everlive/utils"),e=c(d),f=a("underscore"),g=c(f),h=a("rsvp"),i=c(h),j=a("../../everlive/reqwest.everlive"),k=c(j),l=a("path"),m=c(l),n=a("node-cryptojs-aes"),o=a("../../everlive/EverliveError"),p=a("../../everlive/AutoQueue"),q=c(p),r=function(a,b,c){this._offlineFilesProcessor=a,this._everlive=b,this._downloadsQueue=new q["default"](c)};r.prototype={_getFilenameMetadata:function(a,b){return new i["default"].Promise(function(c,d){k["default"]({url:a,method:"HEAD",async:!0,crossDomain:!0}).then(function(a){var d=a.getResponseHeader("Content-Disposition");if(d){var e=/filename="?([^"\\]*(?:\\.[^"\\]*)*)"?/i.exec(d);g["default"].isArray(e)&&(b.filename=e[1])}else b.filename=m["default"].basename(a.responseURL);c(a.responseURL)})["catch"](function(a){return d(a)})})},downloadOffline:function(a,b,c,f){var g=this;return d.buildPromise(function(c,d){g._downloadsQueue.enqueue(function(c){var f;return g._getOfflineFileInfo(a).then(function(c){return f=c,b?!1:g.existsOffline(a)}).then(function(b){return b?g._getOfflineFileInfo(a).then(function(a){return g._getOfflineLocation(a)}):g._everlive.isOnline()?e["default"].successfulPromise().then(function(){return f.filename?void 0:g._getFilenameMetadata(a,f)}).then(function(a){var b=a||f.location;return g._saveFile(b,f.filename,null,f.location)}):void d(new o.EverliveError(o.EverliveErrors.cannotDownloadOffline))}).then(function(a){c(null,a)})["catch"](c)},c,d)},c,f)},_saveFile:function(a,b,c,d){var e,f=this;return f._downloadFile(a,b).then(function(a){return e=a,f._offlineFilesProcessor.getOfflineFilesData()}).then(function(b){return b.push({offlineLocation:e,onlineLocation:d||a,id:c}),f._offlineFilesProcessor.saveOfflineFilesData()}).then(function(){return e})},purgeAll:function(a,b){var c=this;return e["default"].buildPromise(function(a,b){c._offlineFilesProcessor.fileStore.removeFilesDirectory().then(function(){return c._offlineFilesProcessor.filesMetaStore.removeFilesDirectory()}).then(function(){c._offlineFilesProcessor._offlineFilesData=null}).then(a)["catch"](b)},a,b)},_getOfflineLocation:function(a){var b=this,c=a.location,d=a.filename,e=a.Id;return b._offlineFilesProcessor.getOfflineLocation(c,e).then(function(a){return a?a:e&&!c?b._getFileUrlForId(e,d):null})},_downloadFile:function(a,b){var c=this;return new i["default"].Promise(function(d,f){var g=new FileTransfer,h=c._sanitizeUrl(a),i=m["default"].basename(h),j=m["default"].extname(b),k=i;m["default"].extname(h)!==j&&(k+=j);var l="";if(!e["default"].isGuid(a)){var o=a.lastIndexOf(i),p=a.substr(0,o);l=n.CryptoJS.MD5(p).toString()}return c._offlineFilesProcessor.fileStore.getDataDirectory().then(function(a){return e["default"].joinPath(a.nativeURL,c._offlineFilesProcessor.fileStore.filesDirectoryPath,l,k)}).then(function(b){g.download(a,b,function(){d(b)},f,!0,{headers:c._everlive.buildAuthHeader()})})["catch"](f)})},_sanitizeUrl:function(a){if(!a)return a;var b=encodeURI(a),c=b.lastIndexOf("?");return-1!==c&&(b=b.substr(0,c)),b},_getFileUrlForId:function(a,b){var c=this;return this._offlineFilesProcessor.fileStore.getDataDirectory().then(function(d){var f=m["default"].extname(b);return e["default"].joinPath(d.nativeURL,c._offlineFilesProcessor.fileStore.filesDirectoryPath,a+f)})},existsOffline:function(a,b,c){var e=this;return d.buildPromise(function(b,c){e._getOfflineFileInfo(a).then(function(a){return e._getOfflineLocation(a)}).then(function(a){return a?e._offlineFilesProcessor.fileStore.getFileByAbsolutePath(a):void 0}).then(function(a){return!!a}).then(b)["catch"](function(a){return a.code===o.EverliveErrors.itemNotFound.code?b(!1):c.apply(this,arguments)})},b,c)},purge:function(a,b,c){var e=this;return d.buildPromise(function(b,c){e._getOfflineFileInfo(a).then(function(a){return e._getOfflineLocation(a)}).then(function(a){return a?e._offlineFilesProcessor.purge(a):void 0}).then(b)["catch"](c)},b,c)},getOfflineLocation:function(a,b,c){var e=this;return d.buildPromise(function(b,c){e._getOfflineFileInfo(a).then(e._getOfflineLocation.bind(e)).then(function(a){return a?e.existsOffline(a).then(function(b){return b?a:null}):null}).then(b)["catch"](c)},b,c)},_getOfflineFileInfo:function(a){var b=this,c=this._sanitizeUrl(a);return new i["default"].Promise(function(d,e){b._everlive.Files.isSync(!0).useOffline(!0).getById(c).then(function(a){var b=a.result;d({location:b.Uri,filename:b.Filename,Id:c})})["catch"](function(b){b&&b.code===o.EverliveErrors.itemNotFound.code?d({location:a}):e(b)})})},changeFileExtensionById:function(a,b){var c=this;return"string"!=typeof b?new i["default"].Promise(function(a){a()}):c._changeExtension(a,b)},_changeExtension:function(a,b){var c,d=this,e=d._offlineFilesProcessor.fileStore,f=a+b;return e.getFilesDirectory().then(function(b){return c=b,d.getOfflineLocation(a)}).then(function(a){var h=m["default"].basename(a);return h!==f?e.getFileByAbsolutePath(a).then(function(a){return e.renameFile(c,a,f)}).then(function(){return d._offlineFilesProcessor.getOfflineFilesData()}).then(function(c){var e=g["default"].findWhere(c,{offlineLocation:a});if(!e)throw new o.EverliveError("Could not find a cached location for the specified file.");var f=e.offlineLocation,h=m["default"].extname(f),i=f.slice(0,f.length-h.length)+b;return e.offlineLocation=i,d._offlineFilesProcessor.saveOfflineFilesData()}):void 0})}},b.exports=r},{"../../everlive/AutoQueue":55,"../../everlive/EverliveError":58,"../../everlive/reqwest.everlive":100,"../../everlive/utils":121,"node-cryptojs-aes":26,path:4,rsvp:35,underscore:36}],82:[function(a,b){"use strict";function c(a){return a&&a.__esModule?a:{"default":a}}var d=a("../../everlive/EverliveError"),e=a("../../everlive/storages/FileStore"),f=c(e),g=a("../../everlive/everlive.platform"),h=c(g),i=a("underscore"),j=c(i),k=a("rsvp"),l=c(k),m=a("../../everlive/utils"),n=c(m),o=a("path"),p=c(o),q="filesMetadataMap",r=function(a,b){this.fileStore=new f["default"](a.files.storagePath,a),this.filesMetaStore=new f["default"](a.files.metaPath,a),this._everlive=b};r.prototype={validateFileCreateObject:function(a,b){return new l["default"].Promise(function(c,e){return a.base64||b?a.ContentType?a.Filename?void c():e(new d.EverliveError(d.EverliveErrors.invalidRequest)):e(new d.EverliveError(d.EverliveErrors.missingContentType)):e(new d.EverliveError(d.EverliveErrors.missingOrInvalidFileContent))})},getOfflineFilesData:function(){var a=this;return new l["default"].Promise(function(b,c){return a._offlineFilesData?void b(a._offlineFilesData):a.filesMetaStore.getFile(q).then(function(b){return a.filesMetaStore.readFileAsText(b)}).then(function(c){c||(c="[]"),a._offlineFilesData=JSON.parse(c),b(a._offlineFilesData)})["catch"](c)})},saveOfflineFilesData:function(){var a=this;return a.getOfflineFilesData().then(function(b){return a.filesMetaStore.writeText(q,JSON.stringify(b))})},upsertFileFromObject:function(a,b,c){if(h["default"].isDesktop||h["default"].isNativeScript)return n["default"].successfulPromise();var e=this;if(!c)if(b){if(!a.base64)return n["default"].rejectedPromise(new d.EverliveError(d.EverliveErrors.missingOrInvalidFileContent));if(!a.ContentType)return n["default"].rejectedPromise(new d.EverliveError(d.EverliveErrors.missingContentType))}else if(!a.base64)return n["default"].successfulPromise();if(!a.base64){var f,g=n["default"].getId(a),i=a.Uri?n["default"].successfulPromise(a.Uri):e._everlive.files.isSync(c).applyOffline(!1).getDownloadUrlById(g);return i.then(function(a){return f=a,e._everlive.offlineStorage.files.existsOffline(g)}).then(function(b){return b?void 0:e._everlive.offlineStorage.files._saveFile(f,a.Filename)})}return a.Storage="internal",n["default"].successfulPromise().then(function(){return c?void 0:e.validateFileCreateObject(a,c)}).then(function(){var b,c=a.Uri,d=e.getFilenameForObject(a),f=a.base64;delete a.base64;var g=n["default"].b64toBlob(f,a.ContentType);return e.writeFile(d,g).then(function(a){return b=a,e.getOfflineFilesData()}).then(function(d){return d.push({offlineLocation:b.offlineLocation,onlineLocation:c,id:a._id}),a.Length=b.size,e.saveOfflineFilesData()})})},purge:function(a){var b=this;return this.getOfflineFilesData().then(function(c){var d=j["default"].where(c,{offlineLocation:a}),e=c.indexOf(d[0]);return-1!==e&&c.splice(e,1),b.saveOfflineFilesData()}).then(function(){return b.fileStore.getFileByAbsolutePath(a)}).then(function(a){return a?b.fileStore.removeFile(a):void 0})},writeFile:function(a,b,c){var d,e=this;return e.fileStore.writeText(a,b,c).then(function(a){return d=a,e.saveOfflineFilesData()}).then(function(){return e.fileStore.getFileSize(a,c)}).then(function(a){return{size:a,offlineLocation:d}})},getFilenameForObject:function(a){var b=p["default"].extname(a.Filename);return a._id+b},getOfflineLocation:function(a,b){return this.getOfflineFilesData().then(function(c){if(a||b)for(var d=0;d<c.length;d++){var e=c[d],f=a&&(e.offlineLocation===a||e.onlineLocation===a),g=b&&e.id===b;if(f||g)return e.offlineLocation}})}},b.exports=r},{"../../everlive/EverliveError":58,"../../everlive/everlive.platform":74,"../../everlive/storages/FileStore":106,"../../everlive/utils":121,path:4,rsvp:35,underscore:36}],83:[function(a,b){"use strict";function c(a){return a&&a.__esModule?a:{"default":a}}function d(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}function e(a){var b=[D.DataQueryOperations.UserLoginWithProvider,D.DataQueryOperations.UserLinkWithProvider,D.DataQueryOperations.UserUnlinkFromProvider],c=a.operation;return-1!==b.indexOf(c)&&(c+=a.data.Provider||a.data.Identity.Provider),"The Users operation "+c+" is not supported in offline mode"}function f(a){return"The Files operation "+a.operation+" is not supported in offline mode"}function g(a,b,c,d,e){this._collectionCache={},this.offlineFilesProcessor=c,this._persister=a,this._encryptionProvider=b,this.everlive=d,this.setup=e}var h,i=a("../../everlive/utils"),j=c(i),k=a("../../everlive/offline/offlineTransformations"),l=c(k),m=a("../../everlive/ExpandProcessor"),n=c(m),o=a("../../everlive/everlive.platform"),p=c(o),q=a("../../everlive/EverliveError"),r=a("underscore"),s=c(r),t=a("rsvp"),u=c(t),v=a("mingo"),w=c(v),x=a("mongo-query"),y=c(x),z=a("../../scripts/bs-aggregation-translator"),A=c(z),B=a("path"),C=c(B),D=a("../../everlive/constants"),E=c(D),F=[D.Headers.powerFields],G=(h={},d(h,D.DataQueryOperations.Create,!0),d(h,D.DataQueryOperations.Update,!0),d(h,D.DataQueryOperations.Delete,!0),d(h,D.DataQueryOperations.DeleteById,!0),d(h,D.DataQueryOperations.RawUpdate,!0),d(h,D.DataQueryOperations.SetAcl,!0),d(h,D.DataQueryOperations.SetOwner,!0),d(h,D.DataQueryOperations.UserLoginWithProvider,!0),d(h,D.DataQueryOperations.UserLinkWithProvider,!0),d(h,D.DataQueryOperations.UserUnlinkFromProvider,!0),d(h,D.DataQueryOperations.UserLogin,!0),d(h,D.DataQueryOperations.UserLogout,!0),d(h,D.DataQueryOperations.UserChangePassword,!0),d(h,D.DataQueryOperations.UserResetPassword,!0),h);g.prototype={processQuery:function(a){var b=a.collectionName;if(j["default"].isContentType.pushDevices(b)||j["default"].isContentType.pushNotifications(b))return this.everlive.isOnline()?j["default"].successfulPromise():j["default"].rejectedPromise(new q.EverliveError(q.EverliveErrors.pushNotSupportedOffline));var c=this.checkSupportedQuery(a);if(c&&!a.isSync)return new u["default"].Promise(function(a,b){b(new q.EverliveError(c))});var d=a.getQueryParameters(),e=j["default"].getUnsupportedOperators(d.filter),f=e.length;if(f)return new u["default"].Promise(function(a,b){var c;c=1===f?"The operator "+e[0]+" is not supported in offline mode.":"The operators "+e.join(",")+"are not supported in offline mode.",b(new q.EverliveError(c,q.EverliveErrors.operationNotSupportedOffline.code))});switch(l["default"].traverseAndTransformFilterId(d.filter),a.operation){case D.DataQueryOperations.Read:return this.read(a,d.filter,d.sort,d.skip,d.limit,d.select,d.expand);case D.DataQueryOperations.ReadById:return this.readById(a,d.expand);case D.DataQueryOperations.FilesGetDownloadUrlById:return this.getDownloadUrlById(a);case D.DataQueryOperations.Count:return this.count(a,d.filter);case D.DataQueryOperations.Create:return this.create(a);case D.DataQueryOperations.RawUpdate:case D.DataQueryOperations.Update:return this.update(a,d.filter);case D.DataQueryOperations.FilesUpdateContent:return this.updateFileContent(a,d.filter);case D.DataQueryOperations.Delete:return this.remove(a,d.filter);case D.DataQueryOperations.DeleteById:return this.remove(a,{_id:a.additionalOptions.id});case D.DataQueryOperations.Aggregate:return this.aggregate(a,d);default:return new u["default"].Promise(function(b,c){a.isSync?b():c(new q.EverliveError(a.operation+" is not supported in offline mode."))})}},getDownloadUrlById:function(a){var b,c,d=this,e=a.additionalOptions.id;return d.everlive.files.useOffline(!0).isSync(a.isSync).getById(e).then(function(a){var b=a.result;return c=b.Uri,d.everlive.offlineStorage.files._getFileUrlForId(b.Id,b.Filename)}).then(function(a){return b=a,d.everlive.offlineStorage._offlineFilesProcessor.fileStore.getFileByAbsolutePath(a)}).then(function(a){return{result:{Uri:a?b:c}}})},checkSupportedQuery:function(a){for(var b=0;b<F.length;b++){var c=F[b];if(a.getHeader(c))return"The header "+c+" is not supported in offline mode"}if(j["default"].isContentType.users(a.collectionName)&&G[a.operation])return e(a);if(j["default"].isContentType.files(a.collectionName)&&(a.operation===D.DataQueryOperations.create&&Array.isArray(a.data)||a.operation===D.DataQueryOperations.rawUpdate||a.operation===D.DataQueryOperations.update))return q.EverliveErrors.invalidRequest;var d=a.additionalOptions&&a.additionalOptions.id,g=a.operation===D.DataQueryOperations.Update&&!d,h=a.operation===D.DataQueryOperations.RawUpdate;return j["default"].isContentType.files(a.collectionName)&&(h||g)?f(a):void 0},_getCreateResult:function(a,b){if(1===a.length){var c;if(b){var d=s["default"].extend({},a[0]);c=l["default"].idTransform(d)}else c={CreatedAt:j["default"].cloneDate(a[0].CreatedAt),Id:a[0]._id};return{result:c}}var e=[];return s["default"].each(a,function(a){var c;if(b){var d=s["default"].extend({},a);c=l["default"].idTransform(d)}else c={CreatedAt:j["default"].cloneDate(a.CreatedAt),Id:a._id};e.push(c)}),{result:e}},create:function(a){var b=this;return b._createItems(a.collectionName,a.data,a.isSync,a.preserveState).then(function(c){var d=j["default"].isContentType.files(a.collectionName);return b._getCreateResult(c,d)})},read:function(a,b,c,d,e,f,g){var h,i=this;return new u["default"].Promise(function(j,k){var m;i._prepareExpand(g,a,!0).then(function(b){return h=b,b&&(f=b.mainQueryFieldsExpression),i._getCollection(a.collectionName)}).then(function(g){var j=i._readInternal(g,b,c,d,e,f);if(d||e){var k=i._readInternal(g);m=k.length}return j=i._shouldAutogenerateIdForContentType(a.collectionName)?l["default"].idTransform(j):l["default"].removeIdTransform(j,!0),i._expandResult(h,j)}).then(function(b){var c=i._transformOfflineResult(b,m,a);j(c)})["catch"](k)})},_readInternal:function(a,b,c,d,e,f){var g=s["default"].extend({},b),h=this._getWithoutDeletedFilter(g);l["default"].traverseAndTransformFilterId(h);var i=w["default"].Query(h),j=w["default"].Cursor(a,i,f);return c&&(j=j.sort(c)),d&&j.skip(d),e&&j.limit(e),s["default"].map(j.all(),function(a){return s["default"].extend({},a)})},readById:function(a,b){var c,d=this;return d._prepareExpand(b,a,!1).then(function(b){return c=b,d._getCollection(a.collectionName)}).then(function(b){return new u["default"].Promise(function(e,f){var g=d._getById(b,a.additionalOptions.id);return g?(g=l["default"].idTransform(g),d._expandResult(c,g).then(e)["catch"](f)):f(new q.EverliveError(q.EverliveErrors.itemNotFound))})}).then(function(b){return d._transformOfflineResult(b,null,a)})},_getById:function(a,b){if(!b)throw new q.EverliveError("Id field is mandatory when using offline storage");if(a[b]){var c=s["default"].extend({},a[b]),d=c&&c[E["default"].offlineItemsStateMarker]===D.offlineItemStates.deleted;return d?void 0:c}},_prepareExpand:function(a,b,c){return new u["default"].Promise(function(d,e){a?n["default"].prepare(a,b.collectionName,c,b.fields,null,null,function(a,b){return a?("ExpandError"===a.name&&(a.code=q.EverliveErrors.invalidExpandExpression.code),e(a)):void d(b)}):d()})},_expandResult:function(a,b){var c=this;return new u["default"].Promise(function(d,e){a?n["default"].expand(a.relationsTree,b,{offlineModule:c},function(a,b){return a?("ExpandError"===a.name&&(a.code=q.EverliveErrors.invalidExpandExpression.code),e(a)):void d(b)}):d(b)})},_getWithoutDeletedFilter:function(a){var b={$and:[]};b.$and.push(a);var c={};return c[E["default"].offlineItemsStateMarker]={$ne:D.offlineItemStates.deleted},b.$and.push(c),b},_getUpdateItemsResult:function(a){var b=a.length,c=b?a[0].ModifiedAt:new Date;return{ModifiedAt:c,result:b}},update:function(a,b){var c=this;return this._updateItems(a,a.data,b,a.isSync).then(function(a){return c._getUpdateItemsResult(a)})},remove:function(a,b){return this._removeItems(a,b,a.isSync)},count:function(a,b){var c=this;return new u["default"].Promise(function(d,e){c._getCollection(a.collectionName).then(function(a){var e=c._readInternal(a,b);d({result:e.length})})["catch"](e)})},_setItemDates:function(a,b,c){b.CreatedAt=j["default"].isDate(a.CreatedAt)?j["default"].cloneDate(a.CreatedAt):new Date,b.ModifiedAt=j["default"].cloneDate(j["default"].isDate(a.ModifiedAt)?a.ModifiedAt:b.CreatedAt),b.CreatedBy=b.CreatedBy||this.everlive.setup.principalId||E["default"].guidEmpty,b.ModifiedBy=b.ModifiedBy||b.CreatedBy,b.Owner="Users"===c?b._id:b.CreatedBy||E["default"].guidEmpty},_mapCreateItem:function(a,b,c,d,e){function f(){return g._setItemDates(a,h,e),g._setItem(b,s["default"].extend({},h),i),h}var g=this,h=s["default"].extend({},a);h._id=h.Id||j["default"].uuid(),delete h.Id;var i,k=g._getById(b,h._id),l=!!k;if(l&&!c&&!d)throw new q.EverliveError("An item with the specified id already exists");return i=c&&d&&l?k[E["default"].offlineItemsStateMarker]:c?void 0:D.offlineItemStates.created,j["default"].isContentType.files(e)?g.offlineFilesProcessor.upsertFileFromObject(h,!0,c).then(f):f()},_createItems:function(a,b,c,d){var e=this;return this._getCollection(a).then(function(f){var g=s["default"].isArray(b)?b:[b],h=s["default"].map(g,function(b){return e._mapCreateItem(b,f,c,d,a)});return u["default"].all(h).then(function(b){return e._persistData(a).then(function(){return e._shouldAutogenerateIdForContentType(a)||c||(h=l["default"].removeIdTransform(b)),b})})})},_applyUpdateOperation:function(a,b,c,d,e){var f,g=j["default"].getDbOperators(a,!0),h=0!==g.length;f=h?a:{$set:a};var i={ModifiedBy:this.everlive.setup.principalId||E["default"].guidEmpty};f.$set=s["default"].extend(i,f.$set),d&&(f.$set.ModifiedAt=j["default"].cloneDate(a.ModifiedAt||e)),y["default"](b,{},f,{strict:!0}),b._id=b._id||f._id||f.Id,delete b.Id;var k;k=d?void 0:b[E["default"].offlineItemsStateMarker]===D.offlineItemStates.created?D.offlineItemStates.created:D.offlineItemStates.modified,this._setItem(c,b,k)},updateFileContent:function(a){if(p["default"].isDesktop)return j["default"].successfulPromise();var b,c=a.isSync,d=a.data,e=this,f=a.additionalOptions.id,g=a.collectionName;return this._getCollection(g).then(function(a){var h=e._getById(a,f);return b=[h],h.base64=d.base64,h.Filename=d.Filename,h.ContentType=d.ContentType,delete h.Uri,e._overwriteFile(f,h,c).then(function(){return e._applyUpdateOperation(d,h,a),e._setItem(a,h,E["default"].offlineItemStates.modified),e._persistData(g)}).then(function(){return e._getUpdateItemsResult(b)})})},_overwriteFile:function(a,b,c){var d=this;return d.everlive.offlineStorage.files.purge(a).then(function(){return d.offlineFilesProcessor.upsertFileFromObject(b,!0,c)})},_updateItems:function(a,b,c,d){var e=this,f=a.collectionName;return e._getCollection(f).then(function(g){var h;if(a.additionalOptions&&a.additionalOptions.id){var i=a.additionalOptions.id,k=e._getById(g,i);if(!k)throw new q.EverliveError(q.EverliveErrors.itemNotFound,"Item with id :"+i+" does not exist offline in the collection :"+f);if(h=[k],j["default"].isContentType.files(f)&&b.$set&&b.$set.Filename||b.Filename){var l=b.Filename||b.$set.Filename,m=C["default"].extname(l);return e.everlive.offlineStorage.files.changeFileExtensionById(i,m).then(function(){return e._applyUpdateOperation(b,k,g,d,a.ModifiedAt),
e._persistData(f)}).then(function(){return h})}e._applyUpdateOperation(b,k,g,d,a.ModifiedAt)}else{h=e._readInternal(g,c);for(var n=0;n<h.length;n++){var o=h[n],p=!!e._getById(g,o._id.toString());if(!p&&!d)throw new q.EverliveError(q.EverliveErrors.itemNotFound);e._applyUpdateOperation(b,o,g,d,a.ModifiedAt)}}return e._persistData(f).then(function(){return h})})},_getAllCollections:function(){var a=this;return new u["default"].Promise(function(b,c){a._persister.getAllData(function(c){s["default"].each(c,function(b,d){var e=a._encryptionProvider.decrypt(b);c[d]=JSON.parse(e||"{}",j["default"].parseUtilities.getReviver())}),b(c)},c)})},_getCollection:function(a){var b=this;return new u["default"].Promise(function(c,d){b._collectionCache[a]?c(b._collectionCache[a]):b._persister.getData(a,function(d){var e=b._encryptionProvider.decrypt(d),f=JSON.parse(e||"{}",j["default"].parseUtilities.getReviver());b._collectionCache[a]=f,c(b._collectionCache[a])},d)})},_setItem:function(a,b,c){c?b[E["default"].offlineItemsStateMarker]=c:delete b[E["default"].offlineItemsStateMarker],a[b._id]=b},_getDirtyItems:function(a){var b={};b[E["default"].offlineItemsStateMarker]={$exists:!0};var c=w["default"].Query(b),d=w["default"].Cursor(a,c);return d.all()},_persistData:function(a){var b=this;return new u["default"].Promise(function(c,d){var e=b._collectionCache[a]||{};b._transformPersistedData(a,e);var f=JSON.stringify(e),g=b._encryptionProvider.encrypt(f);b._persister.saveData(a,g,c,d)})},_shouldAutogenerateIdForContentType:function(a){return!(this.setup&&this.setup.typeSettings&&this.setup.typeSettings[a]&&this.setup.typeSettings[a].autoGenerateId===!1)},_clearItem:function(a,b){delete a[b._id]},_mapRemoveItem:function(a,b,c,d){var e=this;return new u["default"].Promise(function(b,c){return j["default"].isContentType.files(d)&&!p["default"].isDesktop?e.everlive.offlineStorage.files.purge(a._id).then(b,c):b()}).then(function(){a._id=a._id||a.Id;var d=!!e._getById(b,a._id.toString());if(!d&&!c)throw new q.EverliveError("Cannot delete item - item with id "+a._id+" does not exist.");var f=a[E["default"].offlineItemsStateMarker]===D.offlineItemStates.created||c;f?e._clearItem(b,a):e._setItem(b,a,D.offlineItemStates.deleted)})},_removeItems:function(a,b,c){var d=this,e=a.collectionName;return d._getCollection(e).then(function(a){var f=d._readInternal(a,b),g=s["default"].map(f,function(b){return d._mapRemoveItem(b,a,c,e)});return u["default"].all(g)}).then(function(a){return d._persistData(e).then(function(){return a})}).then(function(a){return d._transformOfflineResult(a.length)})},_applyTransformations:function(a,b){Array.isArray(a.result)?s["default"].each(b,function(b){a.result.map(function(c,d){a.result[d]=b(c)})}):s["default"].each(b,function(b){a.result=b(a.result)})},_transformOfflineResult:function(a,b,c,d){var e={result:a,count:b||(a||[]).length};(void 0!==b&&null!==b||Array.isArray(a))&&(e.count=b||a.length);var f=[];if(f.push(l["default"].idTransform),f.push(l["default"].removeMarkersTransform),c){var g=c.getHeader(D.Headers.includeCount);g===!1&&delete e.count;var h=c.getHeader(D.Headers.singleField);"string"==typeof h&&f.push(l["default"].singleFieldTransform.bind(this,h))}return d&&(f=f.concat(d)),this._applyTransformations(e,f),void 0===e.count&&delete e.count,e},_transformPersistedData:function(a,b){var c=[];"Users"===a&&(c=c.concat(["Password","SecretQuestionId","SecretAnswer"])),c.length&&s["default"].each(b,function(a){l["default"].removeFieldsTransform(a,c)})},aggregate:function(a,b){var c=this;return this._getCollection(a.collectionName).then(function(d){if(!b||!b.aggregate||s["default"].isEmpty(b.aggregate))throw new q.EverliveError("You must specify a valid aggregation definition. Either GroupBy or Aggregate is required.");var e=s["default"].extend({},b.aggregate);e.Filter=b.filter;var f=A["default"].translate(e,{maxDocumentsCount:E["default"].Aggregation.MaxDocumentsCount}),g=s["default"].filter(d,function(a){return a[E["default"].offlineItemsStateMarker]!==E["default"].offlineItemStates.deleted}),h=w["default"].aggregate(g,f);return c._transformOfflineResult(h,null,a)})},purgeAll:function(a,b){var c=this;return this._collectionCache={},i.buildPromise(function(a,b){c._collectionCache={},c._persister.purgeAll(function(){c.everlive.setup.caching?c.everlive.cache.clearAll(a,b):a()},b)},a,b)},purge:function(a,b,c){var d=this;return i.buildPromise(function(b,c){delete d._collectionCache[a],d._persister.purge(a,function(){d.everlive.setup.caching?d.everlive.cache.clear(a,b,c):b()},c)},b,c)}},b.exports=g},{"../../everlive/EverliveError":58,"../../everlive/ExpandProcessor":59,"../../everlive/constants":70,"../../everlive/everlive.platform":74,"../../everlive/offline/offlineTransformations":87,"../../everlive/utils":121,"../../scripts/bs-aggregation-translator":123,mingo:13,"mongo-query":15,path:4,rsvp:35,underscore:36}],84:[function(a,b){"use strict";function c(a){return a&&a.__esModule?a:{"default":a}}var d=a("../../everlive/dataQuery/DataQuery"),e=c(d),f=a("../../everlive/EverliveError"),g=a("../../everlive/constants"),h=c(g),i=a("../../everlive/query/RequestOptionsBuilder"),j=c(i),k=a("underscore"),l=c(k),m=a("rsvp"),n=c(m),o=a("../../everlive/utils"),p=c(o),q=a("../../everlive/Request"),r=c(q),s=a("../../everlive/offline/offlineTransformations"),t=c(s),u=a("../../everlive/offline/OfflineQueryProcessor"),v=c(u),w=a("../../everlive/offline/OfflineFilesProcessor"),x=c(w),y=a("../../everlive/offline/OfflineFilesModule"),z=c(y),A=a("../../everlive/query/Query"),B=c(A),C=a("../../everlive/services/RequestService"),D={server:"server",client:"client"};b.exports=function(){function a(a,b,c,d){this._everlive=a,this.setup=b,this._isSynchronizing=!1,this._encryptionProvider=d,this._offlineFilesProcessor=new x["default"](this.setup,this._everlive),this._queryProcessor=new v["default"](c,d,this._offlineFilesProcessor,this._everlive,this.setup),this.files=new z["default"](this._offlineFilesProcessor,this._everlive,this.setup.files.maxConcurrentDownloads)}var b=function(a){var b=c(a);return b.ModifiedAt=a.ModifiedAt,b},c=function(a){return{Id:a.Id}};return a.prototype={purgeAll:function(a,b){return this._queryProcessor.purgeAll(a,b)},purge:function(a,b,c){return this._queryProcessor.purge(a,b,c)},processQuery:function(a){return this._queryProcessor.processQuery(a)},_setOffline:function(a){this.setup.offline=a},isOnline:function(){return!this.setup.offline},_prepareSyncData:function(a){var b=this,c={},d=[];return l["default"].each(a,function(a,e){var f=t["default"].idTransform(a.offlineItemsToSync),g=b._getSyncItemStates(e,f,a.serverItems);d.push(g.conflicts),c[e]=g.itemsForSync}),{conflicts:d,contentTypesSyncData:c}},_resolveConflicts:function(a){var b=this;return this._applyResolutionStrategy(a.conflicts).then(function(){return b._mergeResolvedConflicts(a.conflicts,a.contentTypesSyncData)}).then(function(){return a.contentTypesSyncData})},isSynchronizing:function(){return this._isSynchronizing},_fireSyncStart:function(){var a=this;return new n["default"].Promise(function(b){a._isSynchronizing?b():(a._isSynchronizing=!0,a._everlive._emitter.emit(h["default"].Events.SyncStart),b())})},_fireSyncEnd:function(){this._isSynchronizing=!1,this._everlive._emitter.emit(h["default"].Events.SyncEnd,this._syncResultInfo),delete this._syncResultInfo},_eachSyncItem:function(a,b,c,d){var e=this;l["default"].each(a,function(a){var f=b(a.remoteItem),g=a.resultingItem,h=a.isCustom,i=a.resolutionType;l["default"].some(e._syncResultInfo.failedItems[c],{itemId:g.Id})||d(g,f,h,i)})},_shouldAutogenerateIdForContentType:function(a){return this._queryProcessor._shouldAutogenerateIdForContentType(a)},_addCreatedFileToSyncPromises:function(a,b,c){var d=this;l["default"].each(a,function(a){var e=d._everlive.files;b[a.Id]=new n["default"].Promise(function(b,f){d.files.getOfflineLocation(a.Id).then(function(b){return b?d._transferFile(!1,a,b):void 0},function(b){f({type:g.offlineItemStates.created,items:a,contentType:c,error:b,storage:D.server})}).then(function(b){var f=l["default"].extend({},a,b.result);return d._onItemProcessed(f,c,D.server,g.offlineItemStates.created),e.isSync(!0).useOffline(!0).updateSingle(f)},function(b){f({type:g.offlineItemStates.created,items:a,contentType:c,error:b,storage:D.server})}).then(b,function(b){f({type:g.offlineItemStates.modified,items:a,contentType:c,error:b,storage:D.client})})})})},_transferFile:function(a,b,c){var d=this._everlive;return new n["default"].Promise(function(e,f){var g=this,i=d.files.getUploadUrl(),j=p["default"].successfulPromise();a&&(j=new n["default"].Promise(function(a){d.files.isSync(!0).applyOffline(!1).getById(b.Id).then(function(){a(!0)})["catch"](function(){a(!1)})})),j.then(function(j){var k=a&&j;k&&(i+="/"+b.Id+"/Content");var m=new FileTransfer,n=h["default"].fileUploadKey,o={fileKey:n,httpMethod:k?"PUT":"POST",mimeType:b.ContentType,fileName:b.Filename,headers:d.buildAuthHeader()};o.params={},l["default"].each(b,function(a,b){if("base64"!==b.toLowerCase()){var c=h["default"].fileUploadKey+h["default"].fileUploadDelimiter+b;o.params[c]=a}}),m.upload(c,i,function(a){var b=p["default"].parseUtilities.parseJSON(a.response);b.Result===!1?f.apply(g,arguments):e(l["default"].isArray(b.Result)?{result:b.Result[0]}:b)},f,o,!0)})})},_addCreatedObjectToSyncPromises:function(a,b,c,d,e,f){var h=this,i=new n["default"].Promise(function(a,i){b.isSync(!0).applyOffline(!1).create(c).then(function(a){c=l["default"].map(c,function(b,c){b.Id=a.result[c].Id,b.CreatedAt=b.ModifiedAt=a.result[c].CreatedAt;var f=l["default"].find(d.createdItems,function(a){return a.resultingItem.Id===b.Id});return f.isCustom&&h._onItemProcessed(b,e,D.client,g.offlineItemStates.modified),b})},function(a){throw{type:g.offlineItemStates.created,items:c,contentType:e,error:a,storage:D.server}}).then(function(){return b.isSync(!0).useOffline(!0).create(c).then(function(){l["default"].each(c,function(a){h._onItemProcessed(a,e,D.server,g.offlineItemStates.created)})},function(a){throw{type:g.offlineItemStates.created,items:c,contentType:e,error:a,storage:D.client}})}).then(function(){if(f&&f.length){var a={Id:{$in:f}};return b.isSync(!0).useOffline(!0).destroy(a)["catch"](function(a){throw{type:g.offlineItemStates.created,items:c,contentType:e,error:a,storage:D.client}})}}).then(a)["catch"](function(a){i(a)})});return l["default"].each(c,function(b){a[b.Id]=i}),c},_addCreatedItemsForSync:function(a,b,c){var d,e=c.collectionName,f=l["default"].pluck(a.createdItems,"resultingItem");return this._shouldAutogenerateIdForContentType(e)||(d=l["default"].pluck(f,"Id"),f=t["default"].removeIdTransform(f)),p["default"].isContentType.files(e)?this._addCreatedFileToSyncPromises(f,b,e):this._addCreatedObjectToSyncPromises(b,c,f,a,e,d)},_addUpdatedItemsForSync:function(a,b,c,d,e){var f=this,g=d.collectionName;f._eachSyncItem(a.modifiedItems,b,g,e)},_addDeletedItemsForSync:function(a,b,c,d,e){var f=this,g=d.collectionName;f._eachSyncItem(a.deletedItems,b,g,e)},_onSyncResponse:function(a,b,c,d,h){var i=this;if(1!==a.result)return new n["default"].Promise(function(a,b){b(l["default"].extend({},f.EverliveErrors.syncConflict,{contentType:c}))});if(d===e["default"].operations.Update){i._onItemProcessed(b,c,D.server,g.offlineItemStates.modified);var j=l["default"].extend({},b,{ModifiedAt:a.ModifiedAt}),k=new e["default"]({operation:d,data:j,additionalOptions:{id:b.Id},meta:{collectionName:c},isSync:!0});return this.processQuery(k).then(function(){if(h){var a=l["default"].find(i._syncResultInfo.syncedItems[c],function(a){return a.itemId===b.Id});a||i._onItemProcessed(b,c,D.client,g.offlineItemStates.modified)}})}return d===e["default"].operations.Delete?(i._onItemProcessed(b,c,D.server,g.offlineItemStates.deleted),this._purgeById(c,b.Id).then(function(){h&&i._onItemProcessed(b,c,D.client,g.offlineItemStates.deleted)})):void 0},_purgeById:function(a,b){var c=this;return this._queryProcessor._getCollection(a).then(function(d){return delete d[b],c._queryProcessor._persistData(a)})},sync:function(){var a=this;if(a._syncResultInfo=a._syncResultInfo||{syncedItems:{},syncedToServer:0,syncedToClient:0,failedItems:{},error:void 0},!this.isOnline())throw new f.EverliveError("Cannot synchronize while offline");a._fireSyncStart().then(function(){return a._applySync()}).then(function(b){var c=[];return l["default"].each(b,function(b,d){b&&"rejected"===b.state&&(b.reason&&b.reason.code===f.EverliveErrors.syncConflict.code?c.push(b):a._onItemFailed(b,d))}),c.length?a.sync():void a._fireSyncEnd()})["catch"](function(b){b||(b=new f.EverliveError(f.EverliveErrors.syncErrorUnknown)),a._syncResultInfo.error=b,a._fireSyncEnd()})},_handleKeepServer:function(a,b,c,d){var i,j=this,k=b.serverItem,l=b.clientItem;if(k&&l)i=new e["default"]({meta:{collectionName:a},operation:e["default"].operations.Update,additionalOptions:{id:k.Id},data:k});else if(k&&!l)i=new e["default"]({meta:{collectionName:a},operation:e["default"].operations.Create,data:k});else{if(k||!l)throw new f.EverliveError('Both serverItem and clientItem are not set when syncing data with "KeepServer" resolution strategy.');i=new e["default"]({meta:{collectionName:a},operation:e["default"].operations.DeleteById,additionalOptions:{id:l.Id}})}i.isSync=!0,c.push(new n["default"].Promise(function(c,f){j.processQuery(i).then(function(){switch(i.operation){case e["default"].operations.Update:j._onItemProcessed(k,a,D.client,g.offlineItemStates.modified),p["default"].isContentType.files(a)&&d.modifiedItems.push({remoteItem:b.serverItem,resultingItem:k,resolutionType:h["default"].ConflictResolution.KeepServer});break;case e["default"].operations.Create:j._onItemProcessed(k,a,D.client,g.offlineItemStates.created);break;case e["default"].operations.DeleteById:j._onItemProcessed(l,a,D.client,g.offlineItemStates.deleted)}c()},function(a){var b,c;switch(i.operation){case e["default"].operations.Update:b=k.Id,c=g.offlineItemStates.modified;break;case e["default"].operations.Create:b=k.Id,c=g.offlineItemStates.created;break;case e["default"].operations.DeleteById:b=l.Id,c=g.offlineItemStates.deleted}f({itemId:b,type:c,contentType:i.collectionName,error:a,storage:D.client})})}))},_handleKeepClient:function(a,b){var c,d,e=a.serverItem,g=a.clientItem;if(e&&g)c=l["default"].extend(g,{ModifiedAt:new Date(e.ModifiedAt)}),d=b.modifiedItems;else if(e&&!g)c=e,d=b.deletedItems;else{if(e||!g)throw new f.EverliveError('Both serverItem and clientItem are not set when syncing data with "KeepClient" resolution strategy.');c=g,d=b.createdItems}d.push({remoteItem:a.serverItem,resultingItem:c,resolutionType:h["default"].ConflictResolution.KeepClient})},_handleCustom:function(a,b,c,d){var f=a.serverItem,h=a.clientItem,i=l["default"].omit(a.result.item,"CreatedAt","ModifiedAt");if(f&&i){var j=new e["default"]({meta:{collectionName:b},operation:e["default"].operations.Create,data:f});j.preserveState=!0,j.isSync=!0,c.push(this.processQuery(j)),this._onItemProcessed(f,b,D.client,g.offlineItemStates.created)}if(f&&i&&!h)i.Id=f.Id,d.modifiedItems.push({remoteItem:f,resultingItem:i,isCustom:!0});else if(f&&!i)d.deletedItems.push({remoteItem:a.serverItem,resultingItem:f,isCustom:!0});else if(!f&&i&&h){var k=new e["default"]({meta:{collectionName:b},operation:e["default"].operations.Update,data:i,additionalOptions:{id:h.Id}});c.push(this.processQuery(k)),i.Id=h.Id,d.createdItems.push({remoteItem:f,resultingItem:i,isCustom:!0})}else i.Id=f.Id,d.modifiedItems.push({remoteItem:f,resultingItem:i,isCustom:!0})},_mergeResolvedConflicts:function(a,b){var c=this,d=[];return l["default"].each(a,function(a){var e=a.contentTypeName;l["default"].each(a.conflictingItems,function(a){var g=b[e];switch(a.result.resolutionType){case h["default"].ConflictResolution.KeepServer:c._handleKeepServer(e,a,d,g);break;case h["default"].ConflictResolution.KeepClient:c._handleKeepClient(a,g);break;case h["default"].ConflictResolution.Custom:if(p["default"].isContentType.files(e)){var i=f.EverliveErrors.customFileSyncNotSupported;throw new f.EverliveError(i.message,i.code)}c._handleCustom(a,e,d,g);break;case h["default"].ConflictResolution.Skip:}})}),n["default"].all(d)},_getSyncItemStates:function(a,b,c){var d=this,e={itemsForSync:{createdItems:[],modifiedItems:[],modifiedItemsOnServer:[],deletedItems:[],deletedItemsOnServer:[]},conflicts:{contentTypeName:a,conflictingItems:[]}};return l["default"].each(b,function(b){var i=l["default"].findWhere(c,{Id:b.Id});if(i){if(i.Id===b.Id&&b[h["default"].offlineItemsStateMarker]===g.offlineItemStates.created)return d.setup.conflicts.strategy===h["default"].ConflictResolutionStrategy.Custom?(d._onItemFailed({type:g.offlineItemStates.modified,storage:D.client,error:new f.EverliveError(f.EverliveErrors.syncError),contentType:a},b.Id),d._onItemFailed({type:g.offlineItemStates.modified,storage:D.server,error:new f.EverliveError(f.EverliveErrors.syncError),contentType:a},i.Id)):d._onItemFailed({type:g.offlineItemStates.created,storage:D.client,error:new f.EverliveError(f.EverliveErrors.syncError),contentType:a},i.Id);var j=!!b[h["default"].offlineItemsStateMarker],k=!1;j&&(k=i.ModifiedAt.getTime()!==b.ModifiedAt.getTime()||b[h["default"].offlineItemsStateMarker]===g.offlineItemStates.deleted),k?e.conflicts.conflictingItems.push({clientItem:b[h["default"].offlineItemsStateMarker]===g.offlineItemStates.deleted?null:b,serverItem:i,result:{}}):b[h["default"].offlineItemsStateMarker]===g.offlineItemStates.deleted?e.itemsForSync.deletedItems.push({remoteItem:i,resultingItem:b}):b[h["default"].offlineItemsStateMarker]===g.offlineItemStates.modified?e.itemsForSync.modifiedItems.push({remoteItem:i,resultingItem:b}):void 0===b[h["default"].offlineItemsStateMarker]?e.itemsForSync.modifiedItemsOnServer.push(i):e.itemsForSync.modifiedItems.push({remoteItem:i,resultingItem:i})}else b[h["default"].offlineItemsStateMarker]===g.offlineItemStates.modified?e.conflicts.conflictingItems.push({clientItem:b,serverItem:null,result:{}}):b[h["default"].offlineItemsStateMarker]===g.offlineItemStates.created?e.itemsForSync.createdItems.push({remoteItem:i,resultingItem:b}):e.itemsForSync.deletedItemsOnServer.push(b);delete b[h["default"].offlineItemsStateMarker]}),e},_setResolutionTypeForItem:function(a,b){b.result={resolutionType:a}},_applyResolutionStrategy:function(a){var b=this,c=b.setup.conflicts.strategy;return new n["default"].Promise(function(d,e){for(var g=[],i=0;i<a.length;i++){var j=a[i];if(j.conflictingItems.length)switch(c){case h["default"].ConflictResolutionStrategy.ServerWins:l["default"].each(j.conflictingItems,b._setResolutionTypeForItem.bind(b,h["default"].ConflictResolution.KeepServer));break;case h["default"].ConflictResolutionStrategy.Custom:var k=b.setup.conflicts.implementation;if(!k)return e(new f.EverliveError("Implementation of the conflict resolution strategy must be provided when set to Custom"));g.push(new n["default"].Promise(function(b){k(a,b)}));break;default:return e(new f.EverliveError("Invalid resolution strategy provided"))}}n["default"].all(g).then(function(){d()})})},_getSyncPromiseBatch:function(a,b){var c=this,d=new e["default"]({meta:{collectionName:a},query:new B["default"]({Id:{$in:b}}),operation:e["default"].operations.Read,applyOffline:!1}),f=j["default"][d.operation],g=f(d),h=new r["default"](c._everlive.setup,g);return C.RequestService.sendRequest(h)},_getPlainItemsForSync:function(a,b){return this.setup.syncUnmodified&&!b?l["default"].values(a):this._queryProcessor._getDirtyItems(a)},_getIdsForSync:function(a,b){return this._shouldAutogenerateIdForContentType(a)?l["default"].pluck(b,"_id"):l["default"].pluck(l["default"].reject(b,function(a){return a[h["default"].offlineItemsStateMarker]===g.offlineItemStates.created}),"_id")},_getSyncPromiseForCollection:function(a,b){for(var c=[],d=h["default"].syncBatchSize,e=this._getPlainItemsForSync(a),f=this._getIdsForSync(b,e),g=Math.ceil(f.length/d),i=0;g>i;i++){var j=i*d,k=f.slice(j,j+d),m=this._getSyncPromiseBatch(b,k);c.push(m)}return n["default"].all(c).then(function(a){var b={serverItems:[]};return l["default"].each(a,function(a){b.serverItems=l["default"].union(b.serverItems,a)}),b.offlineItemsToSync=e,b})},_onItemFailed:function(a,b){var c=this,d=a.reason?a.reason:a,e=d.contentType,h=function(a){var b=l["default"].pick(d,"storage","type","error");return b.error||(b.error=new f.EverliveError(f.EverliveErrors.syncErrorUnknown)),l["default"].extend({itemId:a,contentType:e},b)},i=[];d.type===g.offlineItemStates.created&&d.items?i=l["default"].map(d.items,function(a){return h(a.Id)}):i.push(h(b)),c._syncResultInfo.failedItems[e]=c._syncResultInfo.failedItems[e]||[],l["default"].each(i,function(a){c._syncResultInfo.failedItems[e].push(a),c._fireItemProcessed(a)})},_onItemProcessed:function(a,b,c,d){var e={itemId:a.Id,type:d,storage:c,contentType:b};this._syncResultInfo.syncedItems[b]=this._syncResultInfo.syncedItems[b]||[],this._syncResultInfo.syncedItems[b].push(e),e.storage==D.server?this._syncResultInfo.syncedToServer++:this._syncResultInfo.syncedToClient++,this._fireItemProcessed(e)},_fireItemProcessed:function(a){this._everlive._emitter.emit(h["default"].Events.ItemProcessed,a)},_getClientWinsSyncData:function(a,b){var c=this,d={};return l["default"].each(a,function(a,e){d[e]||(d[e]={createdItems:[],modifiedItems:[],deletedItems:[],deletedItemsOnServer:[],modifiedItemsOnServer:[]});var f=c._getPlainItemsForSync(a,b),i=t["default"].idTransform(f);l["default"].each(i,function(a){switch(a[h["default"].offlineItemsStateMarker]){case g.offlineItemStates.created:d[e].createdItems.push({remoteItem:a,resultingItem:a});break;case g.offlineItemStates.modified:d[e].modifiedItems.push({remoteItem:a,resultingItem:a});break;case g.offlineItemStates.deleted:d[e].deletedItems.push({remoteItem:a,resultingItem:a})}delete a[h["default"].offlineItemsStateMarker]})}),d},_getModifiedFilesForSyncClientWins:function(a,b,c){var d=this,e=d._everlive;return new n["default"].Promise(function(f,h){var i=d.files;i.getOfflineLocation(a).then(function(a){return a?d._transferFile(!0,b,a).then(function(a){return a.Result!==!1?{result:a}:void h({type:g.offlineItemStates.modified,itemId:b.Id,contentType:c,error:a,storage:D.server})},function(a){h({type:g.offlineItemStates.modified,itemId:b.Id,contentType:c,error:a,storage:D.server})}):e.files.isSync(!0).applyOffline(!1).updateSingle(b).then(function(a){return a},function(a){h({type:g.offlineItemStates.modified,itemId:b.Id,contentType:c,error:a,storage:D.server})})}).then(function(a){var f=a.result;return b.ModifiedAt=f.ModifiedAt,d._onItemProcessed(b,c,D.server,g.offlineItemStates.modified),e.files.isSync(!0).useOffline(!0).updateSingle(b)}).then(f)["catch"](function(a){h({type:g.offlineItemStates.modified,itemId:b.Id,contentType:c,error:a,storage:D.server})})})},_getModifiedItemForSyncClientWins:function(a,b,c){var d=this;return new n["default"].Promise(function(f,h){return a.isSync(!0).applyOffline(!1).updateSingle(b).then(function(a){d._onItemProcessed(b,c,D.server,g.offlineItemStates.modified);var f=l["default"].extend({},b,{ModifiedAt:a.ModifiedAt}),h=new e["default"]({operation:e["default"].operations.Update,data:f,additionalOptions:{id:b.Id},meta:{collectionName:c},isSync:!0});return d.processQuery(h)},function(a){h({storage:D.server,type:g.offlineItemStates.modified,itemId:b.Id,contentType:c,error:a})}).then(f,function(a){h({storage:D.client,type:g.offlineItemStates.modified,itemId:b.Id,contentType:c,error:a})})})},_addModifiedItemsForSyncClientWins:function(a,b,d){var e=this;this._addUpdatedItemsForSync(a,c,b,d,function(a){var c=a.Id;if(!c)throw new f.EverliveError("When updating an item it must have an Id field.");var g=d.collectionName;b[c]=p["default"].isContentType.files(g)?e._getModifiedFilesForSyncClientWins(c,a,g):e._getModifiedItemForSyncClientWins(d,a,g)})},_addDeletedItemsForSyncClientWins:function(a,b,d){var e=this;this._addDeletedItemsForSync(a,c,b,d,function(a,c){var h=d.collectionName;b[a.Id]=new n["default"].Promise(function(b,i){var j=a.Id;if(!j)throw new f.EverliveError("When deleting an item it must have an Id field.");return d.isSync(!0).applyOffline(!1).destroySingle(c).then(function(){return e._onItemProcessed(a,h,D.server,g.offlineItemStates.deleted),e._purgeById(h,a.Id).then(function(){b()},function(a){i(l["default"].extend({},{storage:D.client,type:g.offlineItemStates.deleted,contentType:h,itemId:j,error:a}))})},function(a){i(l["default"].extend({},{storage:D.server,type:g.offlineItemStates.deleted,contentType:h,error:a,itemId:j}))})})})},_applyClientWins:function(a){var b=this,c=this._getClientWinsSyncData(a,!0),d={};l["default"].each(c,function(a,c){var e=b._everlive.data(c);a.createdItems.length&&b._addCreatedItemsForSync(a,d,e),a.modifiedItems.length&&b._addModifiedItemsForSyncClientWins(a,d,e),a.deletedItems.length&&b._addDeletedItemsForSyncClientWins(a,d,e)});var e;return n["default"].hashSettled(d).then(function(c){if(e=c,b.setup.syncUnmodified){var d=[];return l["default"].each(a,function(a,c){var e=b._getPlainItemsForSync(a),f=l["default"].where(e,function(a){return void 0!==a[h["default"].offlineItemsStateMarker]}),g=b._everlive.data(c),i=l["default"].pluck(f,"_id"),j=g.isSync(!0).useOffline(!1).get({Id:{$in:i}}).then(function(a){var d=a.result,e=l["default"].pluck(d,"Id");return b._unmodifiedClientWinsItemsDeletedOnServer(c,e,f).then(function(){return b._unmodifiedClientWinsItemsUpdatedOnServer(c,d,f)})});d.push(j)}),n["default"].all(d)}}).then(function(){return e})},_unmodifiedClientWinsItemsDeletedOnServer:function(a,b,c){var d=this,f=[],h=l["default"].pluck(c,"_id");return l["default"].each(h,function(a){-1===b.indexOf(a)&&f.push(a)}),p["default"].successfulPromise().then(function(){if(0!==f.length){var b=new e["default"]({operation:e["default"].operations.Delete,filter:{Id:{$in:f}},meta:{collectionName:a},isSync:!0});return d.processQuery(b).then(function(){l["default"].each(f,function(b){d._onItemProcessed({Id:b},a,D.client,g.offlineItemStates.deleted)})})}})},_unmodifiedClientWinsItemsUpdatedOnServer:function(a,b,c){var d=this,f=[];return l["default"].each(b,function(b){var h=l["default"].find(c,function(a){return a._id===b.Id});if(h){var i=new e["default"]({operation:e["default"].operations.Update,data:b,additionalOptions:{id:h._id},meta:{collectionName:a},isSync:!0}),j=d.processQuery(i).then(function(){d._onItemProcessed(b,a,D.client,g.offlineItemStates.modified)});f.push(j)}}),n["default"].all(f)},_modifyFileStandardSync:function(a,b,c,d,e){var g=this,i=g._everlive.files;a[b]=new n["default"].Promise(function(a,j){var k;g.files.getOfflineLocation(b).then(function(a){k=a}).then(function(){return i.isSync(!0).applyOffline(!1).getById(b)}).then(function(a){var b=a.result;if(b.ModifiedAt.getTime()!==c.ModifiedAt.getTime())j(l["default"].extend({},new f.EverliveError(f.EverliveErrors.syncConflict),{contentType:d}));else if(k){if(e===h["default"].ConflictResolution.KeepServer)return g.files._saveFile(c.Uri,c.Filename,c.Id).then(function(){return g._offlineFilesProcessor.purge(k)}).then(function(){return a});if(e===h["default"].ConflictResolution.KeepClient)return g._transferFile(!0,c,k)}}).then(function(){return g._everlive.files.isSync(!0).useOffline(!0).updateSingle(c)}).then(a)["catch"](j)})},_modifyContentTypeStandardSync:function(a,b,c,d,f,h,i){var j=this;a[b]=c.isSync(!0).applyOffline(!1).update(d,f).then(function(a){return j._onSyncResponse(a,d,h,e["default"].operations.Update,i)},function(a){return new n["default"].Promise(function(b,c){c({type:g.offlineItemStates.modified,itemId:d.Id,contentType:h,error:a,storage:D.server})})})},_applyStandardSync:function(a){var c=this,d={};return l["default"].each(a,function(a,b){d[b]=c._getSyncPromiseForCollection(a,b)}),n["default"].hash(d).then(function(a){return c._prepareSyncData(a)}).then(function(a){return c._resolveConflicts(a)}).then(function(a){var d={};return l["default"].each(a,function(a,f){var h=c._everlive.data(f);a.createdItems.length&&c._addCreatedItemsForSync(a,d,h),a.modifiedItems.length&&c._addUpdatedItemsForSync(a,b,d,h,function(a,b,e,g){var i=a.Id;p["default"].isContentType.files(f)?c._modifyFileStandardSync(d,i,a,f,g,e):c._modifyContentTypeStandardSync(d,i,h,a,b,f,e)}),a.deletedItems.length&&c._addDeletedItemsForSync(a,b,d,h,function(a,b,i){d[a.Id]=h.isSync(!0).applyOffline(!1).destroy(b).then(function(b){return c._onSyncResponse(b,a,f,e["default"].operations.Delete,i)},function(b){return new n["default"].Promise(function(c,d){d({type:g.offlineItemStates.deleted,itemId:a.Id,contentType:f,error:b,storage:D.server})})})}),l["default"].each(a.deletedItemsOnServer,function(a){d[a.Id]=h.isSync(!0).useOffline(!0).destroySingle({Id:a.Id}).then(function(){return c._onItemProcessed(a,f,D.client,g.offlineItemStates.deleted)},function(b){return new n["default"].Promise(function(c,d){d({type:g.offlineItemStates.deleted,itemId:a.Id,contentType:f,error:b,storage:D.client})})})}),l["default"].each(a.modifiedItemsOnServer,function(a){d[a.Id]=h.isSync(!0).useOffline(!0).update(a,{Id:a.Id}).then(function(){return c._onItemProcessed(a,f,D.client,g.offlineItemStates.modified)},function(b){return p["default"].rejectedPromise({type:g.offlineItemStates.modified,itemId:a.Id,contentType:f,error:b,storage:D.client})})})}),n["default"].hashSettled(d)})},_applySync:function(){var a=this;return this._queryProcessor._getAllCollections().then(function(b){return a.setup.conflicts.strategy===h["default"].ConflictResolutionStrategy.ClientWins?a._applyClientWins(b):a._applyStandardSync(b)})},getItemsForSync:function(a,b){var c=this,d={};return o.buildPromise(function(a,b){c._queryProcessor._getAllCollections().then(function(b){l["default"].each(b,function(a,b){var e=c._getPlainItemsForSync(a);d[b]=l["default"].map(e,function(a){var b={item:l["default"].extend({},a),action:a[h["default"].offlineItemsStateMarker]};return delete b.item[h["default"].offlineItemsStateMarker],b})}),a(d)})["catch"](b)},a,b)}},a}()},{"../../everlive/EverliveError":58,"../../everlive/Request":63,"../../everlive/constants":70,"../../everlive/dataQuery/DataQuery":71,"../../everlive/offline/OfflineFilesModule":81,"../../everlive/offline/OfflineFilesProcessor":82,"../../everlive/offline/OfflineQueryProcessor":83,"../../everlive/offline/offlineTransformations":87,"../../everlive/query/Query":96,"../../everlive/query/RequestOptionsBuilder":98,"../../everlive/services/RequestService":105,"../../everlive/utils":121,rsvp:35,underscore:36}],85:[function(a,b){"use strict";function c(a){return a&&a.__esModule?a:{"default":a}}var d=a("../../everlive/constants"),e=c(d),f=a("../../everlive/offline/offlinePersisters"),g=c(f),h=a("../../everlive/offline/OfflineStorageModule"),i=c(h),j=a("../../everlive/EverliveError"),k=a("../../everlive/everlive.platform"),l=a("underscore"),m=c(l),n=a("rsvp"),o=c(n),p=a("../../everlive/encryption/CryptographicProvider"),q=c(p),r={autoSync:!0,enabled:!0,conflicts:{strategy:e["default"].ConflictResolutionStrategy.ClientWins,implementation:null},offline:!1,storage:{name:"",provider:k.isNativeScript?e["default"].StorageProvider.FileSystem:e["default"].StorageProvider.LocalStorage,implementation:null,storagePath:e["default"].DefaultStoragePath,requestedQuota:e["default"].DefaultFilesystemStorageQuota},typeSettings:{},encryption:{provider:e["default"].EncryptionProvider.Default,implementation:null,key:""},files:{storagePath:e["default"].DefaultFilesStoragePath,metaPath:e["default"].DefaultFilesMetadataPath,maxConcurrentDownloads:e["default"].MaxConcurrentDownloadTasks}};b.exports=function(){function a(a){var b,c=a.offline||a.offlineStorage;return c===!0?b=m["default"].defaults({},r):m["default"].isObject(c)?(b=m["default"].defaults(c,r),b.storage=m["default"].defaults(c.storage,r.storage),b.encryption=m["default"].defaults(c.encryption,r.encryption),b.conflicts=m["default"].defaults(c.conflicts,r.conflicts),b.files=m["default"].defaults(c.files,r.files)):(b=m["default"].defaults({},r),b.enabled=!1,
c||(a.offlineStorage=b)),b.cacheEnabled=a.caching&&a.caching.enabled,b}var b={};b[e["default"].ConflictResolutionStrategy.ClientWins]=function(a,b){return new o["default"].Promise(function(a){a(b)})},b[e["default"].ConflictResolutionStrategy.ServerWins]=function(a,b,c){return new o["default"].Promise(function(a){a(c)})};var c=function(a){var b=a.storage.name||"everliveOfflineStorage_"+this.setup.appId,c=g["default"].getPersister(b,a);return a.storage.implementation=c,c},d=function(a){var b,c=a.encryption.provider,d=a.encryption.implementation;if(m["default"].isObject(d)&&c===e["default"].EncryptionProvider.Custom)b=d;else switch(c){case e["default"].EncryptionProvider.Default:b=new q["default"](a);break;case e["default"].EncryptionProvider.Custom:throw new j.EverliveError("Custom encryption provider requires an implementation object");default:throw new j.EverliveError("Unsupported encryption provider "+c)}return a.encryption.implementation=b,b},f=function(b){var e=a(b),f=c.call(this,e),g=d.call(this,e);return new i["default"](this,e,f,g)},h=function(a){this.offlineStorage=f.call(this,a)};return{initOfflineStorage:h,buildOfflineStorageOptions:a}}()},{"../../everlive/EverliveError":58,"../../everlive/constants":70,"../../everlive/encryption/CryptographicProvider":73,"../../everlive/everlive.platform":74,"../../everlive/offline/OfflineStorageModule":84,"../../everlive/offline/offlinePersisters":86,rsvp:35,underscore:36}],86:[function(a,b){"use strict";function c(a){return a&&a.__esModule?a:{"default":a}}var d=a("../../everlive/offline/persisters/BasePersister"),e=c(d),f=a("../../everlive/offline/persisters/LocalStoragePersister"),g=c(f),h=a("../../everlive/offline/persisters/FileSystemPersister"),i=c(h),j=a("../../everlive/constants"),k=c(j),l=a("../../everlive/EverliveError"),m=a("underscore"),n=c(m);b.exports={BasePersister:e["default"],LocalStoragePersister:g["default"],FileSystemPersister:i["default"],getPersister:function(a,b){var c,d=b.storage.provider,e=b.storage.implementation;if(n["default"].isObject(e)&&d===k["default"].StorageProvider.Custom)c=e;else switch(d){case k["default"].StorageProvider.LocalStorage:c=new g["default"](a,b);break;case k["default"].StorageProvider.FileSystem:c=new i["default"](a,b);break;case k["default"].StorageProvider.Custom:throw new l.EverliveError("Custom storage provider requires an implementation object");default:throw new l.EverliveError("Unsupported storage type "+d)}return c}}},{"../../everlive/EverliveError":58,"../../everlive/constants":70,"../../everlive/offline/persisters/BasePersister":88,"../../everlive/offline/persisters/FileSystemPersister":89,"../../everlive/offline/persisters/LocalStoragePersister":90,underscore:36}],87:[function(a,b){"use strict";function c(a){return a&&a.__esModule?a:{"default":a}}var d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol?"symbol":typeof a},e=a("../../everlive/constants"),f=c(e),g=a("underscore"),h=c(g),i=function(a,b,c){return h["default"].isArray(a)?h["default"].map(a,function(a){return b(a,c)}):b(a,c)},j=function(a){return"object"===("undefined"==typeof a?"undefined":d(a))&&a._id&&!a.Id&&(a.Id=a._id,delete a._id),a},k=function(a,b){var c=b.verifyStateCreated,e=c?a[f["default"].offlineItemsStateMarker]===f["default"].offlineItemStates.created:!0;return"object"===("undefined"==typeof a?"undefined":d(a))&&(a._id||a.Id)&&e&&(delete a._id,delete a.Id),a},l=function(a){return delete a[e.offlineItemsStateMarker],a},m={removeIdTransform:function(a,b){return i(a,k,{verifyStateCreated:b})},idTransform:function(a){return i(a,j)},singleFieldTransform:function(a,b){return"undefined"==typeof b||null===b?null:b[a]},traverseAndTransformFilterId:function(a){a&&a.Id&&(a._id=a.Id,delete a.Id);for(var b in a)if(a.hasOwnProperty(b)){var c=a[b];"object"===("undefined"==typeof c?"undefined":d(c))&&m.traverseAndTransformFilterId(c)}},removeMarkersTransform:function(a){return i(a,l)},removeFieldsTransform:function(a,b){return h["default"].each(b,function(b){delete a[b]}),a}};b.exports=m},{"../../everlive/constants":70,underscore:36}],88:[function(a,b){"use strict";function c(a){return a&&a.__esModule?a:{"default":a}}var d=a("../../../everlive/EverliveError"),e=a("underscore"),f=c(e),g=a("rsvp"),h=c(g),i=function(){function a(a,b){this.key=a,this.options=b,this.contentTypesStoreKey=this.key+"@ContentTypes"}return a.prototype={getAllData:function(a,b){var c=this,d={};this._getContentTypes(function(e){f["default"].each(e,function(a){d[a]=new h["default"].Promise(function(b,d){c.getData(a,b,d)})}),h["default"].hash(d).then(a)["catch"](b)},b)},getData:function(){throw new d.EverliveError("The method getData is not implemented")},saveData:function(){throw new d.EverliveError("The method saveData is not implemented")},purge:function(){throw new d.EverliveError("The method clear is not implemented")},purgeAll:function(){throw new d.EverliveError("The method clearAll is not implemented")},_getKey:function(a){return this.key+"_"+a},_getContentTypes:function(){throw new d.EverliveError("The method _getContentTypes is not implemented")}},a}();b.exports=i},{"../../../everlive/EverliveError":58,rsvp:35,underscore:36}],89:[function(a,b){"use strict";function c(a){return a&&a.__esModule?a:{"default":a}}var d=a("../../../everlive/storages/FileStore"),e=c(d),f=a("../../../everlive/offline/persisters/BasePersister"),g=c(f),h=a("underscore"),i=c(h),j=a("util"),k=c(j),l=function(){function a(a,b){g["default"].apply(this,arguments),this.fileStore=new e["default"](b.storage.storagePath,b)}return k["default"].inherits(a,g["default"]),a.prototype.getAllData=function(b,c){var d=this._fileSystemErrorHandler(c);a.super_.prototype.getAllData.call(this,b,d)},a.prototype.getData=function(a,b,c){var d=this,e=this._fileSystemErrorHandler(c);this.getFileHandle(a,function(a){d._readFileContent(a,b,e)},c)},a.prototype.saveData=function(a,b,c,d){var e=this,f=this._fileSystemErrorHandler(d);this.getFileHandle(a,function(d){e._writeFileContent(d,b,function(){e._saveContentTypes(a,c,f)},f)},f)},a.prototype.purge=function(a,b,c){var d=this,e=this._fileSystemErrorHandler(c);this.getFileHandle(a,function(a){d.fileStore.removeFile(a).then(function(){b()})["catch"](c)},e)},a.prototype.purgeAll=function(a,b){var c=this._fileSystemErrorHandler(b);this.fileStore.removeFilesDirectory().then(function(){a()})["catch"](c)},a.prototype._getContentTypes=function(a,b){this.getData(this.contentTypesStoreKey,function(b){var c=JSON.parse(b||"[]");a(c)},b)},a.prototype._saveContentTypes=function(a,b,c){var d=this;this._getContentTypes(function(e){i["default"].contains(e,a)||e.push(a),d.getFileHandle(d.contentTypesStoreKey,function(a){d._writeFileContent(a,JSON.stringify(e),b,c)},c)})},a.prototype.getFileHandle=function(a,b,c){var d=this,e=d._getFilePath(a);this.fileStore.getFilesDirectory().then(function(){return d.fileStore.getFile(e)}).then(function(a){b(a)})["catch"](c)},a.prototype._readFileContent=function(a,b,c){this.fileStore.readFileAsText(a).then(function(a){b(a)})["catch"](c)},a.prototype._writeFileContent=function(a,b,c,d){this.fileStore.writeTextToFile(a,b).then(c)["catch"](d)},a.prototype._getFilePath=function(a){return this._getKey(a)},a.prototype._fileSystemErrorHandler=function(a){return this.fileStore.getErrorHandler(a)},a}();b.exports=l},{"../../../everlive/offline/persisters/BasePersister":88,"../../../everlive/storages/FileStore":106,underscore:36,util:7}],90:[function(a,b){"use strict";function c(a){return a&&a.__esModule?a:{"default":a}}var d=a("underscore"),e=c(d),f=a("util"),g=c(f),h=a("../../../everlive/storages/LocalStore"),i=c(h),j=a("../../../everlive/offline/persisters/BasePersister"),k=c(j),l=function(){function a(a,b){k["default"].apply(this,arguments),this._localStore=new i["default"](b)}return g["default"].inherits(a,k["default"]),a.prototype.getData=function(a,b,c){try{var d=this._getKey(a),e=this._getItem(d);b(e)}catch(f){c(f)}},a.prototype.saveData=function(a,b,c,d){try{var e=this._getKey(a);this._setItem(e,b),c()}catch(f){d(f)}},a.prototype.purge=function(a,b,c){var d=this;try{var f=this._getKey(a);this._removeItem(f),this._getContentTypes(function(c){c=e["default"].without(c,a),d._setContentTypesCollection(c),b()},c)}catch(g){c(g)}},a.prototype.purgeAll=function(a,b){try{var c=this;this._getContentTypes(function(b){e["default"].each(b,function(a){var b=c._getKey(a);c._removeItem(b)}),c._removeItem(c.contentTypesStoreKey),a()},b)}catch(d){b(d)}},a.prototype._getItem=function(a){return this._localStore.getItem(a)},a.prototype._setItem=function(a,b){return this._localStore.setItem(a,b)},a.prototype._removeItem=function(a){return this._localStore.removeItem(a)},a.prototype._getKey=function(b){return this._addTypeToCollectionsCache(b),a.super_.prototype._getKey.apply(this,arguments)},a.prototype._getContentTypes=function(a,b){try{var c=this._getItem(this.contentTypesStoreKey),d=[];c&&(d=JSON.parse(c)),a(d)}catch(e){b(e)}},a.prototype._setContentTypesCollection=function(a){this._setItem(this.contentTypesStoreKey,JSON.stringify(a))},a.prototype._addTypeToCollectionsCache=function(a){var b=this;this._getContentTypes(function(c){e["default"].contains(c,a)||(c.push(a),b._setContentTypesCollection(c))})},a}();b.exports=l},{"../../../everlive/offline/persisters/BasePersister":88,"../../../everlive/storages/LocalStore":107,underscore:36,util:7}],91:[function(a,b){"use strict";function c(a){return a&&a.__esModule?a:{"default":a}}var d=a("../../everlive/utils"),e=c(d),f=a("../../everlive/EverliveError"),g=a("../../everlive/constants"),h=a("jstimezonedetect"),i=a("underscore"),j=c(i);b.exports=function(){var a=function(a){if(!window.cordova)throw new f.EverliveError("Error: currentDevice() can only be called from within a hybrid mobile app, after 'deviceready' event has been fired.");this._pushHandler=a,this._initSuccessCallback=null,this._initErrorCallback=null,this._globalFunctionSuffix=null,this.pushSettings=null,this.pushToken=null,this.isInitialized=!1,this.isInitializing=!1,this.emulatorMode=!1};return a.ensurePushIsAvailable=function(){var a="undefined"!=typeof window&&window.plugins&&window.plugins.pushNotification;if(!a&&!e["default"]._inAppBuilderSimulator())throw new f.EverliveError("The push notification plugin is not available. Ensure that the pushNotification plugin is included and use after `deviceready` event has been fired.")},a.prototype={enableNotifications:function(a,b,c){return this.pushSettings=this._cleanPlatformsPushSettings(a),d.buildPromise(j["default"].bind(this._initialize,this),b,c)},disableNotifications:function(a,b){var c=this;return this.unregister().then(function(){return d.buildPromise(function(a,b){if(c.emulatorMode)a();else{var d,e=window.plugins.pushNotification,f=c._getPlatformType();f===g.Platform.WindowsPhone&&(d={channelName:c.pushSettings.wp8.channelName}),e.unregister(function(){c.isInitialized=!1,a()},b,d)}},a,b)},b)},getRegistration:function(a,b){var c=encodeURIComponent(this._getDeviceId());return this._pushHandler.devices.getById("HardwareId/"+c,a,b)},register:function(a,b,c){var d=this,e={};return void 0!==a&&(e.Parameters=a),this._populateRegistrationObject(e).then(function(){return d._pushHandler.devices.create(e,b,c)},c)},unregister:function(a,b){var c=encodeURIComponent(device.uuid);return this._pushHandler.devices.destroySingle({Id:"HardwareId/"+c},a,b)},updateRegistration:function(a,b,c){var d=this,e={};return void 0!==a&&(e.Parameters=a),this._populateRegistrationObject(e).then(function(){return e.Id="HardwareId/"+encodeURIComponent(e.HardwareId),d._pushHandler.devices.updateSingle(e,b,c)},c)},areNotificationsEnabled:function(a,b,c){a=a||{};var e=window.plugins.pushNotification;return d.buildPromise(function(b,c){e.areNotificationsEnabled(b,c,a)},b,c)},notificationProcessed:function(){var a=window.plugins.pushNotification;a.notificationProcessed()},_initializeInteractivePush:function(a,b,c){var d=window.plugins.pushNotification,e=a.interactiveSettings,f=[];a.alert&&f.push(d.UserNotificationTypes.Alert),a.badge&&f.push(d.UserNotificationTypes.Badge),a.sound&&f.push(d.UserNotificationTypes.Sound);var g=function(a){var b=j["default"].find(e.actions,function(b){return b.identifier===a});return b},h=j["default"].map(e.categories,function(a){return{identifier:a.identifier,actionsForDefaultContext:j["default"].map(a.actionsForDefaultContext,g),actionsForMinimalContext:j["default"].map(a.actionsForMinimalContext,g)}});d.registerUserNotificationSettings(b,c,{types:f,categories:h})},_initialize:function(a,b){var c=this;if(this.isInitializing)return void b(new f.EverliveError("Push notifications are currently initializing."));if(!(this.emulatorMode||window.navigator&&window.navigator.globalization))return void b(new f.EverliveError("The globalization plugin is not initialized."));if(!(this.emulatorMode||window.plugins&&window.plugins.pushNotification))return void b(new f.EverliveError("The push notifications plugin is not initialized."));if(this._initSuccessCallback=a,this._initErrorCallback=b,this.isInitialized)return void this._deviceRegistrationSuccess(this.pushToken);if(this.emulatorMode)return void setTimeout(function(){c._deviceRegistrationSuccess("fake_push_token")},1e3);this.isInitializing=!0;var d=this._globalFunctionSuffix;d||(d=Date.now().toString(),this._globalFunctionSuffix=d);var e=window.plugins.pushNotification,h=this._getPlatformType();if(h===g.Platform.iOS){var i="apnCallback_"+d;Everlive.PushCallbacks[i]=j["default"].bind(this._onNotificationAPN,this);var k=this.pushSettings.iOS;k.ecb="Everlive.PushCallbacks."+i,e.register(j["default"].bind(this._successfulRegistrationAPN,this),j["default"].bind(this._failedRegistrationAPN,this),k)}else if(h===g.Platform.Android){var l="gcmCallback_"+d;Everlive.PushCallbacks[l]=j["default"].bind(this._onNotificationGCM,this);var m=this.pushSettings.android;this._validateAndroidSettings(m),m.ecb="Everlive.PushCallbacks."+l,e.register(j["default"].bind(this._successSentRegistrationGCM,this),j["default"].bind(this._errorSentRegistrationGCM,this),m)}else{if(h!==g.Platform.WindowsPhone)throw new f.EverliveError("The current platform is not supported: "+device.platform);var n="wp8Callback_"+d,o="wp8RegistrationSuccessCallback_"+d,p="wp8RegistrationErrorCallback_"+d;Everlive.PushCallbacks[n]=j["default"].bind(this._onNotificationWP8,this),Everlive.PushCallbacks[o]=j["default"].bind(this._deviceRegistrationSuccessWP,this),Everlive.PushCallbacks[p]=j["default"].bind(this._deviceRegistrationFailed,this);var q=this.pushSettings.wp8;this._validateWP8Settings(q),q.ecb="Everlive.PushCallbacks."+n,q.uccb="Everlive.PushCallbacks."+o,q.errcb="Everlive.PushCallbacks."+p,e.register(j["default"].bind(this._successSentRegistrationWP8,this),j["default"].bind(this._errorSentRegistrationWP8,this),q)}},_deviceRegistrationSuccessWP:function(a){this._deviceRegistrationSuccess(a.uri)},_validateAndroidSettings:function(a){if(!a.senderID)throw new f.EverliveError("Sender ID (project number) is not set in the android settings.")},_validateWP8Settings:function(a){if(!a.channelName)throw new f.EverliveError("channelName is not set in the WP8 settings.")},_cleanPlatformsPushSettings:function(a){var b={};a=a||{};var c=function(b,c,d){if(a[c]){b[c]=b[c]||{};var e=a[c],f=b[c];j["default"].each(d,function(a){e.hasOwnProperty(a)&&(f[a]=e[a])})}};c(b,"iOS",["badge","sound","alert","interactiveSettings"]),c(b,"android",["senderID","projectNumber"]),c(b,"wp8",["channelName"]);var d=["notificationCallbackAndroid","notificationCallbackIOS","notificationCallbackWP8"];return j["default"].each(d,function(c){var d=a[c];if(d){if("function"!=typeof d)throw new f.EverliveError('The "'+c+'" of the push settings should be a function');b[c]=a[c]}}),a.customParameters&&(b.customParameters=a.customParameters),b},_populateRegistrationObject:function(a,b,c){var e=this;return d.buildPromise(function(b,c){if(!e.pushToken)throw new f.EverliveError("Push token is not available.");e._getLocaleName(function(c){var d=e._getDeviceId(),f=device.model,g=e._getPlatformType(),i=h.jstz.determine().name(),j=e.pushToken,k=c.value,l=device.version;a.HardwareId=d,a.HardwareModel=f,a.PlatformType=g,a.PlatformVersion=l,a.TimeZone=i,a.PushToken=j,a.Locale=k,b()},c)},b,c)},_getLocaleName:function(a,b){this.emulatorMode?a({value:"en_US"}):(navigator.globalization.getLocaleName(function(b){a(b)},b),navigator.globalization.getLocaleName(function(){},b))},_getDeviceId:function(){return device.uuid},_getPlatformType:function(){var a=device.platform.toLowerCase();switch(a){case"ios":case"iphone":case"ipad":return g.Platform.iOS;case"android":return g.Platform.Android;case"wince":return g.Platform.WindowsPhone;case"win32nt":return g.Platform.WindowsPhone;default:return g.Platform.Unknown}},_deviceRegistrationFailed:function(a){this.pushToken=null,this.isInitializing=!1,this.isInitialized=!1,this._initErrorCallback&&this._initErrorCallback({error:a})},_deviceRegistrationSuccess:function(a){this.pushToken=a,this.isInitializing=!1,this.isInitialized=!0,this._initSuccessCallback&&this._initSuccessCallback({token:a})},_successfulRegistrationAPN:function(a){var b=this;this.pushSettings.iOS&&this.pushSettings.iOS.interactiveSettings?this._initializeInteractivePush(this.pushSettings.iOS,function(){b._deviceRegistrationSuccess(a)},function(a){throw new f.EverliveError("The interactive push configuration is incorrect: "+a)}):this._deviceRegistrationSuccess(a)},_failedRegistrationAPN:function(a){this._deviceRegistrationFailed(a)},_successSentRegistrationGCM:function(){},_successSentRegistrationWP8:function(){},_errorSentRegistrationWP8:function(a){this._deviceRegistrationFailed(a)},_errorSentRegistrationGCM:function(a){this._deviceRegistrationFailed(a)},_onNotificationAPN:function(a){this._raiseNotificationEventIOS(a)},_onNotificationWP8:function(a){this._raiseNotificationEventWP8(a)},_onNotificationGCM:function(a){switch(a.event){case"registered":a.regid.length>0&&this._deviceRegistrationSuccess(a.regid);break;case"message":this._raiseNotificationEventAndroid(a);break;case"error":this.pushToken?this._raiseNotificationEventAndroid(a):this._deviceRegistrationFailed(a);break;default:this._raiseNotificationEventAndroid(a)}},_raiseNotificationEventAndroid:function(a){this.pushSettings.notificationCallbackAndroid&&this.pushSettings.notificationCallbackAndroid(a)},_raiseNotificationEventIOS:function(a){this.pushSettings.notificationCallbackIOS&&this.pushSettings.notificationCallbackIOS(a)},_raiseNotificationEventWP8:function(a){this.pushSettings.notificationCallbackWP8&&this.pushSettings.notificationCallbackWP8(a)}},a}()},{"../../everlive/EverliveError":58,"../../everlive/constants":70,"../../everlive/utils":121,jstimezonedetect:12,underscore:36}],92:[function(a,b){"use strict";function c(a){return a&&a.__esModule?a:{"default":a}}var d=a("../../everlive/everlive.platform"),e=c(d),f=a("underscore"),g=c(f);if(e["default"].isNativeScript){var h=a("../../everlive/push/NativeScriptCurrentDevice");b.exports=h}else if(e["default"].isCordova||e["default"].isDesktop){var i=a("../../everlive/push/CordovaCurrentDevice");b.exports=i}else b.exports=g["default"].noop},{"../../everlive/everlive.platform":74,"../../everlive/push/CordovaCurrentDevice":91,"../../everlive/push/NativeScriptCurrentDevice":93,underscore:36}],93:[function(a,b){"use strict";function c(a){return a&&a.__esModule?a:{"default":a}}var d=a("../../everlive/utils"),e=a("../../everlive/EverliveError"),f=a("../../everlive/constants"),g=a("jstimezonedetect"),h=a("underscore"),i=c(h),j=a("platform"),k=c(j),l=d.lazyRequire("nativescript-push-notifications","tnsPushPlugin");b.exports=function(){var a=function(a){this._pushHandler=a,this._initSuccessCallback=null,this._initErrorCallback=null,this._globalFunctionSuffix=null,this.pushSettings=null,this.pushToken=null,this.isInitialized=!1,this.isInitializing=!1,this.emulatorMode=!1};return a.ensurePushIsAvailable=function(){},a.prototype={enableNotifications:function(a,b,c){return this.pushSettings=this._cleanPlatformsPushSettings(a),d.buildPromise(i["default"].bind(this._initialize,this),b,c)},disableNotifications:function(a,b){var c=this;return this.unregister().then(function(){return d.buildPromise(function(a,b){var d=function(){c.isInitialized=!1,a()},e=c._getPlatformType();return e===f.Platform.Android?l.tnsPushPlugin.unregister(d,b,c.pushSettings.android):void l.tnsPushPlugin.unregister(d,b)},a,b)},b)},getRegistration:function(a,b){var c=encodeURIComponent(this._getDeviceId());return this._pushHandler.devices.getById("HardwareId/"+c,a,b)},register:function(a,b,c){var d=this,e={};return void 0!==a&&(e.Parameters=a),this._populateRegistrationObject(e).then(function(){return d._pushHandler.devices.create(e,b,c)},c)},unregister:function(a,b){var c=encodeURIComponent(this._getDeviceId());return this._pushHandler.devices.destroySingle({Id:"HardwareId/"+c},a,b)},updateRegistration:function(a,b,c){var d=this,e={};return void 0!==a&&(e.Parameters=a),this._populateRegistrationObject(e).then(function(){return e.Id="HardwareId/"+encodeURIComponent(e.HardwareId),d._pushHandler.devices.updateSingle(e,b,c)},c)},areNotificationsEnabled:function(a,b,c){return a=a||{},d.buildPromise(function(b,c){l.tnsPushPlugin.areNotificationsEnabled(b,c,a)},b,c)},_initializeInteractivePush:function(a,b,c){l.tnsPushPlugin.registerUserNotificationSettings(b,c)},_initialize:function(a,b){if(this.isInitializing)return void b(new e.EverliveError("Push notifications are currently initializing."));if(this._initSuccessCallback=a,this._initErrorCallback=b,this.isInitialized)return void this._deviceRegistrationSuccess(this.pushToken);this.isInitializing=!0;var c=this._globalFunctionSuffix;c||(c=Date.now().toString(),this._globalFunctionSuffix=c);var d=this._getPlatformType();if(d===f.Platform.iOS){var g=this.pushSettings.iOS;g.notificationCallbackIOS=this.pushSettings.notificationCallbackIOS,l.tnsPushPlugin.register(g,i["default"].bind(this._successfulRegistrationAPN,this),i["default"].bind(this._failedRegistrationAPN,this))}else{if(d!==f.Platform.Android)throw new e.EverliveError("The current platform is not supported: "+k["default"].device.os);var h=this.pushSettings.android;this._validateAndroidSettings(h),h.notificationCallbackAndroid=this.pushSettings.notificationCallbackAndroid,l.tnsPushPlugin.register(h,i["default"].bind(this._successSentRegistrationGCM,this),i["default"].bind(this._errorSentRegistrationGCM,this))}},_validateAndroidSettings:function(a){if(!a.senderID)throw new e.EverliveError("Sender ID (project number) is not set in the android settings.")},_cleanPlatformsPushSettings:function(a){var b={};a=a||{};var c=function(b,c,d){if(a[c]){b[c]=b[c]||{};var e=a[c],f=b[c];i["default"].each(d,function(a){e.hasOwnProperty(a)&&(f[a]=e[a])})}};c(b,"iOS",["badge","sound","alert","interactiveSettings"]),c(b,"android",["senderID","projectNumber"]);var d=["notificationCallbackAndroid","notificationCallbackIOS"];return i["default"].each(d,function(c){var d=a[c];if(d){if("function"!=typeof d)throw new e.EverliveError('The "'+c+'" of the push settings should be a function');b[c]=a[c]}}),a.customParameters&&(b.customParameters=a.customParameters),b},_populateRegistrationObject:function(a,b,c){var f=this;return d.buildPromise(function(b,c){if(!f.pushToken)throw new e.EverliveError("Push token is not available.");f._getLocaleName(function(){var c=f._getDeviceId(),d=k["default"].device.model,e=f._getPlatformType(),h=g.jstz.determine().name(),i=f.pushToken,j="en_US",l=k["default"].device.osVersion;a.HardwareId=c,a.HardwareModel=d,a.PlatformType=e,a.PlatformVersion=l,a.TimeZone=h,a.PushToken=i,a.Locale=j,b()},c)},b,c)},_getLocaleName:function(a){return a()},_getDeviceId:function(){return k["default"].device.uuid},_getPlatformType:function(){var a=k["default"].device.os.toLowerCase();switch(a){case"ios":case"iphone":case"ipad":return f.Platform.iOS;case"android":return f.Platform.Android;default:return f.Platform.Unknown}},_deviceRegistrationFailed:function(a){this.pushToken=null,this.isInitializing=!1,this.isInitialized=!1,this._initErrorCallback&&this._initErrorCallback({error:a})},_deviceRegistrationSuccess:function(a){this.pushToken=a,this.isInitializing=!1,this.isInitialized=!0,this._initSuccessCallback&&this._initSuccessCallback({token:a})},_successfulRegistrationAPN:function(a){var b=this;this.pushSettings.iOS&&this.pushSettings.iOS.interactiveSettings?this._initializeInteractivePush(this.pushSettings.iOS,function(){b._deviceRegistrationSuccess(a)},function(a){throw new e.EverliveError("The interactive push configuration is incorrect: "+a)}):this._deviceRegistrationSuccess(a)},_failedRegistrationAPN:function(a){this._deviceRegistrationFailed(a)},_successSentRegistrationGCM:function(a){l.tnsPushPlugin.onMessageReceived(this.pushSettings.notificationCallbackAndroid),this._deviceRegistrationSuccess(a)},_errorSentRegistrationGCM:function(a){this._deviceRegistrationFailed(a)},notificationProcessed:function(){throw new Error("Not implemented")},_onNotificationAPN:function(a){this._raiseNotificationEventIOS(a)},_onNotificationGCM:function(a){switch(a.event){case"registered":a.regid.length>0&&this._deviceRegistrationSuccess(a.regid);break;case"message":this._raiseNotificationEventAndroid(a);break;case"error":this.pushToken?this._raiseNotificationEventAndroid(a):this._deviceRegistrationFailed(a);break;default:this._raiseNotificationEventAndroid(a)}},_raiseNotificationEventAndroid:function(a){this.pushSettings.notificationCallbackAndroid&&this.pushSettings.notificationCallbackAndroid(a)},_raiseNotificationEventIOS:function(a){this.pushSettings.notificationCallbackIOS&&this.pushSettings.notificationCallbackIOS(a)}},a}()},{"../../everlive/EverliveError":58,"../../everlive/constants":70,"../../everlive/utils":121,jstimezonedetect:12,platform:"platform",underscore:36}],94:[function(a,b){"use strict";function c(a){return a&&a.__esModule?a:{"default":a}}var d=a("underscore"),e=c(d),f=a("../../everlive/query/Query"),g=c(f),h=a("util"),i=c(h),j=a("../../everlive/EverliveError"),k=function(){g["default"].apply(this,arguments),this.aggregateExpression={GroupBy:[],Aggregate:{}};var a,b,c=arguments[6];c&&(a=c.GroupBy,b=c.Aggregate),this.aggregateExpression={GroupBy:a||[],Aggregate:b||{}}};i["default"].inherits(k,g["default"]),k.prototype._aggregateFunc=function(a,b,c){if("string"!=typeof b&&"count"!==a)throw new j.EverliveError(a+"() accepts only string as parameter.");var d={};return d[a]=b,this.aggregateExpression.Aggregate[c||b]=d,this},k.prototype.groupBy=function(a){if(e["default"].isArray(a))Array.prototype.push.apply(this.aggregateExpression.GroupBy,a);else{if("string"!=typeof a)throw new j.EverliveError("groupBy() accepts only array or string as parameter.");this.aggregateExpression.GroupBy.push(a)}return this},k.prototype.avg=function(){return Array.prototype.unshift.call(arguments,"avg"),this._aggregateFunc.apply(this,arguments)},k.prototype.count=function(a){return this._aggregateFunc("count",null,a||"Count")},k.prototype.max=function(){return Array.prototype.unshift.call(arguments,"max"),this._aggregateFunc.apply(this,arguments)},k.prototype.min=function(){return Array.prototype.unshift.call(arguments,"min"),this._aggregateFunc.apply(this,arguments)},k.prototype.sum=function(){return Array.prototype.unshift.call(arguments,"sum"),this._aggregateFunc.apply(this,arguments)},k.prototype.select=void 0,k.prototype.skip=void 0,k.prototype.take=void 0,k.prototype.order=void 0,k.prototype.average=k.prototype.avg,b.exports=k},{"../../everlive/EverliveError":58,"../../everlive/query/Query":96,underscore:36,util:7}],95:[function(a,b){"use strict";function c(a){return a&&a.__esModule?a:{"default":a}}function d(a,b){var c=b.getQueryParameters();return a.filter=c.filter,a.fields=c.select,a.sort=c.sort,a.skip=c.skip,a.take=c.limit||c.take,a.expand=c.expand,a.aggregate=c.aggregate,c}function e(a,b){a.settings={useOffline:b.useOffline,applyOffline:b.applyOffline,ignoreCache:b.ignoreCache,forceCache:b.forceCache}}var f=a("../../everlive/constants"),g=c(f),h=function(){};h.fromDataQuery=function(a){var b=new h;if(b.contentTypeName=a.collectionName,a.additionalOptions&&a.additionalOptions.id)switch(a.operation){case g["default"].DataQueryOperations.Update:b.operation=g["default"].DataQueryOperations.UpdateById;break;case g["default"].DataQueryOperations.Delete:b.operation=g["default"].DataQueryOperations.DeleteById;break;default:b.operation=a.operation}else b.operation=a.operation;b.itemId=a.additionalOptions?a.additionalOptions.id:void 0,b.data=a.data,e(b,a),d(b,a),b.headers=a.getHeaders();var c=b.headers[g["default"].Headers.powerFields];return"string"==typeof c&&(b.powerfields=JSON.parse(c)),b.isSync=a.isSync,b},h.prototype={cancel:function(){this._cancelled=!0},isCancelled:function(){return this._cancelled}},b.exports=h},{"../../everlive/constants":70}],96:[function(a,b){"use strict";function c(a){return a&&a.__esModule?a:{"default":a}}function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function f(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var g=a("../../everlive/Expression"),h=c(g),i=a("../../everlive/constants"),j=a("../../everlive/query/WhereQuery"),k=c(j),l=a("../../everlive/query/QueryBuilder"),m=c(l),n=a("../../common/query/Query"),o=c(n),p=function(a){function b(c,f,g,j,k,l){d(this,b);var m=e(this,a.call(this));return m.filter=c,m.fields=f,m.sort=g,m.toskip=j,m.totake=k,m.expandExpression=l,m.expr=new h["default"](i.OperatorType.query),m}return f(b,a),b.prototype.where=function(a){return a?this._simple(i.OperatorType.filter,[a]):new k["default"](this)},b.prototype.select=function(){return this._simple(i.OperatorType.select,arguments)},b.prototype.order=function(a){return this._simple(i.OperatorType.order,[a])},b.prototype.orderDesc=function(a){return this._simple(i.OperatorType.order_desc,[a])},b.prototype.skip=function(a){return this._simple(i.OperatorType.skip,[a])},b.prototype.take=function(a){return this._simple(i.OperatorType.take,[a])},b.prototype.expand=function(a){return this._simple(i.OperatorType.expand,[a])},b.prototype.build=function(){return new m["default"](this).build()},b.prototype._simple=function(a,b){var c=[].slice.call(b);return this.expr.addOperand(new h["default"](a,c)),this},b}(o["default"]);b.exports=p},{"../../common/query/Query":53,"../../everlive/Expression":60,"../../everlive/constants":70,"../../everlive/query/QueryBuilder":97,"../../everlive/query/WhereQuery":99}],97:[function(a,b){"use strict";function c(a){return a&&a.__esModule?a:{"default":a}}var d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol?"symbol":typeof a},e=a("../../everlive/constants"),f=a("underscore"),g=c(f),h=a("../../everlive/GeoPoint"),i=c(h),j=a("../../everlive/EverliveError"),k=a("../../everlive/Expression"),l=c(k);b.exports=function(){function a(a){this.query=a,this.expr=a.expr}return a.prototype={build:function(){var a=this.query;return a.filter||a.fields||a.sort||a.toskip||a.totake||a.expandExpression?{$where:a.filter||null,$select:a.fields||null,$sort:a.sort||null,$skip:a.toskip||null,$take:a.totake||null,$expand:a.expandExpression||null,$aggregate:a.aggregateExpression||null}:{$where:this._buildWhere(),$select:this._buildSelect(),$sort:this._buildSort(),$skip:this._getSkip(),$take:this._getTake(),$expand:this._getExpand(),$aggregate:this._getAggregate()
}},_getSkip:function(){var a=g["default"].find(this.expr.operands,function(a){return a.operator===e.OperatorType.skip});return a?a.operands[0]:null},_getTake:function(){var a=g["default"].find(this.expr.operands,function(a){return a.operator===e.OperatorType.take});return a?a.operands[0]:null},_getExpand:function(){var a=g["default"].chain(this.expr.operands).filter(function(a){return a.operator===e.OperatorType.expand}).reduce(function(a,b){return g["default"].extend(a,b.operands[0])},{}).value();return g["default"].isEmpty(a)?null:a},_getAggregate:function(){if(!this.query.aggregateExpression)return null;var a=g["default"].extend({},this.query.aggregateExpression);return g["default"].isEmpty(a.GroupBy)&&delete a.GroupBy,g["default"].isEmpty(a.Aggregate)&&delete a.Aggregate,a},_buildSelect:function(){var a=g["default"].find(this.expr.operands,function(a){return a.operator===e.OperatorType.select}),b={};return a?(g["default"].reduce(a.operands,function(a,b){return a[b]=1,a},b),b):null},_buildSort:function(){var a=g["default"].filter(this.expr.operands,function(a){return a.operator===e.OperatorType.order||a.operator===e.OperatorType.order_desc}),b={};return a.length>0?(g["default"].reduce(a,function(a,b){return a[b.operands[0]]=b.operator===e.OperatorType.order?1:-1,a},b),b):null},_buildWhere:function(){var a=g["default"].find(this.expr.operands,function(a){return a.operator===e.OperatorType.where});if(a)return this._build(new l["default"](e.OperatorType.and,a.operands));var b=g["default"].find(this.expr.operands,function(a){return a.operator===e.OperatorType.filter});return b?b.operands[0]:null},_build:function(a){return this._isSimple(a)?this._simple(a):this._isRegex(a)?this._regex(a):this._isGeo(a)?this._geo(a):this._isAnd(a)?this._and(a):this._isOr(a)?this._or(a):this._isNot(a)?this._not(a):void 0},_isSimple:function(a){return a.operator>=e.OperatorType.equal&&a.operator<=e.OperatorType.size},_simple:function(a){var b={},c={},d=a.operands,e=this._translateoperator(a.operator);return e?b[e]=d[1]:b=d[1],c[d[0]]=b,c},_isRegex:function(a){return a.operator>=e.OperatorType.regex&&a.operator<=e.OperatorType.endsWith},_regex:function(a){var b={},c=this._getRegex(a),d=this._getRegexValue(c),e=a.operands;return b[e[0]]=d,b},_getRegex:function(a){var b=a.operands[1],c=a.operands[2]?a.operands[2]:"";switch(a.operator){case e.OperatorType.regex:return b instanceof RegExp?b:new RegExp(b,c);case e.OperatorType.startsWith:return new RegExp("^"+b,c);case e.OperatorType.endsWith:return new RegExp(b+"$",c);default:throw new j.EverliveError("Unknown operator type.")}},_getRegexValue:function(a){var b="";return a.global&&(b+="g"),a.multiline&&(b+="m"),a.ignoreCase&&(b+="i"),{$regex:a.source,$options:b}},_isGeo:function(a){return a.operator>=e.OperatorType.nearShpere&&a.operator<=e.OperatorType.withinShpere},_geo:function(a){var b={},c=a.operands;return b[c[0]]=this._getGeoTerm(a),b},_getGeoTerm:function(a){switch(a.operator){case e.OperatorType.nearShpere:return this._getNearSphereTerm(a);case e.OperatorType.withinBox:return this._getWithinBox(a);case e.OperatorType.withinPolygon:return this._getWithinPolygon(a);case e.OperatorType.withinShpere:return this._getWithinCenterSphere(a);default:throw new j.EverliveError("Unknown operator type.")}},_getNearSphereTerm:function(a){var b,c=a.operands,d=this._getGeoPoint(c[1]),f=c[2],g=c[3],h={$nearSphere:d};return"undefined"!=typeof f&&(b=e.maxDistanceConsts[g]||e.maxDistanceConsts.radians,h[b]=f),h},_getWithinBox:function(a){var b=a.operands,c=this._getGeoPoint(b[1]),d=this._getGeoPoint(b[2]);return{$within:{$box:[c,d]}}},_getWithinPolygon:function(a){var b=a.operands,c=this._getGeoPoints(b[1]);return{$within:{$polygon:c}}},_getWithinCenterSphere:function(a){var b=a.operands,c=this._getGeoPoint(b[1]),d=b[2],f=b[3],g=e.radiusConsts[f]||e.radiusConsts.radians,h={center:c};return h[g]=d,{$within:{$centerSphere:h}}},_getGeoPoint:function(a){return g["default"].isArray(a)?new i["default"](a[0],a[1]):a},_getGeoPoints:function(a){var b=this;return g["default"].map(a,function(a){return b._getGeoPoint(a)})},_isAnd:function(a){return a.operator===e.OperatorType.and},_and:function(a){var b,c,d,e={},f=a.operands;for(b=0,c=f.length;c>b;b++)d=this._build(f[b]),e=this._andAppend(e,d);return e},_andAppend:function(a,b){var c,e,f,h,i,j=g["default"].keys(b);for(c=0,e=j.length;e>c;c++)f=j[c],h=a[f],"undefined"==typeof h?a[f]=b[f]:(i=b[f],h="object"===("undefined"==typeof h?"undefined":d(h))&&"object"===("undefined"==typeof i?"undefined":d(i))?g["default"].extend(h,i):i,a[f]=h);return a},_isOr:function(a){return a.operator===e.OperatorType.or},_or:function(a){var b,c,d,e=[],f=a.operands;for(b=0,c=f.length;c>b;b++)d=this._build(f[b]),e.push(d);return{$or:e}},_isNot:function(a){return a.operator===e.OperatorType.not},_not:function(a){return{$not:this._build(a.operands[0])}},_translateoperator:function(a){switch(a){case e.OperatorType.equal:return null;case e.OperatorType.not_equal:return"$ne";case e.OperatorType.gt:return"$gt";case e.OperatorType.lt:return"$lt";case e.OperatorType.gte:return"$gte";case e.OperatorType.lte:return"$lte";case e.OperatorType.isin:return"$in";case e.OperatorType.notin:return"$nin";case e.OperatorType.all:return"$all";case e.OperatorType.size:return"$size"}throw new j.EverliveError("Unknown operator type.")}},a}()},{"../../everlive/EverliveError":58,"../../everlive/Expression":60,"../../everlive/GeoPoint":61,"../../everlive/constants":70,underscore:36}],98:[function(a,b){"use strict";function c(a){return a&&a.__esModule?a:{"default":a}}var d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol?"symbol":typeof a},e=a("underscore"),f=c(e),g=a("path"),h=c(g),i=a("../../everlive/constants"),j=a("../../everlive/Request"),k=c(j);b.exports=function(){function a(a){return b._build(a,a.additionalOptions)}var b={};return b._buildEndpointUrl=function(a){var b=a.collectionName,c=a.additionalOptions&&void 0!==a.additionalOptions.id,e=d(a.query);return c?b=h["default"].join(b,a.additionalOptions.id.toString()):("string"===e||"number"===e)&&(b=h["default"].join(b,a.query)),b},b._buildBaseObject=function(a){var c={endpoint:b._buildEndpointUrl(a),query:a.query,data:a.data,headers:a.headers};return a.parse&&(c.parse=a.parse),c},b._build=function(a,c){var d=f["default"].extend(b._buildBaseObject(a),c);return c.endpointSupplement&&(d.endpoint=h["default"].join(d.endpoint,c.endpointSupplement)),d},b[i.DataQueryOperations.Read]=function(a){return b._build(a,{method:"GET"})},b[i.DataQueryOperations.ReadById]=function(a){return b._build(a,{method:"GET"})},b[i.DataQueryOperations.Count]=function(a){return b._build(a,{method:"GET",endpoint:a.collectionName+"/_count"})},b[i.DataQueryOperations.Create]=function(a){return b._build(a,{method:"POST"})},b[i.DataQueryOperations.RawUpdate]=function(a){var c=a.query,e="object"===("undefined"==typeof c?"undefined":d(c))?c:null;return b._build(a,{method:"PUT",query:e})},b[i.DataQueryOperations.Update]=function(a){return b._build(a,{method:"PUT"})},b[i.DataQueryOperations.Delete]=function(a){return f["default"].extend(b._buildBaseObject(a),{method:"DELETE"})},b[i.DataQueryOperations.DeleteById]=b[i.DataQueryOperations.Delete],b[i.DataQueryOperations.SetAcl]=function(a){var c=void 0,d=void 0;return null===a.additionalOptions.acl?c="DELETE":(c="PUT",d=a.additionalOptions.acl),b._build(a,{method:c,endpointSupplement:"/_acl",data:d})},b[i.DataQueryOperations.SetOwner]=function(a){return b._build(a,{method:"PUT",endpointSupplement:"/_owner"})},b[i.DataQueryOperations.UserLogin]=function(a){return b._build(a,{method:"POST",endpoint:"oauth/token",authHeaders:!1,parse:k["default"].parsers.single})},b[i.DataQueryOperations.UserLogout]=function(a){return b._build(a,{method:"GET",endpoint:"oauth/logout"})},b[i.DataQueryOperations.UserChangePassword]=function(a){var c=a.additionalOptions.keepTokens,d="Users/changepassword";return c&&(d+="?keepTokens=true"),b._build(a,{method:"POST",endpoint:d,parse:k["default"].parsers.single})},b[i.DataQueryOperations.UserLoginWithProvider]=function(a){return b._build(a,{method:"POST",authHeaders:!1})},b[i.DataQueryOperations.UserLinkWithProvider]=function(a){return b._build(a,{method:"POST",endpoint:b._buildEndpointUrl(a)+"/link"})},b[i.DataQueryOperations.UserUnlinkFromProvider]=function(a){return b._build(a,{method:"POST",endpoint:b._buildEndpointUrl(a)+"/unlink"})},b[i.DataQueryOperations.UserResetPassword]=function(a){return b._build(a,{method:"POST",endpoint:b._buildEndpointUrl(a)+"/resetpassword"})},b[i.DataQueryOperations.UserSetPassword]=function(a){return b._build(a,{method:"POST",endpoint:b._buildEndpointUrl(a)+"/setpassword"})},b[i.DataQueryOperations.FilesUpdateContent]=function(a){return b._build(a,{method:"PUT",endpoint:b._buildEndpointUrl(a)+"/Content"})},b[i.DataQueryOperations.FilesGetDownloadUrlById]=function(a){return b._build(a,{method:"GET"})},b[i.DataQueryOperations.Aggregate]=function(a){return b._build(a,{method:"GET",endpoint:a.collectionName+"/_aggregate"})},b[i.DataQueryOperations.InvokeCloudFunction]=a,b[i.DataQueryOperations.InvokeStoredProcedure]=a,b}()},{"../../everlive/Request":63,"../../everlive/constants":70,path:4,underscore:36}],99:[function(a,b){"use strict";function c(a){return a&&a.__esModule?a:{"default":a}}var d=a("../../everlive/Expression"),e=c(d),f=a("../../everlive/constants");b.exports=function(){function a(a,b,c){this.parent=a,this.single=c,this.expr=new e["default"](b||f.OperatorType.where),this.parent.expr.addOperand(this.expr)}return a.prototype={and:function(){return new a(this,f.OperatorType.and)},or:function(){return new a(this,f.OperatorType.or)},not:function(){return new a(this,f.OperatorType.not,!0)},_simple:function(a){var b=[].slice.call(arguments,1);return this.expr.addOperand(new e["default"](a,b)),this._done()},eq:function(a,b){return this._simple(f.OperatorType.equal,a,b)},ne:function(a,b){return this._simple(f.OperatorType.not_equal,a,b)},gt:function(a,b){return this._simple(f.OperatorType.gt,a,b)},gte:function(a,b){return this._simple(f.OperatorType.gte,a,b)},lt:function(a,b){return this._simple(f.OperatorType.lt,a,b)},lte:function(a,b){return this._simple(f.OperatorType.lte,a,b)},isin:function(a,b){return this._simple(f.OperatorType.isin,a,b)},notin:function(a,b){return this._simple(f.OperatorType.notin,a,b)},all:function(a,b){return this._simple(f.OperatorType.all,a,b)},size:function(a,b){return this._simple(f.OperatorType.size,a,b)},regex:function(a,b,c){return this._simple(f.OperatorType.regex,a,b,c)},startsWith:function(a,b,c){return this._simple(f.OperatorType.startsWith,a,b,c)},endsWith:function(a,b,c){return this._simple(f.OperatorType.endsWith,a,b,c)},nearSphere:function(a,b,c,d){return this._simple(f.OperatorType.nearShpere,a,b,c,d)},withinBox:function(a,b,c){return this._simple(f.OperatorType.withinBox,a,b,c)},withinPolygon:function(a,b){return this._simple(f.OperatorType.withinPolygon,a,b)},withinCenterSphere:function(a,b,c,d){return this._simple(f.OperatorType.withinShpere,a,b,c,d)},done:function(){return this.parent instanceof a?this.parent._done():this.parent},_done:function(){return this.single?this.parent:this}},a.prototype.equal=a.prototype.eq,a.prototype.notEqual=a.prototype.ne,a.prototype.greaterThan=a.prototype.gt,a.prototype.greaterThanEqual=a.prototype.gte,a.prototype.lessThan=a.prototype.lt,a.prototype.lessThanEqual=a.prototype.lte,a}()},{"../../everlive/Expression":60,"../../everlive/constants":70}],100:[function(a,b){"use strict";function c(a){return a&&a.__esModule?a:{"default":a}}var d=a("../common/platform"),e=c(d);b.exports=function(){var b=e["default"].isNativeScript,c=e["default"].isNodejs,d=void 0;return c||b?b?d=a("./reqwest.nativescript"):c&&(d=a("./reqwest.nodejs")):d=a("reqwest"),d}()},{"../common/platform":51,"./reqwest.nativescript":101,"./reqwest.nodejs":102,reqwest:34}],101:[function(a,b){"use strict";function c(a){return a&&a.__esModule?a:{"default":a}}var d=a("rsvp"),e=c(d),f=a("../everlive/constants"),g=c(f),h=a("http");b.exports=function(){function a(a){var b={url:a.url,method:a.method,headers:a.headers||{}};return a.data&&(b.content=a.data),b.headers[g["default"].Headers.ContentType]=b.contentType||"application/json",new e["default"].Promise(function(a,c){return h.request(b).then(function(b){var d=b.content.toString(),e=JSON.parse(d);b.statusCode<400?a(e):c(d)},function(a){c(a)})})}return a}()},{"../everlive/constants":70,http:"http",rsvp:35}],102:[function(a,b){(function(c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}var e=a("rsvp"),f=d(e),g=a("../everlive/constants"),h=d(g),i=a("url"),j=a("http"),k=a("https"),l=a("zlib");b.exports=function(){function a(a){var b=i.parse(a.url),d=void 0;d="https:"===b.protocol?k.request:j.request;var e=a.headers||{};return e[h["default"].Headers.ContentType]=a.contentType,new f["default"].Promise(function(f,g){var h=d({method:a.method,hostname:b.hostname,port:b.port,path:b.path,headers:e},function(a){var b="",c=a.headers["content-encoding"],d=void 0;switch(c){case"gzip":d=l.createGunzip(),a.pipe(d);break;default:d=a,d.setEncoding("utf8")}d.on("data",function(a){b+=a.toString()}),d.on("end",function(){if(200<=a.statusCode&&a.statusCode<400){var c=JSON.parse(b);f(c)}else if(b)g(b);else{var d=new Error("Response error.");d.statusCode=a.statusCode,g(d)}})});if(h.on("error",function(a){g({responseText:a})}),a.data){var i=e["content-encoding"];switch(i){case"gzip":var j=new c(a.data,"utf-8");l.gzip(j,function(a,b){h.end(b)});break;default:h.end(a.data)}}else h.end()})}return a}()}).call(this,a("buffer").Buffer)},{"../everlive/constants":70,buffer:"buffer",http:"http",https:"https",rsvp:35,url:"url",zlib:"zlib"}],103:[function(a,b){"use strict";function c(a){return a&&a.__esModule?a:{"default":a}}function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var e=a("../../everlive/constants"),f=a("../../everlive/Request"),g=c(f),h=function(){function a(){d(this,a)}return a.prototype.processDataQuery=function(a,b,c,d){if(a.operation===e.DataQueryOperations.InvokeCloudFunction||a.operation===e.DataQueryOperations.InvokeStoredProcedure)return b.next(d);var f=null;switch(a.operation){case e.DataQueryOperations.ReadById:case e.DataQueryOperations.Aggregate:case e.DataQueryOperations.Count:case e.DataQueryOperations.Create:case e.DataQueryOperations.SetAcl:case e.DataQueryOperations.FilesGetDownloadUrlById:case e.DataQueryOperations.UserLinkWithProvider:case e.DataQueryOperations.UserUnlinkFromProvider:f=g["default"].parsers.single;break;case e.DataQueryOperations.RawUpdate:case e.DataQueryOperations.Update:f=g["default"].parsers.update;break;default:f=a.isCustomRequest?g["default"].parsers.customRequest:g["default"].parsers.simple}var h=f.result(d);return b.next(h)},a}();b.exports=h},{"../../everlive/Request":63,"../../everlive/constants":70}],104:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=a("../../everlive/constants"),f=a("underscore"),g=function(){function a(){d(this,a)}return a.prototype.mergeResultData=function(a,b){var c=b.result;return f.isArray(a)||"number"==typeof a.length?f.each(a,function(a,b){f.extend(a,c[b])}):f.extend(a,c),b},a.prototype.mergeUpdateResultData=function(a,b){var c=b.ModifiedAt;return a.ModifiedAt=c,b},a.prototype.processDataQuery=function(a,b,c,d){var f=null;switch(a.operation){case e.DataQueryOperations.Update:f=this.mergeUpdateResultData(a.data,d);break;case e.DataQueryOperations.Create:f=this.mergeResultData(a.data,d);break;case e.DataQueryOperations.FilesGetDownloadUrlById:f=d.result.Uri;break;default:f=d}return b.next(f)},a}();c["default"]=g},{"../../everlive/constants":70,underscore:36}],105:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}Object.defineProperty(c,"__esModule",{value:!0}),c.RequestService=void 0;{var e=a("rsvp"),f=d(e),g=a("../../everlive/Request"),h=d(g),i=a("../../everlive/utils"),j=a("../../everlive/query/RequestOptionsBuilder"),k=d(j),l=a("../../everlive/EverliveError");c.RequestService={buildRequest:function(a,b){var c=k["default"][a.operation],d=c(a);return b._setAdditionalHeaders(a,d),new h["default"](b.sdk.setup,d)},handleRequestProcessing:function(a,b){var c=arguments.length<=2||void 0===arguments[2]?this.buildRequest(a,b):arguments[2];return new f["default"].Promise(function(d,e){var f=void 0;c.send().then(function(c){return f=c,a.applyOffline?b._applyOffline(a,f):f},function(a){e(a)}).then(function(){d(f)},function(b){var c=l.EverliveErrors.operationNotSupportedOffline.code,g=l.EverliveErrors.itemNotFound.code,h=!a.canUseOffline||!a.useCache;!h||b.code!==c&&b.code!==g?e(b):d(f)})})},sendRequest:function(a){return new f["default"].Promise(function(b,c){a.send().then(function(a){var c=a.Result||a,d=i.parseUtilities.getReviver();i.parseUtilities.parseResult(d,c),b(c)},function(a){c(a)})})}}}},{"../../everlive/EverliveError":58,"../../everlive/Request":63,"../../everlive/query/RequestOptionsBuilder":98,"../../everlive/utils":121,rsvp:35}],106:[function(a,b){"use strict";function c(a){return a&&a.__esModule?a:{"default":a}}var d=a("../../everlive/everlive.platform"),e=c(d),f=a("../../everlive/storages/WebFileStore"),g=c(f),h=a("../../everlive/storages/NativeScriptFileStore"),i=c(h),j=a("underscore"),k=c(j);b.exports=e["default"].isNativeScript?i["default"]:e["default"].isCordova||e["default"].isDesktop?g["default"]:k["default"].noop},{"../../everlive/everlive.platform":74,"../../everlive/storages/NativeScriptFileStore":108,"../../everlive/storages/WebFileStore":109,underscore:36}],107:[function(a,b){"use strict";var c=a("../../everlive/everlive.platform");b.exports=function(){function b(b){if(c.isNativeScript){var d;try{d=a("application-settings")}catch(e){d=a("local-settings")}return{getItem:function(a){return d.getString(a)},removeItem:function(a){return d.remove(a)},setItem:function(a,b){return d.setString(a,b)}}}var f;if(c.isNodejs){var g=a("node-localstorage").LocalStorage;f=new g(b.storage.storagePath)}else f=window.localStorage;return{getItem:function(a){return f.getItem(a)},removeItem:function(a){return f.removeItem(a)},setItem:function(a,b){return f.setItem(a,b)}}}function d(a){this.options=a,this._localStorage=b(this.options)}return d.prototype={getItem:function(a){return this._localStorage.getItem(a)},removeItem:function(a){return this._localStorage.removeItem(a)},setItem:function(a,b){return this._localStorage.setItem(a,b)}},d}()},{"../../everlive/everlive.platform":74,"application-settings":"application-settings","local-settings":"local-settings","node-localstorage":"node-localstorage"}],108:[function(a,b){"use strict";function c(a){return a&&a.__esModule?a:{"default":a}}function d(b,c){this.options=c,this.fs=a("file-system"),this.dataDirectoryPath=this.fs.knownFolders.documents().path,this.filesDirectoryPath=this.fs.path.join(this.dataDirectoryPath,b)}var e=a("rsvp"),f=c(e);d.prototype={getErrorHandler:function(a){return function(b){a&&a(b)}},removeFilesDirectory:function(){var a=this;return a.getFilesDirectory().then(function(a){return a.remove()})},removeFile:function(a){return a.remove()},readFileAsText:function(a){return a.readText()},writeTextToFile:function(a,b){return a.writeText(b)},getFile:function(a){var b=this;return new f["default"].Promise(function(c,d){b.resolveDataDirectory().then(function(d){var e=b.fs.path.join(d.path,a),f=b.fs.File.fromPath(e);c(f)})["catch"](d)})},getFilesDirectory:function(){var a=this;return new f["default"].Promise(function(b){var c=a.fs.Folder.fromPath(a.filesDirectoryPath);b(c)})},resolveDataDirectory:function(){var a=this;return new f["default"].Promise(function(b){var c=a.fs.Folder.fromPath(a.dataDirectoryPath);b(c)})},ensureFilesDirectory:function(){var a=this;return new f["default"].Promise(function(b,c){a.resolveDataDirectory().then(function(c){var d=a.fs.path.join(c.path,a.filesDirectoryPath);a.fs.Folder.fromPath(d),b()})["catch"](c)})},getFilesDirectoryPath:function(){return this.filesDirectoryPath},writeText:function(){throw new Error("Not implemented")},createDirectory:function(){throw new Error("Not implemented")},getFileSize:function(){throw new Error("Not implemented")},getFileByAbsolutePath:function(){throw new Error("Not implemented")},readFileAsBase64:function(){throw new Error("Not implemented")},renameFile:function(){throw new Error("Not implemented")}},b.exports=d},{"file-system":"file-system",rsvp:35}],109:[function(a,b){"use strict";function c(a){return a&&a.__esModule?a:{"default":a}}function d(a,b){this.options=b;var c;n["default"].isWindowsPhone||n["default"].isInAppBuilderSimulator()?c=a.replace(new RegExp("/","g"),""):-1===a.lastIndexOf("/")&&(c=a+"/"),c=c||a;var d=this;o().then(function(){d.filesDirectoryPath=c,d._requestFileSystem=window.requestFileSystem||window.webkitRequestFileSystem,d._resolveLocalFileSystemURL=window.resolveLocalFileSystemURL||window.webkitResolveLocalFileSystemURL,d._PERSISTENT_FILE_SYSTEM=window.LocalFileSystem?window.LocalFileSystem.PERSISTENT:window.PERSISTENT})}var e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol?"symbol":typeof a},f=a("../../everlive/EverliveError"),g=a("rsvp"),h=c(g),i=a("underscore"),j=c(i),k=a("../../everlive/utils"),l=c(k),m=a("../../everlive/everlive.platform"),n=c(m),o=function(){return new h["default"].Promise(function(a){document.addEventListener("deviceready",a)})};d.prototype={getErrorHandler:function(a){var b={1000:"NOT_FOUND"};return j["default"].each(Object.keys(FileError),function(a){b[FileError[a]]=a}),function(c){c.message||(c.message=b[c.code]),a&&a(c)}},getDataDirectory:function(){var a;return function(){var b=this;return o().then(function(){var c=function(c,d,e){b._requestFileSystem.call(window,b._PERSISTENT_FILE_SYSTEM,c,function(b){a=b.root,a.nativeURL=a.nativeURL||a.toURL(),d(a)},e)};return new h["default"].Promise(function(d,e){if(a)return d(a);if(n["default"].isDesktop){if(navigator&&!navigator.webkitPersistentStorage)return e(new f.EverliveError("FileSystemStorage can be used only with browsers supporting it. Consider using localStorage."));navigator.webkitPersistentStorage.requestQuota(b.options.storage.requestedQuota,function(a){c(a,d,e)},e)}else c(0,d,e)})})}}(),getFilesDirectory:function(){var a=this;return new h["default"].Promise(function(b,c){a.getDataDirectory().then(function(d){d.getDirectory(a.filesDirectoryPath,{create:!0,exclusive:!1},b,c)})["catch"](c)})},removeFilesDirectory:function(){var a=this;return this.getFilesDirectory().then(function(b){return a._removeFolderWrap(b)})},removeFile:function(a){return new h["default"].Promise(function(b,c){a.remove(function(){b()},c)})},readFileAsText:function(a){var b=this;return new h["default"].Promise(function(c,d){b.getFilesDirectory().then(function(){a.file(function(a){var b=new FileReader;b.onloadend=function(){var a=this.result;"object"===e(this.result)&&(a=JSON.stringify(this.result)),c(a)},b.onerror=d,b.readAsText(a)},d)})["catch"](d)})},writeTextToFile:function(a,b){var c=this;return c.getFilesDirectory().then(function(){return c._getWriterWrap(a,b)})},getFileSize:function(a,b){var c=this;return new h["default"].Promise(function(d,e){var f=l["default"].joinPath(b,a);return c.getFile(f).then(function(a){a.file(function(a){d(a.size)},e)})})},getFile:function(a,b){return this.getFilesDirectory().then(function(c){var d;return d=b?b:c,new h["default"].Promise(function(b,c){d.getFile(a,{create:!0,exclusive:!1},b,c)})})},getFileByAbsolutePath:function(a){var b=this;return a=l["default"].transformPlatformPath(a),new h["default"].Promise(function(c,d){b._resolveLocalFileSystemURL.call(window,a,c,function(a){return a&&a.code===FileError.NOT_FOUND_ERR?c():d(a)})})},createDirectory:function(a){var b=this;return this.getFilesDirectory().then(function(c){return b._getDirectoryWrap(a,c,{create:!0,exclusive:!1})})},renameFile:function(a,b,c){return new h["default"].Promise(function(d,e){b.moveTo(a,c,d,e)})},_getDirectoryWrap:function(a,b,c){return new h["default"].Promise(function(d,e){b.getDirectory(a,c,d,e)})},_removeFolderWrap:function(a){return new h["default"].Promise(function(b,c){a.removeRecursively(function(){b()},c)})},_getWriterWrap:function(a,b){return new h["default"].Promise(function(c,d){a.createWriter(function(a){a.onwriteend=function(){c()},a.onerror=d;var e=new Blob([b]);a.write(e)},d)})},writeText:function(a,b,c){var d,e=this;return this.getFilesDirectory().then(function(a){return c?e.createDirectory(c):a}).then(function(b){return e.getFile(a,b)}).then(function(a){return d=a,e.writeTextToFile(a,b)}).then(function(){return d.nativeURL||d.toURL()})},readFileAsBase64:function(a){return new h["default"].Promise(function(b,c){a.file(function(a){var c=new FileReader;c.onloadend=function(a){b(l["default"].arrayBufferToBase64(a.target.result))},c.readAsArrayBuffer(a)},c)})}},b.exports=d},{"../../everlive/EverliveError":58,"../../everlive/everlive.platform":74,"../../everlive/utils":121,rsvp:35,underscore:36}],110:[function(a,b){"use strict";function c(a){return a&&a.__esModule?a:{"default":a}}function d(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol?"symbol":typeof a},i=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),j=a("../../everlive/utils"),k=c(j),l=a("../../everlive/constants"),m=c(l),n=a("../../everlive/dataQuery/DataQuery"),o=c(n),p=a("rsvp"),q=c(p),r=a("../../everlive/EverliveError"),s=a("../../everlive/everlive.platform"),t=a("underscore"),u=c(t),v=a("../../everlive/query/Query"),w=c(v),x=a("../../common/Data"),y=c(x);b.exports=function(){var a=function(a){function b(c,d){e(this,b);var g=f(this,a.call(this,c,d));return g.collectionName=d,g.setup=g.sdk.setup,g.options=null,g}return g(b,a),b.prototype._isOnline=function(){return this.offlineStorage?this.offlineStorage.isOnline():!0},b.prototype._getOfflineCreateData=function(a,b){var c;if(u["default"].isArray(a.data)){c=[];for(var d=0;d<a.data.length;d++){var e=u["default"].extend(a.data[d],b.Result[d]);c.push(e)}}else c=u["default"].extend(a.data,b.Result);return c},b.prototype._applyOffline=function(a,b){var c=this.offlineStorage&&this.offlineStorage.setup.autoSync;if(c)switch(a.operation){case l.DataQueryOperations.Read:case l.DataQueryOperations.ReadById:case l.DataQueryOperations.FilesGetDownloadUrlById:var d=new o["default"](u["default"].defaults({data:b.Result,isSync:!0,operation:l.DataQueryOperations.Create},a));return this.offlineStorage.processQuery(d);case l.DataQueryOperations.Create:var e=this._getOfflineCreateData(a,b),f=new o["default"](u["default"].defaults({data:e,isSync:!0},a));return this.offlineStorage.processQuery(f);case l.DataQueryOperations.Update:case l.DataQueryOperations.RawUpdate:return a.isSync=!0,a.ModifiedAt=b.ModifiedAt,this.offlineStorage.processQuery(a);default:return a.isSync=!0,this.offlineStorage.processQuery(a)}return new q["default"].Promise(function(a){a()})},b.prototype._setOption=function(a,b){return this.options=this.options||{},this.options[a]=u["default"].isObject(b)?u["default"].extend({},this.options[a],b):b,this},b.prototype._generateQueryFromFilter=function(a){return a instanceof w["default"]?a:new w["default"](a)},b.prototype.useOffline=function(a){if(1!==arguments.length){var b=r.EverliveErrorHelper.buildSingleValueExpectedErrorMessage("useOffline()");throw new r.EverliveError(b,r.EverliveErrors.singleValueExpected.code)}return this._setOption("useOffline",a)},b.prototype.ignoreCache=function(){return this._setOption("ignoreCache",!0)},b.prototype.forceCache=function(){return this._setOption("forceCache",!0)},b.prototype.maxAge=function c(a){var c=1e3*a*60;return this._setOption("maxAge",c)},b.prototype.isSync=function(a){if(1!==arguments.length){var b=r.EverliveErrorHelper.buildSingleValueExpectedErrorMessage("isSync()");throw new r.EverliveError(b,r.EverliveErrors.singleValueExpected.code)}return this._setOption("isSync",a)},b.prototype.skipAuth=function(a){if(1!==arguments.length){var b=r.EverliveErrorHelper.buildSingleValueExpectedErrorMessage("skipAuth()");throw new r.EverliveError(b,r.EverliveErrors.singleValueExpected.code)}return this._setOption("skipAuth",a)},b.prototype.applyOffline=function(a){if(1!==arguments.length){var b=r.EverliveErrorHelper.buildSingleValueExpectedErrorMessage("applyOffline()");throw new r.EverliveError(b,r.EverliveErrors.singleValueExpected.code)}return this._setOption("applyOffline",a)},b.prototype.withHeaders=function(a){return this._setOption("headers",a)},b.prototype.expand=function(a){var b={"X-Everlive-Expand":JSON.stringify(a)};return this.withHeaders(b)},b.prototype._applyQueryOffline=function(){},b.prototype._sendRequest=function(){},b.prototype._applyQueryOnline=function(a){a.useCache?this.sdk.cache._cacheDataQuery(a):this._sendRequest(a,!0)},b.prototype._setAdditionalHeaders=function(a,b){a.isSync&&(b.headers[m["default"].Headers.sync]=!0);var c={sdk:"js",platform:s.platform};b.headers[m["default"].Headers.sdk]=JSON.stringify(c)},b.prototype.buildDataQuery=function(b,c,d,e){var f=this.collectionName;return a.prototype.buildDataQuery.call(this,b,c,{collectionName:f},d,e)},b.prototype.get=function(a,b,c){var d=this.buildDataQuery(a,l.DataQueryOperations.Read);return this.processDataQuery(d,b,c)},b.prototype.getById=function(a,b,c){if(!k["default"].modelHasValidId(a))return this._invalidIdErrorResponse(c);var d=this.buildDataQuery({additionalOptions:{id:a}},l.DataQueryOperations.ReadById);return this.processDataQuery(d,b,c)},b.prototype.aggregate=function(a,b,c){var d=this.buildDataQuery(a,l.DataQueryOperations.Aggregate);return this.processDataQuery(d,b,c)},b.prototype.count=function(a,b,c){var d=this.buildDataQuery(a,l.DataQueryOperations.Count);return this.processDataQuery(d,b,c)},b.prototype.create=function(a,b,c){var d=this.buildDataQuery(a,l.DataQueryOperations.Create);return this.processDataQuery(d,b,c)},b.prototype.rawUpdate=function(a,b,c,d){var e=this,f="string"==typeof b||"number"==typeof b;if(f&&!k["default"].modelHasValidId(b))return e._invalidIdErrorResponse(d);var g=f?b:this.sdk.dataQueryBuilder._buildQuery(b),h={id:f?b:void 0},i=this.buildDataQuery({query:g,additionalOptions:h,updateObject:a},l.DataQueryOperations.RawUpdate);return this.processDataQuery(i,c,d)},b.prototype._update=function(a,b,c,e,f,g){var h=this.buildDataQuery({updateObject:d({},e?"$replace":"$set",a),additionalOptions:{id:c?a[l.idField]:void 0},query:b},l.DataQueryOperations.Update);return this.processDataQuery(h,f,g)},b.prototype.updateSingle=function(a,b,c){return k["default"].modelHasValidId(a)?this._update(a,null,!0,!1,b,c):this._invalidIdErrorResponse(c)},b.prototype._invalidIdErrorResponse=function(a){var b=new r.EverliveError(r.EverliveErrors.invalidId);return k["default"].callbackAndPromiseErrorResponse(b,a);

},b.prototype.update=function(a,b,c,d){return this._update(a,b,!1,!1,c,d)},b.prototype._destroy=function(a,b,c,d,e){var f=c?l.DataQueryOperations.DeleteById:l.DataQueryOperations.Delete,g=a&&"object"===("undefined"==typeof a?"undefined":h(a))?a[m["default"].idField]:a,i=this.buildDataQuery({additionalOptions:{id:c?g:void 0},query:b},f);return this.processDataQuery(i,d,e)},b.prototype.destroySingle=function(a,b,c){return k["default"].modelHasValidId(a)?this._destroy(a,null,!0,b,c):this._invalidIdErrorResponse(c)},b.prototype.destroy=function(a,b,c){return this._destroy(null,a,!1,b,c)},b.prototype.setAcl=function(a,b,c,d){var e=this;if(!k["default"].modelHasValidId(b))return e._invalidIdErrorResponse(d);var f={acl:a},g={additionalOptions:f};f.id=b[l.idField]||b;var h=this.buildDataQuery(g,l.DataQueryOperations.SetAcl);return this.processDataQuery(h,c,d)},b.prototype.setOwner=function(a,b,c,d){if(!k["default"].modelHasValidId(b))return this._invalidIdErrorResponse(d);var e={updateObject:{Owner:a},additionalOptions:{}};e.additionalOptions.id=b[l.idField]||b;var f=this.buildDataQuery(e,l.DataQueryOperations.SetOwner);return this.processDataQuery(f,c,d)},b.prototype.save=function(a,b,c){var d=this;return j.buildPromise(function(b,c){var e=d.isNew(a),f=void 0;f=e?d.create(a):d.updateSingle(a);var g=e?"create":"update";f.then(function(a){a.type=g,b(a)})["catch"](function(a){a.type=g,c(a)})},b,c)},b.prototype.isNew=function(a){return"undefined"==typeof a[l.idField]},i(b,[{key:"offlineStorage",get:function(){return this.sdk.offlineStorage}}]),b}(y["default"]);return a}()},{"../../common/Data":37,"../../everlive/EverliveError":58,"../../everlive/constants":70,"../../everlive/dataQuery/DataQuery":71,"../../everlive/everlive.platform":74,"../../everlive/query/Query":96,"../../everlive/utils":121,rsvp:35,underscore:36}],111:[function(a,b){"use strict";function c(a){return a&&a.__esModule?a:{"default":a}}function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function f(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var g=a("../../everlive/utils"),h=a("../../everlive/everlive.platform"),i=c(h),j=a("../../everlive/types/Data"),k=c(j),l=a("../../everlive/constants"),m=function(a){function b(c){return d(this,b),e(this,a.call(this,c,"Files"))}return f(b,a),b.prototype.getUploadUrl=function(){return g.buildUrl(this.setup)+this.collectionName},b.prototype.getDownloadUrl=function(a){return g.buildUrl(this.setup)+this.collectionName+"/"+a+"/Download"},b.prototype.getUpdateUrl=function(a){return g.buildUrl(this.setup)+this._getUpdateUrl(a)},b.prototype.updateContent=function(a,b,c,d){var e=b,f={id:a},g=this.buildDataQuery({data:e,additionalOptions:f},l.DataQueryOperations.FilesUpdateContent);return this.processDataQuery(g,c,d)},b.prototype.getDownloadUrlById=function(a,b,c){if(i["default"].isDesktop&&!this.sdk.isOnline()){var d=this.getDownloadUrl(a);return g.buildPromise(function(a){return a(d)},b)}var e={id:a},f=this.buildDataQuery({additionalOptions:e},l.DataQueryOperations.FilesGetDownloadUrlById);return this.processDataQuery(f,b,c)},b.prototype.download=function(a,b,c,d,e,f){var h=this;return g.buildPromise(function(e,f){d||(d=!1);var g=c&&c.headers?c.headers:{},i=new FileTransfer;h.withHeaders(g).getById(a).then(function(g){var h=g.result;a=h.Uri,i.download(a,b,e,f,d,c)},f)},e,f)},b.prototype.upload=function(a,b,c,d,e){var f=this.getUploadUrl();return g.buildPromise(function(d,e){c||(c=!1);var g=new FileTransfer,h=encodeURI(f);g.upload(a,h,d,e,b,c)},d,e)},b.prototype._getUpdateUrl=function(a){return this.collectionName+"/"+a+"/Content"},b}(k["default"]);b.exports=m},{"../../everlive/constants":70,"../../everlive/everlive.platform":74,"../../everlive/types/Data":110,"../../everlive/utils":121}],112:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(c,"__esModule",{value:!0});var h=a("../../everlive/utils"),i=a("underscore"),j=d(i),k=a("../../everlive/EverliveError"),l=a("../../everlive/types/Data"),m=d(l),n=a("../../everlive/constants"),o=function(a){function b(c){return e(this,b),f(this,a.call(this,c,"Users"))}return g(b,a),b.prototype.register=function(a,b,c,d,e){h.guardUnset(a,"username"),h.guardUnset(b,"password");var f=j["default"].extend({Username:a,Password:b},c);return this.create(f,d,e)},b.prototype.currentUser=function(a,b){var c=this,d=this.sdk._isOfflineStorageEnabled()&&this.sdk.isOffline()?this.sdk.setup.principalId:"me";return h.buildPromise(function(a,b){return("me"!==d||c.sdk.setup.token||c.sdk.setup.masterKey)&&d?void c.getById(d).then(function(b){a("undefined"!=typeof b.result?{result:b.result}:{result:null})},function(d){c.sdk.authentication&&c.sdk.authentication.isAuthenticationInProgress()?a({result:null}):601===d.code?a({result:null}):b(801===d.code?new k.EverliveError(k.EverliveErrors.invalidToken):d)}):a({result:null})},a,b)},b.prototype.changePassword=function(a,b,c,d,e,f){var g=this,i={Username:a,Password:b,NewPassword:c},j={keepTokens:d},k=this.buildDataQuery({data:i,additionalOptions:j},n.DataQueryOperations.UserChangePassword);return h.buildPromise(function(a,b){return g.processDataQuery(k).then(function(b){return b&&b.result&&(d||g.clearAuthorization()),a(b)})["catch"](b)},e,f)},b.prototype.login=function(a,b,c,d){return this.sdk.authentication.login(a,b,c,d)},b.prototype.logout=function(a,b){return this.sdk.authentication.logout(a,b)},b.prototype.loginWithFacebook=function(a,b,c){return this.sdk.authentication.loginWithFacebook(a,b,c)},b.prototype.linkWithFacebook=function(a,b,c,d){var e={Provider:"Facebook",Token:b};return this._linkWithProvider(e,a,c,d)},b.prototype.unlinkFromFacebook=function(a,b,c){return this._unlinkFromProvider("Facebook",a,b,c)},b.prototype.loginWithADFS=function(a,b,c){return this.sdk.authentication.loginWithADFS(a,b,c)},b.prototype.linkWithADFS=function(a,b,c,d){var e={Provider:"ADFS",Token:b};return this._linkWithProvider(e,a,c,d)},b.prototype.unlinkFromADFS=function(a,b,c){return this._unlinkFromProvider("ADFS",a,b,c)},b.prototype.loginWithLiveID=function(a,b,c){return this.sdk.authentication.loginWithLiveID(a,b,c)},b.prototype.linkWithLiveID=function(a,b,c,d){var e={Provider:"LiveID",Token:b};return this._linkWithProvider(e,a,c,d)},b.prototype.unlinkFromLiveID=function(a,b,c){return this._unlinkFromProvider("LiveID",a,b,c)},b.prototype.loginWithGoogle=function(a,b,c){return this.sdk.authentication.loginWithGoogle(a,b,c)},b.prototype.linkWithGoogle=function(a,b,c,d){var e={Provider:"Google",Token:b};return this._linkWithProvider(e,a,c,d)},b.prototype.unlinkFromGoogle=function(a,b,c){return this._unlinkFromProvider("Google",a,b,c)},b.prototype.loginWithTwitter=function(a,b,c,d){return this.sdk.authentication.loginWithTwitter(a,b,c,d)},b.prototype.linkWithTwitter=function(a,b,c,d,e){var f={Provider:"Twitter",Token:b,TokenSecret:c};return this._linkWithProvider(f,a,d,e)},b.prototype.unlinkFromTwitter=function(a,b,c){return this._unlinkFromProvider("Twitter",a,b,c)},b.prototype.setAuthorization=function(a,b,c){this.sdk.authentication.setAuthorization(a,b,c)},b.prototype.clearAuthorization=function(){this.sdk.authentication.setAuthorization(null,null,null)},b.prototype.resetPassword=function(a,b,c){var d=this.buildDataQuery(a,n.DataQueryOperations.UserResetPassword);return this.processDataQuery(d,b,c)},b.prototype.setPassword=function(a,b,c){var d=this.buildDataQuery(a,n.DataQueryOperations.UserSetPassword);return this.processDataQuery(d,b,c)},b.prototype._linkWithProvider=function(a,b,c,d){var e=this.buildDataQuery({additionalOptions:{id:b},data:a},n.DataQueryOperations.UserLinkWithProvider);return this.processDataQuery(e,c,d)},b.prototype._unlinkFromProvider=function(a,b,c,d){var e=this.buildDataQuery({additionalOptions:{userId:b},data:{Provider:a}},n.DataQueryOperations.UserUnlinkFromProvider);return this.processDataQuery(e,c,d)},b}(m["default"]);c["default"]=o},{"../../everlive/EverliveError":58,"../../everlive/constants":70,"../../everlive/types/Data":110,"../../everlive/utils":121,underscore:36}],113:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var f=a("underscore"),g=d(f),h=a("../../../everlive/utils"),i=d(h),j=a("../../../everlive/EverliveError"),k=function(){function a(){e(this,a)}return a.prototype.processDataQuery=function(a,b,c,d){var e=c.sdk._isOfflineStorageEnabled();a.useOffline=e?!c.sdk.isOnline():!1;var f=c.sdk.setup.caching===!0||c.sdk.setup.caching&&c.sdk.setup.caching.enabled,h=i["default"].isQuerySupportedOffline(a);return c.options&&(a=g["default"].extend(a,c.options)),a.useCache=f&&!a.isSync&&h,a.applyOffline=void 0!==a.applyOffline?a.applyOffline:e||a.useCache,!a.useCache&&a.forceCache?b.error(new j.EverliveError(j.EverliveErrors.cannotForceCacheWhenDisabled)):(c.options=null,b.next(d))},a}();c["default"]=k},{"../../../everlive/EverliveError":58,"../../../everlive/utils":121,underscore:36}],114:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var f=a("../../../everlive/EverliveError"),g=a("../../../everlive/dataQuery/DataQuery"),h=a("../../../everlive/utils"),i=d(h),j=(a("underscore"),a("../../../common/platform")),k=d(j),l=function(){function a(){e(this,a)}return a.prototype.processDataQuery=function(a,b,c,d){if(!a.isSync&&c.offlineStorage&&c.offlineStorage.isSynchronizing()){var e=new f.EverliveError(f.EverliveErrors.syncInProgress);return b.error(e)}if(i["default"].isContentType.files(c.collectionName)&&k["default"].isDesktop){var h=a.operation;if(a.useOffline&&a.applyOffline&&(h===g.operations.Create||h===g.operations.Update)){var j=new f.EverliveError(f.EverliveErrors.filesNotSupportedInBrowser);return b.error(j)}}return b.next(d)},a}();c["default"]=l},{"../../../common/platform":51,"../../../everlive/EverliveError":58,"../../../everlive/dataQuery/DataQuery":71,"../../../everlive/utils":121,underscore:36}],115:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var f=a("underscore"),g=d(f),h=a("../../../everlive/utils"),i=d(h),j=a("../../../everlive/EverliveError"),k=function(){function a(){e(this,a)}return a.prototype.processDataQuery=function(a,b,c,d){if(!a.skipAuth&&c.sdk.authentication&&c.sdk.authentication.isAuthenticationInProgress()){if(b.prependOnceListener("error",function(e,f){var k=h.parseUtilities.parseErrorOrResponse(e);if(k&&(k.code===j.EverliveErrors.invalidToken.code||k.code===j.EverliveErrors.expiredToken.code)){f.cancel();var l=c.sdk.authentication._ensureAuthentication();if(a.noRetry)return b.next(d);l.then(function(){if(a.headers&&a.headers.authorization){var d=i["default"].buildAuthHeader(c.sdk.setup);g["default"].extend(a.headers,d)}return b.restart()})}}),c.sdk.authentication.isAuthenticating()){var e=c.sdk.authentication._ensureAuthentication();return a.noRetry||e.then(function(){return b.restart()}),e}return b.next(d)}return b.next(d)},a}();c["default"]=k},{"../../../everlive/EverliveError":58,"../../../everlive/utils":121,underscore:36}],116:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=a("../../../everlive/constants"),f=a("../../../everlive/services/RequestService"),g=function(){function a(){d(this,a)}return a.prototype.processDataQuery=function(a,b,c,d){var g=a.operation;if(g!==e.DataQueryOperations.InvokeCloudFunction&&g!==e.DataQueryOperations.InvokeStoredProcedure)return b.next(d);var h=f.RequestService.buildRequest(a,c);return h.send().then(function(a){return b.end(a)})["catch"](function(a){return b.error(a)})},a}();c["default"]=g},{"../../../everlive/constants":70,"../../../everlive/services/RequestService":105}],117:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=a("../../../everlive/services/RequestService"),f=function(){function a(){d(this,a)}return a.prototype.processDataQuery=function(a,b,c,d){return!a.useCache||a.useCache&&a.canUseOffline?b.next(d):this._cacheDataQuery(a,c).then(function(a){return b.next(a||d)},function(a){return b.error(a)})},a.prototype._cacheDataQuery=function(a,b){var c=b.sdk.cache._shouldSkipCache(a);if(c){if(a.ignoreCache&&!b.sdk.cache.isQueryUnsupportedOffline(a)){var d=b.sdk.cache._getHashForQuery(a);return b.sdk.cache._cacheQuery(a,d,b)}return e.RequestService.handleRequestProcessing(a,b)}return a.useCache=!1,b.sdk.cache._processCacheItem(a,b)},a}();c["default"]=f},{"../../../everlive/services/RequestService":105}],118:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=a("underscore"),f=a("../../../everlive/constants"),g=f.DataQueryOperations,h=f.Events,i=a("../../../everlive/query/EventQuery"),j=[g.Count,g.Read,g.Create,g.Update,g.UpdateById,g.Delete,g.DeleteById,g.ReadById,g.Aggregate,g.RawUpdate],k=function(){function a(){d(this,a)}return a.prototype.processDataQuery=function(a,b,c,d){if(e.contains(j,a.operation)){var f=i.fromDataQuery(a);if(c.sdk._emitter.emit(h.BeforeExecute,f),f.isCancelled())return b.cancel();a.applyEventQuery(f)}return b.next(d)},a}();c["default"]=k},{"../../../everlive/constants":70,"../../../everlive/query/EventQuery":95,underscore:36}],119:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=a("../../../everlive/EverliveError"),f=function(){function a(){d(this,a)}return a.prototype.processDataQuery=function(a,b,c,d){if(!a.canUseOffline)return b.next(d);if(a.applyOffline)return c.offlineStorage.processQuery(a).then(function(){return b.next.apply(b,arguments)},function(a){return a.code||(a=new e.EverliveError(a.message,e.EverliveErrors.generalDatabaseError.code)),b.error(a)});var f=new e.EverliveError("The applyOffline must be true when working offline.");return b.error(f)},a}();c["default"]=f},{"../../../everlive/EverliveError":58}],120:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=a("../../../everlive/services/RequestService"),f=(a("../../../everlive/EverliveError"),function(){function a(){d(this,a)}return a.prototype.processDataQuery=function(a,b,c,d){return a.canUseOffline||a.useCache?b.next(d):e.RequestService.handleRequestProcessing(a,c).then(function(a){return b.next(a||d)},function(a){return b.error(a)})},a}());c["default"]=f},{"../../../everlive/EverliveError":58,"../../../everlive/services/RequestService":105}],121:[function(a,b){"use strict";function c(a){return a&&a.__esModule?a:{"default":a}}var d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol?"symbol":typeof a},e=a("underscore"),f=c(e),g=a("../everlive/everlive.platform"),h=c(g),i=a("path"),j=c(i),k=a("../everlive/constants"),l=c(k),m=a("../common/utils"),n=c(m),o=f["default"].deepExtend({},n["default"]);o.normalizeKeys=function(a){var b={};return f["default"].each(a,function(a,c){var d=c.toLowerCase();b.hasOwnProperty(d)||(b[d]=a)}),b},o.buildAuthHeader=function(a,b){var c=null;return b&&b.authHeaders===!1?c:(a.token?c=(a.tokenType||"bearer")+" "+a.token:a.masterKey&&(c="masterkey "+a.masterKey),c?{authorization:c}:null)},o.DeviceRegistrationResult=function(a){this.token=a},o.buildUrl=function(a){var b="";return"string"==typeof a.scheme&&(b+=a.scheme+":"),b+=a.url,a.appId&&(b+=a.appId+"/"),b},o.getDbOperators=function(a,b){var c=[];if("string"==typeof a||"number"==typeof a)return c;var e=Object.keys(a||{});return f["default"].each(e,function(e){0===e.indexOf("$")?c.push(e):"object"!==d(a[e])||b||(c=c.concat(o.getDbOperators(a[e])))}),c},o.disableRequestCache=function(a,b){if("GET"===b){var c=(new Date).getTime(),d=a.indexOf("?")>-1?"&":"?";a+=d+"_el="+c}return a};var p=["$geoWithin","$geoIntersects","$near","$within","$nearSphere"];o.getUnsupportedOperators=function(a){var b=o.getDbOperators(a);return f["default"].intersection(b,p)},o.isQuerySupportedOffline=function(a){var b=a.getQueryParameters(),c=!f["default"].isEmptyObject(b.expand),d=o.getUnsupportedOperators(b.filter),e=0!==d.length,g=c||e;return!g},o.b64toBlob=function(a,b,c){b=b||"",c=c||512;for(var d=atob(a),e=[],f=0;f<d.length;f+=c){for(var g=d.slice(f,f+c),h=new Array(g.length),i=0;i<g.length;i++)h[i]=g.charCodeAt(i);var j=new Uint8Array(h);e.push(j)}var k=new Blob(e,{type:b});return k},o.arrayBufferToBase64=function(a){for(var b="",c=new Uint8Array(a),d=c.byteLength,e=0;d>e;e++)b+=String.fromCharCode(c[e]);return btoa(b)},o.transformPlatformPath=function(a){return a?(h["default"].isWindowsPhone?"/"===a.charAt(0)&&"/"!==a.charAt(1)&&(a="/"+a):-1!==a.indexOf("file:/")&&-1===a.indexOf("file:///")&&(a=a.replace("file:/","file:///")),a):""},o._stringCompare=function(a,b){return a.toLowerCase()===b},o.isContentType={files:function(a){return o._stringCompare(a,"files")},users:function(a){return o._stringCompare(a,"users")},pushNotifications:function(a){return o._stringCompare(a,l["default"].Push.NotificationsType.toLowerCase())},pushDevices:function(a){return o._stringCompare(a,l["default"].Push.DevicesType.toLowerCase())}},o.isElement={_isElement:function(a,b){var c=a;return"string"!=typeof c&&a instanceof HTMLElement&&(c=a.tagName),o._stringCompare(c,b)},image:function(a){return o.isElement._isElement(a,"img")},anchor:function(a){return o.isElement._isElement(a,"a")}},o.joinPath=function(){var a=[].slice.apply(arguments).map(function(a){return a||""}),b=j["default"].join.apply(j["default"],a);return o.transformPlatformPath(b)},o.getId=function(a){return a.Id||a._id||a.id},o._inAppBuilderSimulator=function(){return"undefined"!=typeof window&&window.navigator&&window.navigator.simulator},o.isValidId=function(a){var b="string"==typeof a&&""!==a,c="number"==typeof a&&!f["default"].isNaN(a);return b||c},o.modelHasValidId=function(a){var b="object"===("undefined"==typeof a?"undefined":d(a))&&null!==a?a.Id:a;return o.isValidId(b)},o.callbackAndPromiseErrorResponse=function(a,b){return b=b||f["default"].noop,b(a),o.rejectedPromise(a)},o.toQueryString=function(a){var b="",c=encodeURIComponent,d=function(a,d){b+=c(a)+"="+c(d)+"&"};if(f["default"].isArray(a))for(var e=0;a&&e<a.length;e++)d(a[e].name,a[e].value);else for(var g in a)if(a.hasOwnProperty(g)){var h=a[g];if(f["default"].isArray(h))for(e=0;e<h.length;e++)d(g,h[e]);else d(g,a[g])}return b.replace(/&$/,"").replace(/%20/g,"+")},o.lazyRequire=function(b,c){c=c||b;var d={};return Object.defineProperty(d,c,{get:function(){return a(b)}}),d},b.exports=o},{"../common/utils":54,"../everlive/constants":70,"../everlive/everlive.platform":74,path:4,underscore:36}],122:[function(a,b){"use strict";function c(a){return a&&a.__esModule?a:{"default":a}}a("./common/index");var d=a("./everlive/index"),e=c(d);b.exports=e["default"]},{"./common/index":46,"./everlive/index":79}],123:[function(a,b){"use strict";function c(a){var b;if(a.hasOwnProperty("count"))b={$sum:1};else if(a.min)b={$min:"$"+a.min};else if(a.max)b={$max:"$"+a.max};else if(a.avg)b={$avg:"$"+a.avg};else{if(!a.sum)throw new Error("The aggregating function was not recognized or is not supported: "+JSON.stringify(a));b={$sum:"$"+a.sum}}return b}function d(a,b,c){b[a]="$"+a,c[a]="$_id."+a}var e={};e.translate=function(a,b){var e,f,g;b=b||{},a.Filter&&(e=a.Filter);var h,i=a.GroupBy;if(i)if(g={_id:0},h={},Array.isArray(i))for(var j=i,k=0;k<j.length;k++){var l=j[k];d(l,h,g)}else{var l=i;d(l,h,g)}else h=null,g={_id:0};f={_id:h};var a=a.Aggregate;if(a)for(var m in a)if(a.hasOwnProperty(m)){var n=a[m];f[m]=c(n),g[m]=1}var o=[];return e&&o.push({$match:e}),b.maxDocumentsCount&&o.push({$limit:b.maxDocumentsCount}),f&&o.push({$group:f}),g&&o.push({$project:g}),o},b.exports=e},{}],124:[function(a,b){"use strict";var c={};c.DefaultTakeItemsCount=50,c.ExpandExpressionName="Expand",c.ReturnAsFieldName="ReturnAs",c.FieldsExpressionName="Fields",c.SingleFieldExpressionName="SingleField",c.SortExpressionName="Sort",c.FilterExpressionName="Filter",c.SkipExpressionName="Skip",c.TakeExpressionName="Take",c.ParentRelationFieldName="ParentRelationField",c.IdFieldNameClient="Id",c.TargetTypeNameFieldName="TargetTypeName",c.ReturnItemsCountFieldName="ReturnItemsCount",c.AggregateExpressionFieldName="Aggregate",b.exports=c},{}],125:[function(a,b){"use strict";var c=a("./Constants"),d=function(a,b){var c="";a&&(c=a.path),this.parent=c,this.relations=[b.path],this.name=b.path,this.targetTypeName=b.targetTypeName,this.canAddOtherRelations=!(b.filterExpression||b.sortExpression||b.aggregateExpression||b.take||b.skip),this.children=[];var d="";c&&(d+=c+"."),d+=b.targetTypeName,this.path=d};d.prototype._insertRelationNode=function(a){this.relations.push(a.path)},d.prototype._insertChildNode=function(a){this.children.push(a.name)},d.prototype.canCombineWithRelation=function(a){return this.canAddOtherRelations?!(this.targetTypeName!==a.targetTypeName||a.filterExpression||a.sortExpression||a.aggregateExpression||a.take||a.skip):!1};var e=function(a){this._relationTree=a,this._map={}};e.prototype.addExecutionNode=function(a){this._map[a.name]=a},e.prototype.getExecutionNodeOfRelation=function(a){for(var b in this._map)if(this._map.hasOwnProperty(b)&&this._map[b].relations.indexOf(a)>-1)return this._map[b];return null},e.prototype.getRelationTree=function(){return this._relationTree},e.prototype.getRelationNode=function(a){return a?this._relationTree.map[a]||null:null},e.prototype.getRootRelationNode=function(){return this._relationTree.map[this._relationTree.map.$root]||null},e.prototype.getRootNode=function(){var a=this._map,b=null;for(var c in a)if(a.hasOwnProperty(c)&&""===a[c].parent){b=a[c];break}return b},e.prototype.getNode=function(a){return this._map[a]},e.prototype.build=function(){var a=this.getRelationNode(this._relationTree.map.$root),b=new d(null,a);this.addExecutionNode(b),this.buildInternal(a)},e.prototype.buildInternal=function(a){a.children.forEach(function(a){var b=this.getRelationNode(a);this.insertRelationNodeInExecutionTree(b),this.buildInternal(b)},this)},e.prototype.insertRelationNodeInExecutionTree=function(a){var b=this.getExecutionNodeOfRelation(a.parentPath),c=this.tryGetChildNodeToCombine(b,a);if(c)c._insertRelationNode(a);else{var e=new d(b,a);b._insertChildNode(e),this.addExecutionNode(e)}},e.prototype.tryGetChildNodeToCombine=function(a,b){if(a.canCombineWithRelation(b))return a;for(var c=a.children,d=0;d<c.length;d++){var e=this._map[c[d]],f=this.tryGetChildNodeToCombine(e,b);if(f)return f}return null},e.prototype.getFilterFromExecutionNode=function(a,b){for(var c={},d=[],e=0;e<a.relations.length;e++){var f=this.getFilterFromSingleRelation(this._relationTree.map[a.relations[e]],b);f&&d.push(f)}return d.length>1?c.$or=d:c=d.length>0?d[0]:null,c},e.prototype.getFilterFromSingleRelation=function(a,b){var d=a.filterExpression,e={},f=this.getRelationFieldValues(a,b),g=a.isInvertedRelation?a.relationField:c.IdFieldNameClient;if(!(f.length>0))return null;if(e[g]={$in:f},void 0!==d){var h=[];return h.push(e),h.push(d),{$and:h}}return e},e.prototype.getRelationFieldValues=function(a,b){var c=[],d=this._relationTree.map[a.parentPath],e=Array.isArray(d.result)?d.result:[d.result];if(a.isInvertedRelation)for(var f=0;f<e.length;f++)c.push(e[f][a.parentRelationField]);else if(d&&d.result){a.parentRelationIds=a.parentRelationIds||{};for(var g=0;g<e.length;g++){var h=e[g],i=h[a.relationField];if(Array.isArray(i)){if(a.hasArrayValues=!0,b)for(var j=0;j<i.length;j++){var k=i[j];void 0!==k&&null!==k&&(c.push(k),a.parentRelationIds[k]=1)}}else void 0!==i&&null!==i&&(c.push(i),a.parentRelationIds[i]=1)}}return c},b.exports=e},{"./Constants":124}],126:[function(a,b){"use strict";function c(a){this.name="ExpandError",this.message=a,this.stack=(new Error).stack}c.prototype=new Error,b.exports=c},{}],127:[function(a,b){"use strict";function c(a){this._executionNodeFunction=a.executionNodeFunction,this._metadataProviderFunction=a.metadataProviderFunction}var d=a("async"),e=a("./RelationTreeBuilder"),f=a("./ExecutionTree"),g=a("./Constants"),h=a("./ExpandError");c.prototype._createExecuteNodeExecutor=function(a,b,c,f){var g=this;return function(i){var j=b.getRelationNode(c.relations[0]),k=b.getRelationNode(j.parentPath),l=!(k.parentPath&&k.hasArrayValues),m=b.getFilterFromExecutionNode(c,l),n=e.validateSingleRelation(j);if(n)return i(new h(n));var o={};o.select=j.fieldsExpression,o.sort=j.sortExpression,o.skip=j.skip,o.take=j.take,o.filter=m,o.targetTypeName=j.targetTypeName,o.returnItemsCount=j.returnItemsCount,o.aggregate=j.aggregateExpression,g._executionNodeFunction.call(null,o,f,function(e,h){if(e)return i(e);for(var j,k=0;k<c.relations.length;k++)j=b.getRelationNode(c.relations[k]),j.result=g._extractResultForRelation(j,h);c.result=j.result;for(var l=[],m=0;m<c.children.length;m++){var n=b._map;l.push(g._createExecuteNodeExecutor(a,b,n[c.children[m]],f))}d.parallel(l,i)})}},c.prototype._getSingleResult=function(a,b,c,d){if(!c)return null;var e,f;if(b.singleFieldName)return b.children&&b.children.length>0?(e=a[b.children[0]],f=this._getObjectByIdFromArray(e.result,c[b.singleFieldName]),this._getSingleResult(a,e,f,0)):c[b.singleFieldName];var g={},h={};if(b.children&&b.children.length>0)for(var i=0;i<b.children.length;i++){e=a[b.children[i]];var j=e.relationField,k=e.userDefinedName;e.isInvertedRelation||j!==k||(h[j]=1);var l=e.result;if(e.isInvertedRelation)if(e.aggregateExpression)g[k]=l[d];else if(e.returnItemsCount)g[k]=l;else for(var m=0;m<l.length;m++){var n=this._getSingleResult(a,e,l[m],m);n&&(g[k]=g[k]||[],Array.isArray(b.result)?n[e.relationField]===c.Id&&g[k].push(n):g[k].push(n))}else if(g[k]=e.isArray()?[]:null,c[j])if(Array.isArray(c[j]))if(e.aggregateExpression)g[k]=l[d];else if(e.sortExpression)for(var o=0;o<l.length;o++)c[j].indexOf(l[o].Id)>-1&&(f=l[o],this._addSingleResultToParentArray(a,e,f,g,k));else for(var p=0;p<c[j].length;p++)f=this._getObjectByIdFromArray(l,c[j][p]),this._addSingleResultToParentArray(a,e,f,g,k);else f=this._getObjectByIdFromArray(l,c[j]),g[k]=this._getSingleResult(a,e,f,0)}for(var q in c)if(c.hasOwnProperty(q)){var r=!h[q]&&this._fieldExistInFieldsExpression(q,b.originalFieldsExpression);r&&(g[q]=c[q])}return g},c.prototype._addSingleResultToParentArray=function(a,b,c,d,e){var f=this._getSingleResult(a,b,c,0);d[e]=d[e]||[],f&&d[e].push(f)},c.prototype._fieldExistInFieldsExpression=function(a,b){if(void 0===b||0===Object.keys(b).length)return!0;if(a===g.IdFieldNameClient)return void 0===b[a]?!0:b[a];var c=e.getIsFieldsExpressionExclusive(b);return void 0===c?!0:c?!b.hasOwnProperty(a):b.hasOwnProperty(a)},c.prototype._extractResultForRelation=function(a,b){if(a.returnItemsCount||a.aggregateExpression)return b;for(var c=[],d=0;d<b.length;d++)a.parentRelationIds&&a.parentRelationIds.hasOwnProperty(b[d].Id)&&c.push(b[d]),a.isInvertedRelation&&c.push(b[d]);return c},c.prototype._getObjectByIdFromArray=function(a,b){if(a)for(var c=0;c<a.length;c++)if(a[c].Id===b)return a[c];return null},c.prototype.prepare=function(a,b,c,d,f,g,h){var i=new e(a,b,c,d,f,this._metadataProviderFunction,g);i.build(function(a,b){var c;if(b){c=b[b.$root].fieldsExpression;var d={relationsTree:i,mainQueryFieldsExpression:c}}h(a,d)})},c.prototype.expand=function(a,b,c,g){var i=a.map,j=this,k=new f(a);k.build(),i[i.$root].result=b;var l=(k._map,k.getRootNode());if(l){var m=this._getExecutionList(k,l,c),n=25;m.length>n&&g(new h("Expand expression results in more than "+n+" inner queries!")),d.forEachSeries(m,function(b,d){var f=b.executeOptions,g=b.relationNode;j._adjustFilterForExecuteDefinition(k,b);var i=e.validateSingleRelation(g,a);return i?d(new h(i)):void j._executionNodeFunction.call(null,f,c,function(a,c){if(a)return d(a);var e;if(b.dataItem)e=j._extractResultForRelation(g,c),g.result||(g.result=[]),g.result.push(e);else{for(var f,h=b.executionNode,i=0;i<h.relations.length;i++)f=k.getRelationNode(h.relations[i]),f.result=j._extractResultForRelation(f,c);h.result=f.result}d()})},function(a){if(a)g(a);else{var c,d=i[i.$root];if(Array.isArray(b)){c=[];for(var e=0;e<b.length;e++){var f=j._getSingleResult(i,d,b[e],e);f&&c.push(f)}}else c=j._getSingleResult(i,d,b,0);g(null,c)}})}},c.prototype._getExecutionList=function(a,b,c){for(var d=a.getRelationTree(),e=a.getRelationNode(b.name),f=e.result,g=[],h=0;h<b.children.length;h++){var i,j=b.children[h],k=a.getNode(j),l=a.getRelationNode(j);if(l.aggregateExpression){var f=f;Array.isArray(f)||(f=[f]);for(var m=0;m<f.length;m++)i=this._getExecuteDefinitionForItem(f[m],l,d,c),g.push(i)}else i=this._getExecuteDefinitionForNode(a,k,c),g.push(i);var n=this._getExecutionList(a,k,c);g=g.concat(n)}return g},c.prototype._adjustFilterForExecuteDefinition=function(a,b){var c,d=b.relationNode;if(b.dataItem)c=this._getFilterFromSingleItem(b.dataItem,d);else{var e=b.executionNode,f=a.getRelationNode(d.parentPath),g=!(f.parentPath&&f.hasArrayValues);c=a.getFilterFromExecutionNode(e,g)}b.executeOptions.filter=c},c.prototype._getExecuteDefinitionForItem=function(a,b){var c={};return c.select=b.fieldsExpression,c.sort=b.sortExpression,c.skip=b.skip,c.take=b.take,c.targetTypeName=b.targetTypeName,c.returnItemsCount=b.returnItemsCount,c.aggregate=b.aggregateExpression,{executeOptions:c,relationNode:b,dataItem:a}},c.prototype._getExecuteDefinitionForNode=function(a,b){var c=a.getRelationNode(b.relations[0]),d={};return d.select=c.fieldsExpression,d.sort=c.sortExpression,d.skip=c.skip,d.take=c.take,d.targetTypeName=c.targetTypeName,d.returnItemsCount=c.returnItemsCount,d.aggregate=c.aggregateExpression,{executeOptions:d,relationNode:c,executionNode:b}},c.prototype._getFilterFromSingleItem=function(a,b){var c,d=b.filterExpression,e=b.relationField;if(b.isInvertedRelation)c={},c[b.relationField]=a.Id;else{var f=a[e];f&&(c=Array.isArray(f)?{Id:{$in:f}}:{Id:f})}return c&&d?{$and:[c,d]}:c?c:d?d:null},c.Constants=g,b.exports=c},{"./Constants":124,"./ExecutionTree":125,"./ExpandError":126,"./RelationTreeBuilder":129,async:1}],128:[function(a,b){"use strict";function c(a){this.parentPath=a.parent,this.relationField=a.relationField,this.path=a.path||a.parent+"."+a.relationField,this.fieldsExpression=a.fieldsExpression||{},this.targetTypeName=a.targetTypeName,this.children=[],this.isInvertedRelation=a.isInvertedRelation,
this.isArrayRoot=a.isArrayRoot,this.hasArrayValues=!1;var b=a.expandExpression||{};this.parentRelationField=b[d.ParentRelationFieldName]||d.IdFieldNameClient;var c=this.isInvertedRelation?this.path:this.relationField;this.userDefinedName=b[d.ReturnAsFieldName]||c,e.extend(this.fieldsExpression,b[d.FieldsExpressionName]),this.originalFieldsExpression={},e.extend(this.originalFieldsExpression,this.fieldsExpression),this.singleFieldName=b[d.SingleFieldExpressionName],this.filterExpression=b[d.FilterExpressionName],this.sortExpression=b[d.SortExpressionName],this.skip=b[d.SkipExpressionName],this.take=this._getTakeLimit(b[d.TakeExpressionName],a.maxTakeValue),this.returnItemsCount=b[d.ReturnItemsCountFieldName],this.aggregateExpression=b[d.AggregateExpressionFieldName]}var d=a("./Constants"),e=a("underscore"),f=a("./ExpandError");c.prototype._getTakeLimit=function(a,b){if(b=b||d.DefaultTakeItemsCount,a){if(a>b)throw new f("The maximum allowed take value when expanding relations is "+b+"!");return a}return b},c.prototype.setIsArrayFromMetadata=function(){this.isArrayFromMetadata=!0},c.prototype.isArray=function(){return this.isArrayFromMetadata||this.isInvertedRelation||this.hasArrayValues},c.createInverted=function(a,b,d,e){var f=a.split("."),g=f[0],h=f[1];return c._create(a,g,h,d,e,b,!0)},c.createRegular=function(a,b,e,f){var g=e+"."+a,h=b[d.TargetTypeNameFieldName];return c._create(g,h,a,e,f,b,!1)},c._create=function(a,b,d,e,f,g,h){var i={};return i.parent=e,i.path=a,i.maxTakeValue=f,i.validated=!1,i.expandExpression=g,i.relationField=d,i.targetTypeName=b,i.isInvertedRelation=h,new c(i)},b.exports=c},{"./Constants":124,"./ExpandError":126,underscore:36}],129:[function(a,b){"use strict";var c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol?"symbol":typeof a},d=a("./RelationNode"),e=a("underscore"),f=a("./Constants"),g=a("./ExpandError"),h=[f.ExpandExpressionName,f.ReturnAsFieldName,f.FieldsExpressionName,f.SingleFieldExpressionName,f.SortExpressionName,f.FilterExpressionName,f.SkipExpressionName,f.TakeExpressionName,f.ParentRelationFieldName,f.TargetTypeNameFieldName,f.ReturnItemsCountFieldName,f.AggregateExpressionFieldName],i=function(a,b,c,f,g,h,i){this.maxTakeValue=g,this._metadataProviderFunction=h,this.context=i,this.expandExpression=this._processExpandExpression(a),this.map={},this.map[b]=new d({targetTypeName:b,isArrayRoot:c,fieldsExpression:f,validated:!0,path:b,maxTakeValue:g}),this.map[b].originalFieldsExpression={},e.extend(this.map[b].originalFieldsExpression,f),this.map.$root=b};i.prototype._processExpandExpression=function(a){for(var b in a)if(a.hasOwnProperty(b)&&("boolean"==typeof a[b]&&(a[b]={},a[b][f.ReturnAsFieldName]=b),"string"==typeof a[b])){var c=a[b];a[b]={},a[b][f.ReturnAsFieldName]=c}return a},i.prototype.build=function(b){try{this.buildMapInternal(this.expandExpression,this.map.$root)}catch(c){return b(c)}var d=this;a("async").series([this.configureRelationTree.bind(this),this.validateRelationTree.bind(this)],function(a){b(a,d.map)})},i.prototype.buildMapInternal=function(a,b){for(var e in a)if(a.hasOwnProperty(e)){var j=a[e];for(var k in j)if(j.hasOwnProperty(k)&&-1===h.indexOf(k))throw new g('"'+k+'" is not a valid option for Expand expression');if(e.indexOf(".")>-1){var l=d.createInverted(e,j,b,this.maxTakeValue);if(this.map[l.path]=l,this.map[b].children.push(l.path),i.addFieldToFieldsExpression(this.map[l.parentPath].originalFieldsExpression,l.userDefinedName),a[e][f.ExpandExpressionName]){var m=this._processExpandExpression(a[e][f.ExpandExpressionName]);this.buildMapInternal(m,l.path)}}else{var n=d.createRegular(e,j,b,this.maxTakeValue);if(this.map[n.path]=n,this.map[b].children.push(n.path),j.hasOwnProperty(f.ExpandExpressionName)){if("object"!==c(j[f.ExpandExpressionName]))throw new g(n.path+".Expand must be a valid expand expression!");this.buildMapInternal(this._processExpandExpression(j.Expand),n.path)}}}},i.prototype.configureRelationTree=function(a){if(!this._metadataProviderFunction)return a();var b=[];for(var c in this.map)this.map.hasOwnProperty(c)&&null!==this.map[c].parentPath&&b.push(this.map[c].relationField);this._metadataProviderFunction(b,this.map,this.context,function(b){a(b)})},i.prototype.validateRelationTree=function(a){var b="",c="\r\n";for(var d in this.map)if("$root"!==d&&this.map.hasOwnProperty(d)){var e=this.map[d];b+=i.validateSingleRelation(e,this),this.configureFieldsExpressionsForRelation(e)}if(""!==b){var f=b.substr(0,b.lastIndexOf(c)),h=new g(f);return a(h)}a()},i.prototype.configureFieldsExpressionsForRelation=function(a){if(a.parentPath){var b=this.map[a.parentPath].fieldsExpression;a.isInvertedRelation?i.addFieldToFieldsExpression(b,a.parentRelationField):i.addFieldToFieldsExpression(b,a.relationField)}a.isInvertedRelation?i.addFieldToFieldsExpression(a.fieldsExpression,a.relationField):i.addFieldToFieldsExpression(a.fieldsExpression,f.IdFieldNameClient),i.adjustParentRelationFieldsExpression(this.map[a.parentPath],a)},i.validateSingleRelation=function(a,b){var c="",d=b.map,e=d[d.$root],f="\r\n",g=e.isArrayRoot;if(a.path===a.parentPath)return c+=a.path+" has same parent which will cause an infinite loop."+f;if(a.isArray()){var h=i._getParentMultipleRelationsCount(a,b);h>0&&(c+='Expand expression has multiple relation "'+a.path+'" inside a multiple relation.',c+=f),d[a.parentPath]===e&&g&&(a.filterExpression||a.sortExpression)&&(c+="Filter and Sort are not allowed when expanding multiple items.",c+=f),d[a.parentPath]===e&&g&&a.isInvertedRelation&&a.skip&&(c+="Skip and Take are not supported when expanding multiple items with external relation.",c+=f)}return a.targetTypeName||(c+='Expanding relation "'+a.relationField+'" has no target type name specified. You should use "TargetTypeName" to specify it.',c+=f),a.fieldsExpression&&Object.keys(a.fieldsExpression).length&&a.singleFieldName&&(c+=a.path+" ",c+='expand expression contains both "Fields" and "SingleField" expressions.',c+=f),a.singleFieldName&&a.children&&(a.children.length>1&&(c+=a.path+" has multiple expand expressions with a single field option."+f),1===a.children.length&&d[a.children[0]].relationField!==a.singleFieldName&&(c+="Expand expression "+a.path,c+=' single field "'+a.singleFieldName+'"',c+=' does not match child relation field "'+d[a.children[0]].relationField+'".',c+=f)),c},i._getParentMultipleRelationsCount=function(a,b){for(var c=0,d=a;d.parentPath;){var e=b.map[d.parentPath];e.isArray()&&e.parentPath&&(c+=1),d=e}return c},i.adjustParentRelationFieldsExpression=function(a,b){if(!b.isInvertedRelation&&b.take&&"number"==typeof b.take){var c=b.isArray()&&!b.filterExpression&&!b.sortExpression&&a;c&&(void 0===a.fieldsExpression&&(a.fieldsExpression={}),a.fieldsExpression[b.relationField]=b.skip&&"number"==typeof b.skip?{$slice:[b.skip,b.take]}:{$slice:b.take},b.take=null,b.skip=null,b.movedSkipTakeAsSlice=!0)}},i.addFieldToFieldsExpression=function(a,b){if(void 0!==a&&0!==Object.keys(a).length){var c=i.getIsFieldsExpressionExclusive(a);void 0!==c&&(c?delete a[b]:a[b]=1)}},i.getIsFieldsExpressionExclusive=function(a){var b;for(var d in a)if(d!==f.IdFieldNameClient&&a.hasOwnProperty(d)&&void 0===b){if(0===a[d]){b=!0;break}if("object"===c(a[d]))continue;b=!1;break}return b},b.exports=i},{"./Constants":124,"./ExpandError":126,"./RelationNode":128,async:1,underscore:36}]},{},[122])(122)});